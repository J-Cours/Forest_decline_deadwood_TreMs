---
title: "Study_deadwood_TreMs_dieback"
author: "J. Cours"
date: "21/09/2021"
output: html_document
---


#library
```{r}

library(car)
library(tidyverse)
library(fitdistrplus)
library(vegan)
library(indicspecies)
library(BBmisc)
library(Rmisc)
library(gganimate)
library(Rcpp)
library(FD)
library(glmmTMB)
library(DHARMa)
library(GLMMadaptive)
library(ade4)
library(mvabund)
library(lattice)
library(biclust)
library(betapart)
library(picante)
library(piecewiseSEM)
library(performance)
library(MuMIn)

library(gridExtra)
library(labdsv)
library(hypervolume)
library(psych)
library(StatMatch)
library(BAT)
library(ape)
library(emmeans)

# library(lme4)

```


#Bois mort
##Open Data
```{r data}

General <- readxl::read_xlsx("DATAFILE_ANALYSIS_DW.xlsx", sheet = "General")
General$cat_depe = factor(General$cat_depe, levels = c("Low", "Medium", "High"))
General$cat_depe01 = if_else(General$cat_depe == "Low",0,1)
General$class_depe_G = factor(General$class_depe_G, levels = c("[0 ; 10]", "[0 ; 15]", "]10 ; 40]", "]15 ; 40]", "]40 ; 70]", "]70 ; 100]", "Salvage"))

#Deadwood

##Data univar

Data_univar_All <- readxl::read_xlsx("DATAFILE_ANALYSIS_DW.xlsx", sheet = "Data_univar") %>%
  left_join(General, by = "plot") %>%
  filter(salvaged == 0)


##Data multivar

Data_id = readxl::read_xlsx("DATAFILE_ANALYSIS_DW.xlsx", sheet = "Data_id")
Data_id_multi = Data_id %>%
  column_to_rownames(var = "idtree") %>%
  dplyr::select(c("statut_quanti","stade_saprox_matchable"))
Data_id_multi_dead = Data_id %>%
  filter(statut_uni != "vivant") %>%
  column_to_rownames(var = "idtree") %>%
  dplyr::select(c("dbh","statut_quanti","stade_saprox_matchable","specie"))

Data_id_Pyr = Data_id %>%
  filter(Region %in% "Pyrenees")
Data_id_Bav = Data_id %>%
  filter(Region %in% "Bavaria")
Data_id_CVL = Data_id %>%
  filter(Region %in% "CVL")

Data_id_Pyr_dead = Data_id %>%
  filter(Region %in% "Pyrenees", statut_uni != "vivant")
Data_id_Bav_dead = Data_id %>%
  filter(Region %in% "Bavaria", statut_uni != "vivant")
Data_id_CVL_dead = Data_id %>%
  filter(Region %in% "CVL", statut_uni != "vivant")


#PlotxType

Data_type_Pyr = readxl::read_xlsx("DATAFILE_ANALYSIS_DW.xlsx", sheet = "Data_type_Pyr") %>%
  column_to_rownames(var = "Type")
Data_type_Pyr_dead = Data_type_Pyr[1:40,]
Data_type_Bav = readxl::read_xlsx("DATAFILE_ANALYSIS_DW.xlsx", sheet = "Data_type_Bav") %>%
  column_to_rownames(var = "Type")
Data_type_Bav_dead = Data_type_Bav[1:28,]
Data_type_CVL = readxl::read_xlsx("DATAFILE_ANALYSIS_DW.xlsx", sheet = "Data_type_CVL") %>%
  column_to_rownames(var = "Type")
Data_type_CVL_dead = Data_type_CVL[1:12,]

Data_type_All = readxl::read_xlsx("DATAFILE_ANALYSIS_DW.xlsx", sheet = "Data_type_All") %>%
  column_to_rownames(var = "Type")

Data_plotxtype_All = readxl::read_xlsx("DATAFILE_ANALYSIS_DW.xlsx", sheet = "Data_plotxtype_All") %>%
  column_to_rownames(var = "plot")
Data_plotxtype_All_dead = Data_plotxtype_All[1:52]

Data_plotxtype_Pyr = readxl::read_xlsx("DATAFILE_ANALYSIS_DW.xlsx", sheet = "Data_plotxtype_Pyr") %>%
  column_to_rownames(var = "plot")
Data_plotxtype_Pyr_dead = Data_plotxtype_Pyr[1:40]
Data_plotxtype_Pyr_dead = Data_plotxtype_Pyr_dead[rowSums(Data_plotxtype_Pyr_dead[])>0,]

Data_plotxtype_Bav = readxl::read_xlsx("DATAFILE_ANALYSIS_DW.xlsx", sheet = "Data_plotxtype_Bav") %>%
  column_to_rownames(var = "plot")
Data_plotxtype_Bav_dead = Data_plotxtype_Bav[1:28]
Data_plotxtype_Bav_dead = Data_plotxtype_Bav_dead[rowSums(Data_plotxtype_Bav_dead[])>0,]

Data_plotxtype_CVL = readxl::read_xlsx("DATAFILE_ANALYSIS_DW.xlsx", sheet = "Data_plotxtype_CVL") %>%
  column_to_rownames(var = "plot")
Data_plotxtype_CVL_dead = Data_plotxtype_CVL[1:12]
Data_plotxtype_CVL_dead = Data_plotxtype_CVL_dead[rowSums(Data_plotxtype_CVL_dead[])>0,]

#Randomized matrix plot x type
Random_plotxtype_Pyr <- randomizeMatrix(samp = Data_plotxtype_Pyr, null.model = c("independentswap"), iterations = 999)
Random_plotxtype_Bav <- randomizeMatrix(samp = Data_plotxtype_Bav, null.model = c("independentswap"), iterations = 999)
Random_plotxtype_CVL <- randomizeMatrix(samp = Data_plotxtype_CVL, null.model = c("independentswap"), iterations = 999)

Random_plotxtype_Pyr_dead <- randomizeMatrix(samp = Data_plotxtype_Pyr_dead, null.model = c("independentswap"), iterations = 999)
Random_plotxtype_Pyr_dead = Random_plotxtype_Pyr_dead[rowSums(Random_plotxtype_Pyr_dead[])>0,]
Random_plotxtype_Bav_dead <- randomizeMatrix(samp = Data_plotxtype_Bav_dead, null.model = c("independentswap"), iterations = 999)
Random_plotxtype_Bav_dead = Random_plotxtype_Bav_dead[rowSums(Random_plotxtype_Bav_dead[])>0,]
Random_plotxtype_CVL_dead <- randomizeMatrix(samp = Data_plotxtype_CVL_dead, null.model = c("independentswap"), iterations = 999)
Random_plotxtype_CVL_dead = Random_plotxtype_CVL_dead[rowSums(Random_plotxtype_CVL_dead[])>0,]




#PlotxID

Data_plotxID_All = readxl::read_xlsx("DATAFILE_ANALYSIS_DW.xlsx", sheet = "plotxID_All") %>%
  column_to_rownames(var = "plot")
# dd1 = Data_plotxID_All[,colSums(Data_plotxID_All) == 0]

Data_plotxID_Alldead = readxl::read_xlsx("DATAFILE_ANALYSIS_DW.xlsx", sheet = "plotxID_Alldead") %>%
  column_to_rownames(var = "plot")

Data_plotxID_Pyr = readxl::read_xlsx("DATAFILE_ANALYSIS_DW.xlsx", sheet = "plotxID_Pyr") %>%
  column_to_rownames(var = "plot")
Data_plotxID_Pyrdead = readxl::read_xlsx("DATAFILE_ANALYSIS_DW.xlsx", sheet = "plotxID_Pyrdead") %>%
  column_to_rownames(var = "plot")

Data_plotxID_CVL = readxl::read_xlsx("DATAFILE_ANALYSIS_DW.xlsx", sheet = "plotxID_CVL") %>%
  column_to_rownames(var = "plot")
Data_plotxID_CVLdead = readxl::read_xlsx("DATAFILE_ANALYSIS_DW.xlsx", sheet = "plotxID_CVLdead") %>%
  column_to_rownames(var = "plot")

Data_plotxID_Bav = readxl::read_xlsx("DATAFILE_ANALYSIS_DW.xlsx", sheet = "plotxID_Bav") %>%
  column_to_rownames(var = "plot")
Data_plotxID_Bavdead = readxl::read_xlsx("DATAFILE_ANALYSIS_DW.xlsx", sheet = "plotxID_Bavdead") %>%
  column_to_rownames(var = "plot")



```



##Data Preparation


###dbFD
```{r data preparation}


#Type

#Pyrenees

CWM_statut_Pyr <- dbFD(Data_type_Pyr["statut_quanti"], Data_plotxtype_Pyr, w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)

CWM_stade_saprox_Pyr <- dbFD(Data_type_Pyr_dead["stade_saprox_matchable"], Data_plotxtype_Pyr_dead, w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)

CWM_dbh_Pyr <- dbFD(Data_type_Pyr_dead["dbh"], Data_plotxtype_Pyr_dead, w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)


df_CWM_statut_Pyr <- CWM_statut_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_statut" = "statut_quanti")
df_CWM_stade_saprox_Pyr <- CWM_stade_saprox_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_stade_saprox" = "stade_saprox_matchable")
df_CWM_dbh_Pyr <- CWM_dbh_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_dbh" = "dbh")

df_FDis_statut_Pyr <- as.data.frame(CWM_statut_Pyr$FDis) %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("FDis_statut" = "CWM_statut_Pyr$FDis")
df_FDis_stade_saprox_Pyr <- as.data.frame(CWM_stade_saprox_Pyr$FDis) %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("FDis_stade_saprox" = "CWM_stade_saprox_Pyr$FDis")
df_FDis_dbh_Pyr <- as.data.frame(CWM_dbh_Pyr$FDis) %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("FDis_dbh" = "CWM_dbh_Pyr$FDis")

data_CWM_FDis_Pyr <- df_CWM_statut_Pyr %>%
  left_join(df_CWM_stade_saprox_Pyr, by = "plot") %>%
  left_join(df_CWM_dbh_Pyr, by = "plot") %>%
  left_join(df_FDis_statut_Pyr, by = "plot") %>%
  left_join(df_FDis_stade_saprox_Pyr, by = "plot") %>%
  left_join(df_FDis_dbh_Pyr, by = "plot")

data_CWM_FDis_Pyr[is.na(data_CWM_FDis_Pyr)] <- 0



#CVL

CWM_statut_CVL <- dbFD(Data_type_CVL["statut_quanti"], Data_plotxtype_CVL, w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)

CWM_stade_saprox_CVL <- dbFD(Data_type_CVL_dead["stade_saprox_matchable"], Data_plotxtype_CVL_dead, w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)

CWM_dbh_CVL <- dbFD(Data_type_CVL_dead["dbh"], Data_plotxtype_CVL_dead, w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)


df_CWM_statut_CVL <- CWM_statut_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_statut" = "statut_quanti")
df_CWM_stade_saprox_CVL <- CWM_stade_saprox_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_stade_saprox" = "stade_saprox_matchable")
df_CWM_dbh_CVL <- CWM_dbh_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_dbh" = "dbh")

df_FDis_statut_CVL <- as.data.frame(CWM_statut_CVL$FDis) %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("FDis_statut" = "CWM_statut_CVL$FDis")
df_FDis_stade_saprox_CVL <- as.data.frame(CWM_stade_saprox_CVL$FDis) %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("FDis_stade_saprox" = "CWM_stade_saprox_CVL$FDis")
df_FDis_dbh_CVL <- as.data.frame(CWM_dbh_CVL$FDis) %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("FDis_dbh" = "CWM_dbh_CVL$FDis")

data_CWM_FDis_CVL <- df_CWM_statut_CVL %>%
  left_join(df_CWM_stade_saprox_CVL, by = "plot") %>%
  left_join(df_CWM_dbh_CVL, by = "plot") %>%
  left_join(df_FDis_statut_CVL, by = "plot") %>%
  left_join(df_FDis_stade_saprox_CVL, by = "plot") %>%
  left_join(df_FDis_dbh_CVL, by = "plot")

data_CWM_FDis_CVL[is.na(data_CWM_FDis_CVL)] <- 0



#Bavaria

CWM_statut_Bav <- dbFD(Data_type_Bav["statut_quanti"], Data_plotxtype_Bav, w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)

CWM_stade_saprox_Bav <- dbFD(Data_type_Bav_dead["stade_saprox_matchable"], Data_plotxtype_Bav_dead, w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)

CWM_dbh_Bav <- dbFD(Data_type_Bav_dead["dbh"], Data_plotxtype_Bav_dead, w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)


df_CWM_statut_Bav <- CWM_statut_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_statut" = "statut_quanti")
df_CWM_stade_saprox_Bav <- CWM_stade_saprox_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_stade_saprox" = "stade_saprox_matchable")
df_CWM_dbh_Bav <- CWM_dbh_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_dbh" = "dbh")

df_FDis_statut_Bav <- as.data.frame(CWM_statut_Bav$FDis) %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("FDis_statut" = "CWM_statut_Bav$FDis")
df_FDis_stade_saprox_Bav <- as.data.frame(CWM_stade_saprox_Bav$FDis) %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("FDis_stade_saprox" = "CWM_stade_saprox_Bav$FDis")
df_FDis_dbh_Bav <- as.data.frame(CWM_dbh_Bav$FDis) %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("FDis_dbh" = "CWM_dbh_Bav$FDis")

data_CWM_FDis_Bav <- df_CWM_statut_Bav %>%
  left_join(df_CWM_stade_saprox_Bav, by = "plot") %>%
  left_join(df_CWM_dbh_Bav, by = "plot") %>%
  left_join(df_FDis_statut_Bav, by = "plot") %>%
  left_join(df_FDis_stade_saprox_Bav, by = "plot") %>%
  left_join(df_FDis_dbh_Bav, by = "plot")

data_CWM_FDis_Bav[is.na(data_CWM_FDis_Bav)] <- 0



data_CWM_FDis = data_CWM_FDis_Pyr %>%
  union(data_CWM_FDis_CVL) %>%
  union(data_CWM_FDis_Bav)




## For overall composition (based on Type (1 type including several tree ID))

dbFD_Pyr = data.frame(dbFD(Data_type_Pyr[1:40,], Data_plotxtype_Pyr_dead[rowSums(Data_plotxtype_Pyr_dead[])>0,], w.abun = T, corr="lingoes", calc.FRic=T, calc.CWM=F))
# Random_dbFD_Pyr = data.frame(dbFD(Data_type_Pyr[1:40,], Random_plotxtype_Pyr_dead, w.abun = T, corr="lingoes", calc.FRic=T, calc.CWM=F))

dbFD_Bav = data.frame(dbFD(Data_type_Bav[1:28,], Data_plotxtype_Bav_dead[rowSums(Data_plotxtype_Bav_dead[])>0,], w.abun = T, corr="lingoes", calc.FRic=T, calc.CWM=F))
# Random_dbFD_Bav = data.frame(dbFD(Data_type_Bav[1:28,], Random_plotxtype_Bav_dead, w.abun = T, corr="lingoes", calc.FRic=T, calc.CWM=F))

dbFD_CVL = data.frame(dbFD(Data_type_CVL[1:12,], Data_plotxtype_CVL_dead[rowSums(Data_plotxtype_CVL_dead[])>0,], w.abun = T, corr="lingoes", calc.FRic=T, calc.CWM=F))
# Random_dbFD_CVL = data.frame(dbFD(Data_type_CVL[1:12,], Random_plotxtype_CVL_dead, w.abun = T, corr="lingoes", calc.FRic=T, calc.CWM=F))


# dbFD_Pyr = data.frame(dbFD(Data_type_Pyr, Data_plotxtype_Pyr, w.abun = T, corr="lingoes", calc.FRic=T, calc.CWM=F))
# dbFD_Bav = data.frame(dbFD(Data_type_Bav, Data_plotxtype_Bav, w.abun = T, corr="lingoes", calc.FRic=T, calc.CWM=F))
# dbFD_CVL = data.frame(dbFD(Data_type_CVL, Data_plotxtype_CVL, w.abun = T, corr="lingoes", calc.FRic=T, calc.CWM=F))


# dbFD_Pyr = data.frame(dbFD(column_to_rownames(Data_id_Pyr[c(1,6,7,8,11)], var = "idtree"), Data_plotxID_Pyr, w.abun = T, corr="lingoes", calc.FRic=T, calc.CWM=F))
# dbFD_Bav = data.frame(dbFD(column_to_rownames(Data_id_Bav_dead[c(1,6,7,8,11)], var = "idtree"), Data_plotxID_Bavdead, w.abun = T, corr="lingoes", calc.FRic=T, calc.CWM=F))
# dbFD_CVL = data.frame(dbFD(column_to_rownames(Data_id_CVL_dead[c(1,6,7,8,11)], var = "idtree"), Data_plotxID_CVLdead, w.abun = T, corr="lingoes", calc.FRic=T, calc.CWM=F))


df_dbFD_Pyr <- dbFD_Pyr %>%
  rownames_to_column(var = "plot") %>%
  dplyr::select(c("plot","FRic","FDiv","FEve","FDis"))

# %>%
#   left_join(dplyr::rename(dplyr::select(rownames_to_column(Random_dbFD_Pyr, var = "plot"), c("plot","FRic","FDiv","FEve")), "Random_FRic" = "FRic", "Random_FEve" = "FEve", "Random_FDiv" = "FDiv"), by = "plot") %>%
#   mutate(ses_FRic = (FRic - Random_FRic) / sd(na.omit(Random_dbFD_Pyr$FRic)),
#          ses_FEve = (FEve - Random_FEve) / sd(na.omit(Random_dbFD_Pyr$FEve)),
#          ses_FDiv = (FDiv - Random_FDiv) / sd(na.omit(Random_dbFD_Pyr$FDiv)))

df_dbFD_Bav <- as.data.frame(dbFD_Bav) %>%
  rownames_to_column(var = "plot") %>%
  dplyr::select(c("plot","FRic","FDiv","FEve","FDis"))

# %>%
#   left_join(dplyr::rename(dplyr::select(rownames_to_column(Random_dbFD_Bav, var = "plot"), c("plot","FRic","FDiv","FEve")), "Random_FRic" = "FRic", "Random_FEve" = "FEve", "Random_FDiv" = "FDiv"), by = "plot") %>%
#   mutate(ses_FRic = (FRic - Random_FRic) / sd(na.omit(Random_dbFD_Bav$FRic)),
#          ses_FEve = (FEve - Random_FEve) / sd(na.omit(Random_dbFD_Bav$FEve)),
#          ses_FDiv = (FDiv - Random_FDiv) / sd(na.omit(Random_dbFD_Bav$FDiv)))

df_dbFD_CVL <- as.data.frame(dbFD_CVL) %>%
  rownames_to_column(var = "plot") %>%
  dplyr::select(c("plot","FRic","FDiv","FEve","FDis"))

# %>%
#   left_join(dplyr::rename(dplyr::select(rownames_to_column(Random_dbFD_CVL, var = "plot"), c("plot","FRic","FDiv","FEve")), "Random_FRic" = "FRic", "Random_FEve" = "FEve", "Random_FDiv" = "FDiv"), by = "plot") %>%
#   mutate(ses_FRic = (FRic - Random_FRic) / sd(na.omit(Random_dbFD_CVL$FRic)),
#          ses_FEve = (FEve - Random_FEve) / sd(na.omit(Random_dbFD_CVL$FEve)),
#          ses_FDiv = (FDiv - Random_FDiv) / sd(na.omit(Random_dbFD_CVL$FDiv)))



df_dbFD = df_dbFD_Pyr %>%
  union(df_dbFD_Bav) %>%
  union(df_dbFD_CVL)

data_FRic_CWM_FDis = data_CWM_FDis %>%
  left_join(df_dbFD, by = "plot")

data_FRic_CWM_FDis[is.na(data_FRic_CWM_FDis)] <- 0

write.csv(data_FRic_CWM_FDis, file = "data_FRic_CWM_FDis_DW.csv", row.names = F)

# data_FRic_etc[is.na(data_FRic_etc)] <- 0



Data_univar_CWM = Data_univar_All %>%
  left_join(data_FRic_CWM_FDis, by = "plot")

summary(Data_univar_CWM$level_depe_G)
sd(Data_univar_CWM$level_depe_G)



# Data_univar_All_CWM = Data_univar_All %>%
#   left_join(data_FRic_CWM_FDis, by = "plot") %>%
#   filter(salvaged != 1)
# 
# Data_univar_All_CWM$cat_depe = factor(Data_univar_All_CWM$cat_depe, levels = c("Low","Medium","High"))

# Data_univar_level.depe = Data_univar_CWM %>%
#   filter(Region %in% c("Pyrenees","CVL"))
# Data_univar_Bav = Data_univar_CWM %>%
#   filter(Region %in% "Bavaria" & cat_depe != "salvaged")


# Data_univar_All_CWM_LH = Data_univar_All_CWM %>%
#   filter(cat_depe != "Medium")

# Data_univar_All_CWM_LH$cat_depe = factor(Data_univar_All_CWM_LH$cat_depe, levels = c("Low","High"))

Data_univar_Pyr = Data_univar_All %>%
  filter(Region %in% "Pyrenees")
summary(Data_univar_Pyr$DW_div_tot)


Data_univar_CVL = Data_univar_All %>%
  filter(Region %in% "CVL")
summary(Data_univar_CVL$DW_div_tot)



```



###BAT

####Pyrenees
```{r BAT Pyrenees}


BAT_DW_Pyr = rownames_to_column(Data_plotxtype_Pyr, var = "plot") %>%
  left_join(Data_univar_Pyr[c("plot", "cat_depe01", "salvaged")], by = "plot") %>%
  filter(salvaged == 0) %>%
  dplyr::select(-salvaged) %>%
  column_to_rownames(var = "plot")

cat_depe_Pyr = BAT_DW_Pyr$cat_depe01
BAT_DW_Pyr = dplyr::select(BAT_DW_Pyr, -cat_depe01)

Data_type_Pyr$specie = as.factor(Data_type_Pyr$specie)
BAT_traits_DW_Pyr = Data_type_Pyr


## Calculating the hypervolume for each plot

hv_Pyr_DW <- BAT::kernel.build(comm = as.matrix(BAT_DW_Pyr), trait = as.matrix(BAT_traits_DW_Pyr), 
                   abund = TRUE, #samples are abundances
                   method = "gaussian", 
                   axes = 4) #convert traits to PCoA axex


#############################
# and visualize the hypervolumes
hv_Pyr_DW_cat_depe_Low  <-  hypervolume_join(hv_Pyr_DW@HVList[cat_depe_Pyr == 0])
hv_Pyr_DW_cat_depe_High <-  hypervolume_join(hv_Pyr_DW@HVList[cat_depe_Pyr == 1])


#plot of all hypervolumes in Low dieback subplot
plot(hv_Pyr_DW_cat_depe_Low,
     show.3d=FALSE,
     show.random=TRUE,
     show.density=TRUE,
     show.data=TRUE,
     show.centroid=FALSE,
     cex.centroid=2,
     point.alpha.min=0.2, 
     point.dark.factor=0.7,
     cex.random=0.5,
     cex.data=1,
     contour.lwd=0.1,
     num.points.max.random = 1000,
     col= rep("#56B4E9",30),
     names=c("PCoA_1","PCoA_2","PCoA_3","PCoA_4"))

#plot of all hypervolumes in High dieback subplot
plot(hv_Pyr_DW_cat_depe_High,
     show.3d=FALSE,
     show.random=TRUE,
     show.density=TRUE,
     show.data=TRUE,
     show.centroid=FALSE,
     cex.centroid=2,
     point.alpha.min=0.2, 
     point.dark.factor=0.7,
     cex.random=0.5,
     cex.data=1,
     contour.lwd=0.1,
     num.points.max.random = 1000,
     col= rep("#E69F00",30),
     names=c("PCoA_1","PCoA_2","PCoA_3","PCoA_4"))


#############################
## Calculating the functional alpha diversity of each plot using the kernel.alpha function

kernel_richness_DW_Pyr <- kernel.alpha(comm = hv_Pyr_DW) # vector with richness value for each subplot

#storing results in a data.frame
results_BAT_DW_Pyr <- data.frame(cat_depe = cat_depe_Pyr,
                      Richness = kernel_richness_DW_Pyr)

summary(lm(Richness ~ cat_depe, data = results_BAT_DW_Pyr))


## Calculating the functional gamma diversity between community of the two types of plots
gamma_Pyr_DW_Low <- kernel.gamma(comm = hv_Pyr_DW_cat_depe_Low)
gamma_Pyr_DW_Low
gamma_Pyr_DW_High <- kernel.gamma(comm = hv_Pyr_DW_cat_depe_High)
gamma_Pyr_DW_High


## Calculating the functional beta diversity between community of the two types of plots
beta_Pyr_DW_Low <- kernel.beta(comm = hv_Pyr_DW_cat_depe_Low, func = "jaccard")
beta_Pyr_DW_High <- kernel.beta(comm = hv_Pyr_DW_cat_depe_High, func = "jaccard")

# Storing beta values of Low and High forest dieback
betaFD_Pyr_DW <- data.frame(
  Beta = c(as.vector(beta_Pyr_DW_Low[[1]]), as.vector(beta_Pyr_DW_High[[1]])),
  cat_depe = c(rep("Low", length(as.vector(beta_Pyr_DW_Low[[1]]))),
                 rep("Mid & High", length(as.vector(beta_Pyr_DW_High[[1]])))))

betaFD_2_Pyr_DW <- data.frame(
  Beta = c(as.vector(beta_Pyr_DW_Low[[2]]), as.vector(beta_Pyr_DW_High[[2]])),
  cat_depe = c(rep("Low", length(as.vector(beta_Pyr_DW_Low[[1]]))),
                 rep("Mid & High", length(as.vector(beta_Pyr_DW_High[[1]])))))

betaFD_3_Pyr_DW <- data.frame(
  Beta = c(as.vector(beta_Pyr_DW_Low[[3]]), as.vector(beta_Pyr_DW_High[[3]])),
  cat_depe = c(rep("Low", length(as.vector(beta_Pyr_DW_Low[[1]]))),
                 rep("Mid & High", length(as.vector(beta_Pyr_DW_High[[1]])))))


# Plots

##Beta global
hist(betaFD_Pyr_DW$Beta)
betaFD_Pyr_DW$cat_depe = factor(betaFD_Pyr_DW$cat_depe, levels = c("Low","Mid & High"))
mod_Beta_Pyr_DW = glmmTMB(Beta-0.0001 ~ cat_depe, data = betaFD_Pyr_DW, family = beta_family())
summary(mod_Beta_Pyr_DW)
res = simulateResiduals(mod_Beta_Pyr_DW)
plot(res, rank = T)

t.test(betaFD_Pyr_DW$Beta ~ betaFD_Pyr_DW$cat_depe)
summarySE_Beta_func_Pyr_DW = summarySE(data = betaFD_Pyr_DW, measurevar = "Beta", groupvars = "cat_depe")

plot_Beta_func_Pyr_DW = ggplot(summarySE_Beta_func_Pyr_DW, aes(x = cat_depe, y = Beta)) + geom_bar(stat = "identity", alpha = 0.7, width = 0.5, aes(fill = cat_depe)) + geom_errorbar(aes(ymin = Beta - ci, ymax = Beta + ci), size = 0.8, width = .1) + scale_fill_manual(values=c("Low" = "#77DCC5", "Mid & High" = "#3B7165")) + theme_bw() + theme(legend.position = "none") + labs(y="Dissimilarity value\n(intra-class)", x = "Forest dieback class") + ylim(0,1) + geom_segment(aes(x=1, y=0.85, xend=2, yend=0.85)) + annotate(geom = "text", label = "ns", x = 1.5, y = 0.90, hjust = 0) + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + ggtitle(label= "Fir-dominated forests", subtitle = "Woody elements - Trait β-diversity")
plot_Beta_func_Pyr_DW

ggsave("Figures/plot_Beta_func_Pyr_DW.png", plot = plot_Beta_func_Pyr_DW, units = "cm", width = 8, height=8, type = "cairo")



##Beta replacement
hist(betaFD_2_Pyr_DW$Beta)
betaFD_2_Pyr_DW$cat_depe = factor(betaFD_2_Pyr_DW$cat_depe, levels = c("Low","High"))
mod_Beta_Pyr_DW = glmmTMB(Beta+0.0001 ~ cat_depe, data = betaFD_2_Pyr_DW, family = beta_family())
summary(mod_Beta_Pyr_DW)
res = simulateResiduals(mod_Beta_Pyr_DW)
plot(res, rank = T)

t.test(betaFD_2_Pyr_DW$Beta ~ betaFD_2_Pyr_DW$cat_depe)
summarySE_Beta_func_Pyr_DW_repla = summarySE(data = betaFD_2_Pyr_DW, measurevar = "Beta", groupvars = "cat_depe")

plot_Beta_func_Pyr_DW_repla = ggplot(summarySE_Beta_func_Pyr_DW_repla, aes(x = cat_depe, y = Beta)) + geom_bar(stat = "identity", alpha = 0.7, width = 0.5, aes(fill = cat_depe)) + geom_errorbar(aes(ymin = Beta - ci+0.01, ymax = Beta + ci-0.01), size = 0.8, width = .1) + scale_fill_manual(values=c("Low" = "#33A26C", "Mid & High" = "#A28733")) + theme_bw() + theme(legend.position = "none") + labs(y="Dissimilarity value\n(intra-class)", x = "Forest dieback class") + ylim(0,0.15) + geom_segment(aes(x=1, y=0.125, xend=2, yend=0.125)) + annotate(geom = "text", label = "**", x = 1.5, y = 0.135, hjust = 0) + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + ggtitle(label= "Fir-dominated forests", subtitle = "Woody elements - Trait β-diversity")
plot_Beta_func_Pyr_DW_repla

ggsave("Figures/plot_Beta_func_Pyr_DW_repla.png", plot = plot_Beta_func_Pyr_DW_repla, units = "cm", width = 8, height=8, type = "cairo")



##Beta richness
hist(betaFD_3_Pyr_DW$Beta)
betaFD_3_Pyr_DW$cat_depe = factor(betaFD_3_Pyr_DW$cat_depe, levels = c("Low","High"))
mod_Beta_Pyr_DW = lm(Beta ~ cat_depe, data = betaFD_3_Pyr_DW)
summary(mod_Beta_Pyr_DW)
res = simulateResiduals(mod_Beta_Pyr_DW)
plot(res, rank = T)

t.test(betaFD_3_Pyr_DW$Beta ~ betaFD_3_Pyr_DW$cat_depe)
summarySE_Beta_func_Pyr_DW_rich = summarySE(data = betaFD_3_Pyr_DW, measurevar = "Beta", groupvars = "cat_depe")

plot_Beta_func_Pyr_DW_rich = ggplot(summarySE_Beta_func_Pyr_DW_rich, aes(x = cat_depe, y = Beta)) + geom_bar(stat = "identity", alpha = 0.7, width = 0.5, aes(fill = cat_depe)) + geom_errorbar(aes(ymin = Beta - ci+0.01, ymax = Beta + ci-0.01), size = 0.8, width = .1) + scale_fill_manual(values=c("Low" = "#33A26C", "Mid & High" = "#A28733")) + theme_bw() + theme(legend.position = "none") + labs(y="Dissimilarity value\n(intra-class)", x = "Forest dieback class") + ylim(0,0.85) + geom_segment(aes(x=1, y=0.75, xend=2, yend=0.75)) + annotate(geom = "text", label = "**", x = 1.5, y = 0.795, hjust = 0) + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + ggtitle(label= "Fir-dominated forests", subtitle = "Woody elements - Trait β-diversity")
plot_Beta_func_Pyr_DW_rich

ggsave("Figures/plot_Beta_func_Pyr_DW_rich.png", plot = plot_Beta_func_Pyr_DW_rich, units = "cm", width = 8, height=8, type = "cairo")



```



####Bavaria
```{r BAT Bavaria}


BAT_DW_Bav = rownames_to_column(Data_plotxtype_Bav, var = "plot") %>%
  left_join(Data_univar_Bav[c("plot", "cat_depe01", "salvaged")], by = "plot") %>%
  filter(salvaged == 0) %>%
  dplyr::select(-salvaged) %>%
  column_to_rownames(var = "plot")

cat_depe_Bav = BAT_DW_Bav$cat_depe01
BAT_DW_Bav = dplyr::select(BAT_DW_Bav, -cat_depe01)

Data_type_Bav$specie = as.factor(Data_type_Bav$specie)
BAT_traits_DW_Bav = Data_type_Bav


## Calculating the hypervolume for each plot

hv_Bav_DW <- BAT::kernel.build(comm = as.matrix(BAT_DW_Bav), trait = as.matrix(BAT_traits_DW_Bav), 
                   abund = TRUE, #samples are abundances
                   method = "gaussian", 
                   axes = 4) #convert traits to PCoA axex


#############################
# and visualize the hypervolumes
hv_Bav_DW_cat_depe_Low  <-  hypervolume_join(hv_Bav_DW@HVList[cat_depe_Bav == 0])
hv_Bav_DW_cat_depe_High <-  hypervolume_join(hv_Bav_DW@HVList[cat_depe_Bav == 1])


#plot of all hypervolumes in Low dieback subplot
plot(hv_Bav_DW_cat_depe_Low,
     show.3d=FALSE,
     show.random=TRUE,
     show.density=TRUE,
     show.data=TRUE,
     show.centroid=FALSE,
     cex.centroid=2,
     point.alpha.min=0.2, 
     point.dark.factor=0.7,
     cex.random=0.5,
     cex.data=1,
     contour.lwd=0.1,
     num.points.max.random = 1000,
     col= rep("#56B4E9",30),
     names=c("PCoA_1","PCoA_2","PCoA_3","PCoA_4"))

#plot of all hypervolumes in High dieback subplot
plot(hv_Bav_DW_cat_depe_High,
     show.3d=FALSE,
     show.random=TRUE,
     show.density=TRUE,
     show.data=TRUE,
     show.centroid=FALSE,
     cex.centroid=2,
     point.alpha.min=0.2, 
     point.dark.factor=0.7,
     cex.random=0.5,
     cex.data=1,
     contour.lwd=0.1,
     num.points.max.random = 1000,
     col= rep("#E69F00",30),
     names=c("PCoA_1","PCoA_2","PCoA_3","PCoA_4"))


#############################
## Calculating the functional alpha diversity of each plot using the kernel.alpha function

kernel_richness_DW_Bav <- kernel.alpha(comm = hv_Bav_DW) # vector with richness value for each subplot

#storing results in a data.frame
results_BAT_DW_Bav <- data.frame(cat_depe = cat_depe_Bav,
                      Richness = kernel_richness_DW_Bav)

summary(lm(Richness ~ cat_depe, data = results_BAT_DW_Bav))


## Calculating the functional gamma diversity between community of the two types of plots
gamma_Bav_DW_Low <- kernel.gamma(comm = hv_Bav_DW_cat_depe_Low)
gamma_Bav_DW_Low
gamma_Bav_DW_High <- kernel.gamma(comm = hv_Bav_DW_cat_depe_High)
gamma_Bav_DW_High


## Calculating the functional beta diversity between community of the two types of plots
beta_Bav_DW_Low <- kernel.beta(comm = hv_Bav_DW_cat_depe_Low, func = "jaccard")
beta_Bav_DW_High <- kernel.beta(comm = hv_Bav_DW_cat_depe_High, func = "jaccard")

# Storing beta values of Low and High forest dieback
betaFD_Bav_DW <- data.frame(
  Beta = c(as.vector(beta_Bav_DW_Low[[1]]), as.vector(beta_Bav_DW_High[[1]])),
  cat_depe = c(rep("Low", length(as.vector(beta_Bav_DW_Low[[1]]))),
                 rep("Mid & High", length(as.vector(beta_Bav_DW_High[[1]])))))

betaFD_2_Bav_DW <- data.frame(
  Beta = c(as.vector(beta_Bav_DW_Low[[2]]), as.vector(beta_Bav_DW_High[[2]])),
  cat_depe = c(rep("Low", length(as.vector(beta_Bav_DW_Low[[1]]))),
                 rep("Mid & High", length(as.vector(beta_Bav_DW_High[[1]])))))

betaFD_3_Bav_DW <- data.frame(
  Beta = c(as.vector(beta_Bav_DW_Low[[3]]), as.vector(beta_Bav_DW_High[[3]])),
  cat_depe = c(rep("Low", length(as.vector(beta_Bav_DW_Low[[1]]))),
                 rep("Mid & High", length(as.vector(beta_Bav_DW_High[[1]])))))


# Plots

##Beta global
hist(betaFD_Bav_DW$Beta)
betaFD_Bav_DW$cat_depe = factor(betaFD_Bav_DW$cat_depe, levels = c("Low","Mid & High"))
mod_Beta_Bav_DW = glmmTMB(Beta-0.0001 ~ cat_depe, data = betaFD_Bav_DW, family = beta_family())
summary(mod_Beta_Bav_DW)
res = simulateResiduals(mod_Beta_Bav_DW)
plot(res, rank = T)

t.test(betaFD_Bav_DW$Beta ~ betaFD_Bav_DW$cat_depe)
summarySE_Beta_func_Bav_DW = summarySE(data = betaFD_Bav_DW, measurevar = "Beta", groupvars = "cat_depe")

plot_Beta_func_Bav_DW = ggplot(summarySE_Beta_func_Bav_DW, aes(x = cat_depe, y = Beta)) + geom_bar(stat = "identity", alpha = 0.7, width = 0.5, aes(fill = cat_depe)) + geom_errorbar(aes(ymin = Beta - ci, ymax = Beta + ci), size = 0.8, width = .1) + scale_fill_manual(values=c("Low" = "#E9A7D6", "Mid & High" = "#78205E")) + theme_bw() + theme(legend.position = "none") + labs(y="Dissimilarity value\n(intra-class)", x = "Forest dieback class") + ylim(0,1) + geom_segment(aes(x=1, y=0.92, xend=2, yend=0.92)) + annotate(geom = "text", label = "***", x = 1.5, y = 0.955, hjust = 0) + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + ggtitle(label= "Spruce-dominated forests", subtitle = "Woody elements - Trait β-diversity")
plot_Beta_func_Bav_DW

ggsave("Figures/plot_Beta_func_Bav_DW.png", plot = plot_Beta_func_Bav_DW, units = "cm", width = 8, height=8, type = "cairo")



```




####Loire
```{r BAT Loire}


BAT_DW_CVL = rownames_to_column(Data_plotxtype_CVL, var = "plot") %>%
  left_join(Data_univar_CVL[c("plot", "cat_depe01", "salvaged")], by = "plot") %>%
  filter(salvaged == 0, plot != c("290", "351")) %>%
  dplyr::select(-salvaged) %>%
  column_to_rownames(var = "plot")

cat_depe_CVL = BAT_DW_CVL$cat_depe01
BAT_DW_CVL = dplyr::select(BAT_DW_CVL, -cat_depe01)

Data_type_CVL$specie = as.factor(Data_type_CVL$specie)
BAT_traits_DW_CVL = Data_type_CVL


## Calculating the hypervolume for each plot

hv_CVL_DW <- BAT::kernel.build(comm = as.matrix(BAT_DW_CVL), trait = as.matrix(BAT_traits_DW_CVL), 
                   abund = TRUE, #samples are abundances
                   method = "gaussian", 
                   axes = 4) #convert traits to PCoA axex


#############################
# and visualize the hypervolumes
hv_CVL_DW_cat_depe_Low  <-  hypervolume_join(hv_CVL_DW@HVList[cat_depe_CVL == 0])
hv_CVL_DW_cat_depe_High <-  hypervolume_join(hv_CVL_DW@HVList[cat_depe_CVL == 1])


#plot of all hypervolumes in Low dieback subplot
plot(hv_CVL_DW_cat_depe_Low,
     show.3d=FALSE,
     show.random=TRUE,
     show.density=TRUE,
     show.data=TRUE,
     show.centroid=FALSE,
     cex.centroid=2,
     point.alpha.min=0.2, 
     point.dark.factor=0.7,
     cex.random=0.5,
     cex.data=1,
     contour.lwd=0.1,
     num.points.max.random = 1000,
     col= rep("#56B4E9",30),
     names=c("PCoA_1","PCoA_2","PCoA_3","PCoA_4"))

#plot of all hypervolumes in High dieback subplot
plot(hv_CVL_DW_cat_depe_High,
     show.3d=FALSE,
     show.random=TRUE,
     show.density=TRUE,
     show.data=TRUE,
     show.centroid=FALSE,
     cex.centroid=2,
     point.alpha.min=0.2, 
     point.dark.factor=0.7,
     cex.random=0.5,
     cex.data=1,
     contour.lwd=0.1,
     num.points.max.random = 1000,
     col= rep("#E69F00",30),
     names=c("PCoA_1","PCoA_2","PCoA_3","PCoA_4"))


#############################
## Calculating the functional alpha diversity of each plot using the kernel.alpha function

kernel_richness_DW_CVL <- kernel.alpha(comm = hv_CVL_DW) # vector with richness value for each subplot

#storing results in a data.frame
results_BAT_DW_CVL <- data.frame(cat_depe = cat_depe_CVL,
                      Richness = kernel_richness_DW_CVL)

summary(lm(Richness ~ cat_depe, data = results_BAT_DW_CVL))


## Calculating the functional gamma diversity between community of the two types of plots
gamma_CVL_DW_Low <- kernel.gamma(comm = hv_CVL_DW_cat_depe_Low)
gamma_CVL_DW_Low
gamma_CVL_DW_High <- kernel.gamma(comm = hv_CVL_DW_cat_depe_High)
gamma_CVL_DW_High


## Calculating the functional beta diversity between community of the two types of plots
beta_CVL_DW_Low <- kernel.beta(comm = hv_CVL_DW_cat_depe_Low, func = "jaccard")
beta_CVL_DW_High <- kernel.beta(comm = hv_CVL_DW_cat_depe_High, func = "jaccard")

# Storing beta values of Low and High forest dieback
betaFD_CVL_DW <- data.frame(
  Beta = c(as.vector(beta_CVL_DW_Low[[1]]), as.vector(beta_CVL_DW_High[[1]])),
  cat_depe = c(rep("Low", length(as.vector(beta_CVL_DW_Low[[1]]))),
                 rep("Mid & High", length(as.vector(beta_CVL_DW_High[[1]])))))

betaFD_2_CVL_DW <- data.frame(
  Beta = c(as.vector(beta_CVL_DW_Low[[2]]), as.vector(beta_CVL_DW_High[[2]])),
  cat_depe = c(rep("Low", length(as.vector(beta_CVL_DW_Low[[1]]))),
                 rep("Mid & High", length(as.vector(beta_CVL_DW_High[[1]])))))

betaFD_3_CVL_DW <- data.frame(
  Beta = c(as.vector(beta_CVL_DW_Low[[3]]), as.vector(beta_CVL_DW_High[[3]])),
  cat_depe = c(rep("Low", length(as.vector(beta_CVL_DW_Low[[1]]))),
                 rep("Mid & High", length(as.vector(beta_CVL_DW_High[[1]])))))


# Plots

##Beta global
hist(betaFD_CVL_DW$Beta)
betaFD_CVL_DW$cat_depe = factor(betaFD_CVL_DW$cat_depe, levels = c("Low","Mid & High"))
mod_Beta_CVL_DW = glmmTMB(Beta-0.0001 ~ cat_depe, data = betaFD_CVL_DW, family = beta_family())
summary(mod_Beta_CVL_DW)
res = simulateResiduals(mod_Beta_CVL_DW)
plot(res, rank = T)

t.test(betaFD_CVL_DW$Beta ~ betaFD_CVL_DW$cat_depe)
summarySE_Beta_func_CVL_DW = summarySE(data = betaFD_CVL_DW, measurevar = "Beta", groupvars = "cat_depe")

plot_Beta_func_CVL_DW = ggplot(summarySE_Beta_func_CVL_DW, aes(x = cat_depe, y = Beta)) + geom_bar(stat = "identity", alpha = 0.7, width = 0.5, aes(fill = cat_depe)) + geom_errorbar(aes(ymin = Beta - ci, ymax = Beta + ci), size = 0.8, width = .1) + scale_fill_manual(values=c("Low" = "#E5C07F", "Mid & High" = "#8C703B")) + theme_bw() + theme(legend.position = "none") + labs(y="Dissimilarity value\n(intra-class)", x = "Forest dieback class") + ylim(0,1.2) + geom_segment(aes(x=1, y=1.05, xend=2, yend=1.05)) + annotate(geom = "text", label = "ns", x = 1.5, y = 1.125, hjust = 0) + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + ggtitle(label= "Oak-dominated forests", subtitle = "Woody elements - Trait β-diversity")
plot_Beta_func_CVL_DW

ggsave("Figures/plot_Beta_func_CVL_DW.png", plot = plot_Beta_func_CVL_DW, units = "cm", width = 8, height=8, type = "cairo")



```



##Data summary

```{r}

summarySE(Data_univar_CWM, measurevar = "level_depe_G", groupvars = "Region")


# Dead wood

summarySE(Data_univar_CWM, measurevar = "LW_vol", groupvars = c("Region", "class_depe_G"))

summarySE(Data_univar_CWM, measurevar = "DW_vol", groupvars = c("Region", "class_depe_G"))

summarySE(Data_univar_CWM, measurevar = "DW_div_tot", groupvars = c("Region", "class_depe_G"))

summarySE(Data_univar_CWM, measurevar = "DW_dec12", groupvars = c("Region", "class_depe_G"))

summarySE(Data_univar_CWM, measurevar = "DW_dec34", groupvars = c("Region", "class_depe_G"))

summarySE(Data_univar_CWM, measurevar = "DW_PBBM", groupvars = c("Region", "class_depe_G"))

summarySE(Data_univar_CWM, measurevar = "DW_GBTGB", groupvars = c("Region", "class_depe_G"))

summarySE(Data_univar_CWM, measurevar = "DW_BMS", groupvars = c("Region", "class_depe_G"))

summarySE(Data_univar_CWM, measurevar = "DW_BMD", groupvars = c("Region", "class_depe_G"))

summarySE(Data_univar_CWM, measurevar = "nb_TGB_All_sub", groupvars = c("Region", "class_depe_G"))

summarySE(Data_univar_CWM, measurevar = "nb_TGB_living", groupvars = c("Region", "class_depe_G"))

summarySE(Data_univar_CWM, measurevar = "nb_TGB_dead", groupvars = c("Region", "class_depe_G"))


# TreMs

summarySE(Data_univar_CWM_TreMs_All, measurevar = "TreMs_ab", groupvars = c("Region", "class_depe_G"))

summarySE(Data_univar_CWM_TreMs_All, measurevar = "TreMs_div", groupvars = c("Region", "class_depe_G"))

summarySE(Data_univar_CWM_TreMs_All, measurevar = "FRic", groupvars = c("Region", "class_depe_G"), na.rm = T)

summarySE(Data_univar_CWM_TreMs_All, measurevar = "Concavities", groupvars = c("Region", "class_depe_G"))

summarySE(Data_univar_CWM_TreMs_All, measurevar = "Rot_holes", groupvars = c("Region", "class_depe_G"))

summarySE(Data_univar_CWM_TreMs_All, measurevar = "Wood_pecker_breeding_cavities", groupvars = c("Region", "class_depe_G"))

summarySE(Data_univar_CWM_TreMs_All, measurevar = "Exposed_sapwood_and_heartwood", groupvars = c("Region", "class_depe_G"))

summarySE(Data_univar_CWM_TreMs_All, measurevar = "Exposed_sapwood_only", groupvars = c("Region", "class_depe_G"))

summarySE(Data_univar_CWM_TreMs_All, measurevar = "Crown_deadwood", groupvars = c("Region", "class_depe_G"))

summarySE(Data_univar_CWM_TreMs_All, measurevar = "Burrs_and_cankers", groupvars = c("Region", "class_depe_G"))

summarySE(Data_univar_CWM_TreMs_All, measurevar = "Twig_tangles", groupvars = c("Region", "class_depe_G"))

summarySE(Data_univar_CWM_TreMs_All, measurevar = "Ephemeral_fungal_fruiting_bodies", groupvars = c("Region", "class_depe_G"))

summarySE(Data_univar_CWM_TreMs_All, measurevar = "Perennial_fungi_fruiting_bodies", groupvars = c("Region", "class_depe_G"))

summarySE(Data_univar_CWM_TreMs_All, measurevar = "Epiphytic", groupvars = c("Region", "class_depe_G"))

summarySE(Data_univar_CWM_TreMs_All, measurevar = "Exudates", groupvars = c("Region", "class_depe_G"))


```



##Univariate analysis


### Pyrenees
```{r level_depe_G Pyrenees}

Data_univar_CWM_Pyrenees = Data_univar_CWM %>%
  filter(Region %in% "Pyrenees")


#LW_vol
fit1<-fitdist(round(Data_univar_CWM_Pyrenees$LW_vol), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Pyr_LW_vol_level_depe_G = glmmTMB(round(LW_vol) ~ level_depe_G + (1|site), data = Data_univar_CWM_Pyrenees, family = nbinom2())
summary(mod_Pyr_LW_vol_level_depe_G)
res = simulateResiduals(mod_Pyr_LW_vol_level_depe_G)
plot(res, rank = T)


#DW_vol
ggplot(data = Data_univar_CWM_Pyrenees, aes(y = DW_vol, x = level_depe_G)) + geom_point() + geom_smooth(method = "lm", formula = y ~ x, fullrange = T) + xlim(0,1)
summary(glmmTMB(DW_vol ~ level_depe_G + (1|site), data = Data_univar_CWM_Pyrenees, family = gaussian()))

hist(Data_univar_CWM_Pyrenees$DW_vol)
fit1<-fitdist(round(Data_univar_CWM_Pyrenees$DW_vol), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Pyr_DW_vol_level_depe_G = mixed_model(fixed = round(DW_vol) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Pyrenees, family = negative.binomial())
summary(mod_Pyr_DW_vol_level_depe_G)
res = simulateResiduals(mod_Pyr_DW_vol_level_depe_G)
plot(res, rank = T)

# summarySE(data = Data_univar_CWM_Pyrenees, measurevar = "DW_vol", groupvars = "cat_depe")


#DW_dec12
fit1<-fitdist(round(Data_univar_CWM_Pyrenees$DW_dec12), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Pyr_DW_dec12_level_depe_G = mixed_model(fixed = round(DW_dec12) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Pyrenees, family = negative.binomial())
summary(mod_Pyr_DW_dec12_level_depe_G)
res = simulateResiduals(mod_Pyr_DW_dec12_level_depe_G)
plot(res, rank = T)


#DW_dec34
fit1<-fitdist(sqrt(Data_univar_CWM_Pyrenees$DW_dec34), "norm", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Pyr_DW_dec34_level_depe_G = mixed_model(fixed = round(DW_dec34) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Pyrenees, family = negative.binomial())
summary(mod_Pyr_DW_dec34_level_depe_G)
res = simulateResiduals(mod_Pyr_DW_dec34_level_depe_G)
plot(res, rank = T)


#DW_PBBM
hist(Data_univar_CWM_Pyrenees$DW_PBBM)
fit1<-fitdist(round(Data_univar_CWM_Pyrenees$DW_PBBM), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Pyr_DW_PBBM_level_depe_G = mixed_model(fixed = round(DW_PBBM) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Pyrenees, family = negative.binomial())
summary(mod_Pyr_DW_PBBM_level_depe_G)
res = simulateResiduals(mod_Pyr_DW_PBBM_level_depe_G)
plot(res, rank = T)


#DW_GBTGB
fit1<-fitdist(round(Data_univar_CWM_Pyrenees$DW_GBTGB), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Pyr_DW_GBTGB_level_depe_G = mixed_model(fixed = round(DW_GBTGB) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Pyrenees, family = negative.binomial())
summary(mod_Pyr_DW_GBTGB_level_depe_G)
res = simulateResiduals(mod_Pyr_DW_GBTGB_level_depe_G)
plot(res, rank = T)


#DW_BMS
fit1<-fitdist(round(Data_univar_CWM_Pyrenees$DW_BMS), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Pyr_DW_BMS_level_depe_G = glmmTMB(round(DW_BMS) ~ level_depe_G, data = Data_univar_CWM_Pyrenees, family = nbinom2())
summary(mod_Pyr_DW_BMS_level_depe_G)
res = simulateResiduals(mod_Pyr_DW_BMS_level_depe_G)
plot(res, rank = T)

# summarySE(data = Data_univar_CWM_Pyrenees, measurevar = "DW_BMS", groupvars = "cat_depe")


#DW_BMD
fit1<-fitdist(sqrt(Data_univar_CWM_Pyrenees$DW_BMD), "norm", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Pyr_DW_BMD_level_depe_G = mixed_model(fixed = round(DW_BMD) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Pyrenees, family = negative.binomial())
summary(mod_Pyr_DW_BMD_level_depe_G)
res = simulateResiduals(mod_Pyr_DW_BMD_level_depe_G)
plot(res, rank = T)


#nb_TGB_All_sub
hist(Data_univar_CWM_Pyrenees$nb_TGB_All_sub)
fit1<-fitdist(Data_univar_CWM_Pyrenees$nb_TGB_All_sub, "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Pyr_nb_TGB_All_sub_level_depe_G = glmmTMB(nb_TGB_All_sub ~ level_depe_G + (1|site), data = Data_univar_CWM_Pyrenees, family = nbinom2())
summary(mod_Pyr_nb_TGB_All_sub_level_depe_G)
res = simulateResiduals(mod_Pyr_nb_TGB_All_sub_level_depe_G)
plot(res, rank = T)


#nb_TGB_living
hist(Data_univar_CWM_Pyrenees$nb_TGB_living)
fit1<-fitdist(Data_univar_CWM_Pyrenees$nb_TGB_living, "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Pyr_nb_TGB_living_level_depe_G = glmmTMB(nb_TGB_living ~ level_depe_G + (1|site), data = Data_univar_CWM_Pyrenees, family = nbinom2())
summary(mod_Pyr_nb_TGB_living_level_depe_G)
res = simulateResiduals(mod_Pyr_nb_TGB_living_level_depe_G)
plot(res, rank = T)


#nb_TGB_dead
hist(Data_univar_CWM_Pyrenees$nb_TGB_dead)
fit1<-fitdist(Data_univar_CWM_Pyrenees$nb_TGB_dead, "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Pyr_nb_TGB_dead_level_depe_G = glmmTMB(nb_TGB_dead ~ level_depe_G + (1|site), data = Data_univar_CWM_Pyrenees, family = nbinom2())
summary(mod_Pyr_nb_TGB_dead_level_depe_G)
res = simulateResiduals(mod_Pyr_nb_TGB_dead_level_depe_G)
plot(res, rank = T)



# #DW_GBTGB_dec12
# hist(Data_univar_CWM_Pyrenees$DW_GBTGB_dec12)
# fit1<-fitdist(round(Data_univar_CWM_Pyrenees$DW_GBTGB_dec12), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_Pyr_DW_GBTGB_dec12_level_depe_G = mixed_model(fixed = round(DW_GBTGB_dec12) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Pyrenees, family = negative.binomial())
# summary(mod_Pyr_DW_GBTGB_dec12_level_depe_G)
# res = simulateResiduals(mod_Pyr_DW_GBTGB_dec12_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_GBTGB_dec34
# hist(Data_univar_CWM_Pyrenees$DW_GBTGB_dec34)
# fit1<-fitdist(round(Data_univar_CWM_Pyrenees$DW_GBTGB_dec34), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_Pyr_DW_GBTGB_dec34_level_depe_G = mixed_model(fixed = round(DW_GBTGB_dec34) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Pyrenees, family = negative.binomial())
# summary(mod_Pyr_DW_GBTGB_dec34_level_depe_G)
# res = simulateResiduals(mod_Pyr_DW_GBTGB_dec34_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_PBBM_dec12
# fit1<-fitdist(round(Data_univar_CWM_Pyrenees$DW_PBBM_dec12), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_Pyr_DW_PBBM_dec12_level_depe_G = mixed_model(fixed = round(DW_PBBM_dec12) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Pyrenees, family = negative.binomial())
# summary(mod_Pyr_DW_PBBM_dec12_level_depe_G)
# res = simulateResiduals(mod_Pyr_DW_PBBM_dec12_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_PBBM_dec34
# fit1<-fitdist(round(Data_univar_CWM_Pyrenees$DW_PBBM_dec34), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_Pyr_DW_PBBM_dec34_level_depe_G = mixed_model(fixed = round(DW_PBBM_dec34) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Pyrenees, family = negative.binomial())
# summary(mod_Pyr_DW_PBBM_dec34_level_depe_G)
# res = simulateResiduals(mod_Pyr_DW_PBBM_dec34_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_BMD_dec12
# fit1<-fitdist(round(Data_univar_CWM_Pyrenees$DW_BMD_dec12), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_Pyr_DW_BMD_dec12_level_depe_G = mixed_model(fixed = round(DW_BMD_dec12) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Pyrenees, family = negative.binomial())
# summary(mod_Pyr_DW_BMD_dec12_level_depe_G)
# res = simulateResiduals(mod_Pyr_DW_BMD_dec12_level_depe_G)
# plot(res, rank = T)
# 
# 
#DW_BMD_dec34
# fit1<-fitdist(round(Data_univar_CWM_Pyrenees$DW_BMD_dec34), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_Pyr_DW_BMD_dec34_level_depe_G = mixed_model(fixed = round(DW_BMD_dec34) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Pyrenees, family = negative.binomial())
# summary(mod_Pyr_DW_BMD_dec34_level_depe_G)
# res = simulateResiduals(mod_Pyr_DW_BMD_dec34_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_BMS_dec12
# fit1<-fitdist(round(Data_univar_CWM_Pyrenees$DW_BMS_dec12), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_Pyr_DW_BMS_dec12_level_depe_G = mixed_model(fixed = round(DW_BMS_dec12) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Pyrenees, family = negative.binomial())
# summary(mod_Pyr_DW_BMS_dec12_level_depe_G)
# res = simulateResiduals(mod_Pyr_DW_BMS_dec12_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_BMS_dec34
# fit1<-fitdist(round(Data_univar_CWM_Pyrenees$DW_BMS_dec34), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_Pyr_DW_BMS_dec34_level_depe_G = mixed_model(fixed = round(DW_BMS_dec34) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Pyrenees, family = negative.binomial())
# summary(mod_Pyr_DW_BMS_dec34_level_depe_G)
# res = simulateResiduals(mod_Pyr_DW_BMS_dec34_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_BMS_PBBM
# fit1<-fitdist(round(Data_univar_CWM_Pyrenees$DW_BMS_PBBM), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_Pyr_DW_BMS_PBBM_level_depe_G = mixed_model(fixed = round(DW_BMS_PBBM) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Pyrenees, family = negative.binomial())
# summary(mod_Pyr_DW_BMS_PBBM_level_depe_G)
# res = simulateResiduals(mod_Pyr_DW_BMS_PBBM_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_BMS_GBTGB
# fit1<-fitdist(round(Data_univar_CWM_Pyrenees$DW_BMS_GBTGB), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_Pyr_DW_BMS_GBTGB_level_depe_G = mixed_model(fixed = round(DW_BMS_GBTGB) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Pyrenees, family = negative.binomial())
# summary(mod_Pyr_DW_BMS_GBTGB_level_depe_G)
# res = simulateResiduals(mod_Pyr_DW_BMS_GBTGB_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_BMD_PBBM
# fit1<-fitdist(round(Data_univar_CWM_Pyrenees$DW_BMD_PBBM), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_Pyr_DW_BMD_PBBM_level_depe_G = mixed_model(fixed = round(DW_BMD_PBBM) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Pyrenees, family = negative.binomial())
# summary(mod_Pyr_DW_BMD_PBBM_level_depe_G)
# res = simulateResiduals(mod_Pyr_DW_BMD_PBBM_level_depe_G)
# plot(res, rank = T)


#DW_BMD_GBTGB
fit1<-fitdist(round(Data_univar_CWM_Pyrenees$DW_BMD_GBTGB), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Pyr_DW_BMD_GBTGB_level_depe_G = glmmTMB(round(DW_BMD_GBTGB) ~ level_depe_G + (1|site), data = Data_univar_CWM_Pyrenees, family = nbinom2())
summary(mod_Pyr_DW_BMD_GBTGB_level_depe_G)
res = simulateResiduals(mod_Pyr_DW_BMD_GBTGB_level_depe_G)
plot(res, rank = T)


#DW_div_tot
hist(Data_univar_CWM_Pyrenees$DW_div_tot)
fit1<-fitdist(Data_univar_CWM_Pyrenees$DW_div_tot, "pois", start = NULL)
gofstat(fit1)$chisqpvalue

summary(glmmTMB(DW_div_tot ~ level_depe_G + (1|site), data = Data_univar_CWM_Pyrenees, family = gaussian()))
mod_Pyr_DW_div_tot_level_depe_G = glmmTMB(DW_div_tot ~ level_depe_G + (1|site), data = Data_univar_CWM_Pyrenees, family = gaussian())
summary(mod_Pyr_DW_div_tot_level_depe_G)
res = simulateResiduals(mod_Pyr_DW_div_tot_level_depe_G)
plot(res, rank = T)

# ggplot(data = Data_univar_CWM_Pyrenees, aes(y = sqrt(DW_div_tot), x = level_depe_G)) + geom_point() + geom_smooth(method = "lm")


#FRic
hist(Data_univar_CWM_Pyrenees$FRic)
fit1<-fitdist(sqrt(Data_univar_CWM_Pyrenees$FRic), "norm", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Pyr_FRic_level_depe_G = glmmTMB(FRic ~ level_depe_G + (1|site), data = Data_univar_CWM_Pyrenees, family = gaussian())
summary(mod_Pyr_FRic_level_depe_G)
res = simulateResiduals(mod_Pyr_FRic_level_depe_G)
plot(res, rank = T)

# ggplot(data = Data_univar_CWM_Pyrenees, aes(y = FRic, x = level_depe_G, color = Region)) + geom_point() + geom_smooth(method = "lm")


#FDiv
hist(Data_univar_CWM_Pyrenees$FDiv)
fit1<-fitdist(Data_univar_CWM_Pyrenees$FDiv, "beta", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Pyr_FDiv_level_depe_G = glmmTMB(FDiv ~ level_depe_G, data = Data_univar_CWM_Pyrenees, family = gaussian())
summary(mod_Pyr_FDiv_level_depe_G)
res = simulateResiduals(mod_Pyr_FDiv_level_depe_G)
plot(res, rank = T)


#FEve
hist(Data_univar_CWM_Pyrenees$FEve)
fit1<-fitdist(na.omit(Data_univar_CWM_Pyrenees$FEve), "norm", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Pyr_FEve_level_depe_G = glmmTMB(FEve ~ level_depe_G + (1|site), data = Data_univar_CWM_Pyrenees, family = gaussian())
summary(mod_Pyr_FEve_level_depe_G)
res = simulateResiduals(mod_Pyr_FEve_level_depe_G)
plot(res, rank = T)


#FDis
hist(Data_univar_CWM_Pyrenees$FDis)
fit1<-fitdist(sqrt(Data_univar_CWM_Pyrenees$FDis), "norm", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Pyr_FDis_level_depe_G = glmmTMB(FDis ~ level_depe_G + (1|site), data = Data_univar_CWM_Pyrenees, family = gaussian())
summary(mod_Pyr_FDis_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_level_depe_G)
plot(res, rank = T)


#CWM_statut
hist(Data_univar_CWM_Pyrenees$CWM_statut)

mod_Pyr_CWM_statut_level_depe_G = glmmTMB(CWM_statut ~ level_depe_G + (1|site), data = Data_univar_CWM_Pyrenees, family = gaussian())
summary(mod_Pyr_CWM_statut_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_statut_level_depe_G)
plot(res, rank = T)


#FDis_statut
hist(Data_univar_CWM_Pyrenees$FDis_statut)

mod_Pyr_FDis_statut_level_depe_G = glmmTMB(FDis_statut ~ level_depe_G + (1|site), data = Data_univar_CWM_Pyrenees, family = gaussian())
summary(mod_Pyr_FDis_statut_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_statut_level_depe_G)
plot(res, rank = T)


#CWM_stade_saprox
hist(Data_univar_CWM_Pyrenees$CWM_stade_saprox)
fit1<-fitdist(sqrt(Data_univar_CWM_Pyrenees$CWM_stade_saprox), "norm", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Pyr_CWM_stade_saprox_level_depe_G = glmmTMB(CWM_stade_saprox ~ level_depe_G + (1|site), data = Data_univar_CWM_Pyrenees, family = gaussian())
summary(mod_Pyr_CWM_stade_saprox_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_stade_saprox_level_depe_G)
plot(res, rank = T)


#FDis_stade_saprox
hist(Data_univar_CWM_Pyrenees$FDis_stade_saprox)
fit1<-fitdist(sqrt(Data_univar_CWM_Pyrenees$FDis_stade_saprox), "norm", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Pyr_FDis_stade_saprox_level_depe_G = glmmTMB(FDis_stade_saprox ~ level_depe_G + (1|site), data = Data_univar_CWM_Pyrenees, family = gaussian())
summary(mod_Pyr_FDis_stade_saprox_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_stade_saprox_level_depe_G)
plot(res, rank = T)


#CWM_dbh
hist(Data_univar_CWM_Pyrenees$CWM_dbh)
fit1<-fitdist(Data_univar_CWM_Pyrenees$CWM_dbh, "norm", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Pyr_CWM_dbh_level_depe_G = glmmTMB(CWM_dbh ~ level_depe_G + (1|site), data = Data_univar_CWM_Pyrenees, family = gaussian())
summary(mod_Pyr_CWM_dbh_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_dbh_level_depe_G)
plot(res, rank = T)


#FDis_dbh
hist(Data_univar_CWM_Pyrenees$FDis_dbh)
fit1<-fitdist(Data_univar_CWM_Pyrenees$FDis_dbh, "norm", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Pyr_FDis_dbh_level_depe_G = glmmTMB(FDis_dbh ~ level_depe_G + (1|site), data = Data_univar_CWM_Pyrenees, family = gaussian())
summary(mod_Pyr_FDis_dbh_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_dbh_level_depe_G)
plot(res, rank = T)


```


###Pyrenees Magnitude study
```{r Pyrenees Magnitude study}




#LW_vol
summary(mod_Pyr_LW_vol_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_LW_vol_level_depe_G = rnorm(10000, mean = 1.1654, sd = 0.2825)

D <- (exp(Estimate_mod_Pyr_LW_vol_level_depe_G * 0.27)-1)*-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_LW_vol_level_depe_G)



#DW_vol
summary(mod_Pyr_DW_vol_level_depe_G)

predict(glmmTMB(round(DW_vol) ~ level_depe_G, data = Data_univar_CWM_Pyrenees, family = gaussian()), data.frame(level_depe_G=c(0.1)))
predict(glmmTMB(round(DW_vol) ~ level_depe_G, data = Data_univar_CWM_Pyrenees, family = gaussian()), data.frame(level_depe_G=c(0.25)))
predict(glmmTMB(round(DW_vol) ~ level_depe_G, data = Data_univar_CWM_Pyrenees, family = gaussian()), data.frame(level_depe_G=c(0.5)))
predict(glmmTMB(round(DW_vol) ~ level_depe_G, data = Data_univar_CWM_Pyrenees, family = gaussian()), data.frame(level_depe_G=c(0.75)))
predict(glmmTMB(round(DW_vol) ~ level_depe_G, data = Data_univar_CWM_Pyrenees, family = gaussian()), data.frame(level_depe_G=c(1)))

set.seed(1)
Estimate_mod_Pyr_DW_vol_level_depe_G = rnorm(10000, mean = 4.7489, sd = 0.6071)
summary(Data_univar_CWM_Pyrenees$DW_vol)

D <- exp(Estimate_mod_Pyr_DW_vol_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_DW_vol_level_depe_G)




#DW_dec12
summary(mod_Pyr_DW_dec12_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_DW_dec12_level_depe_G = rnorm(10000, mean = 2.3754, sd = 2.0989)

D <- exp(Estimate_mod_Pyr_DW_dec12_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_DW_dec12_level_depe_G)



#DW_dec34
summary(mod_Pyr_DW_dec34_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_DW_dec34_level_depe_G = rnorm(10000, mean = 5.2705, sd = 0.6504)

D <- exp(Estimate_mod_Pyr_DW_dec34_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_DW_dec34_level_depe_G)



#DW_PBBM
summary(mod_Pyr_DW_PBBM_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_DW_PBBM_level_depe_G = rnorm(10000, mean = 5.0945, sd = 0.8246)

D <- exp(Estimate_mod_Pyr_DW_PBBM_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_DW_PBBM_level_depe_G)



#DW_GBTGB
summary(mod_Pyr_DW_GBTGB_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_DW_GBTGB_level_depe_G = rnorm(10000, mean = 4.2359, sd = 0.9469)

D <- exp(Estimate_mod_Pyr_DW_GBTGB_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_DW_GBTGB_level_depe_G)



#DW_BMS
summary(mod_Pyr_DW_BMS_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_DW_BMS_level_depe_G = rnorm(10000, mean = 5.5186, sd = 0.6904)

D <- exp(Estimate_mod_Pyr_DW_BMS_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_DW_BMS_level_depe_G)



#DW_BMD
summary(mod_Pyr_DW_BMD_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_DW_BMD_level_depe_G = rnorm(10000, mean = 3.8337, sd = 1.1048)

D <- exp(Estimate_mod_Pyr_DW_BMD_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_DW_BMD_level_depe_G)



#nb_TGB_All_sub
summary(mod_Pyr_nb_TGB_All_sub_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_nb_TGB_All_sub_level_depe_G = rnorm(10000, mean = 1.3217, sd = 1.2778)

D <- (exp(Estimate_mod_Pyr_nb_TGB_All_sub_level_depe_G * 0.27)-1)*-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_nb_TGB_All_sub_level_depe_G)



#nb_TGB_living
summary(mod_Pyr_nb_TGB_living_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_nb_TGB_living_level_depe_G = rnorm(10000, mean = 2.5402, sd = 1.2882)

D <- (exp(Estimate_mod_Pyr_nb_TGB_living_level_depe_G * 0.27)-1)*-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_nb_TGB_living_level_depe_G)



#nb_TGB_dead
summary(mod_Pyr_nb_TGB_dead_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_nb_TGB_dead_level_depe_G = rnorm(10000, mean = 3.8464, sd = 2.3405)

D <- exp(Estimate_mod_Pyr_nb_TGB_dead_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_nb_TGB_dead_level_depe_G)



# #DW_GBTGB_dec12
# summary(mod_Pyr_DW_GBTGB_dec12_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Pyr_DW_GBTGB_dec12_level_depe_G = rnorm(10000, mean = 2.4859, sd = 3.1559)
# 
# D <- exp(Estimate_mod_Pyr_DW_GBTGB_dec12_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Pyr_DW_GBTGB_dec12_level_depe_G)
# 
# 
# 
# #DW_GBTGB_dec34
# summary(mod_Pyr_DW_GBTGB_dec34_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Pyr_DW_GBTGB_dec34_level_depe_G = rnorm(10000, mean = 3.5947, sd = 1.2082)
# 
# D <- exp(Estimate_mod_Pyr_DW_GBTGB_dec34_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Pyr_DW_GBTGB_dec34_level_depe_G)
# 
# 
# 
# #DW_PBBM_dec12
# summary(mod_Pyr_DW_PBBM_dec12_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Pyr_DW_PBBM_dec12_level_depe_G = rnorm(10000, mean = 2.8038, sd = 4.6194)
# 
# D <- exp(Estimate_mod_Pyr_DW_PBBM_dec12_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Pyr_DW_PBBM_dec12_level_depe_G)
# 
# 
# 
# #DW_PBBM_dec34
# summary(mod_Pyr_DW_PBBM_dec34_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Pyr_DW_PBBM_dec34_level_depe_G = rnorm(10000, mean = 4.9183, sd = 1.2801)
# 
# D <- exp(Estimate_mod_Pyr_DW_PBBM_dec34_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Pyr_DW_PBBM_dec34_level_depe_G)
# 
# 
# 
# #DW_BMD_dec12
# summary(mod_Pyr_DW_BMD_dec12_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Pyr_DW_BMD_dec12_level_depe_G = rnorm(10000, mean = 5, sd = 4.7161)
# 
# D <- exp(Estimate_mod_Pyr_DW_BMD_dec12_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Pyr_DW_BMD_dec12_level_depe_G)
# 
# 
# 
# #DW_BMD_dec34
# summary(mod_Pyr_DW_BMD_dec34_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Pyr_DW_BMD_dec34_level_depe_G = rnorm(10000, mean = 2.9316, sd = 1.542)
# 
# D <- exp(Estimate_mod_Pyr_DW_BMD_dec34_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Pyr_DW_BMD_dec34_level_depe_G)
# 
# 
# 
# #DW_BMS_dec12
# summary(mod_Pyr_DW_BMS_dec12_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Pyr_DW_BMS_dec12_level_depe_G = rnorm(10000, mean = 5.298, sd = 4.4129)
# 
# D <- exp(Estimate_mod_Pyr_DW_BMS_dec12_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Pyr_DW_BMS_dec12_level_depe_G)
# 
# 
# 
# #DW_BMS_dec34
# summary(mod_Pyr_DW_BMS_dec34_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Pyr_DW_BMS_dec34_level_depe_G = rnorm(10000, mean = 4.7931, sd = 1.1596)
# 
# D <- exp(Estimate_mod_Pyr_DW_BMS_dec34_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Pyr_DW_BMS_dec34_level_depe_G)
# 
# 
# 
# #DW_BMS_PBBM
# summary(mod_Pyr_DW_BMS_PBBM_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Pyr_DW_BMS_PBBM_level_depe_G = rnorm(10000, mean = 6.4172, sd = 1.4671)
# 
# D <- exp(Estimate_mod_Pyr_DW_BMS_PBBM_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Pyr_DW_BMS_PBBM_level_depe_G)
# 
# 
# 
# #DW_BMS_GBTGB
# summary(mod_Pyr_DW_BMS_GBTGB_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Pyr_DW_BMS_GBTGB_level_depe_G = rnorm(10000, mean = 2.5057, sd = 1.3698)
# 
# D <- exp(Estimate_mod_Pyr_DW_BMS_GBTGB_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Pyr_DW_BMS_GBTGB_level_depe_G)
# 
# 
# 
# #DW_BMD_PBBM
# summary(mod_Pyr_DW_BMD_PBBM_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Pyr_DW_BMD_PBBM_level_depe_G = rnorm(10000, mean = 1.6093, sd = 2.8836)
# 
# D <- exp(Estimate_mod_Pyr_DW_BMD_PBBM_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Pyr_DW_BMD_PBBM_level_depe_G)



#DW_BMD_GBTGB
summary(mod_Pyr_DW_BMD_GBTGB_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_DW_BMD_GBTGB_level_depe_G = rnorm(10000, mean = 3.9135, sd = 1.4364)

D <- exp(Estimate_mod_Pyr_DW_BMD_GBTGB_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_DW_BMD_GBTGB_level_depe_G)



#DW_div_tot
summary(mod_Pyr_DW_div_tot_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_DW_div_tot_level_depe_G = rnorm(10000, mean = 8.748, sd = 1.366)
summary(Data_univar_CWM_Pyrenees$DW_div_tot)

D <- ((3 + Estimate_mod_Pyr_DW_div_tot_level_depe_G * 0.27) / 3) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_DW_div_tot_level_depe_G)



#FRic
summary(mod_Pyr_FRic_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FRic_level_depe_G = rnorm(10000, mean = 0.20558, sd = 0.05037)
summary(Data_univar_CWM_Pyrenees$FRic)
val_predict = predict(glmmTMB(FRic ~ level_depe_G, data = Data_univar_CWM_Pyrenees, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FRic_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FRic_level_depe_G)



#FDiv
summary(mod_Pyr_FDiv_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDiv_level_depe_G = rnorm(10000, mean = 0.50078, sd = 0.26188)
summary(Data_univar_CWM_Pyrenees$FDiv)
val_predict = predict(glmmTMB(FDiv ~ level_depe_G, data = Data_univar_CWM_Pyrenees, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDiv_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDiv_level_depe_G)



#FEve
summary(mod_Pyr_FEve_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FEve_level_depe_G = rnorm(10000, mean = 0.2047, sd = 0.2799)
summary(Data_univar_CWM_Pyrenees$FEve)
val_predict = predict(glmmTMB(FEve ~ level_depe_G, data = Data_univar_CWM_Pyrenees, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FEve_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FEve_level_depe_G)



#CWM_statut
ggplot(data = Data_univar_CWM_Pyrenees, aes(y = CWM_statut, x = level_depe_G, color = site)) + geom_point() + geom_smooth(method = "glm", method.args = list(family = gaussian()), formula = y ~ exp(x), fullrange = T) + xlim(0,1)
summary(mod_Pyr_CWM_statut_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_statut_level_depe_G = rnorm(10000, mean = -1.0842, sd = 0.07617)
val_predict = predict(glmmTMB(CWM_statut ~ level_depe_G, data = Data_univar_CWM_Pyrenees, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_CWM_statut_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_CWM_statut_level_depe_G)



#FDis_statut
ggplot(data = Data_univar_CWM_Pyrenees, aes(y = FDis_statut, x = level_depe_G, color = site)) + geom_point() + geom_smooth(method = "lm", fullrange = T) + xlim(0,1)
summary(mod_Pyr_FDis_statut_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_statut_level_depe_G = rnorm(10000, mean = 1.41612, sd = 0.08827)
summary(Data_univar_CWM_Pyrenees$FDis_statut)
val_predict = predict(glmmTMB(FDis_statut ~ level_depe_G, data = Data_univar_CWM_Pyrenees, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDis_statut_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_statut_level_depe_G)



#CWM_stade_saprox
ggplot(data = Data_univar_CWM_Pyrenees, aes(y = CWM_stade_saprox, x = level_depe_G, color = site)) + geom_point() + geom_smooth(method = "lm", fullrange = T) + xlim(0,1)
summary(mod_Pyr_CWM_stade_saprox_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_stade_saprox_level_depe_G = rnorm(10000, mean = 0.45576, sd = 0.333)
summary(Data_univar_CWM_Pyrenees$CWM_stade_saprox)
val_predict = predict(glmmTMB(CWM_stade_saprox ~ level_depe_G, data = Data_univar_CWM_Pyrenees, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_CWM_stade_saprox_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_CWM_stade_saprox_level_depe_G)



#FDis_stade_saprox
ggplot(data = Data_univar_CWM_Pyrenees, aes(y = FDis_stade_saprox, x = level_depe_G, color = site)) + geom_point() + geom_smooth(method = "lm", fullrange = T) + xlim(0,1)
summary(mod_Pyr_FDis_stade_saprox_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_stade_saprox_level_depe_G = rnorm(10000, mean = -0.2333, sd = 0.292)
summary(na.omit(Data_univar_CWM_Pyrenees$FDis_stade_saprox))
val_predict = predict(glmmTMB(FDis_stade_saprox ~ level_depe_G, data = Data_univar_CWM_Pyrenees, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDis_stade_saprox_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_stade_saprox_level_depe_G)



#CWM_dbh
ggplot(data = Data_univar_CWM_Pyrenees, aes(y = CWM_dbh, x = level_depe_G, color = site)) + geom_point() + geom_smooth(method = "lm", fullrange = T) + xlim(0,1)
summary(mod_Pyr_CWM_dbh_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_dbh_level_depe_G = rnorm(10000, mean = -5.195, sd = 8.305)
summary(Data_univar_CWM_Pyrenees$CWM_dbh)
val_predict = predict(glmmTMB(CWM_dbh ~ level_depe_G, data = Data_univar_CWM_Pyrenees, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_CWM_dbh_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_CWM_dbh_level_depe_G)



#FDis_dbh
ggplot(data = Data_univar_CWM_Pyrenees, aes(y = FDis_dbh, x = level_depe_G, color = site)) + geom_point() + geom_smooth(method = "lm", fullrange = T) + xlim(0,1)
summary(mod_Pyr_FDis_dbh_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_dbh_level_depe_G = rnorm(10000, mean = -0.10646, sd = 0.22896)
summary(Data_univar_CWM_Pyrenees$FDis_dbh)
val_predict = predict(glmmTMB(FDis_dbh ~ level_depe_G, data = Data_univar_CWM_Pyrenees, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDis_dbh_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_dbh_level_depe_G)


```





### CVL
```{r level_depe_G CVL}

Data_univar_CWM_CVL = Data_univar_CWM %>%
  filter(Region %in% "CVL")



#LW_vol
fit1<-fitdist(round(Data_univar_CWM_CVL$LW_vol), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_CVL_LW_vol_level_depe_G = glmmTMB(round(LW_vol) ~ level_depe_G + (1|site), data = Data_univar_CWM_CVL, family = nbinom2())
summary(mod_CVL_LW_vol_level_depe_G)
res = simulateResiduals(mod_CVL_LW_vol_level_depe_G)
plot(res, rank = T)


#DW_vol
ggplot(data = Data_univar_CWM_CVL, aes(y = DW_vol, x = level_depe_G)) + geom_point() + geom_smooth(method = "glm", method.args = list(family = nbinom2()), formula = y ~ x, fullrange = T)
ggplot(data = Data_univar_CWM_CVL, aes(y = DW_vol, x = level_depe_G)) + geom_point() + geom_smooth(method = "lm", formula = y ~ x, fullrange = T) + xlim(0,1)

vol_DW_depe_CVL = ggplot(data = Data_univar_CWM_CVL, aes(y = DW_vol, x = level_depe_G)) + geom_point() + geom_smooth(method = "lm", formula = y ~ x, fullrange = T, color = "#A28346") + theme_bw() + labs(x = "Taux de mortalité des arbres", y = bquote('Volume ('*m^3*'/ha)')) + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + ggtitle(label = "Bois mort", subtitle = "Total") + annotate(geom = "text", label = "p < 0.001 ***", x = 0.05, y = 87.5, hjust = 0)
vol_DW_depe_CVL

ggsave("Figures/vol_DW_depe_CVL.png", plot = vol_DW_depe_CVL, width = 12, height = 10, units = "cm", type = "cairo")


hist(Data_univar_CWM_CVL$DW_vol)
fit1<-fitdist(round(Data_univar_CWM_CVL$DW_vol), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_CVL_DW_vol_level_depe_G = glmmTMB(round(DW_vol) ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian())
summary(mod_CVL_DW_vol_level_depe_G)
res = simulateResiduals(mod_CVL_DW_vol_level_depe_G)
plot(res, rank = T)

# summarySE(data = Data_univar_CWM_CVL, measurevar = "DW_vol", groupvars = "cat_depe")


#DW_dec12
ggplot(data = Data_univar_CWM_CVL, aes(y = DW_dec12, x = level_depe_G)) + geom_point() + geom_smooth(method = "lm", formula = y ~ x, fullrange = T)
fit1<-fitdist(round(Data_univar_CWM_CVL$DW_dec12), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_CVL_DW_dec12_level_depe_G = glmmTMB(round(DW_dec12) ~ level_depe_G, data = Data_univar_CWM_CVL, family = nbinom2())
summary(mod_CVL_DW_dec12_level_depe_G)
res = simulateResiduals(mod_CVL_DW_dec12_level_depe_G)
plot(res, rank = T)


#DW_dec34
hist(Data_univar_CWM_CVL$DW_dec34)
fit1<-fitdist(round(Data_univar_CWM_CVL$DW_dec34), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_CVL_DW_dec34_level_depe_G = mixed_model(fixed = round(DW_dec34) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_CVL, family = hurdle.negative.binomial(), zi_fixed = ~ level_depe_G)
summary(mod_CVL_DW_dec34_level_depe_G)
res = simulateResiduals(mod_CVL_DW_dec34_level_depe_G)
plot(res, rank = T)


#DW_PBBM
hist(Data_univar_CWM_CVL$DW_PBBM)
fit1<-fitdist(round(Data_univar_CWM_CVL$DW_PBBM), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_CVL_DW_PBBM_level_depe_G = glmmTMB(round(DW_PBBM) ~ level_depe_G + (1|site), data = Data_univar_CWM_CVL, family = gaussian())
summary(mod_CVL_DW_PBBM_level_depe_G)
res = simulateResiduals(mod_CVL_DW_PBBM_level_depe_G)
plot(res, rank = T)


#DW_GBTGB
fit1<-fitdist(round(Data_univar_CWM_CVL$DW_GBTGB), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_CVL_DW_GBTGB_level_depe_G = glmmTMB(round(DW_GBTGB) ~ level_depe_G + (1|site), data = Data_univar_CWM_CVL, family = nbinom2())
summary(mod_CVL_DW_GBTGB_level_depe_G)
res = simulateResiduals(mod_CVL_DW_GBTGB_level_depe_G)
plot(res, rank = T)


#DW_BMS
fit1<-fitdist(round(Data_univar_CWM_CVL$DW_BMS), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_CVL_DW_BMS_level_depe_G = glmmTMB(round(DW_BMS) ~ level_depe_G + (1|site), data = Data_univar_CWM_CVL, family = nbinom2())
summary(mod_CVL_DW_BMS_level_depe_G)
res = simulateResiduals(mod_CVL_DW_BMS_level_depe_G)
plot(res, rank = T)

# summarySE(data = Data_univar_CWM_CVL, measurevar = "DW_BMS", groupvars = "cat_depe")


#DW_BMD
ggplot(data = Data_univar_CWM_CVL, aes(y = DW_BMD, x = level_depe_G)) + geom_point() + geom_smooth(method = "lm", formula = y ~ x, fullrange = T)
fit1<-fitdist(round(Data_univar_CWM_CVL$DW_BMD), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_CVL_DW_BMD_level_depe_G = glmmTMB(round(DW_BMD) ~ level_depe_G, data = Data_univar_CWM_CVL, family = nbinom2())
summary(mod_CVL_DW_BMD_level_depe_G)
res = simulateResiduals(mod_CVL_DW_BMD_level_depe_G)
plot(res, rank = T)


#nb_TGB_All_sub
hist(Data_univar_CWM_CVL$nb_TGB_All_sub)
fit1<-fitdist(Data_univar_CWM_CVL$nb_TGB_All_sub, "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_CVL_nb_TGB_All_sub_level_depe_G = glmmTMB(nb_TGB_All_sub ~ level_depe_G + (1|site), data = Data_univar_CWM_CVL, family = nbinom2())
summary(mod_CVL_nb_TGB_All_sub_level_depe_G)
res = simulateResiduals(mod_CVL_nb_TGB_All_sub_level_depe_G)
plot(res, rank = T)


#nb_TGB_living
hist(Data_univar_CWM_CVL$nb_TGB_living)
fit1<-fitdist(Data_univar_CWM_CVL$nb_TGB_living, "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_CVL_nb_TGB_living_level_depe_G = glmmTMB(nb_TGB_living ~ level_depe_G + (1|site), data = Data_univar_CWM_CVL, family = nbinom2())
summary(mod_CVL_nb_TGB_living_level_depe_G)
res = simulateResiduals(mod_CVL_nb_TGB_living_level_depe_G)
plot(res, rank = T)


#nb_TGB_dead
hist(Data_univar_CWM_CVL$nb_TGB_dead)
fit1<-fitdist(Data_univar_CWM_CVL$nb_TGB_dead, "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue
summary(glmmTMB(nb_TGB_dead ~ level_depe_G + (1|site), data = Data_univar_CWM_CVL, family = gaussian()))

mod_CVL_nb_TGB_dead_level_depe_G = glmmTMB(nb_TGB_dead ~ level_depe_G, data = Data_univar_CWM_CVL, family = nbinom2())
summary(mod_CVL_nb_TGB_dead_level_depe_G)
res = simulateResiduals(mod_CVL_nb_TGB_dead_level_depe_G)
plot(res, rank = T)


# #DW_GBTGB_dec12
# hist(Data_univar_CWM_CVL$DW_GBTGB_dec12)
# fit1<-fitdist(round(Data_univar_CWM_CVL$DW_GBTGB_dec12), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_CVL_DW_GBTGB_dec12_level_depe_G = mixed_model(fixed = round(DW_GBTGB_dec12) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_CVL, family = negative.binomial())
# summary(mod_CVL_DW_GBTGB_dec12_level_depe_G)
# res = simulateResiduals(mod_CVL_DW_GBTGB_dec12_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_GBTGB_dec34
# hist(Data_univar_CWM_CVL$DW_GBTGB_dec34)
# fit1<-fitdist(round(Data_univar_CWM_CVL$DW_GBTGB_dec34), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_CVL_DW_GBTGB_dec34_level_depe_G = mixed_model(fixed = round(DW_GBTGB_dec34) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_CVL, family = negative.binomial())
# summary(mod_CVL_DW_GBTGB_dec34_level_depe_G)
# res = simulateResiduals(mod_CVL_DW_GBTGB_dec34_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_PBBM_dec12
# fit1<-fitdist(round(Data_univar_CWM_CVL$DW_PBBM_dec12), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_CVL_DW_PBBM_dec12_level_depe_G = mixed_model(fixed = round(DW_PBBM_dec12) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_CVL, family = negative.binomial())
# summary(mod_CVL_DW_PBBM_dec12_level_depe_G)
# res = simulateResiduals(mod_CVL_DW_PBBM_dec12_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_PBBM_dec34
# fit1<-fitdist(round(Data_univar_CWM_CVL$DW_PBBM_dec34), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_CVL_DW_PBBM_dec34_level_depe_G = mixed_model(fixed = round(DW_PBBM_dec34) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_CVL, family = negative.binomial())
# summary(mod_CVL_DW_PBBM_dec34_level_depe_G)
# res = simulateResiduals(mod_CVL_DW_PBBM_dec34_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_BMD_dec12
# fit1<-fitdist(round(Data_univar_CWM_CVL$DW_BMD_dec12), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_CVL_DW_BMD_dec12_level_depe_G = mixed_model(fixed = round(DW_BMD_dec12) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_CVL, family = negative.binomial())
# summary(mod_CVL_DW_BMD_dec12_level_depe_G)
# res = simulateResiduals(mod_CVL_DW_BMD_dec12_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_BMD_dec34
# fit1<-fitdist(round(Data_univar_CWM_CVL$DW_BMD_dec34), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_CVL_DW_BMD_dec34_level_depe_G = mixed_model(fixed = round(DW_BMD_dec34) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_CVL, family = negative.binomial())
# summary(mod_CVL_DW_BMD_dec34_level_depe_G)
# res = simulateResiduals(mod_CVL_DW_BMD_dec34_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_BMS_dec12
# fit1<-fitdist(round(Data_univar_CWM_CVL$DW_BMS_dec12), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_CVL_DW_BMS_dec12_level_depe_G = mixed_model(fixed = round(DW_BMS_dec12) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_CVL, family = negative.binomial())
# summary(mod_CVL_DW_BMS_dec12_level_depe_G)
# res = simulateResiduals(mod_CVL_DW_BMS_dec12_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_BMS_dec34
# fit1<-fitdist(round(Data_univar_CWM_CVL$DW_BMS_dec34), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_CVL_DW_BMS_dec34_level_depe_G = mixed_model(fixed = round(DW_BMS_dec34) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_CVL, family = negative.binomial())
# summary(mod_CVL_DW_BMS_dec34_level_depe_G)
# res = simulateResiduals(mod_CVL_DW_BMS_dec34_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_BMS_PBBM
# fit1<-fitdist(round(Data_univar_CWM_CVL$DW_BMS_PBBM), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_CVL_DW_BMS_PBBM_level_depe_G = mixed_model(fixed = round(DW_BMS_PBBM) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_CVL, family = negative.binomial())
# summary(mod_CVL_DW_BMS_PBBM_level_depe_G)
# res = simulateResiduals(mod_CVL_DW_BMS_PBBM_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_BMS_GBTGB
# fit1<-fitdist(round(Data_univar_CWM_CVL$DW_BMS_GBTGB), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_CVL_DW_BMS_GBTGB_level_depe_G = mixed_model(fixed = round(DW_BMS_GBTGB) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_CVL, family = negative.binomial())
# summary(mod_CVL_DW_BMS_GBTGB_level_depe_G)
# res = simulateResiduals(mod_CVL_DW_BMS_GBTGB_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_BMD_PBBM
# fit1<-fitdist(round(Data_univar_CWM_CVL$DW_BMD_PBBM), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_CVL_DW_BMD_PBBM_level_depe_G = mixed_model(fixed = round(DW_BMD_PBBM) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_CVL, family = negative.binomial())
# summary(mod_CVL_DW_BMD_PBBM_level_depe_G)
# res = simulateResiduals(mod_CVL_DW_BMD_PBBM_level_depe_G)
# plot(res, rank = T)


#DW_BMD_GBTGB
fit1<-fitdist(round(Data_univar_CWM_CVL$DW_BMD_GBTGB), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_CVL_DW_BMD_GBTGB_level_depe_G = glmmTMB(round(DW_BMD_GBTGB) ~ level_depe_G, data = Data_univar_CWM_CVL, family = nbinom2())
summary(mod_CVL_DW_BMD_GBTGB_level_depe_G)
res = simulateResiduals(mod_CVL_DW_BMD_GBTGB_level_depe_G)
plot(res, rank = T)


#DW_div_tot
hist(Data_univar_CWM_CVL$DW_div_tot)
fit1<-fitdist(Data_univar_CWM_CVL$DW_div_tot, "pois", start = NULL)
gofstat(fit1)$chisqpvalue

mod_CVL_DW_div_tot_level_depe_G = glmmTMB(DW_div_tot ~ level_depe_G + (1|site), data = Data_univar_CWM_CVL, family = poisson())
summary(mod_CVL_DW_div_tot_level_depe_G)
res = simulateResiduals(mod_CVL_DW_div_tot_level_depe_G)
plot(res, rank = T)

# ggplot(data = Data_univar_CWM_CVL, aes(y = sqrt(DW_div_tot), x = level_depe_G)) + geom_point() + geom_smooth(method = "lm")


#FRic
hist(Data_univar_CWM_CVL$FRic)
fit1<-fitdist(sqrt(Data_univar_CWM_CVL$FRic), "norm", start = NULL)
gofstat(fit1)$chisqpvalue

mod_CVL_FRic_level_depe_G = glmmTMB(FRic ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian())
summary(mod_CVL_FRic_level_depe_G)
res = simulateResiduals(mod_CVL_FRic_level_depe_G)
plot(res, rank = T)

# ggplot(data = Data_univar_CWM_CVL, aes(y = FRic, x = level_depe_G, color = Region)) + geom_point() + geom_smooth(method = "lm")


#FDiv
hist(Data_univar_CWM_CVL$FDiv)
fit1<-fitdist(Data_univar_CWM_CVL$FDiv, "beta", start = NULL)
gofstat(fit1)$chisqpvalue

mod_CVL_FDiv_level_depe_G = glmmTMB(FDiv ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian())
summary(mod_CVL_FDiv_level_depe_G)
res = simulateResiduals(mod_CVL_FDiv_level_depe_G)
plot(res, rank = T)


#FEve
hist(Data_univar_CWM_CVL$FEve)
shapiro.test(Data_univar_CWM_CVL$FEve)
# fit1<-fitdist(na.omit(Data_univar_CWM_CVL$FEve), "norm", start = NULL)
# gofstat(fit1)$chisqpvalue

mod_CVL_FEve_level_depe_G = glmmTMB(FEve ~ level_depe_G + (1|site), data = Data_univar_CWM_CVL, family = gaussian())
summary(mod_CVL_FEve_level_depe_G)
res = simulateResiduals(mod_CVL_FEve_level_depe_G)
plot(res, rank = T)


#FDis
hist(Data_univar_CWM_CVL$FDis)
fit1<-fitdist(sqrt(Data_univar_CWM_CVL$FDis), "norm", start = NULL)
gofstat(fit1)$chisqpvalue

mod_CVL_FDis_level_depe_G = glmmTMB(FDis ~ level_depe_G + (1|site), data = Data_univar_CWM_CVL, family = gaussian())
summary(mod_CVL_FDis_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_level_depe_G)
plot(res, rank = T)


#CWM_statut
hist(Data_univar_CWM_CVL$CWM_statut)

mod_CVL_CWM_statut_level_depe_G = glmmTMB(CWM_statut ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian())
summary(mod_CVL_CWM_statut_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_statut_level_depe_G)
plot(res, rank = T)


#FDis_statut
hist(Data_univar_CWM_CVL$FDis_statut)

mod_CVL_FDis_statut_level_depe_G = glmmTMB(FDis_statut ~ level_depe_G + (1|site), data = Data_univar_CWM_CVL, family = gaussian())
summary(mod_CVL_FDis_statut_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_statut_level_depe_G)
plot(res, rank = T)


#CWM_stade_saprox
hist(Data_univar_CWM_CVL$CWM_stade_saprox)
fit1<-fitdist(sqrt(Data_univar_CWM_CVL$CWM_stade_saprox), "norm", start = NULL)
gofstat(fit1)$chisqpvalue

mod_CVL_CWM_stade_saprox_level_depe_G = glmmTMB(CWM_stade_saprox ~ level_depe_G + (1|site), data = Data_univar_CWM_CVL, family = gaussian())
summary(mod_CVL_CWM_stade_saprox_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_stade_saprox_level_depe_G)
plot(res, rank = T)


#FDis_stade_saprox
hist(Data_univar_CWM_CVL$FDis_stade_saprox)
fit1<-fitdist(sqrt(Data_univar_CWM_CVL$FDis_stade_saprox), "norm", start = NULL)
gofstat(fit1)$chisqpvalue

mod_CVL_FDis_stade_saprox_level_depe_G = glmmTMB(FDis_stade_saprox ~ level_depe_G + (1|site), data = Data_univar_CWM_CVL, family = gaussian())
summary(mod_CVL_FDis_stade_saprox_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_stade_saprox_level_depe_G)
plot(res, rank = T)


#CWM_dbh
hist(Data_univar_CWM_CVL$CWM_dbh)
fit1<-fitdist(Data_univar_CWM_CVL$CWM_dbh, "norm", start = NULL)
gofstat(fit1)$chisqpvalue

mod_CVL_CWM_dbh_level_depe_G = glmmTMB(CWM_dbh ~ level_depe_G + (1|site), data = Data_univar_CWM_CVL, family = gaussian())
summary(mod_CVL_CWM_dbh_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_dbh_level_depe_G)
plot(res, rank = T)


#FDis_dbh
hist(Data_univar_CWM_CVL$FDis_dbh)
fit1<-fitdist(Data_univar_CWM_CVL$FDis_dbh, "gamma", start = NULL)
gofstat(fit1)$chisqpvalue

mod_CVL_FDis_dbh_level_depe_G = glmmTMB(FDis_dbh ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian())
summary(mod_CVL_FDis_dbh_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_dbh_level_depe_G)
plot(res, rank = T)


```


###CVL Magnitude study
```{r CVL Magnitude study}



#LW_vol
summary(mod_CVL_LW_vol_level_depe_G)

set.seed(1)
Estimate_mod_CVL_LW_vol_level_depe_G = rnorm(10000, mean = 1.44435, sd = 0.57492)

D <- (exp(Estimate_mod_CVL_LW_vol_level_depe_G * 0.27)-1)*-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_CVL_LW_vol_level_depe_G)



#DW_vol
summary(mod_CVL_DW_vol_level_depe_G)

set.seed(1)
Estimate_mod_CVL_DW_vol_level_depe_G = rnorm(10000, mean = 244.286, sd = 36.784)
summary(Data_univar_CWM_CVL$DW_vol)
val_predict = predict(glmmTMB(DW_vol ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_DW_vol_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_DW_vol_level_depe_G)



#DW_dec12
summary(mod_CVL_DW_dec12_level_depe_G)
summary(glmmTMB(DW_dec12 ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()))

set.seed(1)
Estimate_mod_CVL_DW_dec12_level_depe_G = rnorm(10000, mean = 208.031, sd = 39.861)
summary(Data_univar_CWM_CVL$DW_dec12)
val_predict = predict(glmmTMB(DW_dec12 ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_DW_dec12_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_DW_dec12_level_depe_G)



#DW_dec34
summary(mod_CVL_DW_dec34_level_depe_G)
summary(glmmTMB(DW_dec34 ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()))

set.seed(1)
Estimate_mod_CVL_DW_dec34_level_depe_G = rnorm(10000, mean = 35.741, sd = 19.736)
summary(Data_univar_CWM_CVL$DW_dec34)
val_predict = predict(glmmTMB(DW_dec34 ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_DW_dec34_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_DW_dec34_level_depe_G)



#DW_PBBM
summary(mod_CVL_DW_PBBM_level_depe_G)

set.seed(1)
Estimate_mod_CVL_DW_PBBM_level_depe_G = rnorm(10000, mean = 27.728, sd = 21.376)
summary(Data_univar_CWM_CVL$DW_PBBM)
val_predict = predict(glmmTMB(DW_PBBM ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()), data.frame(level_depe_G=c(0.1)))
val_predict

D <- ((val_predict + Estimate_mod_CVL_DW_PBBM_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_CVL_DW_PBBM_level_depe_G)
rm(val_predict)



#DW_GBTGB
summary(mod_CVL_DW_GBTGB_level_depe_G)
summary(glmmTMB(DW_GBTGB ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()))

set.seed(1)
Estimate_mod_CVL_DW_GBTGB_level_depe_G = rnorm(10000, mean = 221.575, sd = 47.573)
summary(Data_univar_CWM_CVL$DW_GBTGB)
val_predict = predict(glmmTMB(DW_GBTGB ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_DW_GBTGB_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_DW_GBTGB_level_depe_G)



#DW_BMS
summary(mod_CVL_DW_BMS_level_depe_G)
summary(glmmTMB(DW_BMS ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()))

set.seed(1)
Estimate_mod_CVL_DW_BMS_level_depe_G = rnorm(10000, mean = 13.951, sd = 11.891)
summary(Data_univar_CWM_CVL$DW_BMS)
val_predict = predict(glmmTMB(DW_BMS ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_DW_BMS_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_DW_BMS_level_depe_G)



#DW_BMD
summary(mod_CVL_DW_BMD_level_depe_G)
summary(glmmTMB(DW_BMD ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()))

set.seed(1)
Estimate_mod_CVL_DW_BMD_level_depe_G = rnorm(10000, mean = 229.821, sd = 41.133)
summary(Data_univar_CWM_CVL$DW_BMD)
val_predict = predict(glmmTMB(DW_BMD ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_DW_BMD_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_DW_BMD_level_depe_G)



#nb_TGB_All_sub
summary(mod_CVL_nb_TGB_All_sub_level_depe_G)

set.seed(1)
Estimate_mod_CVL_nb_TGB_All_sub_level_depe_G = rnorm(10000, mean = 2.1398, sd = 2.7846)

D <- exp(Estimate_mod_CVL_nb_TGB_All_sub_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_CVL_nb_TGB_All_sub_level_depe_G)



#nb_TGB_living
summary(mod_CVL_nb_TGB_living_level_depe_G)

set.seed(1)
Estimate_mod_CVL_nb_TGB_living_level_depe_G = rnorm(10000, mean = 0.9615, sd = 2.8414)

D <- exp(Estimate_mod_CVL_nb_TGB_living_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_CVL_nb_TGB_living_level_depe_G)



#nb_TGB_dead
summary(mod_CVL_nb_TGB_dead_level_depe_G)
summary(glmmTMB(nb_TGB_dead ~ level_depe_G + (1|site), data = Data_univar_CWM_CVL, family = gaussian()))

set.seed(1)
Estimate_mod_CVL_nb_TGB_dead_level_depe_G = rnorm(10000, mean = 13.214, sd = 1.8928)
# Estimate_mod_CVL_nb_TGB_dead_level_depe_G = rnorm(10000, mean = 21.792, sd = 11.191)
summary(Data_univar_CWM_CVL$nb_TGB_dead)
val_predict = predict(glmmTMB(nb_TGB_dead ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_nb_TGB_dead_level_depe_G * 0.27) / val_predict) - 1
# D <- exp(Estimate_mod_CVL_nb_TGB_dead_level_depe_G * 0.27) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_nb_TGB_dead_level_depe_G)



# #DW_GBTGB_dec12
# summary(mod_CVL_DW_GBTGB_dec12_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_CVL_DW_GBTGB_dec12_level_depe_G = rnorm(10000, mean = 3.7814, sd = 3.4942)
# 
# D <- exp(Estimate_mod_CVL_DW_GBTGB_dec12_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_CVL_DW_GBTGB_dec12_level_depe_G)
# 
# 
# 
# #DW_GBTGB_dec34
# summary(mod_CVL_DW_GBTGB_dec34_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_CVL_DW_GBTGB_dec34_level_depe_G = rnorm(10000, mean = 3.5947, sd = 1.2082)
# 
# D <- exp(Estimate_mod_CVL_DW_GBTGB_dec34_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_CVL_DW_GBTGB_dec34_level_depe_G)
# 
# 
# 
# #DW_PBBM_dec12
# summary(mod_CVL_DW_PBBM_dec12_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_CVL_DW_PBBM_dec12_level_depe_G = rnorm(10000, mean = 2.8038, sd = 4.6194)
# 
# D <- exp(Estimate_mod_CVL_DW_PBBM_dec12_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_CVL_DW_PBBM_dec12_level_depe_G)
# 
# 
# 
# #DW_PBBM_dec34
# summary(mod_CVL_DW_PBBM_dec34_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_CVL_DW_PBBM_dec34_level_depe_G = rnorm(10000, mean = 4.9183, sd = 1.2801)
# 
# D <- exp(Estimate_mod_CVL_DW_PBBM_dec34_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_CVL_DW_PBBM_dec34_level_depe_G)
# 
# 
# 
# #DW_BMD_dec12
# summary(mod_CVL_DW_BMD_dec12_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_CVL_DW_BMD_dec12_level_depe_G = rnorm(10000, mean = 5, sd = 4.7161)
# 
# D <- exp(Estimate_mod_CVL_DW_BMD_dec12_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_CVL_DW_BMD_dec12_level_depe_G)
# 
# 
# 
# #DW_BMD_dec34
# summary(mod_CVL_DW_BMD_dec34_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_CVL_DW_BMD_dec34_level_depe_G = rnorm(10000, mean = 2.9316, sd = 1.542)
# 
# D <- exp(Estimate_mod_CVL_DW_BMD_dec34_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_CVL_DW_BMD_dec34_level_depe_G)
# 
# 
# 
# #DW_BMS_dec12
# summary(mod_CVL_DW_BMS_dec12_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_CVL_DW_BMS_dec12_level_depe_G = rnorm(10000, mean = 5.298, sd = 4.4129)
# 
# D <- exp(Estimate_mod_CVL_DW_BMS_dec12_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_CVL_DW_BMS_dec12_level_depe_G)
# 
# 
# 
# #DW_BMS_dec34
# summary(mod_CVL_DW_BMS_dec34_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_CVL_DW_BMS_dec34_level_depe_G = rnorm(10000, mean = 4.7931, sd = 1.1596)
# 
# D <- exp(Estimate_mod_CVL_DW_BMS_dec34_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_CVL_DW_BMS_dec34_level_depe_G)
# 
# 
# 
# #DW_BMS_PBBM
# summary(mod_CVL_DW_BMS_PBBM_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_CVL_DW_BMS_PBBM_level_depe_G = rnorm(10000, mean = 6.4172, sd = 1.4671)
# 
# D <- exp(Estimate_mod_CVL_DW_BMS_PBBM_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_CVL_DW_BMS_PBBM_level_depe_G)
# 
# 
# 
# #DW_BMS_GBTGB
# summary(mod_CVL_DW_BMS_GBTGB_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_CVL_DW_BMS_GBTGB_level_depe_G = rnorm(10000, mean = 2.5057, sd = 1.3698)
# 
# D <- exp(Estimate_mod_CVL_DW_BMS_GBTGB_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_CVL_DW_BMS_GBTGB_level_depe_G)
# 
# 
# 
# #DW_BMD_PBBM
# summary(mod_CVL_DW_BMD_PBBM_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_CVL_DW_BMD_PBBM_level_depe_G = rnorm(10000, mean = 1.6093, sd = 2.8836)
# 
# D <- exp(Estimate_mod_CVL_DW_BMD_PBBM_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_CVL_DW_BMD_PBBM_level_depe_G)



#DW_BMD_GBTGB
summary(mod_CVL_DW_BMD_GBTGB_level_depe_G)
summary(glmmTMB(DW_BMD_GBTGB ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()))

set.seed(1)
Estimate_mod_CVL_DW_BMD_GBTGB_level_depe_G = rnorm(10000, mean = 218.753, sd = 49.124)
summary(Data_univar_CWM_CVL$DW_BMD_GBTGB)
val_predict = predict(glmmTMB(DW_BMD_GBTGB ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_DW_BMD_GBTGB_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_DW_BMD_GBTGB_level_depe_G)



#DW_div_tot
summary(mod_CVL_DW_div_tot_level_depe_G)
summary(glmmTMB(DW_div_tot ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()))

set.seed(1)
Estimate_mod_CVL_DW_div_tot_level_depe_G = rnorm(10000, mean = 9.0603, sd = 1.8229)
summary(Data_univar_CWM_CVL$DW_div_tot)
val_predict = predict(glmmTMB(DW_div_tot ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_DW_div_tot_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_DW_div_tot_level_depe_G)



#FRic
summary(mod_CVL_FRic_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FRic_level_depe_G = rnorm(10000, mean = 0.047424, sd = 0.058647)
summary(Data_univar_CWM_CVL$FRic)
val_predict = predict(glmmTMB(FRic ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FRic_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FRic_level_depe_G)



#FDiv
summary(mod_CVL_FDiv_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDiv_level_depe_G = rnorm(10000, mean = 0.5773, sd = 1.112)
summary(Data_univar_CWM_CVL$FDiv)
val_predict = predict(glmmTMB(FDiv ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDiv_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDiv_level_depe_G)



#FEve
summary(mod_CVL_FEve_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FEve_level_depe_G = rnorm(10000, mean = 0.4934, sd = 1.2235)
summary(Data_univar_CWM_CVL$FEve)
val_predict = predict(glmmTMB(FEve ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FEve_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FEve_level_depe_G)



#CWM_statut
ggplot(data = Data_univar_CWM_CVL, aes(y = CWM_statut, x = level_depe_G, color = site)) + geom_point() + geom_smooth(method = "glm", method.args = list(family = gaussian()), formula = y ~ exp(x), fullrange = T) + xlim(0,1)
summary(mod_CVL_CWM_statut_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_statut_level_depe_G = rnorm(10000, mean = -0.86379, sd = 0.20999)
summary(Data_univar_CWM_CVL$CWM_statut)
val_predict = predict(glmmTMB(CWM_statut ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_CWM_statut_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_CWM_statut_level_depe_G)



#FDis_statut
ggplot(data = Data_univar_CWM_CVL, aes(y = FDis_statut, x = level_depe_G, color = site)) + geom_point() + geom_smooth(method = "lm", fullrange = T) + xlim(0,1)
summary(mod_CVL_FDis_statut_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_statut_level_depe_G = rnorm(10000, mean = 1.54484, sd = 0.47558)
summary(Data_univar_CWM_CVL$FDis_statut)
val_predict = predict(glmmTMB(FDis_statut ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_statut_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_statut_level_depe_G)



#CWM_stade_saprox
ggplot(data = Data_univar_CWM_CVL, aes(y = CWM_stade_saprox, x = level_depe_G, color = site)) + geom_point() + geom_smooth(method = "lm", fullrange = T) + xlim(0,1)
summary(mod_CVL_CWM_stade_saprox_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_stade_saprox_level_depe_G = rnorm(10000, mean = 1.8007, sd = 1.8137)
summary(Data_univar_CWM_CVL$CWM_stade_saprox)
val_predict = predict(glmmTMB(CWM_stade_saprox ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_CWM_stade_saprox_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_CWM_stade_saprox_level_depe_G)



#FDis_stade_saprox
ggplot(data = Data_univar_CWM_CVL, aes(y = FDis_stade_saprox, x = level_depe_G, color = site)) + geom_point() + geom_smooth(method = "lm", fullrange = T)
summary(mod_CVL_FDis_stade_saprox_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_stade_saprox_level_depe_G = rnorm(10000, mean = 0.9696, sd = 2.0286)
summary(Data_univar_CWM_CVL$FDis_stade_saprox)
val_predict = predict(glmmTMB(FDis_stade_saprox ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_stade_saprox_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_stade_saprox_level_depe_G)



#CWM_dbh
ggplot(data = Data_univar_CWM_CVL, aes(y = CWM_dbh, x = level_depe_G, color = site)) + geom_point() + geom_smooth(method = "lm", fullrange = T) + xlim(0,1)
summary(mod_CVL_CWM_dbh_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_dbh_level_depe_G = rnorm(10000, mean = 102.83, sd = 59.8)
summary(Data_univar_CWM_CVL$CWM_dbh)
val_predict = predict(glmmTMB(CWM_dbh ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_CWM_dbh_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_CWM_dbh_level_depe_G)



#FDis_dbh
ggplot(data = Data_univar_CWM_CVL, aes(y = FDis_dbh, x = level_depe_G, color = site)) + geom_point() + geom_smooth(method = "lm", fullrange = T) + xlim(0,1)
summary(mod_CVL_FDis_dbh_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_dbh_level_depe_G = rnorm(10000, mean = 2.1469, sd = 0.53238)
summary(Data_univar_CWM_CVL$FDis_dbh)
val_predict = predict(glmmTMB(FDis_dbh ~ level_depe_G, data = Data_univar_CWM_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_dbh_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_dbh_level_depe_G)


```






### Bavaria
```{r level_depe_G Bav}

Data_univar_CWM_Bav = Data_univar_CWM %>%
  filter(Region %in% "Bavaria")



#LW_vol
fit1<-fitdist(round(Data_univar_CWM_Bav$LW_vol), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Bav_LW_vol_level_depe_G = glmmTMB(round(LW_vol) ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian())
summary(mod_Bav_LW_vol_level_depe_G)
res = simulateResiduals(mod_Bav_LW_vol_level_depe_G)
plot(res, rank = T)


#DW_vol
ggplot(data = Data_univar_CWM_Bav, aes(y = DW_vol, x = level_depe_G)) + geom_point() + geom_smooth(method = "lm", formula = y ~ x, fullrange = T)

hist(Data_univar_CWM_Bav$DW_vol)
fit1<-fitdist(round(Data_univar_CWM_Bav$DW_vol), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Bav_DW_vol_level_depe_G = glmmTMB(round(DW_vol) ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian())
summary(mod_Bav_DW_vol_level_depe_G)
res = simulateResiduals(mod_Bav_DW_vol_level_depe_G)
plot(res, rank = T)

# summarySE(data = Data_univar_CWM_Bav, measurevar = "DW_vol", groupvars = "cat_depe")


#DW_dec12
fit1<-fitdist(round(Data_univar_CWM_Bav$DW_dec12), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Bav_DW_dec12_level_depe_G = glmmTMB(round(DW_dec12) ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian())
summary(mod_Bav_DW_dec12_level_depe_G)
res = simulateResiduals(mod_Bav_DW_dec12_level_depe_G)
plot(res, rank = T)


#DW_dec34
hist(Data_univar_CWM_Bav$DW_dec34)
fit1<-fitdist(round(Data_univar_CWM_Bav$DW_dec34), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Bav_DW_dec34_level_depe_G = glmmTMB(round(DW_dec34) ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian())
summary(mod_Bav_DW_dec34_level_depe_G)
res = simulateResiduals(mod_Bav_DW_dec34_level_depe_G)
plot(res, rank = T)


#DW_PBBM
hist(Data_univar_CWM_Bav$DW_PBBM)
fit1<-fitdist(round(Data_univar_CWM_Bav$DW_PBBM), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Bav_DW_PBBM_level_depe_G = glmmTMB(DW_PBBM ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian())
summary(mod_Bav_DW_PBBM_level_depe_G)
res = simulateResiduals(mod_Bav_DW_PBBM_level_depe_G)
plot(res, rank = T)


#DW_GBTGB
fit1<-fitdist(round(Data_univar_CWM_Bav$DW_GBTGB), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Bav_DW_GBTGB_level_depe_G = glmmTMB(round(DW_GBTGB) ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian())
summary(mod_Bav_DW_GBTGB_level_depe_G)
res = simulateResiduals(mod_Bav_DW_GBTGB_level_depe_G)
plot(res, rank = T)


#DW_BMS
fit1<-fitdist(round(Data_univar_CWM_Bav$DW_BMS), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Bav_DW_BMS_level_depe_G = glmmTMB(round(DW_BMS) ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian())
summary(mod_Bav_DW_BMS_level_depe_G)
res = simulateResiduals(mod_Bav_DW_BMS_level_depe_G)
plot(res, rank = T)

# summarySE(data = Data_univar_CWM_Bav, measurevar = "DW_BMS", groupvars = "cat_depe")


#DW_BMD
fit1<-fitdist(round(Data_univar_CWM_Bav$DW_BMD), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Bav_DW_BMD_level_depe_G = glmmTMB(round(DW_BMD) ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian())
summary(mod_Bav_DW_BMD_level_depe_G)
res = simulateResiduals(mod_Bav_DW_BMD_level_depe_G)
plot(res, rank = T)


#nb_TGB_All_sub
hist(Data_univar_CWM_Bav$nb_TGB_All_sub)
fit1<-fitdist(Data_univar_CWM_Bav$nb_TGB_All_sub, "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Bav_nb_TGB_All_sub_level_depe_G = glmmTMB(nb_TGB_All_sub ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian())
summary(mod_Bav_nb_TGB_All_sub_level_depe_G)
res = simulateResiduals(mod_Bav_nb_TGB_All_sub_level_depe_G)
plot(res, rank = T)


#nb_TGB_living
hist(Data_univar_CWM_Bav$nb_TGB_living)
fit1<-fitdist(Data_univar_CWM_Bav$nb_TGB_living, "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Bav_nb_TGB_living_level_depe_G = glmmTMB(nb_TGB_living ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian())
summary(mod_Bav_nb_TGB_living_level_depe_G)
res = simulateResiduals(mod_Bav_nb_TGB_living_level_depe_G)
plot(res, rank = T)


#nb_TGB_dead
hist(Data_univar_CWM_Bav$nb_TGB_dead)
fit1<-fitdist(Data_univar_CWM_Bav$nb_TGB_dead, "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Bav_nb_TGB_dead_level_depe_G = glmmTMB(nb_TGB_dead ~ level_depe_G, data = Data_univar_CWM_Bav, family = nbinom2())
summary(mod_Bav_nb_TGB_dead_level_depe_G)
res = simulateResiduals(mod_Bav_nb_TGB_dead_level_depe_G)
plot(res, rank = T)


# #DW_GBTGB_dec12
# hist(Data_univar_CWM_Bav$DW_GBTGB_dec12)
# fit1<-fitdist(round(Data_univar_CWM_Bav$DW_GBTGB_dec12), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_Bav_DW_GBTGB_dec12_level_depe_G = mixed_model(fixed = round(DW_GBTGB_dec12) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Bav, family = negative.binomial())
# summary(mod_Bav_DW_GBTGB_dec12_level_depe_G)
# res = simulateResiduals(mod_Bav_DW_GBTGB_dec12_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_GBTGB_dec34
# hist(Data_univar_CWM_Bav$DW_GBTGB_dec34)
# fit1<-fitdist(round(Data_univar_CWM_Bav$DW_GBTGB_dec34), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_Bav_DW_GBTGB_dec34_level_depe_G = mixed_model(fixed = round(DW_GBTGB_dec34) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Bav, family = negative.binomial())
# summary(mod_Bav_DW_GBTGB_dec34_level_depe_G)
# res = simulateResiduals(mod_Bav_DW_GBTGB_dec34_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_PBBM_dec12
# fit1<-fitdist(round(Data_univar_CWM_Bav$DW_PBBM_dec12), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_Bav_DW_PBBM_dec12_level_depe_G = mixed_model(fixed = round(DW_PBBM_dec12) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Bav, family = negative.binomial())
# summary(mod_Bav_DW_PBBM_dec12_level_depe_G)
# res = simulateResiduals(mod_Bav_DW_PBBM_dec12_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_PBBM_dec34
# fit1<-fitdist(round(Data_univar_CWM_Bav$DW_PBBM_dec34), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_Bav_DW_PBBM_dec34_level_depe_G = mixed_model(fixed = round(DW_PBBM_dec34) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Bav, family = negative.binomial())
# summary(mod_Bav_DW_PBBM_dec34_level_depe_G)
# res = simulateResiduals(mod_Bav_DW_PBBM_dec34_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_BMD_dec12
# fit1<-fitdist(round(Data_univar_CWM_Bav$DW_BMD_dec12), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_Bav_DW_BMD_dec12_level_depe_G = mixed_model(fixed = round(DW_BMD_dec12) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Bav, family = negative.binomial())
# summary(mod_Bav_DW_BMD_dec12_level_depe_G)
# res = simulateResiduals(mod_Bav_DW_BMD_dec12_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_BMD_dec34
# fit1<-fitdist(round(Data_univar_CWM_Bav$DW_BMD_dec34), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_Bav_DW_BMD_dec34_level_depe_G = mixed_model(fixed = round(DW_BMD_dec34) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Bav, family = negative.binomial())
# summary(mod_Bav_DW_BMD_dec34_level_depe_G)
# res = simulateResiduals(mod_Bav_DW_BMD_dec34_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_BMS_dec12
# fit1<-fitdist(round(Data_univar_CWM_Bav$DW_BMS_dec12), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_Bav_DW_BMS_dec12_level_depe_G = mixed_model(fixed = round(DW_BMS_dec12) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Bav, family = negative.binomial())
# summary(mod_Bav_DW_BMS_dec12_level_depe_G)
# res = simulateResiduals(mod_Bav_DW_BMS_dec12_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_BMS_dec34
# fit1<-fitdist(round(Data_univar_CWM_Bav$DW_BMS_dec34), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_Bav_DW_BMS_dec34_level_depe_G = mixed_model(fixed = round(DW_BMS_dec34) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Bav, family = negative.binomial())
# summary(mod_Bav_DW_BMS_dec34_level_depe_G)
# res = simulateResiduals(mod_Bav_DW_BMS_dec34_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_BMS_PBBM
# fit1<-fitdist(round(Data_univar_CWM_Bav$DW_BMS_PBBM), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_Bav_DW_BMS_PBBM_level_depe_G = mixed_model(fixed = round(DW_BMS_PBBM) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Bav, family = negative.binomial())
# summary(mod_Bav_DW_BMS_PBBM_level_depe_G)
# res = simulateResiduals(mod_Bav_DW_BMS_PBBM_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_BMS_GBTGB
# fit1<-fitdist(round(Data_univar_CWM_Bav$DW_BMS_GBTGB), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_Bav_DW_BMS_GBTGB_level_depe_G = mixed_model(fixed = round(DW_BMS_GBTGB) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Bav, family = negative.binomial())
# summary(mod_Bav_DW_BMS_GBTGB_level_depe_G)
# res = simulateResiduals(mod_Bav_DW_BMS_GBTGB_level_depe_G)
# plot(res, rank = T)
# 
# 
# #DW_BMD_PBBM
# fit1<-fitdist(round(Data_univar_CWM_Bav$DW_BMD_PBBM), "nbinom", start = NULL)
# gofstat(fit1)$chisqpvalue
# 
# mod_Bav_DW_BMD_PBBM_level_depe_G = mixed_model(fixed = round(DW_BMD_PBBM) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Bav, family = negative.binomial())
# summary(mod_Bav_DW_BMD_PBBM_level_depe_G)
# res = simulateResiduals(mod_Bav_DW_BMD_PBBM_level_depe_G)
# plot(res, rank = T)


#DW_BMD_GBTGB
fit1<-fitdist(round(Data_univar_CWM_Bav$DW_BMD_GBTGB), "nbinom", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Bav_DW_BMD_GBTGB_level_depe_G = glmmTMB(DW_BMD_GBTGB ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian())
summary(mod_Bav_DW_BMD_GBTGB_level_depe_G)
res = simulateResiduals(mod_Bav_DW_BMD_GBTGB_level_depe_G)
plot(res, rank = T)


#DW_div_tot
hist(Data_univar_CWM_Bav$DW_div_tot)
fit1<-fitdist(Data_univar_CWM_Bav$DW_div_tot, "pois", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Bav_DW_div_tot_level_depe_G = glmmTMB(DW_div_tot ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian())
summary(mod_Bav_DW_div_tot_level_depe_G)
res = simulateResiduals(mod_Bav_DW_div_tot_level_depe_G)
plot(res, rank = T)

# ggplot(data = Data_univar_CWM_Bav, aes(y = sqrt(DW_div_tot), x = level_depe_G)) + geom_point() + geom_smooth(method = "lm")


#FRic
hist(Data_univar_CWM_Bav$FRic)
fit1<-fitdist(sqrt(Data_univar_CWM_Bav$FRic), "norm", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Bav_FRic_level_depe_G = glmmTMB(FRic ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian())
summary(mod_Bav_FRic_level_depe_G)
res = simulateResiduals(mod_Bav_FRic_level_depe_G)
plot(res, rank = T)

# ggplot(data = Data_univar_CWM_Bav, aes(y = FRic, x = level_depe_G, color = Region)) + geom_point() + geom_smooth(method = "lm")


#FDiv
hist(Data_univar_CWM_Bav$FDiv)
fit1<-fitdist(Data_univar_CWM_Bav$FDiv, "beta", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Bav_FDiv_level_depe_G = glmmTMB(FDiv ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian())
summary(mod_Bav_FDiv_level_depe_G)
res = simulateResiduals(mod_Bav_FDiv_level_depe_G)
plot(res, rank = T)


#FEve
hist(Data_univar_CWM_Bav$FEve)
shapiro.test(Data_univar_CWM_Bav$FEve)
# fit1<-fitdist(na.omit(Data_univar_CWM_Bav$FEve), "norm", start = NULL)
# gofstat(fit1)$chisqpvalue

mod_Bav_FEve_level_depe_G = glmmTMB(FEve ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian())
summary(mod_Bav_FEve_level_depe_G)
res = simulateResiduals(mod_Bav_FEve_level_depe_G)
plot(res, rank = T)


#FDis
hist(Data_univar_CWM_Bav$FDis)
fit1<-fitdist(sqrt(Data_univar_CWM_Bav$FDis), "norm", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Bav_FDis_level_depe_G = glmmTMB(FDis ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian())
summary(mod_Bav_FDis_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_level_depe_G)
plot(res, rank = T)


#CWM_statut
hist(Data_univar_CWM_Bav$CWM_statut)

mod_Bav_CWM_statut_level_depe_G = glmmTMB(CWM_statut ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian())
summary(mod_Bav_CWM_statut_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_statut_level_depe_G)
plot(res, rank = T)


#FDis_statut
hist(Data_univar_CWM_Bav$FDis_statut)

mod_Bav_FDis_statut_level_depe_G = glmmTMB(FDis_statut ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian())
summary(mod_Bav_FDis_statut_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_statut_level_depe_G)
plot(res, rank = T)


#CWM_stade_saprox
hist(Data_univar_CWM_Bav$CWM_stade_saprox)
fit1<-fitdist(sqrt(Data_univar_CWM_Bav$CWM_stade_saprox), "norm", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Bav_CWM_stade_saprox_level_depe_G = glmmTMB(CWM_stade_saprox ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian())
summary(mod_Bav_CWM_stade_saprox_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_stade_saprox_level_depe_G)
plot(res, rank = T)


#FDis_stade_saprox
hist(Data_univar_CWM_Bav$FDis_stade_saprox)
fit1<-fitdist(sqrt(Data_univar_CWM_Bav$FDis_stade_saprox), "norm", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Bav_FDis_stade_saprox_level_depe_G = glmmTMB(FDis_stade_saprox ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian())
summary(mod_Bav_FDis_stade_saprox_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_stade_saprox_level_depe_G)
plot(res, rank = T)


#CWM_dbh
hist(Data_univar_CWM_Bav$CWM_dbh)
fit1<-fitdist(Data_univar_CWM_Bav$CWM_dbh, "norm", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Bav_CWM_dbh_level_depe_G = glmmTMB(CWM_dbh ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian())
summary(mod_Bav_CWM_dbh_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_dbh_level_depe_G)
plot(res, rank = T)


#FDis_dbh
hist(Data_univar_CWM_Bav$FDis_dbh)
fit1<-fitdist(Data_univar_CWM_Bav$FDis_dbh, "gamma", start = NULL)
gofstat(fit1)$chisqpvalue

mod_Bav_FDis_dbh_level_depe_G = glmmTMB(FDis_dbh ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian())
summary(mod_Bav_FDis_dbh_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_dbh_level_depe_G)
plot(res, rank = T)


```


###Bavaria Magnitude study
```{r Bav Magnitude study}



#LW_vol
summary(mod_Bav_LW_vol_level_depe_G)

set.seed(1)
Estimate_mod_Bav_LW_vol_level_depe_G = rnorm(10000, mean = -578.52, sd = 73.91)
summary(Data_univar_CWM_Bav$LW_vol)
val_predict = predict(glmmTMB(LW_vol ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_LW_vol_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_LW_vol_level_depe_G)



#DW_vol
hist(Data_univar_CWM_Bav$DW_vol)
summary(mod_Bav_DW_vol_level_depe_G)

set.seed(1)
Estimate_mod_Bav_DW_vol_level_depe_G = rnorm(10000, mean = 331.255, sd = 37.495)
summary(Data_univar_CWM_Bav$DW_vol)
val_predict = predict(glmmTMB(DW_vol ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_DW_vol_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_DW_vol_level_depe_G)



#DW_dec12
summary(mod_Bav_DW_dec12_level_depe_G)

set.seed(1)
Estimate_mod_Bav_DW_dec12_level_depe_G = rnorm(10000, mean = 70.92, sd = 32.6)
summary(Data_univar_CWM_Bav$DW_dec12)
val_predict = predict(glmmTMB(DW_dec12 ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_DW_dec12_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_DW_dec12_level_depe_G)



#DW_dec34
summary(mod_Bav_DW_dec34_level_depe_G)

set.seed(1)
Estimate_mod_Bav_DW_dec34_level_depe_G = rnorm(10000, mean = 260.395, sd = 26.479)
summary(Data_univar_CWM_Bav$DW_dec34)
val_predict = predict(glmmTMB(DW_dec34 ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_DW_dec34_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_DW_dec34_level_depe_G)



#DW_PBBM
summary(mod_Bav_DW_PBBM_level_depe_G)

set.seed(1)
Estimate_mod_Bav_DW_PBBM_level_depe_G = rnorm(10000, mean = 188.58, sd = 31)
summary(Data_univar_CWM_Bav$DW_PBBM)
val_predict = predict(glmmTMB(DW_PBBM ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_DW_PBBM_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_DW_PBBM_level_depe_G)



#DW_GBTGB
summary(mod_Bav_DW_GBTGB_level_depe_G)

set.seed(1)
Estimate_mod_Bav_DW_GBTGB_level_depe_G = rnorm(10000, mean = 143.025, sd = 23.732)
summary(Data_univar_CWM_Bav$DW_GBTGB)
val_predict = predict(glmmTMB(DW_GBTGB ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_DW_GBTGB_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_DW_GBTGB_level_depe_G)



#DW_BMS
summary(mod_Bav_DW_BMS_level_depe_G)

set.seed(1)
Estimate_mod_Bav_DW_BMS_level_depe_G = rnorm(10000, mean = 143.65, sd = 27.59)
summary(Data_univar_CWM_Bav$DW_BMS)
val_predict = predict(glmmTMB(DW_BMS ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_DW_BMS_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_DW_BMS_level_depe_G)



#DW_BMD
summary(mod_Bav_DW_BMD_level_depe_G)

set.seed(1)
Estimate_mod_Bav_DW_BMD_level_depe_G = rnorm(10000, mean = 187.786, sd = 32.874)
summary(Data_univar_CWM_Bav$DW_BMD)
val_predict = predict(glmmTMB(DW_BMD ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_DW_BMD_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_DW_BMD_level_depe_G)



#nb_TGB_All_sub
summary(mod_Bav_nb_TGB_All_sub_level_depe_G)

set.seed(1)
Estimate_mod_Bav_nb_TGB_All_sub_level_depe_G = rnorm(10000, mean = -10.449, sd = 4.283)
summary(Data_univar_CWM_Bav$nb_TGB_All_sub)
val_predict = predict(glmmTMB(nb_TGB_All_sub ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_nb_TGB_All_sub_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_nb_TGB_All_sub_level_depe_G)



#nb_TGB_living
summary(mod_Bav_nb_TGB_living_level_depe_G)

set.seed(1)
Estimate_mod_Bav_nb_TGB_living_level_depe_G = rnorm(10000, mean = -11.091, sd = 3.824)
summary(Data_univar_CWM_Bav$nb_TGB_living)
val_predict = predict(glmmTMB(nb_TGB_living ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_nb_TGB_living_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_nb_TGB_living_level_depe_G)



#nb_TGB_dead
summary(mod_Bav_nb_TGB_dead_level_depe_G)

set.seed(1)
Estimate_mod_Bav_nb_TGB_dead_level_depe_G = rnorm(10000, mean = 0.7279, sd = 1.941)

D <- exp(Estimate_mod_Bav_nb_TGB_dead_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Bav_nb_TGB_dead_level_depe_G)



# #DW_GBTGB_dec12
# summary(mod_Bav_DW_GBTGB_dec12_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Bav_DW_GBTGB_dec12_level_depe_G = rnorm(10000, mean = 3.7814, sd = 3.4942)
# 
# D <- exp(Estimate_mod_Bav_DW_GBTGB_dec12_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Bav_DW_GBTGB_dec12_level_depe_G)
# 
# 
# 
# #DW_GBTGB_dec34
# summary(mod_Bav_DW_GBTGB_dec34_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Bav_DW_GBTGB_dec34_level_depe_G = rnorm(10000, mean = 3.5947, sd = 1.2082)
# 
# D <- exp(Estimate_mod_Bav_DW_GBTGB_dec34_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Bav_DW_GBTGB_dec34_level_depe_G)
# 
# 
# 
# #DW_PBBM_dec12
# summary(mod_Bav_DW_PBBM_dec12_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Bav_DW_PBBM_dec12_level_depe_G = rnorm(10000, mean = 2.8038, sd = 4.6194)
# 
# D <- exp(Estimate_mod_Bav_DW_PBBM_dec12_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Bav_DW_PBBM_dec12_level_depe_G)
# 
# 
# 
# #DW_PBBM_dec34
# summary(mod_Bav_DW_PBBM_dec34_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Bav_DW_PBBM_dec34_level_depe_G = rnorm(10000, mean = 4.9183, sd = 1.2801)
# 
# D <- exp(Estimate_mod_Bav_DW_PBBM_dec34_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Bav_DW_PBBM_dec34_level_depe_G)
# 
# 
# 
# #DW_BMD_dec12
# summary(mod_Bav_DW_BMD_dec12_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Bav_DW_BMD_dec12_level_depe_G = rnorm(10000, mean = 5, sd = 4.7161)
# 
# D <- exp(Estimate_mod_Bav_DW_BMD_dec12_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Bav_DW_BMD_dec12_level_depe_G)
# 
# 
# 
# #DW_BMD_dec34
# summary(mod_Bav_DW_BMD_dec34_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Bav_DW_BMD_dec34_level_depe_G = rnorm(10000, mean = 2.9316, sd = 1.542)
# 
# D <- exp(Estimate_mod_Bav_DW_BMD_dec34_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Bav_DW_BMD_dec34_level_depe_G)
# 
# 
# 
# #DW_BMS_dec12
# summary(mod_Bav_DW_BMS_dec12_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Bav_DW_BMS_dec12_level_depe_G = rnorm(10000, mean = 5.298, sd = 4.4129)
# 
# D <- exp(Estimate_mod_Bav_DW_BMS_dec12_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Bav_DW_BMS_dec12_level_depe_G)
# 
# 
# 
# #DW_BMS_dec34
# summary(mod_Bav_DW_BMS_dec34_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Bav_DW_BMS_dec34_level_depe_G = rnorm(10000, mean = 4.7931, sd = 1.1596)
# 
# D <- exp(Estimate_mod_Bav_DW_BMS_dec34_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Bav_DW_BMS_dec34_level_depe_G)
# 
# 
# 
# #DW_BMS_PBBM
# summary(mod_Bav_DW_BMS_PBBM_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Bav_DW_BMS_PBBM_level_depe_G = rnorm(10000, mean = 6.4172, sd = 1.4671)
# 
# D <- exp(Estimate_mod_Bav_DW_BMS_PBBM_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Bav_DW_BMS_PBBM_level_depe_G)
# 
# 
# 
# #DW_BMS_GBTGB
# summary(mod_Bav_DW_BMS_GBTGB_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Bav_DW_BMS_GBTGB_level_depe_G = rnorm(10000, mean = 2.5057, sd = 1.3698)
# 
# D <- exp(Estimate_mod_Bav_DW_BMS_GBTGB_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Bav_DW_BMS_GBTGB_level_depe_G)
# 
# 
# 
# #DW_BMD_PBBM
# summary(mod_Bav_DW_BMD_PBBM_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Bav_DW_BMD_PBBM_level_depe_G = rnorm(10000, mean = 1.6093, sd = 2.8836)
# 
# D <- exp(Estimate_mod_Bav_DW_BMD_PBBM_level_depe_G * 0.27)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Bav_DW_BMD_PBBM_level_depe_G)



#DW_BMD_GBTGB
summary(mod_Bav_DW_BMD_GBTGB_level_depe_G)

set.seed(1)
Estimate_mod_Bav_DW_BMD_GBTGB_level_depe_G = rnorm(10000, mean = 16.4775, sd = 13.0646)

D <- exp(Estimate_mod_Bav_DW_BMD_GBTGB_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Bav_DW_BMD_GBTGB_level_depe_G)



#DW_div_tot
summary(mod_Bav_DW_div_tot_level_depe_G)

set.seed(1)
Estimate_mod_Bav_DW_div_tot_level_depe_G = rnorm(10000, mean = 2.3821, sd = 1.0458)
summary(Data_univar_CWM_Bav$DW_div_tot)
val_predict = predict(glmmTMB(DW_div_tot ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_DW_div_tot_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_DW_div_tot_level_depe_G)



#FRic
summary(mod_Bav_FRic_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FRic_level_depe_G = rnorm(10000, mean = 0.02238, sd = 0.03329)
summary(Data_univar_CWM_Bav$FRic)
val_predict = predict(glmmTMB(FRic ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_FRic_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FRic_level_depe_G)



#FDiv
summary(mod_Bav_FDiv_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDiv_level_depe_G = rnorm(10000, mean = 0.39547, sd = 0.14763)
summary(Data_univar_CWM_Bav$FDiv)
val_predict = predict(glmmTMB(FDiv ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_FDiv_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDiv_level_depe_G)



#FEve
summary(mod_Bav_FEve_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FEve_level_depe_G = rnorm(10000, mean = 0.37396, sd = 0.11705)
summary(Data_univar_CWM_Bav$FEve)
val_predict = predict(glmmTMB(FEve ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_FEve_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FEve_level_depe_G)



#CWM_statut
ggplot(data = Data_univar_CWM_Bav, aes(y = CWM_statut, x = level_depe_G, color = site)) + geom_point() + geom_smooth(method = "glm", method.args = list(family = gaussian()), formula = y ~ x, fullrange = T)
summary(mod_Bav_CWM_statut_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_statut_level_depe_G = rnorm(10000, mean = -1.6181, sd = 0.09105)
summary(Data_univar_CWM_Bav$CWM_statut)
val_predict = predict(glmmTMB(CWM_statut ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_CWM_statut_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_CWM_statut_level_depe_G)



#FDis_statut
ggplot(data = Data_univar_CWM_Bav, aes(y = FDis_statut, x = level_depe_G, color = site)) + geom_point() + geom_smooth(method = "lm", fullrange = T) + xlim(0,1)
summary(mod_Bav_FDis_statut_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_statut_level_depe_G = rnorm(10000, mean = 0.42898, sd = 0.13105)
summary(Data_univar_CWM_Bav$FDis_statut)
val_predict = predict(glmmTMB(FDis_statut ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_FDis_statut_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_statut_level_depe_G)



#CWM_stade_saprox
ggplot(data = Data_univar_CWM_Bav, aes(y = CWM_stade_saprox, x = level_depe_G, color = site)) + geom_point() + geom_smooth(method = "lm", fullrange = T) + xlim(0,1)
summary(mod_Bav_CWM_stade_saprox_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_stade_saprox_level_depe_G = rnorm(10000, mean = 0.5209, sd = 0.2715)
summary(Data_univar_CWM_Bav$CWM_stade_saprox)
val_predict = predict(glmmTMB(CWM_stade_saprox ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_CWM_stade_saprox_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_CWM_stade_saprox_level_depe_G)



#FDis_stade_saprox
ggplot(data = Data_univar_CWM_Bav, aes(y = FDis_stade_saprox, x = level_depe_G, color = site)) + geom_point() + geom_smooth(method = "lm", fullrange = T)
summary(mod_Bav_FDis_stade_saprox_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_stade_saprox_level_depe_G = rnorm(10000, mean = -0.04423, sd = 0.08005)
summary(Data_univar_CWM_Bav$FDis_stade_saprox)
val_predict = predict(glmmTMB(FDis_stade_saprox ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_FDis_stade_saprox_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_stade_saprox_level_depe_G)



#CWM_dbh
ggplot(data = Data_univar_CWM_Bav, aes(y = CWM_dbh, x = level_depe_G, color = site)) + geom_point() + geom_smooth(method = "lm", fullrange = T) + xlim(0,1)
summary(mod_Bav_CWM_dbh_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_dbh_level_depe_G = rnorm(10000, mean = 4.133, sd = 3.689)
summary(Data_univar_CWM_Bav$CWM_dbh)
val_predict = predict(glmmTMB(CWM_dbh ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_CWM_dbh_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_CWM_dbh_level_depe_G)



#FDis_dbh
ggplot(data = Data_univar_CWM_Bav, aes(y = FDis_dbh, x = level_depe_G, color = site)) + geom_point() + geom_smooth(method = "lm", fullrange = T) + xlim(0,1)
summary(mod_Bav_FDis_dbh_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_dbh_level_depe_G = rnorm(10000, mean = 0.01831, sd = 0.09097)
summary(Data_univar_CWM_Bav$FDis_dbh)
val_predict = predict(glmmTMB(FDis_dbh ~ level_depe_G, data = Data_univar_CWM_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_FDis_dbh_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_dbh_level_depe_G)


```








###Construction figure magnitudes
```{r Construction figure magnitudes}


Tab_results_magnitude <- readxl::read_xlsx("Tab_result_habitat_study.xlsx", sheet = "Magnitude_DW")


Tab_results_magnitude$Y = factor(Tab_results_magnitude$Y, levels = c("vol. LW", "nb. Very Large Living", "vol. DW", "div. DW", "vol. DW dec12", "vol. DW dec34", "vol. DW Med", "vol. DW LarVer", "vol. DW Lying", "vol. DW Standing", "nb. Very Large All", "nb. Very Large Dead", "vol. DW LarVer dec12", "vol. DW LarVer dec34", "vol. DW Med dec12", "vol. DW Med dec34", "vol. DW Standing dec12", "vol. DW Standing dec34", "vol. DW Lying dec12", "vol. DW Lying dec34", "vol. DW Lying Med", "vol. DW Lying LarVer", "vol. DW Standing Med", "vol. DW Standing LarVer", "Functional Richness", "Functional Divergence", "Functional Evenness", "CWM Substrate", "FDis Substrate", "CWM Decay stage", "FDis Decay stage", "CWM Diameter", "FDis Diameter"))
Tab_results_magnitude$Y = fct_rev(Tab_results_magnitude$Y)

Tab_results_magnitude = dplyr::filter(Tab_results_magnitude, Y != "nb. Very Large All")

Tab_results_magnitude$pval_0_01 = factor(Tab_results_magnitude$pval_0_01, levels = c("ns", "p < 0.01", "p < 0.001", "p < 0.0001"))
Tab_results_magnitude$pval = factor(Tab_results_magnitude$pval, levels = c("ns", "p < 0.05", "p < 0.01", "p < 0.001", "p < 0.0001"))
Tab_results_magnitude$Context = factor(Tab_results_magnitude$Context, levels = c("Fir", "Spruce", "Oak"))
# Tab_results_magnitude$pval = as.numeric(Tab_results_magnitude$pval)
# Tab_results_magnitude$pval = factor(Tab_results_magnitude$pval, levels = c("ns", "p < 0.0001", "p < 0.001", "p < 0.01", "p < 0.05"))

tab_Magnitude_DW_ress_Simple = filter(Tab_results_magnitude, cat1 %in% "Ressource", cat2 %in% "Simple", keep == 1)
tab_Magnitude_DW_ress_Simple$Context = factor(tab_Magnitude_DW_ress_Simple$Context, levels = c("Fir", "Spruce", "Oak"))

Magnitude_DW_ress_Simple = ggplot(tab_Magnitude_DW_ress_Simple, aes(x = Y, y = magn_mean, color = Context, ymin = magn_CI25, ymax = magn_CI975, size = pval)) + coord_flip() + geom_hline(yintercept = 0, linetype = 2) + geom_point(position = position_dodge(width = -1), alpha = 1) + geom_errorbar(size = 0.5, width = 0, position = position_dodge(width = -1), alpha = 1) + theme_bw() + theme(axis.title.y = element_blank(), plot.subtitle = element_text(color="grey20", size=10, face="italic"), strip.text = element_blank()) + scale_color_manual(values = c("#4F9B8A", "#D076B5", "#A28346")) + scale_size_manual(values = c(1,2.5,4,5,6), labels = c("ns", "p < 0.05", "p < 0.01", "p < 0.001", "p < 0.0001")) + labs(y = "Magnitude (+/- 95% Confidence Interval)", size = "p.value", color = "Context") + ylim(-1.2,5) + ggtitle(label = "Woody elements", subtitle = "Ecological groups") + facet_grid(fct_rev(Y) ~ ., scales = "free")

Magnitude_DW_ress_Simple
ggsave("Figures/Magnitude_DW_ress_Simple.png", plot = Magnitude_DW_ress_Simple, width = 20, height = 19, units = "cm", type = "cairo")




Magnitude_DW_ress_Simple_CVL = ggplot(filter(tab_Magnitude_DW_ress_Simple, Context %in% "Oak"), aes(x = Y, y = magn_mean, color = Context, ymin = magn_CI25, ymax = magn_CI975, size = pval)) + coord_flip() + geom_hline(yintercept = 0, linetype = 2) + geom_point(position = position_dodge(width = -1), alpha = 1) + geom_errorbar(size = 0.5, width = 0, position = position_dodge(width = -1), alpha = 1) + theme_bw() + theme(axis.title.y = element_blank(), plot.subtitle = element_text(color="grey20", size=10, face="italic"), strip.text = element_blank()) + scale_color_manual(values = c("#A28346")) + scale_size_manual(values = c(1,2.5,4,6), labels = c("ns", "p < 0.05", "p < 0.01", "p < 0.0001")) + labs(y = "Magnitude (+/- 95% Confidence Interval)", size = "p.value", color = "Context") + ylim(-1.2,5) + ggtitle(label = "Dead wood", subtitle = "Resource") + facet_grid(fct_rev(Y) ~ ., scales = "free")

Magnitude_DW_ress_Simple_CVL
ggsave("Figures/Magnitude_DW_ress_Simple_CVL.png", plot = Magnitude_DW_ress_Simple_CVL, width = 15, height = 15, units = "cm", type = "cairo")




# Magnitude_DW_ress_Sim_Com = ggplot(filter(Tab_results_magnitude, cat1 %in% "Ressource", Context %in% "All", cat2 %in% "Complex"), aes(x = Y, y = magn_mean, ymin = magn_CI25, ymax = magn_CI975, size = pval)) + coord_flip() + geom_hline(yintercept = 0, linetype = 2) + geom_errorbar(size = 0.5, width = 0) + geom_point(color = "grey20") + theme_bw() + theme(axis.title.y = element_blank(), plot.subtitle = element_text(color="grey20", size=10, face="italic")) + scale_color_manual(values = c("grey20")) + scale_size_manual(values = c(1,2.5,4,6), labels = c("ns", "p < 0.05", "p < 0.01", "p < 0.0001")) + labs(y = "Magnitude (+/- 95% Confidence Interval)", size = "p.value") + ylim(-1,3)
# 
# Magnitude_DW_ress_Sim_Com
# ggsave("Figures/Magnitude_DW_ress_Sim_Com.png", plot = Magnitude_DW_ress_Sim_Com, width = 20, height = 10, units = "cm", type = "cairo")
# + ggtitle(label = "Woody biomass", subtitle = "Ressource")


tab_Magnitude_DW_traits_Simple = filter(Tab_results_magnitude, cat1 %in% "Traits", cat2 %in% "Simple", keep == 1)
tab_Magnitude_DW_traits_Simple$Context = factor(tab_Magnitude_DW_traits_Simple$Context, levels = c("Fir", "Spruce", "Oak"))

Magnitude_DW_traits_Simple = ggplot(tab_Magnitude_DW_traits_Simple, aes(x = Y, y = magn_mean, ymin = magn_CI25, ymax = magn_CI975, color = Context, size = pval)) + coord_flip() + geom_hline(yintercept = 0, linetype = 2) + geom_point(position = position_dodge(width = -1), alpha = 1) + geom_errorbar(size = 0.5, width = 0, position = position_dodge(width = -1), alpha = 1) + theme_bw() + theme(axis.title.y = element_blank(), plot.subtitle = element_text(color="grey20", size=10, face="italic")) + scale_color_manual(values = c("#4F9B8A", "#D076B5", "#A28346")) + scale_size_manual(values = c(1,4,6), labels = c("ns", "p < 0.01", "p < 0.0001")) + labs(y = "Magnitude (+/- 95% Confidence Interval)", size = "p.value", color = "Context") + ylim(-3.5,5) + ggtitle(label = "Woody elements", subtitle = "Traits")

Magnitude_DW_traits_Simple
ggsave("Figures/Magnitude_DW_traits_Simple.png", plot = Magnitude_DW_traits_Simple, width = 20, height = 9, units = "cm", type = "cairo")




Magnitude_DW_traits_Simple_CVL = ggplot(filter(tab_Magnitude_DW_traits_Simple, Context %in% "Oak"), aes(x = Y, y = magn_mean, ymin = magn_CI25, ymax = magn_CI975, color = Context, size = pval)) + coord_flip() + geom_hline(yintercept = 0, linetype = 2) + geom_point(position = position_dodge(width = -1), alpha = 1) + geom_errorbar(size = 0.5, width = 0, position = position_dodge(width = -1), alpha = 1) + theme_bw() + theme(axis.title.y = element_blank(), plot.subtitle = element_text(color="grey20", size=10, face="italic")) + scale_color_manual(values = c("#A28346")) + scale_size_manual(values = c(1,4,6), labels = c("ns", "p < 0.01", "p < 0.0001")) + labs(y = "Magnitude (+/- 95% Confidence Interval)", size = "p.value", color = "Context") + ylim(-3.5,5) + ggtitle(label = "Woody elements", subtitle = "Traits")

Magnitude_DW_traits_Simple_CVL
ggsave("Figures/Magnitude_DW_traits_Simple_CVL.png", plot = Magnitude_DW_traits_Simple_CVL, width = 15, height = 7, units = "cm", type = "cairo")


```





##Multivariate analysis
###Pyrenees

####Ordination
``` {r Deadwood Pyrenees}


veganCovEllipse <- function (cov, center = c(0, 0), scale = 1, npoints = 100) 
{
  theta <- (0:npoints) * 2 * pi/npoints
  Circle <- cbind(cos(theta), sin(theta))
  t(center + scale * t(Circle %*% chol(cov)))
}



#Preparation nMDS
Data_plotxtype_Pyr_env = Data_plotxtype_Pyr %>%
  rownames_to_column(var = "plot") %>%
  left_join(General, by = "plot") %>%
  filter(salvaged != 1)
Data_plotxtype_Pyr_env$cat_depe = factor(Data_plotxtype_Pyr_env$cat_depe, levels = c("Low","Medium","High"))
Data_plotxtype_Pyr_env$cat_depe01 = factor(Data_plotxtype_Pyr_env$cat_depe01, levels = c(0,1), labels = c("Low", "Mid & High"))
Data_plotxtype_Pyr_env$class_depe_G = factor(Data_plotxtype_Pyr_env$class_depe_G, levels = c("[0 ; 15]","]15 ; 40]","]40 ; 70]"))

dist_DW_Pyrenees <- vegdist(column_to_rownames(Data_plotxtype_Pyr_env[1:65], "plot"), method = "bray", binary = F)
ord_DW_CLIMTREE_Pyr <- metaMDS(column_to_rownames(Data_plotxtype_Pyr_env[1:65], "plot"), k=4)
ord_DW_CLIMTREE_Pyr
stressplot(ord_DW_CLIMTREE_Pyr)



#only deadwood
Data_plotxtype_Pyr_dead_no0 = Data_plotxtype_Pyr_dead[rowSums(Data_plotxtype_Pyr_dead[])>0,]
Data_plotxtype_Pyr_dead_env = Data_plotxtype_Pyr_dead_no0 %>%
  rownames_to_column(var = "plot") %>%
  left_join(General, by = "plot") %>%
  filter(salvaged != 1)
Data_plotxtype_Pyr_dead_env$cat_depe = factor(Data_plotxtype_Pyr_dead_env$cat_depe, levels = c("Low","Medium","High"))
Data_plotxtype_Pyr_dead_env$cat_depe01 = factor(Data_plotxtype_Pyr_dead_env$cat_depe01, levels = c(0,1), labels = c("Low", "Mid & High"))
Data_plotxtype_Pyr_dead_env$class_depe_G = factor(Data_plotxtype_Pyr_dead_env$class_depe_G, levels = c("[0 ; 15]","]15 ; 40]","]40 ; 70]"))



##ggplot

NMDS_DW_CLIMTREE_Pyr <- data.frame(NMDS1 = ord_DW_CLIMTREE_Pyr$points[,1], NMDS2 = ord_DW_CLIMTREE_Pyr$points[,2], group = Data_plotxtype_Pyr_env$class_depe_G)

df_ell_NMDS_DW_Pyr <- data.frame() #sets up a data frame before running the function.
for(g in levels(NMDS_DW_CLIMTREE_Pyr$group)){
  df_ell_NMDS_DW_Pyr <- rbind(df_ell_NMDS_DW_Pyr, cbind(as.data.frame(with(NMDS_DW_CLIMTREE_Pyr [NMDS_DW_CLIMTREE_Pyr$group==g,],
                                                         veganCovEllipse(cov.wt(cbind(NMDS1,NMDS2),wt=rep(1/length(NMDS1),length(NMDS1)))$cov,center=c(mean(NMDS1),mean(NMDS2))))) ,group=g))
}

NMDS_DW_CLIMTREE_Pyr.mean <- aggregate(NMDS_DW_CLIMTREE_Pyr[,1:2], list(group=NMDS_DW_CLIMTREE_Pyr$group), mean)
segments_DW_CLIMTREE_Pyr <- merge(NMDS_DW_CLIMTREE_Pyr,NMDS_DW_CLIMTREE_Pyr.mean, by="group", suffixes = c("",".centroid"))



GGplot_NMDS_DW_CLIMTREE_Pyr <- ggplot(NMDS_DW_CLIMTREE_Pyr, aes(NMDS1, NMDS2)) +
  geom_point(size = 2, aes(color = group, shape=group)) +
  geom_path(data = df_ell_NMDS_DW_Pyr, aes(x = NMDS1, y = NMDS2, group = group, color = group), size = 1)+
  theme_classic() +
  scale_color_manual(values = c("[0 ; 15]" = "#77DCC5", "]15 ; 40]" = "#49A490", "]40 ; 70]" = "#3B7165")) +
  labs(colour = "Forest\nmortality", shape = "Forest\nmortality") +
  theme(legend.position="bottom") +
  theme(legend.position="bottom", plot.subtitle = element_text(color="grey20", size=10, face="italic")) +
  ggtitle(label= "Fir-dominated forests", subtitle = "Woody elements") +
  xlim(-1,1) +
  ylim(-1,1) +
  annotate(geom = "text", label = "p < 0.001 ***\nstress = 0.126", x = 0.3, y = 0.9, hjust = 0)
GGplot_NMDS_DW_CLIMTREE_Pyr

ggsave("Figures//nMDS_DW_CLIMPyr.png", plot = GGplot_NMDS_DW_CLIMTREE_Pyr, width = 10, height = 10, units = "cm")



#Adonis
set.seed(1)
adonis2(dist_DW_Pyrenees ~ level.depe, data = Data_plotxtype_Pyr_env, strata = Data_plotxtype_Pyr_env$site)
set.seed(1)
adonis2(dist_DW_Pyrenees ~ level_depe_G, data = Data_plotxtype_Pyr_env, strata = Data_plotxtype_Pyr_env$site)
set.seed(1)
adonis2(dist_DW_Pyrenees ~ class_depe_G, data = Data_plotxtype_Pyr_env, strata = Data_plotxtype_Pyr_env$site)



#Anosim
ANOSIM_DW_Pyrenees <- anosim(dist_DW_Pyrenees, Data_plotxtype_Pyr_env$class_depe_G)
summary(ANOSIM_DW_Pyrenees)
plot(ANOSIM_DW_Pyrenees)

#Anosim comparison
df_ANOSIM_DW_Pyrenees <- as.data.frame(cbind(ANOSIM_DW_Pyrenees$dis.rank, as.character(ANOSIM_DW_Pyrenees$class.vec)))
df_ANOSIM_DW_Pyrenees$V1  <- as.numeric(df_ANOSIM_DW_Pyrenees$V1)

df_ANOSIM_DW_Pyrenees = filter(df_ANOSIM_DW_Pyrenees, V2 != "Between")
df_ANOSIM_DW_Pyrenees$V2 = factor(df_ANOSIM_DW_Pyrenees$V2, levels = c("[0 ; 15]", "]15 ; 40]", "]40 ; 70]"), labels = c("[0 ; 15]", "]15 ; 40]", "]40 ; 70]"))

ggplot(df_ANOSIM_DW_Pyrenees, aes(x = V2, y = V1)) +
  geom_boxplot(notch = T)

hist(df_ANOSIM_DW_Pyrenees$V1)
fit1<-fitdist(df_ANOSIM_DW_Pyrenees$V1, "norm", start = NULL)
gofstat(fit1)$chisqpvalue
summary(lm(normalize(V1, "scale") ~ V2, data = df_ANOSIM_DW_Pyrenees))
# plot(lm(normalize(V1, "scale") ~ V2, data = df_ANOSIM_DW_Pyrenees))

Pyr_anosim_DW_lm = lm(V1 ~ V2, data = df_ANOSIM_DW_Pyrenees)
Pyr_anosim_DW_emmeans <- emmeans(Pyr_anosim_DW_lm, "V2")
pairs(Pyr_anosim_DW_emmeans)

summarySE_ANOSIM_DW_Pyrenees = summarySE(data = df_ANOSIM_DW_Pyrenees, measurevar = "V1", groupvars = "V2")

plot_ANOSIM_DW_Pyrenees = ggplot(summarySE_ANOSIM_DW_Pyrenees, aes(x = V2, y = V1)) + geom_bar(stat="identity", alpha = 0.8, width = 0.5, aes(fill = V2)) + geom_errorbar(aes(ymin = V1 - se, ymax = V1 + se), size = 0.8, width = .1) + scale_fill_manual(values=c("[0 ; 15]" = "#77DCC5", "]15 ; 40]" = "#49A490", "]40 ; 70]" = "#3B7165")) + theme_bw() + theme(legend.position = "none") + labs(y="Dissimilarity value\n(intra-class)", x = "Forest mortality") + ylim(0, 950) + geom_segment(aes(x=1, y=875, xend=3, yend=875)) + annotate(geom = "text", label = "***", x = 2, y = 920) + geom_segment(aes(x=2, y=775, xend=3, yend=775)) + annotate(geom = "text", label = "***", x = 2.5, y = 820) + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + ggtitle(label= "Fir-dominated forests", subtitle = "Woody elements - β-diversity")
plot_ANOSIM_DW_Pyrenees

ggsave("Figures/plot_ANOSIM_DW_Pyrenees.png", plot = plot_ANOSIM_DW_Pyrenees, units = "cm", width = 8, height=8, type = "cairo")
# ggsave("Figures/plot_ANOSIM_DW_Pyrenees.pdf", plot = plot_ANOSIM_DW_Pyrenees, units = "cm", width = 8, height=8)


#Anosim DW
ANOSIM_Only_DW_Pyrenees <- anosim(vegdist(column_to_rownames(Data_plotxtype_Pyr_env[1:41], "plot"), method = "bray", binary = F), Data_plotxtype_Pyr_env$class_depe_G)
summary(ANOSIM_Only_DW_Pyrenees)
plot(ANOSIM_Only_DW_Pyrenees)

#Anosim comparison DW
df_ANOSIM_Only_DW_Pyrenees <- as.data.frame(cbind(ANOSIM_Only_DW_Pyrenees$dis.rank, as.character(ANOSIM_Only_DW_Pyrenees$class.vec)))
df_ANOSIM_Only_DW_Pyrenees$V1  <- as.numeric(df_ANOSIM_Only_DW_Pyrenees$V1)

df_ANOSIM_Only_DW_Pyrenees = filter(df_ANOSIM_Only_DW_Pyrenees, V2 != "Between")
df_ANOSIM_Only_DW_Pyrenees$V2 = factor(df_ANOSIM_Only_DW_Pyrenees$V2, levels = c("[0 ; 15]", "]15 ; 40]", "]40 ; 70]"), labels = c("[0 ; 15]", "]15 ; 40]", "]40 ; 70]"))

ggplot(df_ANOSIM_Only_DW_Pyrenees, aes(x = V2, y = V1)) +
  geom_boxplot(notch = T)

hist(df_ANOSIM_Only_DW_Pyrenees$V1)
fit1<-fitdist(df_ANOSIM_Only_DW_Pyrenees$V1, "norm", start = NULL)
gofstat(fit1)$chisqpvalue
summary(lm(normalize(V1, "scale") ~ V2, data = df_ANOSIM_Only_DW_Pyrenees))
# plot(lm(normalize(V1, "scale") ~ V2, data = df_ANOSIM_Only_DW_Pyrenees))

Pyr_anosim_DW_dead_lm = lm(V1 ~ V2, data = df_ANOSIM_Only_DW_Pyrenees)
Pyr_anosim_DW_dead_emmeans <- emmeans(Pyr_anosim_DW_dead_lm, "V2")
pairs(Pyr_anosim_DW_dead_emmeans)

summarySE_ANOSIM_only_DW_Pyrenees = summarySE(data = df_ANOSIM_Only_DW_Pyrenees, measurevar = "V1", groupvars = "V2")

plot_ANOSIM_only_DW_Pyrenees = ggplot(summarySE_ANOSIM_only_DW_Pyrenees, aes(x = V2, y = V1)) + geom_bar(stat="identity", alpha = 0.8, width = 0.5, aes(fill = V2)) + geom_errorbar(aes(ymin = V1 - se, ymax = V1 + se), size = 0.8, width = .1) + scale_fill_manual(values=c("[0 ; 15]" = "#77DCC5", "]15 ; 40]" = "#49A490", "]40 ; 70]" = "#3B7165")) + theme_bw() + theme(legend.position = "none") + labs(y="Dissimilarity value\n(intra-class)", x = "Forest mortality") + ylim(0, 850) + geom_segment(aes(x=1, y=700, xend=1.95, yend=700)) + annotate(geom = "text", label = "***", x = 1.5, y = 730) + geom_segment(aes(x=2.05, y=700, xend=3, yend=700)) + annotate(geom = "text", label = "**", x = 2.5, y = 730) + geom_segment(aes(x=1, y=780, xend=3, yend=780)) + annotate(geom = "text", label = "***", x = 2, y = 820) + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + ggtitle(label= "Fir-dominated forests", subtitle = "Deadwood - β-diversity")
plot_ANOSIM_only_DW_Pyrenees

ggsave("Figures/plot_ANOSIM_only_DW_Pyrenees.png", plot = plot_ANOSIM_only_DW_Pyrenees, units = "cm", width = 8, height=8, type = "cairo")

#Simper
summary(simper(Data_plotxtype_Pyr_env[2:65], Data_plotxtype_Pyr_env$class_depe_G, permutations = 999), ordered = T)
summary(simper(Data_plotxtype_Pyr_dead_env[2:41], Data_plotxtype_Pyr_dead_env$class_depe_G, permutations = 999), ordered = T)

#Indval
set.seed(1)
Indval_DW_Pyrenees <-  multipatt(Data_plotxtype_Pyr_env[2:65], Data_plotxtype_Pyr_env$class_depe_G, control = how(nperm=999), func = "IndVal.g", duleg=T)
summary(Indval_DW_Pyrenees, indvalcomp=TRUE)

```



####Adipart
```{r Adipart Pyrenees}

##### Woody elements
#####

# [0 ; 15]
y_adipart_Pyr_0_15 = Data_plotxtype_Pyr_env %>%
  dplyr::filter(class_depe_G %in% "[0 ; 15]")

x_adipart_Pyr_0_15 = y_adipart_Pyr_0_15 %>%
  dplyr::select("plot", "site", "class_depe_G")
y_adipart_Pyr_0_15 = round(y_adipart_Pyr_0_15[2:65])


adipart(y_adipart_Pyr_0_15 ~ plot + site + class_depe_G, x_adipart_Pyr_0_15, index="richness", nsimul=999, relative = F, weighted = T)

adipart(y_adipart_Pyr_0_15 ~ plot + site + class_depe_G, x_adipart_Pyr_0_15, index="richness", nsimul=999, relative = T, weighted = T)



# ]15 ; 40]
y_adipart_Pyr_15_40 = Data_plotxtype_Pyr_env %>%
  dplyr::filter(class_depe_G %in% "]15 ; 40]")

x_adipart_Pyr_15_40 = y_adipart_Pyr_15_40 %>%
  dplyr::select("plot", "site", "class_depe_G")
y_adipart_Pyr_15_40 = round(y_adipart_Pyr_15_40[2:65])


adipart(y_adipart_Pyr_15_40 ~ plot + site + class_depe_G, x_adipart_Pyr_15_40, index="richness", nsimul=999, relative = F, weighted = T)

adipart(y_adipart_Pyr_15_40 ~ plot + site + class_depe_G, x_adipart_Pyr_15_40, index="richness", nsimul=999, relative = T, weighted = T)

# ]40 ; 70]
y_adipart_Pyr_40_70 = Data_plotxtype_Pyr_env %>%
  dplyr::filter(class_depe_G %in% "]40 ; 70]")

x_adipart_Pyr_40_70 = y_adipart_Pyr_40_70 %>%
  dplyr::select("plot", "site", "class_depe_G")
y_adipart_Pyr_40_70 = round(y_adipart_Pyr_40_70[2:65])


adipart(y_adipart_Pyr_40_70 ~ plot + site + class_depe_G, x_adipart_Pyr_40_70, index="richness", nsimul=999, relative = F, weighted = T)

adipart(y_adipart_Pyr_40_70 ~ plot + site + class_depe_G, x_adipart_Pyr_40_70, index="richness", nsimul=999, relative = T, weighted = T)


```




####



###Loire

####Ordination
``` {r Deadwood Loire}


#Preparation nMDS
Data_plotxtype_CVL_env = Data_plotxtype_CVL %>%
  rownames_to_column(var = "plot") %>%
  left_join(General, by = "plot") %>%
  filter(salvaged != 1)
Data_plotxtype_CVL_env$cat_depe = factor(Data_plotxtype_CVL_env$cat_depe, levels = c("Low","Medium","High"))
Data_plotxtype_CVL_env$cat_depe01 = factor(Data_plotxtype_CVL_env$cat_depe01, levels = c(0,1), labels = c("Low", "Mid & High"))
Data_plotxtype_CVL_env$class_depe_G = factor(Data_plotxtype_CVL_env$class_depe_G, levels = c("[0 ; 10]","]10 ; 40]"))

dist_DW_CVL <- vegdist(column_to_rownames(Data_plotxtype_CVL_env[1:24], var = "plot"), method = "bray", binary = F)
ord_DW_CVL <- metaMDS(dist_DW_CVL, k=4, try = 20)
ord_DW_CVL
stressplot(ord_DW_CVL)



#only deadwood
Data_plotxtype_CVL_dead_no0 = Data_plotxtype_CVL_dead[rowSums(Data_plotxtype_CVL_dead[])>0,]
Data_plotxtype_CVL_dead_env = Data_plotxtype_CVL_dead_no0 %>%
  rownames_to_column(var = "plot") %>%
  left_join(General, by = "plot") %>%
  filter(salvaged != 1)
Data_plotxtype_CVL_dead_env$cat_depe = factor(Data_plotxtype_CVL_dead_env$cat_depe, levels = c("Low","Medium","High"))
Data_plotxtype_CVL_dead_env$cat_depe01 = factor(Data_plotxtype_CVL_dead_env$cat_depe01, levels = c(0,1), labels = c("Low", "Mid & High"))
Data_plotxtype_CVL_dead_env$class_depe_G = factor(Data_plotxtype_CVL_dead_env$class_depe_G, levels = c("[0 ; 10]","]10 ; 40]"))
# 
# dist_DW_CVL <- vegdist(column_to_rownames(Data_plotxtype_CVL_dead_env[1:13], var = "plot"), method = "bray", binary = F)
# ord_DW_CVL <- metaMDS(dist_DW_CVL, k=3, try = 20)
# ord_DW_CVL
# # ord_DW_CANOPEE_cat <- wcmdscale(dist_DW_CANOPEE_cat, eig = T, add = T)
# # ord_DW_CANOPEE_cat
# stressplot(ord_DW_CVL)
# 
# adonis(dist_DW_CVL ~ level.depe, data = Data_plotxtype_CVL_dead_env, strata = Data_plotxtype_CVL_dead_env$Region)
# adonis(dist_DW_CVL ~ cat_depe, data = Data_plotxtype_CVL_dead_env, strata = Data_plotxtype_CVL_dead_env$Region)



##ggplot

NMDS_DW_CVL <- data.frame(NMDS1 = ord_DW_CVL$points[,1], NMDS2 = ord_DW_CVL$points[,2], group = Data_plotxtype_CVL_env$class_depe_G)

df_ell_NMDS_DW_CVL <- data.frame() #sets up a data frame before running the function.
for(g in levels(NMDS_DW_CVL$group)){
  df_ell_NMDS_DW_CVL <- rbind(df_ell_NMDS_DW_CVL, cbind(as.data.frame(with(NMDS_DW_CVL [NMDS_DW_CVL$group==g,],
                                                         veganCovEllipse(cov.wt(cbind(NMDS1,NMDS2),wt=rep(1/length(NMDS1),length(NMDS1)))$cov,center=c(mean(NMDS1),mean(NMDS2))))) ,group=g))
}

NMDS_DW_CVL.mean <- aggregate(NMDS_DW_CVL[,1:2], list(group=NMDS_DW_CVL$group), mean)
segments_DW_CVL <- merge(NMDS_DW_CVL,NMDS_DW_CVL.mean, by="group", suffixes = c("",".centroid"))



GGplot_NMDS_DW_CVL <- ggplot(NMDS_DW_CVL, aes(NMDS1, NMDS2)) +
  geom_point(size = 2, aes(color = group, shape=group)) +
  geom_path(data = df_ell_NMDS_DW_CVL, aes(x = NMDS1, y = NMDS2, group = group, color = group), size = 1)+
  theme_classic() +
  scale_color_manual(values = c("[0 ; 10]" = "#E5C07F", "]10 ; 40]" = "#AC8B4E")) +
  labs(colour = "Forest\nmortality", shape = "Forest\nmortality") +
  theme(legend.position="bottom") +
  theme(legend.position="bottom", plot.subtitle = element_text(color="grey20", size=10, face="italic")) +
  ggtitle(label= "Oak-dominated forests", subtitle = "Woody elements") +
  xlim(-0.5,0.5) +
  ylim(-0.5,0.5) +
  annotate(geom = "text", label = "p < 0.05 *\nstress = 0.04", x = 0.1, y = 0.45, hjust = 0)
GGplot_NMDS_DW_CVL

ggsave("Figures//nMDS_DW_CVL.png", plot = GGplot_NMDS_DW_CVL, width = 10, height = 10, units = "cm")



#Adonis
set.seed(1)
adonis2(dist_DW_CVL ~ level.depe, data = Data_plotxtype_CVL_env, strata = Data_plotxtype_CVL_env$site)
set.seed(1)
adonis2(dist_DW_CVL ~ level_depe_G, data = Data_plotxtype_CVL_env, strata = Data_plotxtype_CVL_env$site)
set.seed(1)
adonis2(dist_DW_CVL ~ class_depe_G, data = Data_plotxtype_CVL_env, strata = Data_plotxtype_CVL_env$site)

#Anosim
ANOSIM_DW_CVL <- anosim(dist_DW_CVL, Data_plotxtype_CVL_env$class_depe_G)
summary(ANOSIM_DW_CVL)
plot(ANOSIM_DW_CVL)

#Anosim comparison
df_ANOSIM_DW_CVL <- as.data.frame(cbind(ANOSIM_DW_CVL$dis.rank, as.character(ANOSIM_DW_CVL$class.vec)))
df_ANOSIM_DW_CVL$V1  <- as.numeric(df_ANOSIM_DW_CVL$V1)

df_ANOSIM_DW_CVL = filter(df_ANOSIM_DW_CVL, V2 != "Between")
df_ANOSIM_DW_CVL$V2 = factor(df_ANOSIM_DW_CVL$V2, levels = c("[0 ; 10]", "]10 ; 40]"), labels = c("[0 ; 10]", "]10 ; 40]"))

ggplot(df_ANOSIM_DW_CVL, aes(x = V2, y = V1)) +
  geom_boxplot(notch = T)

hist(df_ANOSIM_DW_CVL$V1)
fit1<-fitdist(df_ANOSIM_DW_CVL$V1, "norm", start = NULL)
gofstat(fit1)$chisqpvalue
summary(lm(normalize(V1, "scale") ~ V2, data = df_ANOSIM_DW_CVL))
# plot(lm(normalize(V1, "scale") ~ V2, data = df_ANOSIM_DW_CVL))

t.test(df_ANOSIM_DW_CVL$V1 ~ df_ANOSIM_DW_CVL$V2)
summarySE_ANOSIM_DW_CVL = summarySE(data = df_ANOSIM_DW_CVL, measurevar = "V1", groupvars = "V2")

plot_ANOSIM_DW_CVL = ggplot(summarySE_ANOSIM_DW_CVL, aes(x = V2, y = V1)) + geom_bar(stat="identity", alpha = 0.8, width = 0.5, aes(fill = V2)) + geom_errorbar(aes(ymin = V1 - se, ymax = V1 + se), size = 0.8, width = .1) + scale_fill_manual(values=c("[0 ; 10]" = "#E5C07F", "]10 ; 40]" = "#AC8B4E")) + theme_bw() + theme(legend.position = "none") + labs(y="Dissimilarity value\n(intra-class)", x = "Forest mortality") + ylim(0, 125) + geom_segment(aes(x=1, y=109, xend=2, yend=109)) + annotate(geom = "text", label = "ns", x = 1.5, y = 115, hjust = 0) + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + ggtitle(label= "Oak-dominated forests", subtitle = "Woody elements - β-diversity")
plot_ANOSIM_DW_CVL

ggsave("Figures/plot_ANOSIM_DW_CVL.png", plot = plot_ANOSIM_DW_CVL, units = "cm", width = 8, height=8, type = "cairo")
# ggsave("Figures/plot_ANOSIM_DW_CVL.pdf", plot = plot_ANOSIM_DW_CVL, units = "cm", width = 8, height=8)



#Anosim DW
Data_plotxtype_CVL_env_onlyDW = Data_plotxtype_CVL_env[rowSums(Data_plotxtype_CVL_env[2:13])>0,]
rownames(Data_plotxtype_CVL_env_onlyDW) = NULL

ANOSIM_Only_DW_CVL <- anosim(vegdist(column_to_rownames(Data_plotxtype_CVL_env_onlyDW[1:13], "plot"), method = "bray", binary = F), Data_plotxtype_CVL_env_onlyDW$class_depe_G)
summary(ANOSIM_Only_DW_CVL)
plot(ANOSIM_Only_DW_CVL)

#Anosim comparison DW
df_ANOSIM_Only_DW_CVL <- as.data.frame(cbind(ANOSIM_Only_DW_CVL$dis.rank, as.character(ANOSIM_Only_DW_CVL$class.vec)))
df_ANOSIM_Only_DW_CVL$V1  <- as.numeric(df_ANOSIM_Only_DW_CVL$V1)

df_ANOSIM_Only_DW_CVL = filter(df_ANOSIM_Only_DW_CVL, V2 != "Between")

ggplot(df_ANOSIM_Only_DW_CVL, aes(x = V2, y = V1)) +
  geom_boxplot(notch = T)

hist(df_ANOSIM_Only_DW_CVL$V1)
fit1<-fitdist(df_ANOSIM_Only_DW_CVL$V1, "norm", start = NULL)
gofstat(fit1)$chisqpvalue
summary(lm(V1 ~ V2, data = df_ANOSIM_Only_DW_CVL))
# plot(lm(normalize(V1, "scale") ~ V2, data = df_ANOSIM_Only_DW_CVL))

t.test(df_ANOSIM_Only_DW_CVL$V1 ~ df_ANOSIM_Only_DW_CVL$V2)
summarySE_ANOSIM_only_DW_CVL = summarySE(data = df_ANOSIM_Only_DW_CVL, measurevar = "V1", groupvars = "V2")

plot_ANOSIM_only_DW_CVL = ggplot(summarySE_ANOSIM_only_DW_CVL, aes(x = V2, y = V1)) + geom_bar(stat="identity", alpha = 0.8, width = 0.5, aes(fill = V2)) + geom_errorbar(aes(ymin = V1 - se, ymax = V1 + se), size = 0.8, width = .1) + scale_fill_manual(values=c("[0 ; 10]" = "#E5C07F", "]10 ; 40]" = "#AC8B4E")) + theme_bw() + theme(legend.position = "none") + labs(y="Dissimilarity value\n(intra-class)", x = "Forest mortality") + ylim(0, 65) + geom_segment(aes(x=1, y=55, xend=2, yend=55)) + annotate(geom = "text", label = "ns", x = 1.5, y = 59, hjust = 0) + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + ggtitle(label= "Oak-dominated forests", subtitle = "Deadwood - β-diversity")
plot_ANOSIM_only_DW_CVL

ggsave("Figures/plot_ANOSIM_only_DW_CVL.png", plot = plot_ANOSIM_only_DW_CVL, units = "cm", width = 8, height=8, type = "cairo")


#Simper
summary(simper(Data_plotxtype_CVL_env[2:24], Data_plotxtype_CVL_env$class_depe_G, permutations = 999), ordered = T)
summary(simper(Data_plotxtype_CVL_dead_env[2:13], Data_plotxtype_CVL_dead_env$class_depe_G, permutations = 999), ordered = T)

#Indval
set.seed(1)
Indval_DW_CVL <-  multipatt(Data_plotxtype_CVL_env[2:24], Data_plotxtype_CVL_env$class_depe_G, control = how(nperm=999), func = "IndVal.g", duleg=T)
summary(Indval_DW_CVL, indvalcomp=TRUE)

```



####Adipart
```{r Adipart CVL}

# [0 ; 10]
y_adipart_CVL_0_10 = Data_plotxtype_CVL_env %>%
  dplyr::filter(class_depe_G %in% "[0 ; 10]")

x_adipart_CVL_0_10 = y_adipart_CVL_0_10 %>%
  dplyr::select("plot", "site", "class_depe_G")
y_adipart_CVL_0_10 = round(y_adipart_CVL_0_10[2:24])


adipart(y_adipart_CVL_0_10 ~ plot + site + class_depe_G, x_adipart_CVL_0_10, index="richness", nsimul=999, relative = F, weighted = T)

adipart(y_adipart_CVL_0_10 ~ plot + site + class_depe_G, x_adipart_CVL_0_10, index="richness", nsimul=999, relative = T, weighted = T)



# ]10 ; 40]
y_adipart_CVL_10_40 = Data_plotxtype_CVL_env %>%
  dplyr::filter(class_depe_G %in% "]10 ; 40]")

x_adipart_CVL_10_40 = y_adipart_CVL_10_40 %>%
  dplyr::select("plot", "site", "class_depe_G")
y_adipart_CVL_10_40 = round(y_adipart_CVL_10_40[2:24])


adipart(y_adipart_CVL_10_40 ~ plot + site + class_depe_G, x_adipart_CVL_10_40, index="richness", nsimul=999, relative = F, weighted = T)

adipart(y_adipart_CVL_10_40 ~ plot + site + class_depe_G, x_adipart_CVL_10_40, index="richness", nsimul=999, relative = T, weighted = T)


```




####




###Bavaria

####Ordination
``` {r Deadwood Bavaria}

#Preparation nMDS
Data_plotxtype_Bav_env = Data_plotxtype_Bav %>%
  rownames_to_column(var = "plot") %>%
  left_join(General, by = "plot") %>%
  filter(salvaged != 1)
Data_plotxtype_Bav_env$cat_depe01 = factor(Data_plotxtype_Bav_env$cat_depe01, levels = c(0,1), labels = c("Low", "Mid & High"))
Data_plotxtype_Bav_env$class_depe_G = factor(Data_plotxtype_Bav_env$class_depe_G, levels = c("[0 ; 15]","]15 ; 40]","]70 ; 100]"))

dist_DW_Bav <- vegdist(column_to_rownames(Data_plotxtype_Bav_env[1:39], "plot"), method = "bray", binary = F)
ord_DW_CLIMTREE_Bav <- metaMDS(dist_DW_Bav, k=4)
ord_DW_CLIMTREE_Bav
stressplot(ord_DW_CLIMTREE_Bav)



#only deadwood
Data_plotxtype_Bav_dead_no0 = Data_plotxtype_Bav_dead[rowSums(Data_plotxtype_Bav_dead[])>0,]
Data_plotxtype_Bav_dead_env = Data_plotxtype_Bav_dead_no0 %>%
  rownames_to_column(var = "plot") %>%
  left_join(General, by = "plot") %>%
  filter(salvaged != 1)
Data_plotxtype_Bav_dead_env$cat_depe01 = factor(Data_plotxtype_Bav_dead_env$cat_depe01, levels = c(0,1), labels = c("Low", "Mid & High"))
Data_plotxtype_Bav_dead_env$class_depe_G = factor(Data_plotxtype_Bav_dead_env$class_depe_G, levels = c("[0 ; 15]","]15 ; 40]","]70 ; 100]"))




##ggplot

NMDS_DW_CLIMTREE_Bav <- data.frame(NMDS1 = ord_DW_CLIMTREE_Bav$points[,1], NMDS2 = ord_DW_CLIMTREE_Bav$points[,2], group = Data_plotxtype_Bav_env$class_depe_G)

df_ell_NMDS_DW_Bav <- data.frame() #sets up a data frame before running the function.
for(g in levels(NMDS_DW_CLIMTREE_Bav$group)){
  df_ell_NMDS_DW_Bav <- rbind(df_ell_NMDS_DW_Bav, cbind(as.data.frame(with(NMDS_DW_CLIMTREE_Bav [NMDS_DW_CLIMTREE_Bav$group==g,],
                                                         veganCovEllipse(cov.wt(cbind(NMDS1,NMDS2),wt=rep(1/length(NMDS1),length(NMDS1)))$cov,center=c(mean(NMDS1),mean(NMDS2))))) ,group=g))
}

NMDS_DW_CLIMTREE_Bav.mean <- aggregate(NMDS_DW_CLIMTREE_Bav[,1:2], list(group=NMDS_DW_CLIMTREE_Bav$group), mean)
segments_DW_CLIMTREE_Bav <- merge(NMDS_DW_CLIMTREE_Bav,NMDS_DW_CLIMTREE_Bav.mean, by="group", suffixes = c("",".centroid"))



GGplot_NMDS_DW_CLIMTREE_Bav <- ggplot(NMDS_DW_CLIMTREE_Bav, aes(NMDS1, NMDS2)) +
  geom_point(size = 2, aes(color = group, shape=group)) +
  geom_path(data = df_ell_NMDS_DW_Bav, aes(x = NMDS1, y = NMDS2, group = group, color = group), size = 1)+
  theme_classic() +
  scale_color_manual(values = c("[0 ; 15]" = "#E9A7D6", "]15 ; 40]" = "#AE3E8D", "]70 ; 100]" = "#78205E")) +
  labs(colour = "Forest\nmortality", shape = "Forest\nmortality") +
  theme(legend.position="bottom") +
  theme(legend.position="bottom", plot.subtitle = element_text(color="grey20", size=10, face="italic")) +
  ggtitle(label= "Spruce-dominated forests", subtitle = "Woody elements") +
  xlim(-0.5,0.5) +
  ylim(-0.5,0.5) +
  annotate(geom = "text", label = "p < 0.001 ***\nstress = 0.04", x = -0.4, y = 0.45, hjust = 0)
GGplot_NMDS_DW_CLIMTREE_Bav

ggsave("Figures//nMDS_DW_CLIMBav.png", plot = GGplot_NMDS_DW_CLIMTREE_Bav, width = 10, height = 10, units = "cm")




#Adonis
set.seed(1)
adonis2(dist_DW_Bav ~ cat_depe01, data = Data_plotxtype_Bav_env)
set.seed(1)
adonis2(dist_DW_Bav ~ level_depe_G, data = Data_plotxtype_Bav_env)
set.seed(1)
adonis2(dist_DW_Bav ~ class_depe_G, data = Data_plotxtype_Bav_env)

#Anosim
ANOSIM_DW_Bav <- anosim(dist_DW_Bav, Data_plotxtype_Bav_env$class_depe_G)
summary(ANOSIM_DW_Bav)
plot(ANOSIM_DW_Bav)

#Anosim comparison
df_ANOSIM_DW_Bav <- as.data.frame(cbind(ANOSIM_DW_Bav$dis.rank, as.character(ANOSIM_DW_Bav$class.vec)))
df_ANOSIM_DW_Bav$V1  <- as.numeric(df_ANOSIM_DW_Bav$V1)

df_ANOSIM_DW_Bav = filter(df_ANOSIM_DW_Bav, V2 != "Between")

ggplot(df_ANOSIM_DW_Bav, aes(x = V2, y = V1)) +
  geom_boxplot(notch = T)

hist(df_ANOSIM_DW_Bav$V1)
fit1<-fitdist(df_ANOSIM_DW_Bav$V1, "norm", start = NULL)
gofstat(fit1)$chisqpvalue
summary(lm(normalize(V1, "scale") ~ V2, data = df_ANOSIM_DW_Bav))
# plot(lm(normalize(V1, "scale") ~ V2, data = df_ANOSIM_DW_Bav))

Bav_anosim_DW_lm = lm(V1 ~ V2, data = df_ANOSIM_DW_Bav)
Bav_anosim_DW_emmeans <- emmeans(Bav_anosim_DW_lm, "V2")
pairs(Bav_anosim_DW_emmeans)

summarySE_ANOSIM_DW_Bav = summarySE(data = df_ANOSIM_DW_Bav, measurevar = "V1", groupvars = "V2")

plot_ANOSIM_DW_Bav = ggplot(summarySE_ANOSIM_DW_Bav, aes(x = V2, y = V1)) + geom_bar(stat="identity", alpha = 0.8, width = 0.5, aes(fill = V2)) + geom_errorbar(aes(ymin = V1 - se, ymax = V1 + se), size = 0.8, width = .1) + scale_fill_manual(values=c("[0 ; 15]" = "#E9A7D6", "]15 ; 40]" = "#AE3E8D", "]70 ; 100]" = "#78205E")) + theme_bw() + theme(legend.position = "none") + labs(y="Dissimilarity value\n(intra-class)", x = "Forest mortality") + ylim(0, 90) + annotate(geom = "text", label = "ns", x = 2, y = 85) + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + ggtitle(label= "Spruce-dominated forests", subtitle = "Woody elements - β-diversity")
plot_ANOSIM_DW_Bav

ggsave("Figures/plot_ANOSIM_DW_Bav.png", plot = plot_ANOSIM_DW_Bav, units = "cm", width = 8, height=8, type = "cairo")
# ggsave("Figures/plot_ANOSIM_DW_Bav.pdf", plot = plot_ANOSIM_DW_Bav, units = "cm", width = 8, height=8)



#Anosim DW
ANOSIM_Only_DW_Bav <- anosim(vegdist(column_to_rownames(Data_plotxtype_Bav_env[1:29], "plot"), method = "bray", binary = F), Data_plotxtype_Bav_env$class_depe_G)
summary(ANOSIM_Only_DW_Bav)
plot(ANOSIM_Only_DW_Bav)

#Anosim comparison DW
df_ANOSIM_Only_DW_Bav <- as.data.frame(cbind(ANOSIM_Only_DW_Bav$dis.rank, as.character(ANOSIM_Only_DW_Bav$class.vec)))
df_ANOSIM_Only_DW_Bav$V1  <- as.numeric(df_ANOSIM_Only_DW_Bav$V1)

df_ANOSIM_Only_DW_Bav = filter(df_ANOSIM_Only_DW_Bav, V2 != "Between")

ggplot(df_ANOSIM_Only_DW_Bav, aes(x = V2, y = V1)) +
  geom_boxplot(notch = T)

hist(df_ANOSIM_Only_DW_Bav$V1)
fit1<-fitdist(df_ANOSIM_Only_DW_Bav$V1, "norm", start = NULL)
gofstat(fit1)$chisqpvalue
summary(lm(normalize(V1, "scale") ~ V2, data = df_ANOSIM_Only_DW_Bav))
# plot(lm(normalize(V1, "scale") ~ V2, data = df_ANOSIM_Only_DW_Bav))

Bav_anosim_DW_dead_lm = lm(V1 ~ V2, data = df_ANOSIM_Only_DW_Bav)
Bav_anosim_DW_dead_emmeans <- emmeans(Bav_anosim_DW_dead_lm, "V2")
pairs(Bav_anosim_DW_dead_emmeans)

summarySE_ANOSIM_only_DW_Bav = summarySE(data = df_ANOSIM_Only_DW_Bav, measurevar = "V1", groupvars = "V2")

plot_ANOSIM_only_DW_Bav = ggplot(summarySE_ANOSIM_only_DW_Bav, aes(x = V2, y = V1)) + geom_bar(stat="identity", alpha = 0.8, width = 0.5, aes(fill = V2)) + geom_errorbar(aes(ymin = V1 - se, ymax = V1 + se), size = 0.8, width = .1) + scale_fill_manual(values=c("[0 ; 15]" = "#E9A7D6", "]15 ; 40]" = "#AE3E8D", "]70 ; 100]" = "#78205E")) + theme_bw() + theme(legend.position = "none") + labs(y="Dissimilarity value\n(intra-class)", x = "Forest mortality") + ylim(0, 150) + geom_segment(aes(x=2, y=112.5, xend=3, yend=112.5)) + annotate(geom = "text", label = "***", x = 2.5, y = 118) + geom_segment(aes(x=1, y=128, xend=3, yend=128)) + annotate(geom = "text", label = "***", x = 2, y = 135) + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + ggtitle(label= "Spruce-dominated forests", subtitle = "Deadwood - β-diversity")
plot_ANOSIM_only_DW_Bav

ggsave("Figures/plot_ANOSIM_only_DW_Bav.png", plot = plot_ANOSIM_only_DW_Bav, units = "cm", width = 8, height=8, type = "cairo")

#Simper
summary(simper(Data_plotxtype_Bav_env[2:39], Data_plotxtype_Bav_env$class_depe_G, permutations = 999), ordered = T)
summary(simper(Data_plotxtype_Bav_env[2:29], Data_plotxtype_Bav_env$class_depe_G, permutations = 999), ordered = T)

#Indval
set.seed(1)
Indval_DW_Bav <-  multipatt(Data_plotxtype_Bav_env[2:39], Data_plotxtype_Bav_env$class_depe_G, control = how(nperm=999), func = "IndVal.g", duleg=T)
summary(Indval_DW_Bav, indvalcomp=TRUE)

```


####Adipart
```{r Adipart Bavaria}

##### Woody elements
#####

# [0 ; 15]
y_adipart_Bav_0_15 = Data_plotxtype_Bav_env %>%
  dplyr::filter(class_depe_G %in% "[0 ; 15]")

x_adipart_Bav_0_15 = y_adipart_Bav_0_15 %>%
  dplyr::select("plot", "class_depe_G")
y_adipart_Bav_0_15 = round(y_adipart_Bav_0_15[2:39])


adipart(y_adipart_Bav_0_15 ~ plot + class_depe_G, x_adipart_Bav_0_15, index="richness", nsimul=999, relative = F, weighted = T)

adipart(y_adipart_Bav_0_15 ~ plot + class_depe_G, x_adipart_Bav_0_15, index="richness", nsimul=999, relative = T, weighted = T)



# ]15 ; 40]
y_adipart_Bav_15_40 = Data_plotxtype_Bav_env %>%
  dplyr::filter(class_depe_G %in% "]15 ; 40]")

x_adipart_Bav_15_40 = y_adipart_Bav_15_40 %>%
  dplyr::select("plot", "class_depe_G")
y_adipart_Bav_15_40 = round(y_adipart_Bav_15_40[2:39])


adipart(y_adipart_Bav_15_40 ~ plot + class_depe_G, x_adipart_Bav_15_40, index="richness", nsimul=999, relative = F, weighted = T)

adipart(y_adipart_Bav_15_40 ~ plot + class_depe_G, x_adipart_Bav_15_40, index="richness", nsimul=999, relative = T, weighted = T)

# ]70 ; 100]
y_adipart_Bav_70_100 = Data_plotxtype_Bav_env %>%
  dplyr::filter(class_depe_G %in% "]70 ; 100]")

x_adipart_Bav_70_100 = y_adipart_Bav_70_100 %>%
  dplyr::select("plot", "class_depe_G")
y_adipart_Bav_70_100 = round(y_adipart_Bav_70_100[2:39])


adipart(y_adipart_Bav_70_100 ~ plot + class_depe_G, x_adipart_Bav_70_100, index="richness", nsimul=999, relative = F, weighted = T)

adipart(y_adipart_Bav_70_100 ~ plot + class_depe_G, x_adipart_Bav_70_100, index="richness", nsimul=999, relative = T, weighted = T)


```






###################################################################





#Dendromicrohabitat
##Open Data
```{r data}

General <- readxl::read_xlsx("DATAFILE_ANALYSIS_DW.xlsx", sheet = "General")
General$cat_depe = factor(General$cat_depe, levels = c("Low", "Medium", "High"))
General$cat_depe01 = if_else(General$cat_depe == "Low",0,1)
General$class_depe_G = factor(General$class_depe_G, levels = c("[0 ; 10]", "[0 ; 15]", "]10 ; 40]", "]15 ; 40]", "]40 ; 70]", "]70 ; 100]", "Salvage"))


##Data univar

Data_univar_TreMs <- readxl::read_xlsx("DATAFILE_ANALYSIS_TreMs.xlsx", sheet = "Data_univar") %>%
  left_join(General, by = "plot")




##Data multivar

Data_traits_TreMs_All = readxl::read_xlsx("DATAFILE_ANALYSIS_TreMs.xlsx", sheet = "Data_TreMs_All")

Data_traits_TreMs_Pyr = readxl::read_xlsx("DATAFILE_ANALYSIS_TreMs.xlsx", sheet = "Data_TreMs_Pyr")

Data_traits_TreMs_CVL = readxl::read_xlsx("DATAFILE_ANALYSIS_TreMs.xlsx", sheet = "Data_TreMs_CVL")

Data_traits_TreMs_Bav = readxl::read_xlsx("DATAFILE_ANALYSIS_TreMs.xlsx", sheet = "Data_TreMs_Bav")





Data_plotxTreMs_All = readxl::read_xlsx("DATAFILE_ANALYSIS_TreMs.xlsx", sheet = "Data_plotxTreMs_All")

Data_plotxTreMs_Pyr = readxl::read_xlsx("DATAFILE_ANALYSIS_TreMs.xlsx", sheet = "Data_plotxTreMs_Pyr")

Data_plotxTreMs_CVL = readxl::read_xlsx("DATAFILE_ANALYSIS_TreMs.xlsx", sheet = "Data_plotxTreMs_CVL")
Data_plotxTreMs_CVL$plot = as.character(Data_plotxTreMs_CVL$plot)

Data_plotxTreMs_Bav = readxl::read_xlsx("DATAFILE_ANALYSIS_TreMs.xlsx", sheet = "Data_plotxTreMs_Bav")

#Randomized matrix plot x type
Random_plotxTreMs_Pyr <- randomizeMatrix(samp = column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), null.model = c("independentswap"), iterations = 999)
Random_plotxTreMs_CVL <- randomizeMatrix(samp = column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), null.model = c("independentswap"), iterations = 999)
Random_plotxTreMs_Bav <- randomizeMatrix(samp = column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), null.model = c("independentswap"), iterations = 999)


```



##Data Preparation

###dbFD
```{r data preparation}


#CWM & FDis


##CWM & FDis For gradient


#DW_type_substrate
CWM_TreMs_DW_type_substrate_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")["Glob_DW_type_substrate"], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_DW_type_substrate_Pyr <- CWM_TreMs_DW_type_substrate_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_DW_type_substrate" = "Glob_DW_type_substrate") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_DW_type_substrate_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_DW_type_substrate" = "CWM_TreMs_DW_type_substrate_Pyr$FDis")

CWM_TreMs_DW_type_substrate_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")["Glob_DW_type_substrate"], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_DW_type_substrate_CVL <- CWM_TreMs_DW_type_substrate_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_DW_type_substrate" = "Glob_DW_type_substrate") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_DW_type_substrate_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_DW_type_substrate" = "CWM_TreMs_DW_type_substrate_CVL$FDis")

CWM_TreMs_DW_type_substrate_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")["Glob_DW_type_substrate"], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_DW_type_substrate_Bav <- CWM_TreMs_DW_type_substrate_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_DW_type_substrate" = "Glob_DW_type_substrate") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_DW_type_substrate_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_DW_type_substrate" = "CWM_TreMs_DW_type_substrate_Bav$FDis")

df_CWM_TreMs_DW_type_substrate = df_CWM_TreMs_DW_type_substrate_Pyr %>%
  union(df_CWM_TreMs_DW_type_substrate_CVL) %>%
  union(df_CWM_TreMs_DW_type_substrate_Bav)



#POS
CWM_TreMs_POS_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")["Glob_POS"], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_POS_Pyr <- CWM_TreMs_POS_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_POS" = "Glob_POS") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_POS_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_POS" = "CWM_TreMs_POS_Pyr$FDis")

CWM_TreMs_POS_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")["Glob_POS"], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_POS_CVL <- CWM_TreMs_POS_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_POS" = "Glob_POS") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_POS_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_POS" = "CWM_TreMs_POS_CVL$FDis")

CWM_TreMs_POS_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")["Glob_POS"], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_POS_Bav <- CWM_TreMs_POS_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_POS" = "Glob_POS") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_POS_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_POS" = "CWM_TreMs_POS_Bav$FDis")

df_CWM_TreMs_POS = df_CWM_TreMs_POS_Pyr %>%
  union(df_CWM_TreMs_POS_CVL) %>%
  union(df_CWM_TreMs_POS_Bav)



#HUM_dry_wet
CWM_TreMs_HUM_dry_wet_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")["Glob_HUM_dry_wet"], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_HUM_dry_wet_Pyr <- CWM_TreMs_HUM_dry_wet_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_HUM_dry_wet" = "Glob_HUM_dry_wet") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_HUM_dry_wet_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_HUM_dry_wet" = "CWM_TreMs_HUM_dry_wet_Pyr$FDis")

CWM_TreMs_HUM_dry_wet_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")["Glob_HUM_dry_wet"], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_HUM_dry_wet_CVL <- CWM_TreMs_HUM_dry_wet_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_HUM_dry_wet" = "Glob_HUM_dry_wet") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_HUM_dry_wet_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_HUM_dry_wet" = "CWM_TreMs_HUM_dry_wet_CVL$FDis")

CWM_TreMs_HUM_dry_wet_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")["Glob_HUM_dry_wet"], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_HUM_dry_wet_Bav <- CWM_TreMs_HUM_dry_wet_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_HUM_dry_wet" = "Glob_HUM_dry_wet") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_HUM_dry_wet_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_HUM_dry_wet" = "CWM_TreMs_HUM_dry_wet_Bav$FDis")

df_CWM_TreMs_HUM_dry_wet = df_CWM_TreMs_HUM_dry_wet_Pyr %>%
  union(df_CWM_TreMs_HUM_dry_wet_CVL) %>%
  union(df_CWM_TreMs_HUM_dry_wet_Bav)



#LIFE
CWM_TreMs_LIFE_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")["Glob_LIFE"], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_LIFE_Pyr <- CWM_TreMs_LIFE_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_LIFE" = "Glob_LIFE") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_LIFE_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_LIFE" = "CWM_TreMs_LIFE_Pyr$FDis")

CWM_TreMs_LIFE_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")["Glob_LIFE"], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_LIFE_CVL <- CWM_TreMs_LIFE_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_LIFE" = "Glob_LIFE") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_LIFE_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_LIFE" = "CWM_TreMs_LIFE_CVL$FDis")

CWM_TreMs_LIFE_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")["Glob_LIFE"], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_LIFE_Bav <- CWM_TreMs_LIFE_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_LIFE" = "Glob_LIFE") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_LIFE_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_LIFE" = "CWM_TreMs_LIFE_Bav$FDis")

df_CWM_TreMs_LIFE = df_CWM_TreMs_LIFE_Pyr %>%
  union(df_CWM_TreMs_LIFE_CVL) %>%
  union(df_CWM_TreMs_LIFE_Bav)



#ONTO
CWM_TreMs_ONTO_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")["Glob_ONTO"], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_ONTO_Pyr <- CWM_TreMs_ONTO_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_ONTO" = "Glob_ONTO") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_ONTO_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_ONTO" = "CWM_TreMs_ONTO_Pyr$FDis")

CWM_TreMs_ONTO_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")["Glob_ONTO"], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_ONTO_CVL <- CWM_TreMs_ONTO_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_ONTO" = "Glob_ONTO") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_ONTO_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_ONTO" = "CWM_TreMs_ONTO_CVL$FDis")

CWM_TreMs_ONTO_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")["Glob_ONTO"], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_ONTO_Bav <- CWM_TreMs_ONTO_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_ONTO" = "Glob_ONTO") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_ONTO_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_ONTO" = "CWM_TreMs_ONTO_Bav$FDis")

df_CWM_TreMs_ONTO = df_CWM_TreMs_ONTO_Pyr %>%
  union(df_CWM_TreMs_ONTO_CVL) %>%
  union(df_CWM_TreMs_ONTO_Bav)





##CWM & FDis For each trait


#DW_saproxylic
CWM_TreMs_DW_saproxylic_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")[1], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_DW_saproxylic_Pyr <- CWM_TreMs_DW_saproxylic_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_DW_saproxylic" = "DW_saproxylic") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_DW_saproxylic_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_DW_saproxylic" = "CWM_TreMs_DW_saproxylic_Pyr$FDis")

CWM_TreMs_DW_saproxylic_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")[1], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_DW_saproxylic_CVL <- CWM_TreMs_DW_saproxylic_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_DW_saproxylic" = "DW_saproxylic") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_DW_saproxylic_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_DW_saproxylic" = "CWM_TreMs_DW_saproxylic_CVL$FDis")

CWM_TreMs_DW_saproxylic_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")[1], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_DW_saproxylic_Bav <- CWM_TreMs_DW_saproxylic_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_DW_saproxylic" = "DW_saproxylic") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_DW_saproxylic_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_DW_saproxylic" = "CWM_TreMs_DW_saproxylic_Bav$FDis")

df_CWM_TreMs_DW_saproxylic = df_CWM_TreMs_DW_saproxylic_Pyr %>%
  union(df_CWM_TreMs_DW_saproxylic_CVL) %>%
  union(df_CWM_TreMs_DW_saproxylic_Bav)




#DW_epixylic
CWM_TreMs_DW_epixylic_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")[2], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_DW_epixylic_Pyr <- CWM_TreMs_DW_epixylic_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_DW_epixylic" = "DW_epixylic") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_DW_epixylic_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_DW_epixylic" = "CWM_TreMs_DW_epixylic_Pyr$FDis")

CWM_TreMs_DW_epixylic_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")[2], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_DW_epixylic_CVL <- CWM_TreMs_DW_epixylic_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_DW_epixylic" = "DW_epixylic") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_DW_epixylic_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_DW_epixylic" = "CWM_TreMs_DW_epixylic_CVL$FDis")

CWM_TreMs_DW_epixylic_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")[2], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_DW_epixylic_Bav <- CWM_TreMs_DW_epixylic_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_DW_epixylic" = "DW_epixylic") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_DW_epixylic_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_DW_epixylic" = "CWM_TreMs_DW_epixylic_Bav$FDis")

df_CWM_TreMs_DW_epixylic = df_CWM_TreMs_DW_epixylic_Pyr %>%
  union(df_CWM_TreMs_DW_epixylic_CVL) %>%
  union(df_CWM_TreMs_DW_epixylic_Bav)




#DW_contains_mould
CWM_TreMs_DW_contains_mould_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")[3], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_DW_contains_mould_Pyr <- CWM_TreMs_DW_contains_mould_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_DW_contains_mould" = "DW_contains.mould") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_DW_contains_mould_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_DW_contains_mould" = "CWM_TreMs_DW_contains_mould_Pyr$FDis")

CWM_TreMs_DW_contains_mould_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")[3], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_DW_contains_mould_CVL <- CWM_TreMs_DW_contains_mould_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_DW_contains_mould" = "DW_contains.mould") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_DW_contains_mould_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_DW_contains_mould" = "CWM_TreMs_DW_contains_mould_CVL$FDis")

CWM_TreMs_DW_contains_mould_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")[3], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_DW_contains_mould_Bav <- CWM_TreMs_DW_contains_mould_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_DW_contains_mould" = "DW_contains.mould") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_DW_contains_mould_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_DW_contains_mould" = "CWM_TreMs_DW_contains_mould_Bav$FDis")

df_CWM_TreMs_DW_contains_mould = df_CWM_TreMs_DW_contains_mould_Pyr %>%
  union(df_CWM_TreMs_DW_contains_mould_CVL) %>%
  union(df_CWM_TreMs_DW_contains_mould_Bav)




#DW_living_tree
CWM_TreMs_DW_living_tree_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")[4], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_DW_living_tree_Pyr <- CWM_TreMs_DW_living_tree_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_DW_living_tree" = "DW_living_tree_linked") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_DW_living_tree_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_DW_living_tree" = "CWM_TreMs_DW_living_tree_Pyr$FDis")

CWM_TreMs_DW_living_tree_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")[4], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_DW_living_tree_CVL <- CWM_TreMs_DW_living_tree_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_DW_living_tree" = "DW_living_tree_linked") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_DW_living_tree_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_DW_living_tree" = "CWM_TreMs_DW_living_tree_CVL$FDis")

CWM_TreMs_DW_living_tree_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")[4], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_DW_living_tree_Bav <- CWM_TreMs_DW_living_tree_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_DW_living_tree" = "DW_living_tree_linked") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_DW_living_tree_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_DW_living_tree" = "CWM_TreMs_DW_living_tree_Bav$FDis")

df_CWM_TreMs_DW_living_tree = df_CWM_TreMs_DW_living_tree_Pyr %>%
  union(df_CWM_TreMs_DW_living_tree_CVL) %>%
  union(df_CWM_TreMs_DW_living_tree_Bav)




#DW_snag
CWM_TreMs_DW_snag_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")[5], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_DW_snag_Pyr <- CWM_TreMs_DW_snag_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_DW_snag" = "DW_snag_linked") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_DW_snag_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_DW_snag" = "CWM_TreMs_DW_snag_Pyr$FDis")

CWM_TreMs_DW_snag_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")[5], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_DW_snag_CVL <- CWM_TreMs_DW_snag_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_DW_snag" = "DW_snag_linked") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_DW_snag_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_DW_snag" = "CWM_TreMs_DW_snag_CVL$FDis")

CWM_TreMs_DW_snag_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")[5], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_DW_snag_Bav <- CWM_TreMs_DW_snag_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_DW_snag" = "DW_snag_linked") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_DW_snag_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_DW_snag" = "CWM_TreMs_DW_snag_Bav$FDis")

df_CWM_TreMs_DW_snag = df_CWM_TreMs_DW_snag_Pyr %>%
  union(df_CWM_TreMs_DW_snag_CVL) %>%
  union(df_CWM_TreMs_DW_snag_Bav)




#DW_log
CWM_TreMs_DW_log_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")[6], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_DW_log_Pyr <- CWM_TreMs_DW_log_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_DW_log" = "DW_log_linked") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_DW_log_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_DW_log" = "CWM_TreMs_DW_log_Pyr$FDis")

CWM_TreMs_DW_log_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")[6], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_DW_log_CVL <- CWM_TreMs_DW_log_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_DW_log" = "DW_log_linked") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_DW_log_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_DW_log" = "CWM_TreMs_DW_log_CVL$FDis")

CWM_TreMs_DW_log_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")[6], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_DW_log_Bav <- CWM_TreMs_DW_log_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_DW_log" = "DW_log_linked") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_DW_log_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_DW_log" = "CWM_TreMs_DW_log_Bav$FDis")

df_CWM_TreMs_DW_log = df_CWM_TreMs_DW_log_Pyr %>%
  union(df_CWM_TreMs_DW_log_CVL) %>%
  union(df_CWM_TreMs_DW_log_Bav)




#SH_concavity
CWM_TreMs_SH_concavity_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")[7], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_SH_concavity_Pyr <- CWM_TreMs_SH_concavity_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_SH_concavity" = "SH_concavity") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_SH_concavity_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_SH_concavity" = "CWM_TreMs_SH_concavity_Pyr$FDis")

CWM_TreMs_SH_concavity_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")[7], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_SH_concavity_CVL <- CWM_TreMs_SH_concavity_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_SH_concavity" = "SH_concavity") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_SH_concavity_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_SH_concavity" = "CWM_TreMs_SH_concavity_CVL$FDis")

CWM_TreMs_SH_concavity_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")[7], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_SH_concavity_Bav <- CWM_TreMs_SH_concavity_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_SH_concavity" = "SH_concavity") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_SH_concavity_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_SH_concavity" = "CWM_TreMs_SH_concavity_Bav$FDis")

df_CWM_TreMs_SH_concavity = df_CWM_TreMs_SH_concavity_Pyr %>%
  union(df_CWM_TreMs_SH_concavity_CVL) %>%
  union(df_CWM_TreMs_SH_concavity_Bav)




#SH_cavity
CWM_TreMs_SH_cavity_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")[8], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_SH_cavity_Pyr <- CWM_TreMs_SH_cavity_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_SH_cavity" = "SH_cavity") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_SH_cavity_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_SH_cavity" = "CWM_TreMs_SH_cavity_Pyr$FDis")

CWM_TreMs_SH_cavity_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")[8], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_SH_cavity_CVL <- CWM_TreMs_SH_cavity_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_SH_cavity" = "SH_cavity") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_SH_cavity_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_SH_cavity" = "CWM_TreMs_SH_cavity_CVL$FDis")

CWM_TreMs_SH_cavity_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")[8], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_SH_cavity_Bav <- CWM_TreMs_SH_cavity_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_SH_cavity" = "SH_cavity") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_SH_cavity_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_SH_cavity" = "CWM_TreMs_SH_cavity_Bav$FDis")

df_CWM_TreMs_SH_cavity = df_CWM_TreMs_SH_cavity_Pyr %>%
  union(df_CWM_TreMs_SH_cavity_CVL) %>%
  union(df_CWM_TreMs_SH_cavity_Bav)




#SH_crack
CWM_TreMs_SH_crack_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")[9], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_SH_crack_Pyr <- CWM_TreMs_SH_crack_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_SH_crack" = "SH_crack") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_SH_crack_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_SH_crack" = "CWM_TreMs_SH_crack_Pyr$FDis")

CWM_TreMs_SH_crack_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")[9], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_SH_crack_CVL <- CWM_TreMs_SH_crack_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_SH_crack" = "SH_crack") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_SH_crack_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_SH_crack" = "CWM_TreMs_SH_crack_CVL$FDis")

CWM_TreMs_SH_crack_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")[9], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_SH_crack_Bav <- CWM_TreMs_SH_crack_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_SH_crack" = "SH_crack") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_SH_crack_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_SH_crack" = "CWM_TreMs_SH_crack_Bav$FDis")

df_CWM_TreMs_SH_crack = df_CWM_TreMs_SH_crack_Pyr %>%
  union(df_CWM_TreMs_SH_crack_CVL) %>%
  union(df_CWM_TreMs_SH_crack_Bav)




#POS_base
CWM_TreMs_POS_base_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")[10], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_POS_base_Pyr <- CWM_TreMs_POS_base_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_POS_base" = "POS_base") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_POS_base_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_POS_base" = "CWM_TreMs_POS_base_Pyr$FDis")

CWM_TreMs_POS_base_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")[10], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_POS_base_CVL <- CWM_TreMs_POS_base_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_POS_base" = "POS_base") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_POS_base_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_POS_base" = "CWM_TreMs_POS_base_CVL$FDis")

CWM_TreMs_POS_base_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")[10], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_POS_base_Bav <- CWM_TreMs_POS_base_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_POS_base" = "POS_base") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_POS_base_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_POS_base" = "CWM_TreMs_POS_base_Bav$FDis")

df_CWM_TreMs_POS_base = df_CWM_TreMs_POS_base_Pyr %>%
  union(df_CWM_TreMs_POS_base_CVL) %>%
  union(df_CWM_TreMs_POS_base_Bav)




#POS_trunk
CWM_TreMs_POS_trunk_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")[11], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_POS_trunk_Pyr <- CWM_TreMs_POS_trunk_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_POS_trunk" = "POS_trunk") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_POS_trunk_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_POS_trunk" = "CWM_TreMs_POS_trunk_Pyr$FDis")

CWM_TreMs_POS_trunk_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")[11], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_POS_trunk_CVL <- CWM_TreMs_POS_trunk_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_POS_trunk" = "POS_trunk") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_POS_trunk_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_POS_trunk" = "CWM_TreMs_POS_trunk_CVL$FDis")

CWM_TreMs_POS_trunk_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")[11], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_POS_trunk_Bav <- CWM_TreMs_POS_trunk_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_POS_trunk" = "POS_trunk") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_POS_trunk_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_POS_trunk" = "CWM_TreMs_POS_trunk_Bav$FDis")

df_CWM_TreMs_POS_trunk = df_CWM_TreMs_POS_trunk_Pyr %>%
  union(df_CWM_TreMs_POS_trunk_CVL) %>%
  union(df_CWM_TreMs_POS_trunk_Bav)




#POS_crown
CWM_TreMs_POS_crown_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")[12], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_POS_crown_Pyr <- CWM_TreMs_POS_crown_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_POS_crown" = "POS_crown") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_POS_crown_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_POS_crown" = "CWM_TreMs_POS_crown_Pyr$FDis")

CWM_TreMs_POS_crown_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")[12], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_POS_crown_CVL <- CWM_TreMs_POS_crown_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_POS_crown" = "POS_crown") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_POS_crown_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_POS_crown" = "CWM_TreMs_POS_crown_CVL$FDis")

CWM_TreMs_POS_crown_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")[12], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_POS_crown_Bav <- CWM_TreMs_POS_crown_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_POS_crown" = "POS_crown") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_POS_crown_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_POS_crown" = "CWM_TreMs_POS_crown_Bav$FDis")

df_CWM_TreMs_POS_crown = df_CWM_TreMs_POS_crown_Pyr %>%
  union(df_CWM_TreMs_POS_crown_CVL) %>%
  union(df_CWM_TreMs_POS_crown_Bav)




#SOIL_contact
CWM_TreMs_SOIL_contact_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")[13], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_SOIL_contact_Pyr <- CWM_TreMs_SOIL_contact_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_SOIL_contact" = "SOIL_contact") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_SOIL_contact_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_SOIL_contact" = "CWM_TreMs_SOIL_contact_Pyr$FDis")

CWM_TreMs_SOIL_contact_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")[13], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_SOIL_contact_CVL <- CWM_TreMs_SOIL_contact_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_SOIL_contact" = "SOIL_contact") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_SOIL_contact_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_SOIL_contact" = "CWM_TreMs_SOIL_contact_CVL$FDis")

CWM_TreMs_SOIL_contact_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")[13], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_SOIL_contact_Bav <- CWM_TreMs_SOIL_contact_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_SOIL_contact" = "SOIL_contact") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_SOIL_contact_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_SOIL_contact" = "CWM_TreMs_SOIL_contact_Bav$FDis")

df_CWM_TreMs_SOIL_contact = df_CWM_TreMs_SOIL_contact_Pyr %>%
  union(df_CWM_TreMs_SOIL_contact_CVL) %>%
  union(df_CWM_TreMs_SOIL_contact_Bav)




#HUM_dry
CWM_TreMs_HUM_dry_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")[14], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_HUM_dry_Pyr <- CWM_TreMs_HUM_dry_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_HUM_dry" = "HUM_dry") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_HUM_dry_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_HUM_dry" = "CWM_TreMs_HUM_dry_Pyr$FDis")

CWM_TreMs_HUM_dry_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")[14], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_HUM_dry_CVL <- CWM_TreMs_HUM_dry_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_HUM_dry" = "HUM_dry") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_HUM_dry_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_HUM_dry" = "CWM_TreMs_HUM_dry_CVL$FDis")

CWM_TreMs_HUM_dry_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")[14], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_HUM_dry_Bav <- CWM_TreMs_HUM_dry_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_HUM_dry" = "HUM_dry") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_HUM_dry_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_HUM_dry" = "CWM_TreMs_HUM_dry_Bav$FDis")

df_CWM_TreMs_HUM_dry = df_CWM_TreMs_HUM_dry_Pyr %>%
  union(df_CWM_TreMs_HUM_dry_CVL) %>%
  union(df_CWM_TreMs_HUM_dry_Bav)




#HUM_wet
CWM_TreMs_HUM_wet_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")[15], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_HUM_wet_Pyr <- CWM_TreMs_HUM_wet_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_HUM_wet" = "HUM_wet") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_HUM_wet_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_HUM_wet" = "CWM_TreMs_HUM_wet_Pyr$FDis")

CWM_TreMs_HUM_wet_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")[15], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_HUM_wet_CVL <- CWM_TreMs_HUM_wet_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_HUM_wet" = "HUM_wet") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_HUM_wet_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_HUM_wet" = "CWM_TreMs_HUM_wet_CVL$FDis")

CWM_TreMs_HUM_wet_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")[15], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_HUM_wet_Bav <- CWM_TreMs_HUM_wet_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_HUM_wet" = "HUM_wet") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_HUM_wet_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_HUM_wet" = "CWM_TreMs_HUM_wet_Bav$FDis")

df_CWM_TreMs_HUM_wet = df_CWM_TreMs_HUM_wet_Pyr %>%
  union(df_CWM_TreMs_HUM_wet_CVL) %>%
  union(df_CWM_TreMs_HUM_wet_Bav)




#LIFE_ephemeral
CWM_TreMs_LIFE_ephemeral_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")[17], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_LIFE_ephemeral_Pyr <- CWM_TreMs_LIFE_ephemeral_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_LIFE_ephemeral" = "LIFE_ephemeral...1year.") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_LIFE_ephemeral_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_LIFE_ephemeral" = "CWM_TreMs_LIFE_ephemeral_Pyr$FDis")

CWM_TreMs_LIFE_ephemeral_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")[17], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_LIFE_ephemeral_CVL <- CWM_TreMs_LIFE_ephemeral_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_LIFE_ephemeral" = "LIFE_ephemeral...1year.") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_LIFE_ephemeral_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_LIFE_ephemeral" = "CWM_TreMs_LIFE_ephemeral_CVL$FDis")

CWM_TreMs_LIFE_ephemeral_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")[17], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_LIFE_ephemeral_Bav <- CWM_TreMs_LIFE_ephemeral_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_LIFE_ephemeral" = "LIFE_ephemeral...1year.") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_LIFE_ephemeral_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_LIFE_ephemeral" = "CWM_TreMs_LIFE_ephemeral_Bav$FDis")

df_CWM_TreMs_LIFE_ephemeral = df_CWM_TreMs_LIFE_ephemeral_Pyr %>%
  union(df_CWM_TreMs_LIFE_ephemeral_CVL) %>%
  union(df_CWM_TreMs_LIFE_ephemeral_Bav)




#LIFE_annual
CWM_TreMs_LIFE_annual_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")[18], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_LIFE_annual_Pyr <- CWM_TreMs_LIFE_annual_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_LIFE_annual" = "LIFE_annual") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_LIFE_annual_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_LIFE_annual" = "CWM_TreMs_LIFE_annual_Pyr$FDis")

CWM_TreMs_LIFE_annual_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")[18], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_LIFE_annual_CVL <- CWM_TreMs_LIFE_annual_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_LIFE_annual" = "LIFE_annual") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_LIFE_annual_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_LIFE_annual" = "CWM_TreMs_LIFE_annual_CVL$FDis")

CWM_TreMs_LIFE_annual_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")[18], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_LIFE_annual_Bav <- CWM_TreMs_LIFE_annual_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_LIFE_annual" = "LIFE_annual") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_LIFE_annual_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_LIFE_annual" = "CWM_TreMs_LIFE_annual_Bav$FDis")

df_CWM_TreMs_LIFE_annual = df_CWM_TreMs_LIFE_annual_Pyr %>%
  union(df_CWM_TreMs_LIFE_annual_CVL) %>%
  union(df_CWM_TreMs_LIFE_annual_Bav)




#LIFE_perenial
CWM_TreMs_LIFE_perenial_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")[19], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_LIFE_perenial_Pyr <- CWM_TreMs_LIFE_perenial_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_LIFE_perenial" = "LIFE_perenial_..1y.") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_LIFE_perenial_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_LIFE_perenial" = "CWM_TreMs_LIFE_perenial_Pyr$FDis")

CWM_TreMs_LIFE_perenial_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")[19], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_LIFE_perenial_CVL <- CWM_TreMs_LIFE_perenial_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_LIFE_perenial" = "LIFE_perenial_..1y.") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_LIFE_perenial_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_LIFE_perenial" = "CWM_TreMs_LIFE_perenial_CVL$FDis")

CWM_TreMs_LIFE_perenial_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")[19], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_LIFE_perenial_Bav <- CWM_TreMs_LIFE_perenial_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_LIFE_perenial" = "LIFE_perenial_..1y.") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_LIFE_perenial_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_LIFE_perenial" = "CWM_TreMs_LIFE_perenial_Bav$FDis")

df_CWM_TreMs_LIFE_perenial = df_CWM_TreMs_LIFE_perenial_Pyr %>%
  union(df_CWM_TreMs_LIFE_perenial_CVL) %>%
  union(df_CWM_TreMs_LIFE_perenial_Bav)




#ONTO_slow
CWM_TreMs_ONTO_slow_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")[22], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_ONTO_slow_Pyr <- CWM_TreMs_ONTO_slow_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_ONTO_slow" = "ONTO_slow_.decades.") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_ONTO_slow_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_ONTO_slow" = "CWM_TreMs_ONTO_slow_Pyr$FDis")

CWM_TreMs_ONTO_slow_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")[22], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_ONTO_slow_CVL <- CWM_TreMs_ONTO_slow_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_ONTO_slow" = "ONTO_slow_.decades.") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_ONTO_slow_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_ONTO_slow" = "CWM_TreMs_ONTO_slow_CVL$FDis")

CWM_TreMs_ONTO_slow_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")[22], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_ONTO_slow_Bav <- CWM_TreMs_ONTO_slow_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_ONTO_slow" = "ONTO_slow_.decades.") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_ONTO_slow_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_ONTO_slow" = "CWM_TreMs_ONTO_slow_Bav$FDis")

df_CWM_TreMs_ONTO_slow = df_CWM_TreMs_ONTO_slow_Pyr %>%
  union(df_CWM_TreMs_ONTO_slow_CVL) %>%
  union(df_CWM_TreMs_ONTO_slow_Bav)




#ONTO_fairly_slow
CWM_TreMs_ONTO_fairly_slow_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")[23], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_ONTO_fairly_slow_Pyr <- CWM_TreMs_ONTO_fairly_slow_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_ONTO_fairly_slow" = "ONTO_fairly_slow_.decade.") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_ONTO_fairly_slow_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_ONTO_fairly_slow" = "CWM_TreMs_ONTO_fairly_slow_Pyr$FDis")

CWM_TreMs_ONTO_fairly_slow_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")[23], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_ONTO_fairly_slow_CVL <- CWM_TreMs_ONTO_fairly_slow_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_ONTO_fairly_slow" = "ONTO_fairly_slow_.decade.") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_ONTO_fairly_slow_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_ONTO_fairly_slow" = "CWM_TreMs_ONTO_fairly_slow_CVL$FDis")

CWM_TreMs_ONTO_fairly_slow_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")[23], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_ONTO_fairly_slow_Bav <- CWM_TreMs_ONTO_fairly_slow_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_ONTO_fairly_slow" = "ONTO_fairly_slow_.decade.") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_ONTO_fairly_slow_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_ONTO_fairly_slow" = "CWM_TreMs_ONTO_fairly_slow_Bav$FDis")

df_CWM_TreMs_ONTO_fairly_slow = df_CWM_TreMs_ONTO_fairly_slow_Pyr %>%
  union(df_CWM_TreMs_ONTO_fairly_slow_CVL) %>%
  union(df_CWM_TreMs_ONTO_fairly_slow_Bav)




#ONTO_fairly_rapid
CWM_TreMs_ONTO_fairly_rapid_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")[24], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_ONTO_fairly_rapid_Pyr <- CWM_TreMs_ONTO_fairly_rapid_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_ONTO_fairly_rapid" = "ONTO_fairly_rapid_.years.") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_ONTO_fairly_rapid_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_ONTO_fairly_rapid" = "CWM_TreMs_ONTO_fairly_rapid_Pyr$FDis")

CWM_TreMs_ONTO_fairly_rapid_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")[24], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_ONTO_fairly_rapid_CVL <- CWM_TreMs_ONTO_fairly_rapid_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_ONTO_fairly_rapid" = "ONTO_fairly_rapid_.years.") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_ONTO_fairly_rapid_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_ONTO_fairly_rapid" = "CWM_TreMs_ONTO_fairly_rapid_CVL$FDis")

CWM_TreMs_ONTO_fairly_rapid_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")[24], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_ONTO_fairly_rapid_Bav <- CWM_TreMs_ONTO_fairly_rapid_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_ONTO_fairly_rapid" = "ONTO_fairly_rapid_.years.") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_ONTO_fairly_rapid_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_ONTO_fairly_rapid" = "CWM_TreMs_ONTO_fairly_rapid_Bav$FDis")

df_CWM_TreMs_ONTO_fairly_rapid = df_CWM_TreMs_ONTO_fairly_rapid_Pyr %>%
  union(df_CWM_TreMs_ONTO_fairly_rapid_CVL) %>%
  union(df_CWM_TreMs_ONTO_fairly_rapid_Bav)




#ONTO_rapid
CWM_TreMs_ONTO_rapid_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")[25], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_ONTO_rapid_Pyr <- CWM_TreMs_ONTO_rapid_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_ONTO_rapid" = "ONTO_rapid_.year.") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_ONTO_rapid_Pyr$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_ONTO_rapid" = "CWM_TreMs_ONTO_rapid_Pyr$FDis")

CWM_TreMs_ONTO_rapid_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")[25], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_ONTO_rapid_CVL <- CWM_TreMs_ONTO_rapid_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_ONTO_rapid" = "ONTO_rapid_.year.") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_ONTO_rapid_CVL$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_ONTO_rapid" = "CWM_TreMs_ONTO_rapid_CVL$FDis")
df_CWM_TreMs_ONTO_rapid_CVL$CWM_ONTO_rapid = as.numeric(df_CWM_TreMs_ONTO_rapid_CVL$CWM_ONTO_rapid)

CWM_TreMs_ONTO_rapid_Bav <- dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")[25], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_ONTO_rapid_Bav <- CWM_TreMs_ONTO_rapid_Bav$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_ONTO_rapid" = "ONTO_rapid_.year.") %>%
  left_join(rownames_to_column(as.data.frame(CWM_TreMs_ONTO_rapid_Bav$FDis), var = "plot"), by = "plot") %>%
  dplyr::rename("FDis_ONTO_rapid" = "CWM_TreMs_ONTO_rapid_Bav$FDis")

df_CWM_TreMs_ONTO_rapid = df_CWM_TreMs_ONTO_rapid_Pyr %>%
  union(df_CWM_TreMs_ONTO_rapid_CVL) %>%
  union(df_CWM_TreMs_ONTO_rapid_Bav)



#natur_manag
CWM_TreMs_natur_manag_mean_Pyr <- dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")[26], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_natur_manag_mean_Pyr <- CWM_TreMs_natur_manag_mean_Pyr$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_natur_manag" = "natur_manag_Abies")
df_FDis_TreMs_natur_manag_mean_Pyr <- as.data.frame(CWM_TreMs_natur_manag_mean_Pyr$FDis) %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("FDis_natur_manag" = "CWM_TreMs_natur_manag_mean_Pyr$FDis")

CWM_TreMs_natur_manag_mean_CVL <- dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")[26], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=F, calc.CWM=T)
df_CWM_TreMs_natur_manag_mean_CVL <- CWM_TreMs_natur_manag_mean_CVL$CWM %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("CWM_natur_manag" = "natur_manag_Quercus")
df_FDis_TreMs_natur_manag_mean_CVL <- as.data.frame(CWM_TreMs_natur_manag_mean_CVL$FDis) %>%
  rownames_to_column(var = "plot") %>%
  dplyr::rename("FDis_natur_manag" = "CWM_TreMs_natur_manag_mean_CVL$FDis")



data_CWM_FDis_TreMs <- General %>%
  dplyr::select(c("plot", "Region")) %>%
  left_join(df_CWM_TreMs_DW_type_substrate, by = "plot") %>%
  left_join(df_CWM_TreMs_POS, by = "plot") %>%
  left_join(df_CWM_TreMs_HUM_dry_wet, by = "plot") %>%
  left_join(df_CWM_TreMs_LIFE, by = "plot") %>%
  left_join(df_CWM_TreMs_ONTO, by = "plot") %>%
  left_join(df_CWM_TreMs_DW_saproxylic, by = "plot") %>%
  left_join(df_CWM_TreMs_DW_epixylic, by = "plot") %>%
  left_join(df_CWM_TreMs_DW_contains_mould, by = "plot") %>%
  left_join(df_CWM_TreMs_DW_living_tree, by = "plot") %>%
  left_join(df_CWM_TreMs_DW_snag, by = "plot") %>%
  left_join(df_CWM_TreMs_DW_log, by = "plot") %>%
  left_join(df_CWM_TreMs_SH_concavity, by = "plot") %>%
  left_join(df_CWM_TreMs_SH_cavity, by = "plot") %>%
  left_join(df_CWM_TreMs_SH_crack, by = "plot") %>%
  left_join(df_CWM_TreMs_POS_base, by = "plot") %>%
  left_join(df_CWM_TreMs_POS_trunk, by = "plot") %>%
  left_join(df_CWM_TreMs_POS_crown, by = "plot") %>%
  left_join(df_CWM_TreMs_SOIL_contact, by = "plot") %>%
  left_join(df_CWM_TreMs_HUM_dry, by = "plot") %>%
  left_join(df_CWM_TreMs_HUM_wet, by = "plot") %>%
  left_join(df_CWM_TreMs_LIFE_ephemeral, by = "plot") %>%
  left_join(df_CWM_TreMs_LIFE_annual, by = "plot") %>%
  left_join(df_CWM_TreMs_LIFE_perenial, by = "plot") %>%
  left_join(df_CWM_TreMs_ONTO_slow, by = "plot") %>%
  left_join(df_CWM_TreMs_ONTO_fairly_slow, by = "plot") %>%
  left_join(df_CWM_TreMs_ONTO_fairly_rapid, by = "plot") %>%
  left_join(df_CWM_TreMs_ONTO_rapid, by = "plot") %>%
  left_join(df_CWM_TreMs_natur_manag_mean_Pyr, by = "plot") %>%
  left_join(df_FDis_TreMs_natur_manag_mean_Pyr, by = "plot") %>%
  left_join(df_CWM_TreMs_natur_manag_mean_CVL, by = "plot") %>%
  left_join(df_FDis_TreMs_natur_manag_mean_CVL, by = "plot")

data_CWM_FDis_TreMs[is.na(data_CWM_FDis_TreMs)] <- 0

data_CWM_FDis_TreMs = data_CWM_FDis_TreMs %>%
  mutate(CWM_natur_manag_mean = CWM_natur_manag.x + CWM_natur_manag.y) %>%
  mutate(FDis_natur_manag_mean = FDis_natur_manag.x + FDis_natur_manag.y)

data_CWM_FDis_TreMs = data_CWM_FDis_TreMs[c(-2,-57,-58,-59,-60)]



## For overall composition (based on Type (1 type including several tree ID))


dbFD_Pyr_TreMs = data.frame(dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs")[c(1,27:31)], column_to_rownames(Data_plotxTreMs_Pyr, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=T, calc.CWM=F))
# Random_dbFD_Pyr_TreMs = rownames_to_column(dplyr::rename(dplyr::select(data.frame(dbFD(column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs"), Random_plotxTreMs_Pyr, w.abun=T, corr="lingoes", calc.FRic=T, calc.CWM=F)), c("FRic","FEve","FDiv")), "Random_FRic" = "FRic", "Random_FEve" = "FEve", "Random_FDiv" = "FDiv"), var = "plot")
# 
# dbFD_Pyr_TreMs_ses = dplyr::select(rownames_to_column(dbFD_Pyr_TreMs, var = "plot"), c("plot","FRic","FDiv","FEve", "FDis")) %>%
#   left_join(dplyr::select(Random_dbFD_Pyr_TreMs, c("plot","Random_FRic","Random_FDiv","Random_FEve")), by = "plot") %>%
#   mutate(ses_FRic = (FRic - Random_FRic) / sd(Random_dbFD_Pyr_TreMs$Random_FRic),
#          ses_FEve = (FEve - Random_FEve) / sd(Random_dbFD_Pyr_TreMs$Random_FEve),
#          ses_FDiv = (FDiv - Random_FDiv) / sd(Random_dbFD_Pyr_TreMs$Random_FDiv))
  


dbFD_CVL_TreMs = data.frame(dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs")[c(1,27:31)], column_to_rownames(Data_plotxTreMs_CVL, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=T, calc.CWM=F))
# Random_dbFD_CVL_TreMs = rownames_to_column(dplyr::rename(dplyr::select(data.frame(dbFD(column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs"), Random_plotxTreMs_CVL, w.abun=T, corr="lingoes", calc.FRic=T, calc.CWM=F)), c("FRic","FEve","FDiv")), "Random_FRic" = "FRic", "Random_FEve" = "FEve", "Random_FDiv" = "FDiv"), var = "plot")
# 
# dbFD_CVL_TreMs_ses = dplyr::select(rownames_to_column(dbFD_CVL_TreMs, var = "plot"), c("plot","FRic","FDiv","FEve", "FDis")) %>%
#   left_join(dplyr::select(Random_dbFD_CVL_TreMs, c("plot","Random_FRic","Random_FDiv","Random_FEve")), by = "plot") %>%
#   mutate(ses_FRic = (FRic - Random_FRic) / sd(na.omit(Random_dbFD_CVL_TreMs$Random_FRic)),
#          ses_FEve = (FEve - Random_FEve) / sd(na.omit(Random_dbFD_CVL_TreMs$Random_FEve)),
#          ses_FDiv = (FDiv - Random_FDiv) / sd(na.omit(Random_dbFD_CVL_TreMs$Random_FDiv)))


dbFD_Bav_TreMs = data.frame(dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs")[c(1,26:30)], column_to_rownames(Data_plotxTreMs_Bav, var = "plot"), w.abun=T, corr="lingoes", calc.FRic=T, calc.CWM=F))
# Random_dbFD_Bav_TreMs = rownames_to_column(dplyr::rename(dplyr::select(data.frame(dbFD(column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs"), Random_plotxTreMs_Bav, w.abun=T, corr="lingoes", calc.FRic=T, calc.CWM=F)), c("FRic","FEve","FDiv")), "Random_FRic" = "FRic", "Random_FEve" = "FEve", "Random_FDiv" = "FDiv"), var = "plot")
# 
# dbFD_Bav_TreMs_ses = dplyr::select(rownames_to_column(dbFD_Bav_TreMs, var = "plot"), c("plot","FRic","FDiv","FEve", "FDis")) %>%
#   left_join(dplyr::select(Random_dbFD_Bav_TreMs, c("plot","Random_FRic","Random_FDiv","Random_FEve")), by = "plot") %>%
#   mutate(ses_FRic = (FRic - Random_FRic) / sd(na.omit(Random_dbFD_Bav_TreMs$Random_FRic)),
#          ses_FEve = (FEve - Random_FEve) / sd(na.omit(Random_dbFD_Bav_TreMs$Random_FEve)),
#          ses_FDiv = (FDiv - Random_FDiv) / sd(na.omit(Random_dbFD_Bav_TreMs$Random_FDiv)))



df_dbFD_All_TreMs <- rownames_to_column(dbFD_Pyr_TreMs, var = "plot") %>%
  union(rownames_to_column(dbFD_CVL_TreMs, var = "plot")) %>%
  union(rownames_to_column(dbFD_Bav_TreMs, var = "plot")) %>%
  left_join(data_CWM_FDis_TreMs, by = "plot")

write.csv(df_dbFD_All_TreMs, file = "data_FRic_CWM_FDis_TreMs.csv", row.names = F)


Data_univar_CWM_TreMs_All = Data_univar_TreMs %>%
  left_join(df_dbFD_All_TreMs, by = "plot") %>%
  left_join(Data_univar_All[c("plot","LW_nb")], by = "plot") %>%
  mutate(Crown_deadwood_LW_nb = Crown_deadwood/LW_nb) %>%
  mutate(Dead_branches_LW_nb = Dead_branches/LW_nb) %>%
  mutate(Dead_top_LW_nb = Dead_top/LW_nb) %>%
  filter(salvaged != 1)

Data_univar_CWM_TreMs_All$cat_depe = factor(Data_univar_CWM_TreMs_All$cat_depe, levels = c("Low","Medium","High"))

Data_univar_CWM_TreMs_CVL = Data_univar_CWM_TreMs_All %>%
  filter(Region %in% "CVL")

Data_univar_CWM_TreMs_Pyr = Data_univar_CWM_TreMs_All %>%
  filter(Region %in% "Pyrenees")

Data_univar_CWM_TreMs_Bav = Data_univar_CWM_TreMs_All %>%
  filter(Region %in% "Bavaria")

summary(Data_univar_CWM_TreMs_All$level_depe_G)
sd(Data_univar_CWM_TreMs_All$level_depe_G)



```


###BAT

####Pyrenees
```{r BAT Pyrenees}


BAT_TreMs_Pyr = Data_plotxTreMs_Pyr %>%
  left_join(Data_univar_Pyr[c("plot", "cat_depe01", "salvaged")], by = "plot") %>%
  filter(salvaged == 0) %>%
  dplyr::select(-salvaged) %>%
  column_to_rownames(var = "plot")

cat_depe_Pyr = BAT_TreMs_Pyr$cat_depe01
BAT_TreMs_Pyr = dplyr::select(BAT_TreMs_Pyr, -cat_depe01)

BAT_traits_TreMs_Pyr = column_to_rownames(Data_traits_TreMs_Pyr, var = "TreMs") %>%
  dplyr::select(c(DW_saproxylic, Glob_DW_type_substrate, Glob_POS, Glob_HUM_dry_wet, Glob_LIFE, Glob_ONTO))


## Calculating the hypervolume for each plot

hv_Pyr_TreMs <- BAT::kernel.build(comm = as.matrix(BAT_TreMs_Pyr), trait = as.matrix(BAT_traits_TreMs_Pyr), 
                   abund = TRUE, #samples are abundances
                   method = "gaussian", 
                   axes = 6) #convert traits to PCoA axex


#############################
# and visualize the hypervolumes
hv_Pyr_TreMs_cat_depe_Low  <-  hypervolume_join(hv_Pyr_TreMs@HVList[cat_depe_Pyr == 0])
hv_Pyr_TreMs_cat_depe_High <-  hypervolume_join(hv_Pyr_TreMs@HVList[cat_depe_Pyr == 1])


#plot of all hypervolumes in Low dieback subplot
plot(hv_Pyr_TreMs_cat_depe_Low,
     show.3d=FALSE,
     show.random=TRUE,
     show.density=TRUE,
     show.data=TRUE,
     show.centroid=FALSE,
     cex.centroid=2,
     point.alpha.min=0.2, 
     point.dark.factor=0.7,
     cex.random=0.5,
     cex.data=1,
     contour.lwd=0.1,
     num.points.max.random = 1000,
     col= rep("#56B4E9",30),
     names=c("PCoA_1","PCoA_2","PCoA_3","PCoA_4","PCoA_5","PCoA_6"))

#plot of all hypervolumes in High dieback subplot
plot(hv_Pyr_TreMs_cat_depe_High,
     show.3d=FALSE,
     show.random=TRUE,
     show.density=TRUE,
     show.data=TRUE,
     show.centroid=FALSE,
     cex.centroid=2,
     point.alpha.min=0.2, 
     point.dark.factor=0.7,
     cex.random=0.5,
     cex.data=1,
     contour.lwd=0.1,
     num.points.max.random = 1000,
     col= rep("#E69F00",30),
     names=c("PCoA_1","PCoA_2","PCoA_3","PCoA_4","PCoA_5","PCoA_6"))


#############################
## Calculating the functional alpha diversity of each plot using the kernel.alpha function

kernel_richness_TreMs_Pyr <- kernel.alpha(comm = hv_Pyr_TreMs) # vector with richness value for each subplot

#storing results in a data.frame
results_BAT_TreMs_Pyr <- data.frame(cat_depe = as.character(cat_depe_Pyr),
                      Richness = kernel_richness_TreMs_Pyr)

summary(lm(Richness ~ cat_depe, data = results_BAT_TreMs_Pyr))


## Calculating the functional gamma diversity between community of the two types of plots
gamma_Pyr_TreMs_Low <- kernel.gamma(comm = hv_Pyr_TreMs_cat_depe_Low)
gamma_Pyr_TreMs_Low
gamma_Pyr_TreMs_High <- kernel.gamma(comm = hv_Pyr_TreMs_cat_depe_High)
gamma_Pyr_TreMs_High


## Calculating the functional beta diversity between community of the two types of plots
beta_Pyr_TreMs_Low <- kernel.beta(comm = hv_Pyr_TreMs_cat_depe_Low, func = "jaccard")
beta_Pyr_TreMs_High <- kernel.beta(comm = hv_Pyr_TreMs_cat_depe_High, func = "jaccard")

# Storing beta values of Low and High forest dieback
betaFD_Pyr_TreMs <- data.frame(
  Beta = c(as.vector(beta_Pyr_TreMs_Low[[1]]), as.vector(beta_Pyr_TreMs_High[[1]])),
  cat_depe = c(rep("Low", length(as.vector(beta_Pyr_TreMs_Low[[1]]))),
                 rep("Mid & High", length(as.vector(beta_Pyr_TreMs_High[[1]])))))

betaFD_2_Pyr_TreMs <- data.frame(
  Beta = c(as.vector(beta_Pyr_TreMs_Low[[2]]), as.vector(beta_Pyr_TreMs_High[[2]])),
  cat_depe = c(rep("Low", length(as.vector(beta_Pyr_TreMs_Low[[1]]))),
                 rep("Mid & High", length(as.vector(beta_Pyr_TreMs_High[[1]])))))

betaFD_3_Pyr_TreMs <- data.frame(
  Beta = c(as.vector(beta_Pyr_TreMs_Low[[3]]), as.vector(beta_Pyr_TreMs_High[[3]])),
  cat_depe = c(rep("Low", length(as.vector(beta_Pyr_TreMs_Low[[1]]))),
                 rep("Mid & High", length(as.vector(beta_Pyr_TreMs_High[[1]])))))


# Plots

hist(betaFD_Pyr_TreMs$Beta)
betaFD_Pyr_TreMs$cat_depe = factor(betaFD_Pyr_TreMs$cat_depe, levels = c("Low","Mid & High"))
mod_Beta_Pyr_TreMs = glm(Beta ~ cat_depe, data = betaFD_Pyr_TreMs, family = Gamma(link = log))
summary(mod_Beta_Pyr_TreMs)
res = simulateResiduals(mod_Beta_Pyr_TreMs)
plot(res, rank = T)

t.test(betaFD_Pyr_TreMs$Beta ~ betaFD_Pyr_TreMs$cat_depe)
summarySE_Beta_func_Pyr_TreMs = summarySE(data = betaFD_Pyr_TreMs, measurevar = "Beta", groupvars = "cat_depe")

plot_Beta_func_Pyr_TreMs = ggplot(summarySE_Beta_func_Pyr_TreMs, aes(x = cat_depe, y = Beta)) + geom_bar(stat = "identity", alpha = 0.7, width = 0.5, aes(fill = cat_depe)) + geom_errorbar(aes(ymin = Beta - ci, ymax = Beta + ci), size = 0.8, width = .1) + scale_fill_manual(values=c("Low" = "#77DCC5", "Mid & High" = "#3B7165")) + theme_bw() + theme(legend.position = "none") + labs(y="Dissimilarity value\n(intra-class)", x = "Forest dieback class") + ylim(0,0.7) + geom_segment(aes(x=1, y=0.6, xend=2, yend=0.6)) + annotate(geom = "text", label = "ns", x = 1.5, y = 0.65, hjust = 0) + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + ggtitle(label= "Fir-dominated forests", subtitle = "TreMs - Trait β-diversity")
plot_Beta_func_Pyr_TreMs

ggsave("Figures/plot_Beta_func_Pyr_TreMs.png", plot = plot_Beta_func_Pyr_TreMs, units = "cm", width = 8, height=8, type = "cairo")



```


####Bavaria
```{r BAT Bavaria}


BAT_TreMs_Bav = Data_plotxTreMs_Bav %>%
  left_join(Data_univar_Bav[c("plot", "cat_depe01", "salvaged")], by = "plot") %>%
  filter(salvaged == 0) %>%
  dplyr::select(-salvaged) %>%
  column_to_rownames(var = "plot")

cat_depe_Bav = BAT_TreMs_Bav$cat_depe01
BAT_TreMs_Bav = dplyr::select(BAT_TreMs_Bav, -cat_depe01)

BAT_traits_TreMs_Bav = column_to_rownames(Data_traits_TreMs_Bav, var = "TreMs") %>%
  dplyr::select(c(DW_saproxylic, Glob_DW_type_substrate, Glob_POS, Glob_HUM_dry_wet, Glob_LIFE, Glob_ONTO))


## Calculating the hypervolume for each plot

hv_Bav_TreMs <- BAT::kernel.build(comm = as.matrix(BAT_TreMs_Bav), trait = as.matrix(BAT_traits_TreMs_Bav), 
                   abund = TRUE, #samples are abundances
                   method = "gaussian", 
                   axes = 6) #convert traits to PCoA axex


#############################
# and visualize the hypervolumes
hv_Bav_TreMs_cat_depe_Low  <-  hypervolume_join(hv_Bav_TreMs@HVList[cat_depe_Bav == 0])
hv_Bav_TreMs_cat_depe_High <-  hypervolume_join(hv_Bav_TreMs@HVList[cat_depe_Bav == 1])


#plot of all hypervolumes in Low dieback subplot
plot(hv_Bav_TreMs_cat_depe_Low,
     show.3d=FALSE,
     show.random=TRUE,
     show.density=TRUE,
     show.data=TRUE,
     show.centroid=FALSE,
     cex.centroid=2,
     point.alpha.min=0.2, 
     point.dark.factor=0.7,
     cex.random=0.5,
     cex.data=1,
     contour.lwd=0.1,
     num.points.max.random = 1000,
     col= rep("#56B4E9",30),
     names=c("PCoA_1","PCoA_2","PCoA_3","PCoA_4","PCoA_5","PCoA_6"))

#plot of all hypervolumes in High dieback subplot
plot(hv_Bav_TreMs_cat_depe_High,
     show.3d=FALSE,
     show.random=TRUE,
     show.density=TRUE,
     show.data=TRUE,
     show.centroid=FALSE,
     cex.centroid=2,
     point.alpha.min=0.2, 
     point.dark.factor=0.7,
     cex.random=0.5,
     cex.data=1,
     contour.lwd=0.1,
     num.points.max.random = 1000,
     col= rep("#E69F00",30),
     names=c("PCoA_1","PCoA_2","PCoA_3","PCoA_4","PCoA_5","PCoA_6"))


#############################
## Calculating the functional alpha diversity of each plot using the kernel.alpha function

kernel_richness_TreMs_Bav <- kernel.alpha(comm = hv_Bav_TreMs) # vector with richness value for each subplot

#storing results in a data.frame
results_BAT_TreMs_Bav <- data.frame(cat_depe = as.character(cat_depe_Bav),
                      Richness = kernel_richness_TreMs_Bav)

t.test(results_BAT_TreMs_Bav$Richness ~ results_BAT_TreMs_Bav$cat_depe)


## Calculating the functional gamma diversity between community of the two types of plots
gamma_Bav_TreMs_Low <- kernel.gamma(comm = hv_Bav_TreMs_cat_depe_Low)
gamma_Bav_TreMs_Low
gamma_Bav_TreMs_High <- kernel.gamma(comm = hv_Bav_TreMs_cat_depe_High)
gamma_Bav_TreMs_High


## Calculating the functional beta diversity between community of the two types of plots
beta_Bav_TreMs_Low <- kernel.beta(comm = hv_Bav_TreMs_cat_depe_Low, func = "jaccard")
beta_Bav_TreMs_High <- kernel.beta(comm = hv_Bav_TreMs_cat_depe_High, func = "jaccard")

# Storing beta values of Low and High forest dieback
betaFD_Bav_TreMs <- data.frame(
  Beta = c(as.vector(beta_Bav_TreMs_Low[[1]]), as.vector(beta_Bav_TreMs_High[[1]])),
  cat_depe = c(rep("Low", length(as.vector(beta_Bav_TreMs_Low[[1]]))),
                 rep("Mid & High", length(as.vector(beta_Bav_TreMs_High[[1]])))))

betaFD_2_Bav_TreMs <- data.frame(
  Beta = c(as.vector(beta_Bav_TreMs_Low[[2]]), as.vector(beta_Bav_TreMs_High[[2]])),
  cat_depe = c(rep("Low", length(as.vector(beta_Bav_TreMs_Low[[1]]))),
                 rep("Mid & High", length(as.vector(beta_Bav_TreMs_High[[1]])))))

betaFD_3_Bav_TreMs <- data.frame(
  Beta = c(as.vector(beta_Bav_TreMs_Low[[3]]), as.vector(beta_Bav_TreMs_High[[3]])),
  cat_depe = c(rep("Low", length(as.vector(beta_Bav_TreMs_Low[[1]]))),
                 rep("Mid & High", length(as.vector(beta_Bav_TreMs_High[[1]])))))


# Plots

hist(betaFD_Bav_TreMs$Beta)
betaFD_Bav_TreMs$cat_depe = factor(betaFD_Bav_TreMs$cat_depe, levels = c("Low","Mid & High"))
mod_Beta_Bav_TreMs = glm(Beta ~ cat_depe, data = betaFD_Bav_TreMs, family = Gamma(link = log))
summary(mod_Beta_Bav_TreMs)
res = simulateResiduals(mod_Beta_Bav_TreMs)
plot(res, rank = T)

t.test(betaFD_Bav_TreMs$Beta ~ betaFD_Bav_TreMs$cat_depe)
summarySE_Beta_func_Bav_TreMs = summarySE(data = betaFD_Bav_TreMs, measurevar = "Beta", groupvars = "cat_depe")

plot_Beta_func_Bav_TreMs = ggplot(summarySE_Beta_func_Bav_TreMs, aes(x = cat_depe, y = Beta)) + geom_bar(stat = "identity", alpha = 0.7, width = 0.5, aes(fill = cat_depe)) + geom_errorbar(aes(ymin = Beta - ci+0.015, ymax = Beta + ci-0.015), size = 0.8, width = .1) + scale_fill_manual(values=c("Low" = "#E9A7D6", "Mid & High" = "#78205E")) + theme_bw() + theme(legend.position = "none") + labs(y="Dissimilarity value\n(intra-class)", x = "Forest dieback class") + ylim(0,0.7) + geom_segment(aes(x=1, y=0.63, xend=2, yend=0.63)) + annotate(geom = "text", label = "*", x = 1.5, y = 0.66, hjust = 0) + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + ggtitle(label= "Spruce-dominated forests", subtitle = "TreMs - Trait β-diversity")
plot_Beta_func_Bav_TreMs

ggsave("Figures/plot_Beta_func_Bav_TreMs.png", plot = plot_Beta_func_Bav_TreMs, units = "cm", width = 8, height=8, type = "cairo")



```


####Loire
```{r BAT Loire}


BAT_TreMs_CVL = Data_plotxTreMs_CVL %>%
  left_join(Data_univar_CVL[c("plot", "cat_depe01", "salvaged")], by = "plot") %>%
  filter(salvaged == 0, plot != "290") %>%
  dplyr::select(-salvaged) %>%
  column_to_rownames(var = "plot")

cat_depe_CVL = BAT_TreMs_CVL$cat_depe01
BAT_TreMs_CVL = dplyr::select(BAT_TreMs_CVL, -cat_depe01)

BAT_traits_TreMs_CVL = column_to_rownames(Data_traits_TreMs_CVL, var = "TreMs") %>%
  dplyr::select(c(DW_saproxylic, Glob_DW_type_substrate, Glob_POS, Glob_HUM_dry_wet, Glob_LIFE, Glob_ONTO))


## Calculating the hypervolume for each plot

hv_CVL_TreMs <- BAT::kernel.build(comm = as.matrix(BAT_TreMs_CVL), trait = as.matrix(BAT_traits_TreMs_CVL), 
                   abund = TRUE, #samples are abundances
                   method = "gaussian", 
                   axes = 6) #convert traits to PCoA axex


#############################
# and visualize the hypervolumes
hv_CVL_TreMs_cat_depe_Low  <-  hypervolume_join(hv_CVL_TreMs@HVList[cat_depe_CVL == 0])
hv_CVL_TreMs_cat_depe_High <-  hypervolume_join(hv_CVL_TreMs@HVList[cat_depe_CVL == 1])


#plot of all hypervolumes in Low dieback subplot
plot(hv_CVL_TreMs_cat_depe_Low,
     show.3d=FALSE,
     show.random=TRUE,
     show.density=TRUE,
     show.data=TRUE,
     show.centroid=FALSE,
     cex.centroid=2,
     point.alpha.min=0.2, 
     point.dark.factor=0.7,
     cex.random=0.5,
     cex.data=1,
     contour.lwd=0.1,
     num.points.max.random = 1000,
     col= rep("#56B4E9",30),
     names=c("PCoA_1","PCoA_2","PCoA_3","PCoA_4","PCoA_5","PCoA_6"))

#plot of all hypervolumes in High dieback subplot
plot(hv_CVL_TreMs_cat_depe_High,
     show.3d=FALSE,
     show.random=TRUE,
     show.density=TRUE,
     show.data=TRUE,
     show.centroid=FALSE,
     cex.centroid=2,
     point.alpha.min=0.2, 
     point.dark.factor=0.7,
     cex.random=0.5,
     cex.data=1,
     contour.lwd=0.1,
     num.points.max.random = 1000,
     col= rep("#E69F00",30),
     names=c("PCoA_1","PCoA_2","PCoA_3","PCoA_4","PCoA_5","PCoA_6"))


#############################
## Calculating the functional alpha diversity of each plot using the kernel.alpha function

kernel_richness_TreMs_CVL <- kernel.alpha(comm = hv_CVL_TreMs) # vector with richness value for each subplot

#storing results in a data.frame
results_BAT_TreMs_CVL <- data.frame(cat_depe = as.character(cat_depe_CVL),
                      Richness = kernel_richness_TreMs_CVL)

summary(lm(Richness ~ cat_depe, data = results_BAT_TreMs_CVL))


## Calculating the functional gamma diversity between community of the two types of plots
gamma_CVL_TreMs_Low <- kernel.gamma(comm = hv_CVL_TreMs_cat_depe_Low)
gamma_CVL_TreMs_Low
gamma_CVL_TreMs_High <- kernel.gamma(comm = hv_CVL_TreMs_cat_depe_High)
gamma_CVL_TreMs_High


## Calculating the functional beta diversity between community of the two types of plots
beta_CVL_TreMs_Low <- kernel.beta(comm = hv_CVL_TreMs_cat_depe_Low, func = "jaccard")
beta_CVL_TreMs_High <- kernel.beta(comm = hv_CVL_TreMs_cat_depe_High, func = "jaccard")

# Storing beta values of Low and High forest dieback
betaFD_CVL_TreMs <- data.frame(
  Beta = c(as.vector(beta_CVL_TreMs_Low[[1]]), as.vector(beta_CVL_TreMs_High[[1]])),
  cat_depe = c(rep("Low", length(as.vector(beta_CVL_TreMs_Low[[1]]))),
                 rep("Mid & High", length(as.vector(beta_CVL_TreMs_High[[1]])))))

betaFD_2_CVL_TreMs <- data.frame(
  Beta = c(as.vector(beta_CVL_TreMs_Low[[2]]), as.vector(beta_CVL_TreMs_High[[2]])),
  cat_depe = c(rep("Low", length(as.vector(beta_CVL_TreMs_Low[[1]]))),
                 rep("Mid & High", length(as.vector(beta_CVL_TreMs_High[[1]])))))

betaFD_3_CVL_TreMs <- data.frame(
  Beta = c(as.vector(beta_CVL_TreMs_Low[[3]]), as.vector(beta_CVL_TreMs_High[[3]])),
  cat_depe = c(rep("Low", length(as.vector(beta_CVL_TreMs_Low[[1]]))),
                 rep("Mid & High", length(as.vector(beta_CVL_TreMs_High[[1]])))))


# Plots

hist(betaFD_CVL_TreMs$Beta)
betaFD_CVL_TreMs$cat_depe = factor(betaFD_CVL_TreMs$cat_depe, levels = c("Low","Mid & High"))
mod_Beta_CVL_TreMs = glm(Beta ~ cat_depe, data = betaFD_CVL_TreMs, family = Gamma(link = log))
summary(mod_Beta_CVL_TreMs)
res = simulateResiduals(mod_Beta_CVL_TreMs)
plot(res, rank = T)

t.test(betaFD_CVL_TreMs$Beta ~ betaFD_CVL_TreMs$cat_depe)
summarySE_Beta_func_CVL_TreMs = summarySE(data = betaFD_CVL_TreMs, measurevar = "Beta", groupvars = "cat_depe")

plot_Beta_func_CVL_TreMs = ggplot(summarySE_Beta_func_CVL_TreMs, aes(x = cat_depe, y = Beta)) + geom_bar(stat = "identity", alpha = 0.7, width = 0.5, aes(fill = cat_depe)) + geom_errorbar(aes(ymin = Beta - ci, ymax = Beta + ci), size = 0.8, width = .1) + scale_fill_manual(values=c("Low" = "#E5C07F", "Mid & High" = "#8C703B")) + theme_bw() + theme(legend.position = "none") + labs(y="Dissimilarity value\n(intra-class)", x = "Forest dieback class") + ylim(0,1) + geom_segment(aes(x=1, y=0.85, xend=2, yend=0.85)) + annotate(geom = "text", label = "ns", x = 1.5, y = 0.91, hjust = 0) + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + ggtitle(label= "Oak-dominated forests", subtitle = "TreMs - Trait β-diversity")
plot_Beta_func_CVL_TreMs

ggsave("Figures/plot_Beta_func_CVL_TreMs.png", plot = plot_Beta_func_CVL_TreMs, units = "cm", width = 8, height=8, type = "cairo")



```




###



##Univariate analysis



### Pyrenees
```{r level_depe_G Pyrenees}


#TreMs_ab
hist(Data_univar_CWM_TreMs_Pyr$TreMs_ab)

mod_Pyr_TreMs_ab_level_depe_G = glmmTMB(TreMs_ab ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = nbinom2())
summary(mod_Pyr_TreMs_ab_level_depe_G)
res = simulateResiduals(mod_Pyr_TreMs_ab_level_depe_G)
plot(res, rank = T)


#TreMs_div
hist(Data_univar_CWM_TreMs_Pyr$TreMs_div)

mod_Pyr_TreMs_div_level_depe_G = mixed_model(fixed = TreMs_div ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_Pyr, family = poisson())
summary(mod_Pyr_TreMs_div_level_depe_G)
res = simulateResiduals(mod_Pyr_TreMs_div_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Pyr, aes(x = level_depe_G, y = TreMs_div)) + geom_point() + geom_smooth(method = "glm", method.args = list(family = poisson(link = log)))


#Exposed_sapwood_only
hist(Data_univar_CWM_TreMs_Pyr$Exposed_sapwood_only)

mod_Pyr_Exposed_sapwood_only_level_depe_G = mixed_model(fixed = round(Exposed_sapwood_only) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_Pyr, family = negative.binomial())
summary(mod_Pyr_Exposed_sapwood_only_level_depe_G)
res = simulateResiduals(mod_Pyr_Exposed_sapwood_only_level_depe_G)
plot(res, rank = T)


#Epiphytic
hist(Data_univar_CWM_TreMs_Pyr$Epiphytic)

mod_Pyr_Epiphytic_level_depe_G = mixed_model(fixed = round(Epiphytic) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_Pyr, family = negative.binomial())
summary(mod_Pyr_Epiphytic_level_depe_G)
res = simulateResiduals(mod_Pyr_Epiphytic_level_depe_G)
plot(res, rank = T)


#Exposed_sapwood_and_heartwood
hist(Data_univar_CWM_TreMs_Pyr$Exposed_sapwood_and_heartwood)

mod_Pyr_Exposed_sapwood_and_heartwood_level_depe_G = glmmTMB(round(Exposed_sapwood_and_heartwood) ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = nbinom2())
summary(mod_Pyr_Exposed_sapwood_and_heartwood_level_depe_G)
res = simulateResiduals(mod_Pyr_Exposed_sapwood_and_heartwood_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Pyr, aes(x = level_depe_G, y = Exposed_sapwood_and_heartwood)) + geom_point() + geom_smooth(method = "glm", method.args = list(family = nbinom2()))


#Concavities
hist(Data_univar_CWM_TreMs_Pyr$Concavities)

mod_Pyr_Concavities_level_depe_G = mixed_model(fixed = round(Concavities) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_Pyr, family = negative.binomial())
summary(mod_Pyr_Concavities_level_depe_G)
res = simulateResiduals(mod_Pyr_Concavities_level_depe_G)
plot(res, rank = T)


#Perennial_fungi_fruiting_bodies
hist(Data_univar_CWM_TreMs_Pyr$Perennial_fungi_fruiting_bodies)

mod_Pyr_Perennial_fungi_fruiting_bodies_level_depe_G = mixed_model(fixed = round(Perennial_fungi_fruiting_bodies) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_Pyr, family = negative.binomial())
summary(mod_Pyr_Perennial_fungi_fruiting_bodies_level_depe_G)
res = simulateResiduals(mod_Pyr_Perennial_fungi_fruiting_bodies_level_depe_G)
plot(res, rank = T)


#Twig_tangles
hist(Data_univar_CWM_TreMs_Pyr$Twig_tangles)

mod_Pyr_Twig_tangles_level_depe_G = mixed_model(fixed = round(Twig_tangles) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_Pyr, family = negative.binomial())
summary(mod_Pyr_Twig_tangles_level_depe_G)
res = simulateResiduals(mod_Pyr_Twig_tangles_level_depe_G)
plot(res, rank = T)


#Crown_deadwood
hist(Data_univar_CWM_TreMs_Pyr$Crown_deadwood)

mod_Pyr_Crown_deadwood_level_depe_G = glmmTMB(Crown_deadwood_LW_nb ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_Crown_deadwood_level_depe_G)
res = simulateResiduals(mod_Pyr_Crown_deadwood_level_depe_G)
plot(res, rank = T)


#Dead_branches
hist(Data_univar_CWM_TreMs_Pyr$Dead_branches)

mod_Pyr_Dead_branches_level_depe_G = glmmTMB(Dead_branches_LW_nb ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_Dead_branches_level_depe_G)
res = simulateResiduals(mod_Pyr_Dead_branches_level_depe_G)
plot(res, rank = T)


#Dead_top
hist(Data_univar_CWM_TreMs_Pyr$Dead_top)

# mod_Pyr_Dead_top_level_depe_G = mixed_model(fixed = round(Dead_top) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_Pyr, family = hurdle.negative.binomial(), zi_fixed = ~ level_depe_G)
mod_Pyr_Dead_top_level_depe_G = glmmTMB(Dead_top_LW_nb ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_Dead_top_level_depe_G)
res = simulateResiduals(mod_Pyr_Dead_top_level_depe_G)
plot(res, rank = T)


#Rot_holes
hist(Data_univar_CWM_TreMs_Pyr$Rot_holes)

mod_Pyr_Rot_holes_level_depe_G = mixed_model(fixed = round(Rot_holes) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_Pyr, family = negative.binomial())
summary(mod_Pyr_Rot_holes_level_depe_G)
res = simulateResiduals(mod_Pyr_Rot_holes_level_depe_G)
plot(res, rank = T)


#Burrs_and_cankers
hist(Data_univar_CWM_TreMs_Pyr$Burrs_and_cankers)

mod_Pyr_Burrs_and_cankers_level_depe_G = mixed_model(fixed = round(Burrs_and_cankers) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_Pyr, family = negative.binomial())
summary(mod_Pyr_Burrs_and_cankers_level_depe_G)
res = simulateResiduals(mod_Pyr_Burrs_and_cankers_level_depe_G)
plot(res, rank = T)


#Exudates
hist(Data_univar_CWM_TreMs_Pyr$Exudates)

mod_Pyr_Exudates_level_depe_G = mixed_model(fixed = round(Exudates) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_Pyr, family = negative.binomial())
summary(mod_Pyr_Exudates_level_depe_G)
res = simulateResiduals(mod_Pyr_Exudates_level_depe_G)
plot(res, rank = T)


#Wood_pecker_breeding_cavities
hist(Data_univar_CWM_TreMs_Pyr$Wood_pecker_breeding_cavities)

mod_Pyr_Wood_pecker_breeding_cavities_level_depe_G = mixed_model(fixed = round(Wood_pecker_breeding_cavities) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_Pyr, family = negative.binomial())
summary(mod_Pyr_Wood_pecker_breeding_cavities_level_depe_G)
res = simulateResiduals(mod_Pyr_Wood_pecker_breeding_cavities_level_depe_G)
plot(res, rank = T)


#Ephemeral_fungal_fruiting_bodies
hist(Data_univar_CWM_TreMs_Pyr$Ephemeral_fungal_fruiting_bodies)

mod_Pyr_Ephemeral_fungal_fruiting_bodies_level_depe_G = mixed_model(fixed = round(Ephemeral_fungal_fruiting_bodies) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_Pyr, family = negative.binomial())
summary(mod_Pyr_Ephemeral_fungal_fruiting_bodies_level_depe_G)
res = simulateResiduals(mod_Pyr_Ephemeral_fungal_fruiting_bodies_level_depe_G)
plot(res, rank = T)


#Rootplate
hist(Data_univar_CWM_TreMs_Pyr$Rootplate)

mod_Pyr_Rootplate_level_depe_G = mixed_model(fixed = round(Rootplate) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_Pyr, family = negative.binomial())
summary(mod_Pyr_Rootplate_level_depe_G)
res = simulateResiduals(mod_Pyr_Rootplate_level_depe_G)
plot(res, rank = T)


#Nest
hist(Data_univar_CWM_TreMs_Pyr$Nest)

mod_Pyr_Nest_level_depe_G = mixed_model(fixed = round(Nest) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_Pyr, family = negative.binomial())
summary(mod_Pyr_Nest_level_depe_G)
res = simulateResiduals(mod_Pyr_Nest_level_depe_G)
plot(res, rank = T)


# #CWD
# hist(Data_univar_CWM_TreMs_Pyr$CWD)
# 
# mod_Pyr_CWD_level_depe_G = mixed_model(fixed = round(CWD) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_Pyr, family = negative.binomial())
# summary(mod_Pyr_CWD_level_depe_G)
# res = simulateResiduals(mod_Pyr_CWD_level_depe_G)
# plot(res, rank = T)
# 
# 
# #Microsoil
# hist(Data_univar_CWM_TreMs_Pyr$Microsoil)
# 
# mod_Pyr_Microsoil_level_depe_G = glmmTMB(round(Microsoil) ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = nbinom1())
# summary(mod_Pyr_Microsoil_level_depe_G)
# res = simulateResiduals(mod_Pyr_Microsoil_level_depe_G)
# plot(res, rank = T)
# 
# 
# #Insect_galleries
# hist(Data_univar_CWM_TreMs_Pyr$Insect_galleries)
# 
# mod_Pyr_Insect_galleries_level_depe_G = glmmTMB(round(Insect_galleries) ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = nbinom1())
# summary(mod_Pyr_Insect_galleries_level_depe_G)
# res = simulateResiduals(mod_Pyr_Insect_galleries_level_depe_G)
# plot(res, rank = T)


#FRic
hist(Data_univar_CWM_TreMs_Pyr$FRic)

mod_Pyr_FRic_level_depe_G = glmmTMB(FRic ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FRic_level_depe_G)
res = simulateResiduals(mod_Pyr_FRic_level_depe_G)
plot(res, rank = T)


#FDiv
hist(Data_univar_CWM_TreMs_Pyr$FDiv)

mod_Pyr_FDiv_level_depe_G = glmmTMB(FDiv ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDiv_level_depe_G)
res = simulateResiduals(mod_Pyr_FDiv_level_depe_G)
plot(res, rank = T)


#FEve
hist(Data_univar_CWM_TreMs_Pyr$FEve)

mod_Pyr_FEve_level_depe_G = glmmTMB(FEve ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FEve_level_depe_G)
res = simulateResiduals(mod_Pyr_FEve_level_depe_G)
plot(res, rank = T)


#FDis
hist(Data_univar_CWM_TreMs_Pyr$FDis)

mod_Pyr_FDis_level_depe_G = glmmTMB(FDis ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_level_depe_G)
plot(res, rank = T)


#CWM_DW_type_substrate
hist(Data_univar_CWM_TreMs_Pyr$CWM_DW_type_substrate)

mod_Pyr_CWM_DW_type_substrate_level_depe_G = glmmTMB(CWM_DW_type_substrate ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_CWM_DW_type_substrate_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_DW_type_substrate_level_depe_G)
plot(res, rank = T)


#FDis_DW_type_substrate
hist(Data_univar_CWM_TreMs_Pyr$FDis_DW_type_substrate)

mod_Pyr_FDis_DW_type_substrate_level_depe_G = glmmTMB(FDis_DW_type_substrate ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_DW_type_substrate_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_DW_type_substrate_level_depe_G)
plot(res, rank = T)


#CWM_POS
hist(Data_univar_CWM_TreMs_Pyr$CWM_POS)

mod_Pyr_CWM_POS_level_depe_G = glmmTMB(CWM_POS ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_CWM_POS_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_POS_level_depe_G)
plot(res, rank = T)


#FDis_POS
hist(Data_univar_CWM_TreMs_Pyr$FDis_POS)

mod_Pyr_FDis_POS_level_depe_G = glmmTMB(FDis_POS ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_POS_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_POS_level_depe_G)
plot(res, rank = T)


#CWM_HUM_dry_wet
hist(Data_univar_CWM_TreMs_Pyr$CWM_HUM_dry_wet)

mod_Pyr_CWM_HUM_dry_wet_level_depe_G = glmmTMB(CWM_HUM_dry_wet ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = Gamma(link = log))
summary(mod_Pyr_CWM_HUM_dry_wet_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_HUM_dry_wet_level_depe_G)
plot(res, rank = T)


#FDis_HUM_dry_wet
hist(Data_univar_CWM_TreMs_Pyr$FDis_HUM_dry_wet)

mod_Pyr_FDis_HUM_dry_wet_level_depe_G = glmmTMB(FDis_HUM_dry_wet ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_HUM_dry_wet_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_HUM_dry_wet_level_depe_G)
plot(res, rank = T)


#CWM_LIFE
hist(Data_univar_CWM_TreMs_Pyr$CWM_LIFE)

mod_Pyr_CWM_LIFE_level_depe_G = glmmTMB(CWM_LIFE ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = Gamma(link = log))
summary(mod_Pyr_CWM_LIFE_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_LIFE_level_depe_G)
plot(res, rank = T)


#FDis_LIFE
hist(Data_univar_CWM_TreMs_Pyr$FDis_LIFE)

mod_Pyr_FDis_LIFE_level_depe_G = glmmTMB(FDis_LIFE ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_LIFE_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_LIFE_level_depe_G)
plot(res, rank = T)

#CWM_ONTO
hist(Data_univar_CWM_TreMs_Pyr$CWM_ONTO)

mod_Pyr_CWM_ONTO_level_depe_G = glmmTMB(CWM_ONTO ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_CWM_ONTO_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_ONTO_level_depe_G)
plot(res, rank = T)


#FDis_ONTO
hist(Data_univar_CWM_TreMs_Pyr$FDis_ONTO)

mod_Pyr_FDis_ONTO_level_depe_G = glmmTMB(FDis_ONTO ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_ONTO_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_ONTO_level_depe_G)
plot(res, rank = T)





#CWM_DW_saproxylic
hist(Data_univar_CWM_TreMs_Pyr$CWM_DW_saproxylic)

mod_Pyr_CWM_DW_saproxylic_level_depe_G = glmmTMB(CWM_DW_saproxylic ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_CWM_DW_saproxylic_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_DW_saproxylic_level_depe_G)
plot(res, rank = T)


#FDis_DW_saproxylic
hist(Data_univar_CWM_TreMs_Pyr$FDis_DW_saproxylic)

mod_Pyr_FDis_DW_saproxylic_level_depe_G = glmmTMB(FDis_DW_saproxylic ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_DW_saproxylic_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_DW_saproxylic_level_depe_G)
plot(res, rank = T)


#CWM_DW_epixylic
hist(Data_univar_CWM_TreMs_Pyr$CWM_DW_epixylic)

mod_Pyr_CWM_DW_epixylic_level_depe_G = glmmTMB(CWM_DW_epixylic ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_CWM_DW_epixylic_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_DW_epixylic_level_depe_G)
plot(res, rank = T)


#FDis_DW_epixylic
hist(Data_univar_CWM_TreMs_Pyr$FDis_DW_epixylic)

mod_Pyr_FDis_DW_epixylic_level_depe_G = glmmTMB(FDis_DW_epixylic ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_DW_epixylic_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_DW_epixylic_level_depe_G)
plot(res, rank = T)


#CWM_DW_contains_mould
hist(Data_univar_CWM_TreMs_Pyr$CWM_DW_contains_mould)

mod_Pyr_CWM_DW_contains_mould_level_depe_G = glmmTMB(CWM_DW_contains_mould ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_CWM_DW_contains_mould_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_DW_contains_mould_level_depe_G)
plot(res, rank = T)


#FDis_DW_contains_mould
hist(Data_univar_CWM_TreMs_Pyr$FDis_DW_contains_mould)

mod_Pyr_FDis_DW_contains_mould_level_depe_G = glmmTMB(FDis_DW_contains_mould ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = Gamma(link = log))
summary(mod_Pyr_FDis_DW_contains_mould_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_DW_contains_mould_level_depe_G)
plot(res, rank = T)


#CWM_DW_living_tree
hist(Data_univar_CWM_TreMs_Pyr$CWM_DW_living_tree)

mod_Pyr_CWM_DW_living_tree_level_depe_G = glmmTMB(CWM_DW_living_tree ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = Gamma(link = log))
summary(mod_Pyr_CWM_DW_living_tree_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_DW_living_tree_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Pyr, aes(x = level_depe_G, y = CWM_DW_living_tree, color = site)) + geom_point() + geom_smooth(method = "glm", method.args = list(family = Gamma(link = log)))


#FDis_DW_living_tree
hist(Data_univar_CWM_TreMs_Pyr$FDis_DW_living_tree)

mod_Pyr_FDis_DW_living_tree_level_depe_G = glmmTMB(FDis_DW_living_tree ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_DW_living_tree_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_DW_living_tree_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Pyr, aes(x = level_depe_G, y = FDis_DW_living_tree)) + geom_point(aes(color = site)) + geom_smooth(method = "lm")


#CWM_DW_snag
hist(Data_univar_CWM_TreMs_Pyr$CWM_DW_snag)

mod_Pyr_CWM_DW_snag_level_depe_G = glmmTMB(CWM_DW_snag ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_CWM_DW_snag_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_DW_snag_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Pyr, aes(x = level_depe_G, y = CWM_DW_snag, color = site)) + geom_point() + geom_smooth(method = "lm")


#FDis_DW_snag
hist(Data_univar_CWM_TreMs_Pyr$FDis_DW_snag)

mod_Pyr_FDis_DW_snag_level_depe_G = glmmTMB(FDis_DW_snag ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_DW_snag_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_DW_snag_level_depe_G)
plot(res, rank = T)


#CWM_DW_log
hist(Data_univar_CWM_TreMs_Pyr$CWM_DW_log)

mod_Pyr_CWM_DW_log_level_depe_G = glmmTMB(CWM_DW_log ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = Gamma(link = log))
summary(mod_Pyr_CWM_DW_log_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_DW_log_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Pyr, aes(x = level_depe_G, y = CWM_DW_log, color = site)) + geom_point() + geom_smooth(method = "lm")


#FDis_DW_log
hist(Data_univar_CWM_TreMs_Pyr$FDis_DW_log)

mod_Pyr_FDis_DW_log_level_depe_G = glmmTMB(FDis_DW_log ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_DW_log_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_DW_log_level_depe_G)
plot(res, rank = T)


#CWM_SH_concavity
hist(Data_univar_CWM_TreMs_Pyr$CWM_SH_concavity)

mod_Pyr_CWM_SH_concavity_level_depe_G = glmmTMB(CWM_SH_concavity ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = Gamma(link = log))
summary(mod_Pyr_CWM_SH_concavity_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_SH_concavity_level_depe_G)
plot(res, rank = T)

# ggplot(Data_univar_CWM_TreMs_Pyr, aes(x = level_depe_G, y = CWM_SH_concavity, color = site)) + geom_point() + geom_smooth(method = "lm")


#FDis_SH_concavity
hist(Data_univar_CWM_TreMs_Pyr$FDis_SH_concavity)

mod_Pyr_FDis_SH_concavity_level_depe_G = glmmTMB(FDis_SH_concavity ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = Gamma(link = log))
summary(mod_Pyr_FDis_SH_concavity_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_SH_concavity_level_depe_G)
plot(res, rank = T)


#CWM_SH_cavity
hist(Data_univar_CWM_TreMs_Pyr$CWM_SH_cavity)

mod_Pyr_CWM_SH_cavity_level_depe_G = glmmTMB(CWM_SH_cavity ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_CWM_SH_cavity_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_SH_cavity_level_depe_G)
plot(res, rank = T)


#FDis_SH_cavity
hist(Data_univar_CWM_TreMs_Pyr$FDis_SH_cavity)

mod_Pyr_FDis_SH_cavity_level_depe_G = glmmTMB(FDis_SH_cavity ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_SH_cavity_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_SH_cavity_level_depe_G)
plot(res, rank = T)


#CWM_SH_crack
hist(Data_univar_CWM_TreMs_Pyr$CWM_SH_crack)

mod_Pyr_CWM_SH_crack_level_depe_G = glmmTMB(CWM_SH_crack ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_CWM_SH_crack_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_SH_crack_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Pyr, aes(x = level_depe_G, y = CWM_SH_crack, color = site)) + geom_point() + geom_smooth(method = "lm")


#FDis_SH_crack
hist(Data_univar_CWM_TreMs_Pyr$FDis_SH_crack)

mod_Pyr_FDis_SH_crack_level_depe_G = glmmTMB(FDis_SH_crack ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_SH_crack_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_SH_crack_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Pyr, aes(x = level_depe_G, y = FDis_SH_crack, color = site)) + geom_point() + geom_smooth(method = "lm")


#CWM_POS_base
hist(Data_univar_CWM_TreMs_Pyr$CWM_POS_base)

mod_Pyr_CWM_POS_base_level_depe_G = glmmTMB(CWM_POS_base ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_CWM_POS_base_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_POS_base_level_depe_G)
plot(res, rank = T)


#FDis_POS_base
hist(Data_univar_CWM_TreMs_Pyr$FDis_POS_base)

mod_Pyr_FDis_POS_base_level_depe_G = glmmTMB(FDis_POS_base ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_POS_base_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_POS_base_level_depe_G)
plot(res, rank = T)


#CWM_POS_trunk
hist(Data_univar_CWM_TreMs_Pyr$CWM_POS_trunk)

mod_Pyr_CWM_POS_trunk_level_depe_G = glmmTMB(CWM_POS_trunk ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_CWM_POS_trunk_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_POS_trunk_level_depe_G)
plot(res, rank = T)


#FDis_POS_trunk
hist(Data_univar_CWM_TreMs_Pyr$FDis_POS_trunk)

mod_Pyr_FDis_POS_trunk_level_depe_G = glmmTMB(FDis_POS_trunk ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_POS_trunk_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_POS_trunk_level_depe_G)
plot(res, rank = T)


#CWM_POS_crown
hist(Data_univar_CWM_TreMs_Pyr$CWM_POS_crown)

mod_Pyr_CWM_POS_crown_level_depe_G = glmmTMB(CWM_POS_crown ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_CWM_POS_crown_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_POS_crown_level_depe_G)
plot(res, rank = T)


#FDis_POS_crown
hist(Data_univar_CWM_TreMs_Pyr$FDis_POS_crown)

mod_Pyr_FDis_POS_crown_level_depe_G = glmmTMB(FDis_POS_crown ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_POS_crown_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_POS_crown_level_depe_G)
plot(res, rank = T)


# #CWM_SOIL_contact
# hist(Data_univar_CWM_TreMs_Pyr$CWM_SOIL_contact)
# 
# mod_Pyr_CWM_SOIL_contact_level_depe_G = mixed_model(fixed = CWM_SOIL_contact ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_Pyr, family = hurdle.lognormal(), n_phis = 1, zi_fixed = ~ level_depe_G)
# summary(mod_Pyr_CWM_SOIL_contact_level_depe_G)
# res = simulateResiduals(mod_Pyr_CWM_SOIL_contact_level_depe_G)
# plot(res, rank = T)
# 
# 
# #FDis_SOIL_contact
# hist(Data_univar_CWM_TreMs_Pyr$FDis_SOIL_contact)
# 
# mod_Pyr_FDis_SOIL_contact_level_depe_G = glmmTMB(FDis_SOIL_contact ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
# summary(mod_Pyr_FDis_SOIL_contact_level_depe_G)
# res = simulateResiduals(mod_Pyr_FDis_SOIL_contact_level_depe_G)
# plot(res, rank = T)


#CWM_HUM_dry
hist(Data_univar_CWM_TreMs_Pyr$CWM_HUM_dry)

mod_Pyr_CWM_HUM_dry_level_depe_G = glmmTMB(CWM_HUM_dry ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_CWM_HUM_dry_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_HUM_dry_level_depe_G)
plot(res, rank = T)


#FDis_HUM_dry
hist(Data_univar_CWM_TreMs_Pyr$FDis_HUM_dry)

mod_Pyr_FDis_HUM_dry_level_depe_G = glmmTMB(FDis_HUM_dry ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_HUM_dry_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_HUM_dry_level_depe_G)
plot(res, rank = T)


#CWM_HUM_wet
hist(Data_univar_CWM_TreMs_Pyr$CWM_HUM_wet)

mod_Pyr_CWM_HUM_wet_level_depe_G = glmmTMB(CWM_HUM_wet ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_CWM_HUM_wet_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_HUM_wet_level_depe_G)
plot(res, rank = T)


#FDis_HUM_wet
hist(Data_univar_CWM_TreMs_Pyr$FDis_HUM_wet)

mod_Pyr_FDis_HUM_wet_level_depe_G = glmmTMB(FDis_HUM_wet ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_HUM_wet_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_HUM_wet_level_depe_G)
plot(res, rank = T)


#CWM_LIFE_ephemeral
hist(Data_univar_CWM_TreMs_Pyr$CWM_LIFE_ephemeral)

mod_Pyr_CWM_LIFE_ephemeral_level_depe_G = glmmTMB(CWM_LIFE_ephemeral ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_CWM_LIFE_ephemeral_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_LIFE_ephemeral_level_depe_G)
plot(res, rank = T)


#FDis_LIFE_ephemeral
hist(Data_univar_CWM_TreMs_Pyr$FDis_LIFE_ephemeral)

mod_Pyr_FDis_LIFE_ephemeral_level_depe_G = glmmTMB(FDis_LIFE_ephemeral ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_LIFE_ephemeral_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_LIFE_ephemeral_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Pyr, aes(x = level_depe_G, y = FDis_LIFE_ephemeral)) + geom_point() + geom_smooth(method = "lm")


#CWM_LIFE_annual
hist(Data_univar_CWM_TreMs_Pyr$CWM_LIFE_annual)

mod_Pyr_CWM_LIFE_annual_level_depe_G = glmmTMB(CWM_LIFE_annual ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_CWM_LIFE_annual_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_LIFE_annual_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Pyr, aes(x = level_depe_G, y = CWM_LIFE_annual)) + geom_point() + geom_smooth(method = "lm")


#FDis_LIFE_annual
hist(Data_univar_CWM_TreMs_Pyr$FDis_LIFE_annual)

mod_Pyr_FDis_LIFE_annual_level_depe_G = glmmTMB(FDis_LIFE_annual ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_LIFE_annual_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_LIFE_annual_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Pyr, aes(x = level_depe_G, y = FDis_LIFE_annual)) + geom_point() + geom_smooth(method = "lm")


#CWM_LIFE_perenial
hist(Data_univar_CWM_TreMs_Pyr$CWM_LIFE_perenial)

mod_Pyr_CWM_LIFE_perenial_level_depe_G = glmmTMB(CWM_LIFE_perenial ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_CWM_LIFE_perenial_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_LIFE_perenial_level_depe_G)
plot(res, rank = T)


#FDis_LIFE_perenial
hist(Data_univar_CWM_TreMs_Pyr$FDis_LIFE_perenial)

mod_Pyr_FDis_LIFE_perenial_level_depe_G = glmmTMB(FDis_LIFE_perenial ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_LIFE_perenial_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_LIFE_perenial_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Pyr, aes(x = level_depe_G, y = FDis_LIFE_perenial)) + geom_point() + geom_smooth(method = "lm")


#CWM_ONTO_slow
hist(Data_univar_CWM_TreMs_Pyr$CWM_ONTO_slow)

mod_Pyr_CWM_ONTO_slow_level_depe_G = glmmTMB(CWM_ONTO_slow ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_CWM_ONTO_slow_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_ONTO_slow_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Pyr, aes(x = level_depe_G, y = CWM_ONTO_slow)) + geom_point() + geom_smooth(method = "lm")


#FDis_ONTO_slow
hist(Data_univar_CWM_TreMs_Pyr$FDis_ONTO_slow)

mod_Pyr_FDis_ONTO_slow_level_depe_G = glmmTMB(FDis_ONTO_slow ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_ONTO_slow_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_ONTO_slow_level_depe_G)
plot(res, rank = T)


#CWM_ONTO_fairly_slow
hist(Data_univar_CWM_TreMs_Pyr$CWM_ONTO_fairly_slow)

mod_Pyr_CWM_ONTO_fairly_slow_level_depe_G = glmmTMB(CWM_ONTO_fairly_slow ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_CWM_ONTO_fairly_slow_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_ONTO_fairly_slow_level_depe_G)
plot(res, rank = T)


#FDis_ONTO_fairly_slow
hist(Data_univar_CWM_TreMs_Pyr$FDis_ONTO_fairly_slow)

mod_Pyr_FDis_ONTO_fairly_slow_level_depe_G = glmmTMB(FDis_ONTO_fairly_slow ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_ONTO_fairly_slow_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_ONTO_fairly_slow_level_depe_G)
plot(res, rank = T)


#CWM_ONTO_fairly_rapid
hist(Data_univar_CWM_TreMs_Pyr$CWM_ONTO_fairly_rapid)

mod_Pyr_CWM_ONTO_fairly_rapid_level_depe_G = glmmTMB(CWM_ONTO_fairly_rapid ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_CWM_ONTO_fairly_rapid_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_ONTO_fairly_rapid_level_depe_G)
plot(res, rank = T)


#FDis_ONTO_fairly_rapid
hist(Data_univar_CWM_TreMs_Pyr$FDis_ONTO_fairly_rapid)

mod_Pyr_FDis_ONTO_fairly_rapid_level_depe_G = glmmTMB(FDis_ONTO_fairly_rapid ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_ONTO_fairly_rapid_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_ONTO_fairly_rapid_level_depe_G)
plot(res, rank = T)


#CWM_ONTO_rapid
hist(Data_univar_CWM_TreMs_Pyr$CWM_ONTO_rapid)

mod_Pyr_CWM_ONTO_rapid_level_depe_G =glmmTMB(CWM_ONTO_rapid ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_CWM_ONTO_rapid_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_ONTO_rapid_level_depe_G)
plot(res, rank = T)


#FDis_ONTO_rapid
hist(Data_univar_CWM_TreMs_Pyr$FDis_ONTO_rapid)

mod_Pyr_FDis_ONTO_rapid_level_depe_G = glmmTMB(FDis_ONTO_rapid ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_ONTO_rapid_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_ONTO_rapid_level_depe_G)
plot(res, rank = T)


#CWM_natur_manag_mean
hist(Data_univar_CWM_TreMs_Pyr$CWM_natur_manag_mean)

mod_Pyr_CWM_natur_manag_mean_level_depe_G = glmmTMB(CWM_natur_manag_mean ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_CWM_natur_manag_mean_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_natur_manag_mean_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Pyr, aes(x = level_depe_G, y = CWM_natur_manag_mean, color = site)) + geom_point() + geom_smooth(method = "lm")


#FDis_natur_manag_mean
hist(Data_univar_CWM_TreMs_Pyr$FDis_natur_manag_mean)

mod_Pyr_FDis_natur_manag_mean_level_depe_G = glmmTMB(FDis_natur_manag_mean ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Pyr, family = gaussian())
summary(mod_Pyr_FDis_natur_manag_mean_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_natur_manag_mean_level_depe_G)
plot(res, rank = T)


```



###



###Pyrenees Magnitude study
```{r Pyr Magnitude study TreMs}


#TreMs_ab
summary(mod_Pyr_TreMs_ab_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_TreMs_ab_level_depe_G = rnorm(10000, mean = 0.7066, sd = 0.3865)

D <- exp(Estimate_mod_Pyr_TreMs_ab_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_TreMs_ab_level_depe_G)


#TreMs_div
summary(mod_Pyr_TreMs_div_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_TreMs_div_level_depe_G = rnorm(10000, mean = 0.7566, sd = 0.2763)

D <- exp(Estimate_mod_Pyr_TreMs_div_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_TreMs_div_level_depe_G)


#Exposed_sapwood_only
summary(mod_Pyr_Exposed_sapwood_only_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_Exposed_sapwood_only_level_depe_G = rnorm(10000, mean = 3.1985, sd = 0.7068)

D <- exp(Estimate_mod_Pyr_Exposed_sapwood_only_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_Exposed_sapwood_only_level_depe_G)


#Epiphytic
summary(mod_Pyr_Epiphytic_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_Epiphytic_level_depe_G = rnorm(10000, mean = 0.7635, sd = 0.5674)

D <- (exp(Estimate_mod_Pyr_Epiphytic_level_depe_G * 0.27)-1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_Epiphytic_level_depe_G)


#Exposed_sapwood_and_heartwood
summary(mod_Pyr_Exposed_sapwood_and_heartwood_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_Exposed_sapwood_and_heartwood_level_depe_G = rnorm(10000, mean = 6.53913, sd = 2.55796)

D <- exp(Estimate_mod_Pyr_Exposed_sapwood_and_heartwood_level_depe_G * 0.27)- 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_Exposed_sapwood_and_heartwood_level_depe_G)


#Concavities
summary(mod_Pyr_Concavities_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_Concavities_level_depe_G = rnorm(10000, mean = 0.1803, sd = 0.6198)

D <- exp(Estimate_mod_Pyr_Concavities_level_depe_G * 0.27)- 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_Concavities_level_depe_G)


#Perennial_fungi_fruiting_bodies
summary(mod_Pyr_Perennial_fungi_fruiting_bodies_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_Perennial_fungi_fruiting_bodies_level_depe_G = rnorm(10000, mean = 3.1008, sd = 2.0941)

D <- exp(Estimate_mod_Pyr_Perennial_fungi_fruiting_bodies_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_Perennial_fungi_fruiting_bodies_level_depe_G)


#Twig_tangles
summary(mod_Pyr_Twig_tangles_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_Twig_tangles_level_depe_G = rnorm(10000, mean = 3.0434, sd = 2.1306)

D <- (exp(Estimate_mod_Pyr_Twig_tangles_level_depe_G * 0.27)- 1)*-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_Twig_tangles_level_depe_G)


#Crown_deadwood
summary(mod_Pyr_Crown_deadwood_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_Crown_deadwood_level_depe_G = rnorm(10000, mean = 0.04736, sd = 0.0794)
summary(Data_univar_CWM_TreMs_Pyr$Crown_deadwood_LW_nb)
val_predict = predict(glmmTMB(Crown_deadwood_LW_nb ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_Crown_deadwood_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_Crown_deadwood_level_depe_G)


#Dead_branches
summary(mod_Pyr_Dead_branches_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_Dead_branches_level_depe_G = rnorm(10000, mean = 0.9526, sd = 1.1171)

D <- exp(Estimate_mod_Pyr_Dead_branches_level_depe_G * 0.27)- 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))

rm(Estimate_mod_Pyr_Dead_branches_level_depe_G)


#Dead_top
summary(mod_Pyr_Dead_top_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_Dead_top_level_depe_G = rnorm(10000, mean = 0.33736, sd = 0.33036)
summary(Data_univar_CWM_TreMs_Pyr$Dead_top_LW_nb)
val_predict = predict(glmmTMB(Dead_top_LW_nb ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_Dead_top_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_Dead_top_level_depe_G)


#Rot_holes
summary(mod_Pyr_Rot_holes_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_Rot_holes_level_depe_G = rnorm(10000, mean = 1.5597, sd = 2.1321)

D <- exp(Estimate_mod_Pyr_Rot_holes_level_depe_G * 0.27)- 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_Rot_holes_level_depe_G)


#Burrs_and_cankers
summary(mod_Pyr_Burrs_and_cankers_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_Burrs_and_cankers_level_depe_G = rnorm(10000, mean = 0.1958, sd = 1.8374)
summary(Data_univar_CWM_TreMs_Pyr$Burrs_and_cankers)
val_predict = predict(glmmTMB(Burrs_and_cankers ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Pyr_Burrs_and_cankers_level_depe_G * 0.27) / val_predict) - 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_Burrs_and_cankers_level_depe_G)


#Exudates
summary(mod_Pyr_Exudates_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_Exudates_level_depe_G = rnorm(10000, mean = 7.7853, sd = 6.7335)

D <- exp(Estimate_mod_Pyr_Exudates_level_depe_G * 0.27)- 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_Exudates_level_depe_G)


#Wood_pecker_breeding_cavities
summary(mod_Pyr_Wood_pecker_breeding_cavities_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_Wood_pecker_breeding_cavities_level_depe_G = rnorm(10000, mean = 7.7991, sd = 8.1131)

D <- exp(Estimate_mod_Pyr_Wood_pecker_breeding_cavities_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_Wood_pecker_breeding_cavities_level_depe_G)


#Ephemeral_fungal_fruiting_bodies
summary(mod_Pyr_Ephemeral_fungal_fruiting_bodies_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_Ephemeral_fungal_fruiting_bodies_level_depe_G = rnorm(10000, mean = 6.5941, sd = 2.6965)

D <- exp(Estimate_mod_Pyr_Ephemeral_fungal_fruiting_bodies_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_Ephemeral_fungal_fruiting_bodies_level_depe_G)


# #Rootplate
# summary(mod_Pyr_Rootplate_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Pyr_Rootplate_level_depe_G = rnorm(10000, mean = 1.5401, sd = 7.2523)
# 
# D <- exp(Estimate_mod_Pyr_Rootplate_level_depe_G * 0.15)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Pyr_Rootplate_level_depe_G)


# #Nest
# summary(mod_Pyr_Nest_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Pyr_Nest_level_depe_G = rnorm(10000, mean = 2.399, sd = 5.8673)
# 
# D <- exp(Estimate_mod_Pyr_Nest_level_depe_G * 0.15)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Pyr_Nest_level_depe_G)


# #CWD
# summary(mod_Pyr_CWD_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Pyr_CWD_level_depe_G = rnorm(10000, mean = 0.069, sd = 0.4043)
# 
# D <- exp(Estimate_mod_Pyr_CWD_level_depe_G * 0.15)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Pyr_CWD_level_depe_G)


# #Microsoil
# summary(mod_Pyr_Microsoil_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Pyr_Microsoil_level_depe_G = rnorm(10000, mean = 5.1266, sd = 11.628)
# 
# D <- exp(Estimate_mod_Pyr_Microsoil_level_depe_G * 0.15)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Pyr_Microsoil_level_depe_G)


# #Insect_gPyreries
# summary(mod_Pyr_Insect_gPyreries_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Pyr_Insect_gPyreries_level_depe_G = rnorm(10000, mean = 0.069, sd = 0.4043)
# 
# D <- exp(Estimate_mod_Pyr_Insect_gPyreries_level_depe_G * 0.15)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Pyr_Insect_gPyreries_level_depe_G)


#FRic
summary(mod_Pyr_FRic_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FRic_level_depe_G = rnorm(10000, mean = 12.451, sd = 4.589)
summary(Data_univar_CWM_TreMs_Pyr$FRic)
val_predict = predict(glmmTMB(FRic ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FRic_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FRic_level_depe_G)


#FDiv
summary(mod_Pyr_FDiv_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDiv_level_depe_G = rnorm(10000, mean = 0.13118, sd = 0.07417)
summary(Data_univar_CWM_TreMs_Pyr$FDiv)
val_predict = predict(glmmTMB(FDiv ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDiv_level_depe_G * 0.27) / val_predict)- 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDiv_level_depe_G)


#FEve
summary(mod_Pyr_FEve_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FEve_level_depe_G = rnorm(10000, mean = 0.09695, sd = 0.089)
summary(Data_univar_CWM_TreMs_Pyr$FEve)
val_predict = predict(glmmTMB(FEve ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FEve_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FEve_level_depe_G)


#FDis
summary(mod_Pyr_FDis_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_level_depe_G = rnorm(10000, mean = 0.70731, sd = 0.22747)
summary(Data_univar_CWM_TreMs_Pyr$FDis)
val_predict = predict(glmmTMB(FDis ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDis_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_level_depe_G)


#CWM_DW_type_substrate
summary(mod_Pyr_CWM_DW_type_substrate_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_DW_type_substrate_level_depe_G = rnorm(10000, mean = 0.03877, sd = 0.12246)
summary(Data_univar_CWM_TreMs_Pyr$CWM_DW_type_substrate)
val_predict = predict(glmmTMB(CWM_DW_type_substrate ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Pyr_CWM_DW_type_substrate_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_CWM_DW_type_substrate_level_depe_G)


#FDis_DW_type_substrate
summary(mod_Pyr_FDis_DW_type_substrate_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_DW_type_substrate_level_depe_G = rnorm(10000, mean = 0.22744, sd = 0.12346)
summary(Data_univar_CWM_TreMs_Pyr$FDis_DW_type_substrate)
val_predict = predict(glmmTMB(FDis_DW_type_substrate ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDis_DW_type_substrate_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_DW_type_substrate_level_depe_G)


#CWM_POS
summary(mod_Pyr_CWM_POS_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_POS_level_depe_G = rnorm(10000, mean = 0.27542, sd = 0.11283)
summary(Data_univar_CWM_TreMs_Pyr$CWM_POS)
val_predict = predict(glmmTMB(CWM_POS ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_CWM_POS_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_CWM_POS_level_depe_G)


#FDis_POS
summary(mod_Pyr_FDis_POS_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_POS_level_depe_G = rnorm(10000, mean = 0.19016, sd = 0.20605)
summary(Data_univar_CWM_TreMs_Pyr$FDis_POS)
val_predict = predict(glmmTMB(FDis_POS ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Pyr_FDis_POS_level_depe_G * 0.27) / val_predict) - 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_POS_level_depe_G)


#CWM_HUM_dry_wet
summary(mod_Pyr_CWM_HUM_dry_wet_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_HUM_dry_wet_level_depe_G = rnorm(10000, mean = 0.001879, sd = 0.046771)
summary(Data_univar_CWM_TreMs_Pyr$CWM_HUM_dry_wet)

D <- (exp(Estimate_mod_Pyr_CWM_HUM_dry_wet_level_depe_G * 0.27)-1)*-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_CWM_HUM_dry_wet_level_depe_G)


#FDis_HUM_dry_wet
summary(mod_Pyr_FDis_HUM_dry_wet_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_HUM_dry_wet_level_depe_G = rnorm(10000, mean = 0.47567, sd = 0.12413)
summary(Data_univar_CWM_TreMs_Pyr$FDis_HUM_dry_wet)
val_predict = predict(glmmTMB(FDis_HUM_dry_wet ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDis_HUM_dry_wet_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_HUM_dry_wet_level_depe_G)


#CWM_LIFE
summary(mod_Pyr_CWM_LIFE_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_LIFE_level_depe_G = rnorm(10000, mean = 0.135406, sd = 0.030718)
summary(Data_univar_CWM_TreMs_Pyr$CWM_LIFE)

D <- (exp(Estimate_mod_Pyr_CWM_LIFE_level_depe_G * 0.27)-1)*-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_CWM_LIFE_level_depe_G)


#FDis_LIFE
summary(mod_Pyr_FDis_LIFE_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_LIFE_level_depe_G = rnorm(10000, mean = 0.72403, sd = 0.21214)
summary(Data_univar_CWM_TreMs_Pyr$FDis_LIFE)
val_predict = predict(glmmTMB(FDis_LIFE ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDis_LIFE_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_LIFE_level_depe_G)


#CWM_ONTO
summary(mod_Pyr_CWM_ONTO_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_ONTO_level_depe_G = rnorm(10000, mean = 0.09624, sd = 0.15268)
summary(Data_univar_CWM_TreMs_Pyr$CWM_ONTO)
val_predict = predict(glmmTMB(CWM_ONTO ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Pyr_CWM_ONTO_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_CWM_ONTO_level_depe_G)


#FDis_ONTO
summary(mod_Pyr_FDis_ONTO_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_ONTO_level_depe_G = rnorm(10000, mean = 0.07955, sd = 0.14222)
summary(Data_univar_CWM_TreMs_Pyr$FDis_ONTO)
val_predict = predict(glmmTMB(FDis_ONTO ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDis_ONTO_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_ONTO_level_depe_G)





#CWM_DW_saproxylic
summary(mod_Pyr_CWM_DW_saproxylic_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_DW_saproxylic_level_depe_G = rnorm(10000, mean = 1.1289, sd = 0.3538)
summary(Data_univar_CWM_TreMs_Pyr$CWM_DW_saproxylic)
val_predict = predict(glmmTMB(CWM_DW_saproxylic ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_CWM_DW_saproxylic_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_CWM_DW_saproxylic_level_depe_G)


#FDis_DW_saproxylic
summary(mod_Pyr_FDis_DW_saproxylic_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_DW_saproxylic_level_depe_G = rnorm(10000, mean = 0.40761, sd = 0.19938)
summary(Data_univar_CWM_TreMs_Pyr$FDis_DW_saproxylic)
val_predict = predict(glmmTMB(FDis_DW_saproxylic ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDis_DW_saproxylic_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_DW_saproxylic_level_depe_G)


#CWM_DW_epixylic
summary(mod_Pyr_CWM_DW_epixylic_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_DW_epixylic_level_depe_G = rnorm(10000, mean = 1.3406, sd = 0.3522)
summary(Data_univar_CWM_TreMs_Pyr$CWM_DW_epixylic)
val_predict = predict(glmmTMB(CWM_DW_epixylic ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Pyr_CWM_DW_epixylic_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_CWM_DW_epixylic_level_depe_G)


#FDis_DW_epixylic
summary(mod_Pyr_FDis_DW_epixylic_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_DW_epixylic_level_depe_G = rnorm(10000, mean = 0.51341, sd = 0.18704)
summary(Data_univar_CWM_TreMs_Pyr$FDis_DW_epixylic)
val_predict = predict(glmmTMB(FDis_DW_epixylic ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDis_DW_epixylic_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_DW_epixylic_level_depe_G)


#CWM_DW_mould
summary(mod_Pyr_CWM_DW_contains_mould_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_DW_contains_mould_level_depe_G = rnorm(10000, mean = 0.4731, sd = 0.1861)
summary(Data_univar_CWM_TreMs_Pyr$CWM_DW_contains_mould)
val_predict = predict(glmmTMB(CWM_DW_contains_mould ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_CWM_DW_contains_mould_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_CWM_DW_contains_mould_level_depe_G)


#FDis_DW_mould
summary(mod_Pyr_FDis_DW_contains_mould_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_DW_contains_mould_level_depe_G = rnorm(10000, mean = 1.3318, sd = 0.8146)
summary(Data_univar_CWM_TreMs_Pyr$FDis_DW_contains_mould)

D <- exp(Estimate_mod_Pyr_FDis_DW_contains_mould_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_FDis_DW_contains_mould_level_depe_G)


#CWM_DW_living_tree
summary(mod_Pyr_CWM_DW_living_tree_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_DW_living_tree_level_depe_G = rnorm(10000, mean = 0.37161, sd = 0.08531)
summary(Data_univar_CWM_TreMs_Pyr$CWM_DW_living_tree)

D <- (exp(Estimate_mod_Pyr_CWM_DW_living_tree_level_depe_G * 0.27)-1)*-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_CWM_DW_living_tree_level_depe_G)


#FDis_DW_living_tree
summary(mod_Pyr_FDis_DW_living_tree_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_DW_living_tree_level_depe_G = rnorm(10000, mean = 0.93733, sd = 0.2441)
summary(Data_univar_CWM_TreMs_Pyr$FDis_DW_living_tree)
val_predict = predict(glmmTMB(FDis_DW_living_tree ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDis_DW_living_tree_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_DW_living_tree_level_depe_G)


#CWM_DW_snag
summary(mod_Pyr_CWM_DW_snag_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_DW_snag_level_depe_G = rnorm(10000, mean = 0.1455, sd = 0.4019)
summary(Data_univar_CWM_TreMs_Pyr$CWM_DW_snag)
val_predict = predict(glmmTMB(CWM_DW_snag ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Pyr_CWM_DW_snag_level_depe_G * 0.27) / val_predict) - 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_CWM_DW_snag_level_depe_G)


#FDis_DW_snag
summary(mod_Pyr_FDis_DW_snag_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_DW_snag_level_depe_G = rnorm(10000, mean = 0.2936, sd = 0.14146)
summary(Data_univar_CWM_TreMs_Pyr$FDis_DW_snag)
val_predict = predict(glmmTMB(FDis_DW_snag ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDis_DW_snag_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_DW_snag_level_depe_G)


#CWM_DW_log
summary(mod_Pyr_CWM_DW_log_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_DW_log_level_depe_G = rnorm(10000, mean = 0.3758, sd = 0.3049)
summary(Data_univar_CWM_TreMs_Pyr$CWM_DW_log)

D <- (exp(Estimate_mod_Pyr_CWM_DW_log_level_depe_G * 0.27)-1)*-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Pyr_CWM_DW_log_level_depe_G)


#FDis_DW_log
summary(mod_Pyr_FDis_DW_log_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_DW_log_level_depe_G = rnorm(10000, mean = 0.05348, sd = 0.14698)
summary(Data_univar_CWM_TreMs_Pyr$FDis_DW_log)
val_predict = predict(glmmTMB(FDis_DW_log ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDis_DW_log_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_DW_log_level_depe_G)


#CWM_POS_base
summary(mod_Pyr_CWM_POS_base_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_POS_base_level_depe_G = rnorm(10000, mean = 0.949, sd = 0.3101)
summary(Data_univar_CWM_TreMs_Pyr$CWM_POS_base)
val_predict = predict(glmmTMB(CWM_POS_base ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Pyr_CWM_POS_base_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_CWM_POS_base_level_depe_G)


#FDis_POS_base
summary(mod_Pyr_FDis_POS_base_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_POS_base_level_depe_G = rnorm(10000, mean = 0.06232, sd = 0.17562)
summary(Data_univar_CWM_TreMs_Pyr$FDis_POS_base)
val_predict = predict(glmmTMB(FDis_POS_base ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDis_POS_base_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_POS_base_level_depe_G)


#CWM_POS_trunk
summary(mod_Pyr_CWM_POS_trunk_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_POS_trunk_level_depe_G = rnorm(10000, mean = 0.83823, sd = 0.26727)
summary(Data_univar_CWM_TreMs_Pyr$CWM_POS_trunk)
val_predict = predict(glmmTMB(CWM_POS_trunk ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_CWM_POS_trunk_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_CWM_POS_trunk_level_depe_G)


#FDis_POS_trunk
summary(mod_Pyr_FDis_POS_trunk_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_POS_trunk_level_depe_G = rnorm(10000, mean = 0.13753, sd = 0.19025)
summary(Data_univar_CWM_TreMs_Pyr$FDis_POS_trunk)
val_predict = predict(glmmTMB(FDis_POS_trunk ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Pyr_FDis_POS_trunk_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_POS_trunk_level_depe_G)


#CWM_POS_crown
summary(mod_Pyr_CWM_POS_crown_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_POS_crown_level_depe_G = rnorm(10000, mean = 0.53319, sd = 0.21095)
summary(Data_univar_CWM_TreMs_Pyr$CWM_POS_crown)
val_predict = predict(glmmTMB(CWM_POS_crown ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_CWM_POS_crown_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_CWM_POS_crown_level_depe_G)


#FDis_POS_crown
summary(mod_Pyr_FDis_POS_crown_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_POS_crown_level_depe_G = rnorm(10000, mean = 0.1215, sd = 0.15723)
summary(Data_univar_CWM_TreMs_Pyr$FDis_POS_crown)
val_predict = predict(glmmTMB(FDis_POS_crown ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDis_POS_crown_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_POS_crown_level_depe_G)


# #CWM_SOIL_contact
# summary(mod_Pyr_CWM_SOIL_contact_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Pyr_CWM_SOIL_contact_level_depe_G = rnorm(10000, mean = 1.3234, sd = 0.3566)
# 
# D <- (exp(Estimate_mod_Pyr_CWM_SOIL_contact_level_depe_G * 0.15) - 1)*-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Pyr_CWM_SOIL_contact_level_depe_G)
# 
# 
# #FDis_SOIL_contact
# summary(mod_Pyr_FDis_SOIL_contact_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Pyr_FDis_SOIL_contact_level_depe_G = rnorm(10000, mean = 0.06063, sd = 0.20439)
# summary(Data_univar_CWM_TreMs_Pyr$FDis_SOIL_contact)
# 
# D <- ((0.6737 + (Estimate_mod_Pyr_FDis_SOIL_contact_level_depe_G * 0.15)) / 0.6737) - 1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Pyr_FDis_SOIL_contact_level_depe_G)


#CWM_HUM_dry
summary(mod_Pyr_CWM_HUM_dry_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_HUM_dry_level_depe_G = rnorm(10000, mean = 0.06086, sd = 0.29231)
summary(Data_univar_CWM_TreMs_Pyr$CWM_HUM_dry)
val_predict = predict(glmmTMB(CWM_HUM_dry ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Pyr_CWM_HUM_dry_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_CWM_HUM_dry_level_depe_G)


#FDis_HUM_dry
summary(mod_Pyr_FDis_HUM_dry_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_HUM_dry_level_depe_G = rnorm(10000, mean = 0.3672, sd = 0.13501)
summary(Data_univar_CWM_TreMs_Pyr$FDis_HUM_dry)
val_predict = predict(glmmTMB(FDis_HUM_dry ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDis_HUM_dry_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_HUM_dry_level_depe_G)


#CWM_HUM_wet
summary(mod_Pyr_CWM_HUM_wet_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_HUM_wet_level_depe_G = rnorm(10000, mean = 0.0007346, sd = 0.2375599)
summary(Data_univar_CWM_TreMs_Pyr$CWM_HUM_wet)
val_predict = predict(glmmTMB(CWM_HUM_wet ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_CWM_HUM_wet_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_CWM_HUM_wet_level_depe_G)


#FDis_HUM_wet
summary(mod_Pyr_FDis_HUM_wet_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_HUM_wet_level_depe_G = rnorm(10000, mean = 0.61715, sd = 0.12285)
summary(Data_univar_CWM_TreMs_Pyr$FDis_HUM_wet)
val_predict = predict(glmmTMB(FDis_HUM_wet ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDis_HUM_wet_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_HUM_wet_level_depe_G)


#CWM_LIFE_ephemeral
summary(mod_Pyr_CWM_LIFE_ephemeral_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_LIFE_ephemeral_level_depe_G = rnorm(10000, mean = 0.34844, sd = 0.1142)
summary(Data_univar_CWM_TreMs_Pyr$CWM_LIFE_ephemeral)
val_predict = predict(glmmTMB(CWM_LIFE_ephemeral ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_CWM_LIFE_ephemeral_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_CWM_LIFE_ephemeral_level_depe_G)


#FDis_LIFE_ephemeral
summary(mod_Pyr_FDis_LIFE_ephemeral_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_LIFE_ephemeral_level_depe_G = rnorm(10000, mean = 0.44001, sd = 0.18491)
summary(Data_univar_CWM_TreMs_Pyr$FDis_LIFE_ephemeral)
val_predict = predict(glmmTMB(FDis_LIFE_ephemeral ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDis_LIFE_ephemeral_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_LIFE_ephemeral_level_depe_G)


#CWM_LIFE_annual
summary(mod_Pyr_CWM_LIFE_annual_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_LIFE_annual_level_depe_G = rnorm(10000, mean = 1.37073, sd = 0.2729)
summary(Data_univar_CWM_TreMs_Pyr$CWM_LIFE_annual)
val_predict = predict(glmmTMB(CWM_LIFE_annual ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_CWM_LIFE_annual_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_CWM_LIFE_annual_level_depe_G)


#FDis_LIFE_annual
summary(mod_Pyr_FDis_LIFE_annual_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_LIFE_annual_level_depe_G = rnorm(10000, mean = 1.59025, sd = 0.36314)
summary(Data_univar_CWM_TreMs_Pyr$FDis_LIFE_annual)
val_predict = predict(glmmTMB(FDis_LIFE_annual ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDis_LIFE_annual_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_LIFE_annual_level_depe_G)


#CWM_LIFE_perenial
summary(mod_Pyr_CWM_LIFE_perenial_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_LIFE_perenial_level_depe_G = rnorm(10000, mean = 0.60679, sd = 0.12682)
summary(Data_univar_CWM_TreMs_Pyr$CWM_LIFE_perenial)
val_predict = predict(glmmTMB(CWM_LIFE_perenial ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Pyr_CWM_LIFE_perenial_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_CWM_LIFE_perenial_level_depe_G)


#FDis_LIFE_perenial
summary(mod_Pyr_FDis_LIFE_perenial_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_LIFE_perenial_level_depe_G = rnorm(10000, mean = 0.8197, sd = 0.2194)
summary(Data_univar_CWM_TreMs_Pyr$FDis_LIFE_perenial)
val_predict = predict(glmmTMB(FDis_LIFE_perenial ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDis_LIFE_perenial_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_LIFE_perenial_level_depe_G)


#CWM_ONTO_slow
summary(mod_Pyr_CWM_ONTO_slow_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_ONTO_slow_level_depe_G = rnorm(10000, mean = 0.3625, sd = 0.3432)
summary(Data_univar_CWM_TreMs_Pyr$CWM_ONTO_slow)
val_predict = predict(glmmTMB(CWM_ONTO_slow ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_CWM_ONTO_slow_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_CWM_ONTO_slow_level_depe_G)


#FDis_ONTO_slow
summary(mod_Pyr_FDis_ONTO_slow_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_ONTO_slow_level_depe_G = rnorm(10000, mean = 0.14725, sd = 0.14657)
summary(Data_univar_CWM_TreMs_Pyr$FDis_ONTO_slow)
val_predict = predict(glmmTMB(FDis_ONTO_slow ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDis_ONTO_slow_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_ONTO_slow_level_depe_G)


#CWM_ONTO_fairly_slow
summary(mod_Pyr_CWM_ONTO_fairly_slow_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_ONTO_fairly_slow_level_depe_G = rnorm(10000, mean = 0.4324, sd = 0.2887)
summary(Data_univar_CWM_TreMs_Pyr$CWM_ONTO_fairly_slow)
val_predict = predict(glmmTMB(CWM_ONTO_fairly_slow ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_CWM_ONTO_fairly_slow_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_CWM_ONTO_fairly_slow_level_depe_G)


#FDis_ONTO_fairly_slow
summary(mod_Pyr_FDis_ONTO_fairly_slow_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_ONTO_fairly_slow_level_depe_G = rnorm(10000, mean = 0.2028, sd = 0.15403)
summary(Data_univar_CWM_TreMs_Pyr$FDis_ONTO_fairly_slow)
val_predict = predict(glmmTMB(FDis_ONTO_fairly_slow ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDis_ONTO_fairly_slow_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_ONTO_fairly_slow_level_depe_G)


#CWM_ONTO_fairly_rapid
summary(mod_Pyr_CWM_ONTO_fairly_rapid_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_ONTO_fairly_rapid_level_depe_G = rnorm(10000, mean = 0.1245, sd = 0.4623)
summary(Data_univar_CWM_TreMs_Pyr$CWM_ONTO_fairly_rapid)
val_predict = predict(glmmTMB(CWM_ONTO_fairly_rapid ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_CWM_ONTO_fairly_rapid_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_CWM_ONTO_fairly_rapid_level_depe_G)


#FDis_ONTO_fairly_rapid
summary(mod_Pyr_FDis_ONTO_fairly_rapid_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_ONTO_fairly_rapid_level_depe_G = rnorm(10000, mean = 0.17344, sd = 0.1918)
summary(Data_univar_CWM_TreMs_Pyr$FDis_ONTO_fairly_rapid)
val_predict = predict(glmmTMB(FDis_ONTO_fairly_rapid ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDis_ONTO_fairly_rapid_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_ONTO_fairly_rapid_level_depe_G)


#CWM_ONTO_rapid
summary(mod_Pyr_CWM_ONTO_rapid_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_ONTO_rapid_level_depe_G = rnorm(10000, mean = 0.04241, sd = 0.13429)
summary(Data_univar_CWM_TreMs_Pyr$CWM_ONTO_rapid)
val_predict = predict(glmmTMB(CWM_ONTO_rapid ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Pyr_CWM_ONTO_rapid_level_depe_G * 0.27) / val_predict) - 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_CWM_ONTO_rapid_level_depe_G)


#FDis_ONTO_rapid
summary(mod_Pyr_FDis_ONTO_rapid_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_ONTO_rapid_level_depe_G = rnorm(10000, mean = 0.00958, sd = 0.14292)
summary(Data_univar_CWM_TreMs_Pyr$FDis_ONTO_rapid)
val_predict = predict(glmmTMB(FDis_ONTO_rapid ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Pyr_FDis_ONTO_rapid_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_ONTO_rapid_level_depe_G)


#CWM_natur_manag_mean
summary(mod_Pyr_CWM_natur_manag_mean_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_CWM_natur_manag_mean_level_depe_G = rnorm(10000, mean = 0.11236, sd = 0.02242)
summary(Data_univar_CWM_TreMs_Pyr$CWM_natur_manag_mean)
val_predict = predict(glmmTMB(CWM_natur_manag_mean ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Pyr_CWM_natur_manag_mean_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_CWM_natur_manag_mean_level_depe_G)


#FDis_natur_manag_mean
summary(mod_Pyr_FDis_natur_manag_mean_level_depe_G)

set.seed(1)
Estimate_mod_Pyr_FDis_natur_manag_mean_level_depe_G = rnorm(10000, mean = 0.04375, sd = 0.21077)
summary(Data_univar_CWM_TreMs_Pyr$FDis_natur_manag_mean)
val_predict = predict(glmmTMB(FDis_natur_manag_mean ~ level_depe_G, data = Data_univar_CWM_TreMs_Pyr, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Pyr_FDis_natur_manag_mean_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Pyr_FDis_natur_manag_mean_level_depe_G)


```



###



### CVL
```{r level_depe_G CVL}


#TreMs_ab
ggplot(data = Data_univar_CWM_TreMs_CVL, aes(y = TreMs_ab, x = level_depe_G)) + geom_point() + geom_smooth(method = "lm", formula = y ~ x, fullrange = T)
hist(Data_univar_CWM_TreMs_CVL$TreMs_ab)

mod_CVL_TreMs_ab_level_depe_G = glmmTMB(TreMs_ab ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = nbinom2())
summary(mod_CVL_TreMs_ab_level_depe_G)
res = simulateResiduals(mod_CVL_TreMs_ab_level_depe_G)
plot(res, rank = T)


#TreMs_div
TreMs_div_depe_CVL = ggplot(data = Data_univar_CWM_TreMs_CVL, aes(y = TreMs_div, x = level_depe_G)) + geom_point(aes(color = site)) + geom_smooth(method = "lm", formula = y ~ x, fullrange = T, color = "#A28346") + theme_bw() + labs(x = "Taux de mortalité des arbres", y = "Diversité locale", color = "Contexte") + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + ggtitle(label = "Dendromicrohabitats", subtitle = "Total") + annotate(geom = "text", label = "p < 0.05 *", x = 0.05, y = 16, hjust = 0)
TreMs_div_depe_CVL

ggsave("Figures/TreMs_div_depe_CVL.png", plot = TreMs_div_depe_CVL, width = 12, height = 10, units = "cm", type = "cairo")

hist(Data_univar_CWM_TreMs_CVL$TreMs_div)

mod_CVL_TreMs_div_level_depe_G = glm(TreMs_div ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = poisson())
summary(mod_CVL_TreMs_div_level_depe_G)
res = simulateResiduals(mod_CVL_TreMs_div_level_depe_G)
plot(res, rank = T)


#Exposed_sapwood_only
hist(Data_univar_CWM_TreMs_CVL$Exposed_sapwood_only)

mod_CVL_Exposed_sapwood_only_level_depe_G = mixed_model(fixed = round(Exposed_sapwood_only) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_CVL, family = negative.binomial())
summary(mod_CVL_Exposed_sapwood_only_level_depe_G)
res = simulateResiduals(mod_CVL_Exposed_sapwood_only_level_depe_G)
plot(res, rank = T)


#Epiphytic
hist(Data_univar_CWM_TreMs_CVL$Epiphytic)

mod_CVL_Epiphytic_level_depe_G = mixed_model(fixed = round(Epiphytic) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_CVL, family = negative.binomial())
summary(mod_CVL_Epiphytic_level_depe_G)
res = simulateResiduals(mod_CVL_Epiphytic_level_depe_G)
plot(res, rank = T)


#Exposed_sapwood_and_heartwood
hist(Data_univar_CWM_TreMs_CVL$Exposed_sapwood_and_heartwood)

mod_CVL_Exposed_sapwood_and_heartwood_level_depe_G = glmmTMB(round(Exposed_sapwood_and_heartwood) ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = nbinom1())
summary(mod_CVL_Exposed_sapwood_and_heartwood_level_depe_G)
res = simulateResiduals(mod_CVL_Exposed_sapwood_and_heartwood_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_CVL, aes(x = level_depe_G, y = Exposed_sapwood_and_heartwood)) + geom_point() + geom_smooth(method = "glm", method.args = list(family = nbinom1()))


#Concavities
hist(Data_univar_CWM_TreMs_CVL$Concavities)

mod_CVL_Concavities_level_depe_G = glmmTMB(round(Concavities) ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = nbinom2())
summary(mod_CVL_Concavities_level_depe_G)
res = simulateResiduals(mod_CVL_Concavities_level_depe_G)
plot(res, rank = T)


#Perennial_fungi_fruiting_bodies
hist(Data_univar_CWM_TreMs_CVL$Perennial_fungi_fruiting_bodies)

mod_CVL_Perennial_fungi_fruiting_bodies_level_depe_G = glmmTMB(round(Perennial_fungi_fruiting_bodies) ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = nbinom2())
summary(mod_CVL_Perennial_fungi_fruiting_bodies_level_depe_G)
res = simulateResiduals(mod_CVL_Perennial_fungi_fruiting_bodies_level_depe_G)
plot(res, rank = T)

plot_perennial_fungi_level_depe_G_CVL = ggplot(Data_univar_CWM_TreMs_CVL, aes(x = level_depe_G, y = Perennial_fungi_fruiting_bodies)) + geom_point(size = 2, aes(color = site)) + geom_smooth(color = "#A28346", method = "glm", method.args = list(family = gaussian())) + theme_bw() + labs(x = "Taux de mortalité", y = "Ab. Fructification pérennes\nde champignons saprolignicoles", color = "Contexte") + annotate(geom = "text", label = "p < 0.05 *", x = 0.21, y = 1, hjust = 0) + ggtitle(label = "Dendromicrohabitats")
plot_perennial_fungi_level_depe_G_CVL

ggsave("Figures/plot_perennial_fungi_level_depe_G_CVL.png", plot = plot_perennial_fungi_level_depe_G_CVL, width = 12, height = 10, units = "cm", type = "cairo")


#Twig_tangles
hist(Data_univar_CWM_TreMs_CVL$Twig_tangles)

mod_CVL_Twig_tangles_level_depe_G = mixed_model(fixed = round(Twig_tangles) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_CVL, family = negative.binomial())
summary(mod_CVL_Twig_tangles_level_depe_G)
res = simulateResiduals(mod_CVL_Twig_tangles_level_depe_G)
plot(res, rank = T)


#Crown_deadwood
hist(Data_univar_CWM_TreMs_CVL$Crown_deadwood)

mod_CVL_Crown_deadwood_level_depe_G = glmmTMB(Crown_deadwood_LW_nb ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_Crown_deadwood_level_depe_G)
res = simulateResiduals(mod_CVL_Crown_deadwood_level_depe_G)
plot(res, rank = T)

plot_crown_DW_level_depe_G_CVL = ggplot(Data_univar_CWM_TreMs_CVL, aes(x = level_depe_G, y = Crown_deadwood_LW_nb)) + geom_point(size = 2, aes(color = site)) + geom_smooth(color = "#A28346", method = "glm", method.args = list(family = Gamma(link = log))) + theme_bw() + labs(x = "Taux de mortalité", y = "Prop. Arbres vivants\nportant des branches mortes", color = "Contexte") + annotate(geom = "text", label = "p > 0.05 ns", x = 0.05, y = 1.325, hjust = 0) + ggtitle(label = "Dendromicrohabitats")
plot_crown_DW_level_depe_G_CVL

ggsave("Figures/plot_crown_DW_level_depe_G_CVL.png", plot = plot_crown_DW_level_depe_G_CVL, width = 11, height = 9, units = "cm", type = "cairo")


#Dead_branches
hist(Data_univar_CWM_TreMs_CVL$Dead_branches_LW_nb)

mod_CVL_Dead_branches_level_depe_G = glmmTMB(Dead_branches_LW_nb ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = Gamma(link = log))
summary(mod_CVL_Dead_branches_level_depe_G)
res = simulateResiduals(mod_CVL_Dead_branches_level_depe_G)
plot(res, rank = T)


#Dead_top
hist(Data_univar_CWM_TreMs_CVL$Dead_top_LW_nb)

# mod_CVL_Dead_top_level_depe_G = mixed_model(fixed = round(Dead_top) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_CVL, family = hurdle.negative.binomial(), zi_fixed = ~ level_depe_G)
mod_CVL_Dead_top_level_depe_G = glmmTMB(Dead_top_LW_nb ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_Dead_top_level_depe_G)
res = simulateResiduals(mod_CVL_Dead_top_level_depe_G)
plot(res, rank = T)


#Rot_holes
hist(Data_univar_CWM_TreMs_CVL$Rot_holes)

mod_CVL_Rot_holes_level_depe_G = glmmTMB(round(Rot_holes) ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = nbinom2())
summary(mod_CVL_Rot_holes_level_depe_G)
res = simulateResiduals(mod_CVL_Rot_holes_level_depe_G)
plot(res, rank = T)


#Burrs_and_cankers
hist(Data_univar_CWM_TreMs_CVL$Burrs_and_cankers)

mod_CVL_Burrs_and_cankers_level_depe_G = glmmTMB(Burrs_and_cankers ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_Burrs_and_cankers_level_depe_G)
res = simulateResiduals(mod_CVL_Burrs_and_cankers_level_depe_G)
plot(res, rank = T)


#Exudates
hist(Data_univar_CWM_TreMs_CVL$Exudates)

mod_CVL_Exudates_level_depe_G = glmmTMB(round(Exudates) ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_Exudates_level_depe_G)
res = simulateResiduals(mod_CVL_Exudates_level_depe_G)
plot(res, rank = T)


#Wood_pecker_breeding_cavities
hist(Data_univar_CWM_TreMs_CVL$Wood_pecker_breeding_cavities)

mod_CVL_Wood_pecker_breeding_cavities_level_depe_G = glmmTMB(round(Wood_pecker_breeding_cavities) ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = nbinom2())
summary(mod_CVL_Wood_pecker_breeding_cavities_level_depe_G)
res = simulateResiduals(mod_CVL_Wood_pecker_breeding_cavities_level_depe_G)
plot(res, rank = T)


#Ephemeral_fungal_fruiting_bodies
hist(Data_univar_CWM_TreMs_CVL$Ephemeral_fungal_fruiting_bodies)

mod_CVL_Ephemeral_fungal_fruiting_bodies_level_depe_G = glmmTMB(round(Ephemeral_fungal_fruiting_bodies) ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = nbinom2())
summary(mod_CVL_Ephemeral_fungal_fruiting_bodies_level_depe_G)
res = simulateResiduals(mod_CVL_Ephemeral_fungal_fruiting_bodies_level_depe_G)
plot(res, rank = T)


# #Rootplate
# hist(Data_univar_CWM_TreMs_CVL$Rootplate)
# 
# mod_CVL_Rootplate_level_depe_G = mixed_model(fixed = round(Rootplate) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_CVL, family = negative.binomial())
# summary(mod_CVL_Rootplate_level_depe_G)
# res = simulateResiduals(mod_CVL_Rootplate_level_depe_G)
# plot(res, rank = T)


# #Nest
# hist(Data_univar_CWM_TreMs_CVL$Nest)
# 
# mod_CVL_Nest_level_depe_G = mixed_model(fixed = round(Nest) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_CVL, family = negative.binomial())
# summary(mod_CVL_Nest_level_depe_G)
# res = simulateResiduals(mod_CVL_Nest_level_depe_G)
# plot(res, rank = T)


# #CWD
# hist(Data_univar_CWM_TreMs_CVL$CWD)
# 
# mod_CVL_CWD_level_depe_G = mixed_model(fixed = round(CWD) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_CVL, family = negative.binomial())
# summary(mod_CVL_CWD_level_depe_G)
# res = simulateResiduals(mod_CVL_CWD_level_depe_G)
# plot(res, rank = T)


#Microsoil
hist(Data_univar_CWM_TreMs_CVL$Microsoil)

mod_CVL_Microsoil_level_depe_G = glmmTMB(round(Microsoil) ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = nbinom2())
summary(mod_CVL_Microsoil_level_depe_G)
res = simulateResiduals(mod_CVL_Microsoil_level_depe_G)
plot(res, rank = T)


#Insect_galleries
hist(Data_univar_CWM_TreMs_CVL$Insect_galleries)

mod_CVL_Insect_galleries_level_depe_G = glmmTMB(round(Insect_galleries) ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_Insect_galleries_level_depe_G)
res = simulateResiduals(mod_CVL_Insect_galleries_level_depe_G)
plot(res, rank = T)


#FRic
TreMs_FRic_depe_CVL = ggplot(data = Data_univar_CWM_TreMs_CVL, aes(y = FRic, x = level_depe_G)) + geom_point(aes(color = site)) + geom_smooth(method = "lm", formula = y ~ x, fullrange = T, color = "#A28346") + theme_bw() + labs(x = "Taux de mortalité des arbres", y = "Richesse de traits", color = "Contexte") + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + ggtitle(label = "Dendromicrohabitats") + annotate(geom = "text", label = "p < 0.05 *", x = 0.2, y = 2.5, hjust = 0)
TreMs_FRic_depe_CVL

ggsave("Figures/TreMs_FRic_depe_CVL.png", plot = TreMs_FRic_depe_CVL, width = 12, height = 10, units = "cm", type = "cairo")

hist(Data_univar_CWM_TreMs_CVL$FRic)

mod_CVL_FRic_level_depe_G = glmmTMB(FRic ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FRic_level_depe_G)
res = simulateResiduals(mod_CVL_FRic_level_depe_G)
plot(res, rank = T)


#FDiv
hist(Data_univar_CWM_TreMs_CVL$FDiv)

mod_CVL_FDiv_level_depe_G = glmmTMB(FDiv ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDiv_level_depe_G)
res = simulateResiduals(mod_CVL_FDiv_level_depe_G)
plot(res, rank = T)


#FEve
hist(Data_univar_CWM_TreMs_CVL$FEve)

mod_CVL_FEve_level_depe_G = glmmTMB(FEve ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FEve_level_depe_G)
res = simulateResiduals(mod_CVL_FEve_level_depe_G)
plot(res, rank = T)


#FDis
hist(Data_univar_CWM_TreMs_CVL$FDis)

mod_CVL_FDis_level_depe_G = glmmTMB(FDis ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_level_depe_G)
plot(res, rank = T)


#CWM_DW_type_substrate
hist(Data_univar_CWM_TreMs_CVL$CWM_DW_type_substrate)

mod_CVL_CWM_DW_type_substrate_level_depe_G = glmmTMB(CWM_DW_type_substrate ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_CWM_DW_type_substrate_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_DW_type_substrate_level_depe_G)
plot(res, rank = T)


#FDis_DW_type_substrate
hist(Data_univar_CWM_TreMs_CVL$FDis_DW_type_substrate)

mod_CVL_FDis_DW_type_substrate_level_depe_G = glmmTMB(FDis_DW_type_substrate ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_DW_type_substrate_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_DW_type_substrate_level_depe_G)
plot(res, rank = T)


#CWM_POS
hist(Data_univar_CWM_TreMs_CVL$CWM_POS)

mod_CVL_CWM_POS_level_depe_G = glmmTMB(CWM_POS ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_CWM_POS_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_POS_level_depe_G)
plot(res, rank = T)


#FDis_POS
hist(Data_univar_CWM_TreMs_CVL$FDis_POS)

mod_CVL_FDis_POS_level_depe_G = glmmTMB(FDis_POS ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_POS_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_POS_level_depe_G)
plot(res, rank = T)


#CWM_HUM_dry_wet
hist(Data_univar_CWM_TreMs_CVL$CWM_HUM_dry_wet)

mod_CVL_CWM_HUM_dry_wet_level_depe_G = glmmTMB(CWM_HUM_dry_wet ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = Gamma(link = log))
summary(mod_CVL_CWM_HUM_dry_wet_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_HUM_dry_wet_level_depe_G)
plot(res, rank = T)


#FDis_HUM_dry_wet
hist(Data_univar_CWM_TreMs_CVL$FDis_HUM_dry_wet)

mod_CVL_FDis_HUM_dry_wet_level_depe_G = glmmTMB(FDis_HUM_dry_wet ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_HUM_dry_wet_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_HUM_dry_wet_level_depe_G)
plot(res, rank = T)


#CWM_LIFE
hist(Data_univar_CWM_TreMs_CVL$CWM_LIFE)

mod_CVL_CWM_LIFE_level_depe_G = glmmTMB(CWM_LIFE ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = Gamma(link = log))
summary(mod_CVL_CWM_LIFE_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_LIFE_level_depe_G)
plot(res, rank = T)


#FDis_LIFE
hist(Data_univar_CWM_TreMs_CVL$FDis_LIFE)

mod_CVL_FDis_LIFE_level_depe_G = glmmTMB(FDis_LIFE ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_LIFE_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_LIFE_level_depe_G)
plot(res, rank = T)

#CWM_ONTO
hist(Data_univar_CWM_TreMs_CVL$CWM_ONTO)

mod_CVL_CWM_ONTO_level_depe_G = glmmTMB(CWM_ONTO ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_CWM_ONTO_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_ONTO_level_depe_G)
plot(res, rank = T)


#FDis_ONTO
hist(Data_univar_CWM_TreMs_CVL$FDis_ONTO)

mod_CVL_FDis_ONTO_level_depe_G = glmmTMB(FDis_ONTO ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_ONTO_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_ONTO_level_depe_G)
plot(res, rank = T)





#CWM_DW_saproxylic
hist(Data_univar_CWM_TreMs_CVL$CWM_DW_saproxylic)

mod_CVL_CWM_DW_saproxylic_level_depe_G = glmmTMB(CWM_DW_saproxylic ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_CWM_DW_saproxylic_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_DW_saproxylic_level_depe_G)
plot(res, rank = T)


#FDis_DW_saproxylic
hist(Data_univar_CWM_TreMs_CVL$FDis_DW_saproxylic)

mod_CVL_FDis_DW_saproxylic_level_depe_G = glmmTMB(FDis_DW_saproxylic ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_DW_saproxylic_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_DW_saproxylic_level_depe_G)
plot(res, rank = T)


#CWM_DW_epixylic
hist(Data_univar_CWM_TreMs_CVL$CWM_DW_epixylic)

mod_CVL_CWM_DW_epixylic_level_depe_G = glmmTMB(CWM_DW_epixylic ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_CWM_DW_epixylic_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_DW_epixylic_level_depe_G)
plot(res, rank = T)


#FDis_DW_epixylic
hist(Data_univar_CWM_TreMs_CVL$FDis_DW_epixylic)

mod_CVL_FDis_DW_epixylic_level_depe_G = glmmTMB(FDis_DW_epixylic ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_DW_epixylic_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_DW_epixylic_level_depe_G)
plot(res, rank = T)


#CWM_DW_contains_mould
hist(Data_univar_CWM_TreMs_CVL$CWM_DW_contains_mould)

mod_CVL_CWM_DW_contains_mould_level_depe_G = glmmTMB(CWM_DW_contains_mould ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = Gamma(link = "log"))
summary(mod_CVL_CWM_DW_contains_mould_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_DW_contains_mould_level_depe_G)
plot(res, rank = T)


#FDis_DW_contains_mould
hist(Data_univar_CWM_TreMs_CVL$FDis_DW_contains_mould)

mod_CVL_FDis_DW_contains_mould_level_depe_G = glmmTMB(FDis_DW_contains_mould ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_DW_contains_mould_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_DW_contains_mould_level_depe_G)
plot(res, rank = T)


#CWM_DW_living_tree
hist(Data_univar_CWM_TreMs_CVL$CWM_DW_living_tree)

mod_CVL_CWM_DW_living_tree_level_depe_G = glmmTMB(CWM_DW_living_tree ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_CWM_DW_living_tree_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_DW_living_tree_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_CVL, aes(x = level_depe_G, y = CWM_DW_living_tree)) + geom_point() + geom_smooth(method = "glm", method.args = list(family = Gamma(link = log)))


#FDis_DW_living_tree
hist(Data_univar_CWM_TreMs_CVL$FDis_DW_living_tree)

mod_CVL_FDis_DW_living_tree_level_depe_G = glmmTMB(FDis_DW_living_tree ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_DW_living_tree_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_DW_living_tree_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_CVL, aes(x = level_depe_G, y = FDis_DW_living_tree)) + geom_point() + geom_smooth(method = "lm")


#CWM_DW_snag
hist(Data_univar_CWM_TreMs_CVL$CWM_DW_snag)

mod_CVL_CWM_DW_snag_level_depe_G = glmmTMB(CWM_DW_snag ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_CWM_DW_snag_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_DW_snag_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_CVL, aes(x = level_depe_G, y = CWM_DW_snag, color = site)) + geom_point() + geom_smooth(method = "lm")


#FDis_DW_snag
hist(Data_univar_CWM_TreMs_CVL$FDis_DW_snag)

mod_CVL_FDis_DW_snag_level_depe_G = glmmTMB(FDis_DW_snag ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_DW_snag_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_DW_snag_level_depe_G)
plot(res, rank = T)


#CWM_DW_log
hist(Data_univar_CWM_TreMs_CVL$CWM_DW_log)

mod_CVL_CWM_DW_log_level_depe_G = glmmTMB(CWM_DW_log ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_CWM_DW_log_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_DW_log_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_CVL, aes(x = level_depe_G, y = CWM_DW_log, color = site)) + geom_point() + geom_smooth(method = "lm")


#FDis_DW_log
hist(Data_univar_CWM_TreMs_CVL$FDis_DW_log)

mod_CVL_FDis_DW_log_level_depe_G = glmmTMB(FDis_DW_log ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_DW_log_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_DW_log_level_depe_G)
plot(res, rank = T)


#CWM_SH_concavity
hist(Data_univar_CWM_TreMs_CVL$CWM_SH_concavity)

mod_CVL_CWM_SH_concavity_level_depe_G = glmmTMB(CWM_SH_concavity ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_CWM_SH_concavity_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_SH_concavity_level_depe_G)
plot(res, rank = T)

# ggplot(Data_univar_CWM_TreMs_CVL, aes(x = level_depe_G, y = CWM_SH_concavity, color = site)) + geom_point() + geom_smooth(method = "lm")


#FDis_SH_concavity
hist(Data_univar_CWM_TreMs_CVL$FDis_SH_concavity)

mod_CVL_FDis_SH_concavity_level_depe_G = glmmTMB(FDis_SH_concavity ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_SH_concavity_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_SH_concavity_level_depe_G)
plot(res, rank = T)


#CWM_SH_cavity
hist(Data_univar_CWM_TreMs_CVL$CWM_SH_cavity)

mod_CVL_CWM_SH_cavity_level_depe_G = glmmTMB(CWM_SH_cavity ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_CWM_SH_cavity_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_SH_cavity_level_depe_G)
plot(res, rank = T)


#FDis_SH_cavity
hist(Data_univar_CWM_TreMs_CVL$FDis_SH_cavity)

mod_CVL_FDis_SH_cavity_level_depe_G = glmmTMB(FDis_SH_cavity ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_SH_cavity_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_SH_cavity_level_depe_G)
plot(res, rank = T)


#CWM_SH_crack
hist(Data_univar_CWM_TreMs_CVL$CWM_SH_crack)

mod_CVL_CWM_SH_crack_level_depe_G = glmmTMB(CWM_SH_crack ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_CWM_SH_crack_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_SH_crack_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_CVL, aes(x = level_depe_G, y = CWM_SH_crack, color = site)) + geom_point() + geom_smooth(method = "lm")


#FDis_SH_crack
hist(Data_univar_CWM_TreMs_CVL$FDis_SH_crack)

mod_CVL_FDis_SH_crack_level_depe_G = glmmTMB(FDis_SH_crack ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_SH_crack_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_SH_crack_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_CVL, aes(x = level_depe_G, y = FDis_SH_crack + 0.01, color = site)) + geom_point() + geom_smooth(method = "glm", method.args = list(family = Gamma(link = log)))


#CWM_POS_base
hist(Data_univar_CWM_TreMs_CVL$CWM_POS_base)

mod_CVL_CWM_POS_base_level_depe_G = glmmTMB(CWM_POS_base ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_CWM_POS_base_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_POS_base_level_depe_G)
plot(res, rank = T)


#FDis_POS_base
hist(Data_univar_CWM_TreMs_CVL$FDis_POS_base)

mod_CVL_FDis_POS_base_level_depe_G = glmmTMB(FDis_POS_base ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_POS_base_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_POS_base_level_depe_G)
plot(res, rank = T)


#CWM_POS_trunk
hist(Data_univar_CWM_TreMs_CVL$CWM_POS_trunk)

mod_CVL_CWM_POS_trunk_level_depe_G = glmmTMB(CWM_POS_trunk ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_CWM_POS_trunk_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_POS_trunk_level_depe_G)
plot(res, rank = T)


#FDis_POS_trunk
hist(Data_univar_CWM_TreMs_CVL$FDis_POS_trunk)

mod_CVL_FDis_POS_trunk_level_depe_G = glmmTMB(FDis_POS_trunk ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_POS_trunk_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_POS_trunk_level_depe_G)
plot(res, rank = T)


#CWM_POS_crown
hist(Data_univar_CWM_TreMs_CVL$CWM_POS_crown)

mod_CVL_CWM_POS_crown_level_depe_G = glmmTMB(CWM_POS_crown ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_CWM_POS_crown_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_POS_crown_level_depe_G)
plot(res, rank = T)


#FDis_POS_crown
hist(Data_univar_CWM_TreMs_CVL$FDis_POS_crown)

mod_CVL_FDis_POS_crown_level_depe_G = glmmTMB(FDis_POS_crown ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_POS_crown_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_POS_crown_level_depe_G)
plot(res, rank = T)


# #CWM_SOIL_contact
# hist(Data_univar_CWM_TreMs_CVL$CWM_SOIL_contact)
# 
# mod_CVL_CWM_SOIL_contact_level_depe_G = mixed_model(fixed = CWM_SOIL_contact ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_CVL, family = hurdle.lognormal(), n_phis = 1, zi_fixed = ~ level_depe_G)
# summary(mod_CVL_CWM_SOIL_contact_level_depe_G)
# res = simulateResiduals(mod_CVL_CWM_SOIL_contact_level_depe_G)
# plot(res, rank = T)
# 
# 
# #FDis_SOIL_contact
# hist(Data_univar_CWM_TreMs_CVL$FDis_SOIL_contact)
# 
# mod_CVL_FDis_SOIL_contact_level_depe_G = glmmTMB(FDis_SOIL_contact ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
# summary(mod_CVL_FDis_SOIL_contact_level_depe_G)
# res = simulateResiduals(mod_CVL_FDis_SOIL_contact_level_depe_G)
# plot(res, rank = T)


#CWM_HUM_dry
hist(Data_univar_CWM_TreMs_CVL$CWM_HUM_dry)

mod_CVL_CWM_HUM_dry_level_depe_G = glmmTMB(CWM_HUM_dry ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_CWM_HUM_dry_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_HUM_dry_level_depe_G)
plot(res, rank = T)


#FDis_HUM_dry
hist(Data_univar_CWM_TreMs_CVL$FDis_HUM_dry)

mod_CVL_FDis_HUM_dry_level_depe_G = glmmTMB(FDis_HUM_dry ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_HUM_dry_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_HUM_dry_level_depe_G)
plot(res, rank = T)


#CWM_HUM_wet
hist(Data_univar_CWM_TreMs_CVL$CWM_HUM_wet)

mod_CVL_CWM_HUM_wet_level_depe_G = glmmTMB(CWM_HUM_wet ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_CWM_HUM_wet_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_HUM_wet_level_depe_G)
plot(res, rank = T)


#FDis_HUM_wet
hist(Data_univar_CWM_TreMs_CVL$FDis_HUM_wet)

mod_CVL_FDis_HUM_wet_level_depe_G = glmmTMB(FDis_HUM_wet ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_HUM_wet_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_HUM_wet_level_depe_G)
plot(res, rank = T)


#CWM_LIFE_ephemeral
hist(Data_univar_CWM_TreMs_CVL$CWM_LIFE_ephemeral)

mod_CVL_CWM_LIFE_ephemeral_level_depe_G = glmmTMB(CWM_LIFE_ephemeral ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_CWM_LIFE_ephemeral_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_LIFE_ephemeral_level_depe_G)
plot(res, rank = T)


#FDis_LIFE_ephemeral
hist(Data_univar_CWM_TreMs_CVL$FDis_LIFE_ephemeral)

mod_CVL_FDis_LIFE_ephemeral_level_depe_G = glmmTMB(FDis_LIFE_ephemeral ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_LIFE_ephemeral_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_LIFE_ephemeral_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_CVL, aes(x = level_depe_G, y = FDis_LIFE_ephemeral)) + geom_point() + geom_smooth(method = "lm")


#CWM_LIFE_annual
hist(Data_univar_CWM_TreMs_CVL$CWM_LIFE_annual)

mod_CVL_CWM_LIFE_annual_level_depe_G = glmmTMB(CWM_LIFE_annual ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_CWM_LIFE_annual_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_LIFE_annual_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_CVL, aes(x = level_depe_G, y = CWM_LIFE_annual)) + geom_point() + geom_smooth(method = "lm")


#FDis_LIFE_annual
hist(Data_univar_CWM_TreMs_CVL$FDis_LIFE_annual)

mod_CVL_FDis_LIFE_annual_level_depe_G = glmmTMB(FDis_LIFE_annual ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_LIFE_annual_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_LIFE_annual_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_CVL, aes(x = level_depe_G, y = FDis_LIFE_annual)) + geom_point() + geom_smooth(method = "lm")


#CWM_LIFE_perenial
hist(Data_univar_CWM_TreMs_CVL$CWM_LIFE_perenial)

mod_CVL_CWM_LIFE_perenial_level_depe_G = glmmTMB(CWM_LIFE_perenial ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_CWM_LIFE_perenial_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_LIFE_perenial_level_depe_G)
plot(res, rank = T)


#FDis_LIFE_perenial
hist(Data_univar_CWM_TreMs_CVL$FDis_LIFE_perenial)

mod_CVL_FDis_LIFE_perenial_level_depe_G = glmmTMB(FDis_LIFE_perenial ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_LIFE_perenial_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_LIFE_perenial_level_depe_G)
plot(res, rank = T)


#CWM_ONTO_slow
hist(Data_univar_CWM_TreMs_CVL$CWM_ONTO_slow)

mod_CVL_CWM_ONTO_slow_level_depe_G = glmmTMB(CWM_ONTO_slow ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_CWM_ONTO_slow_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_ONTO_slow_level_depe_G)
plot(res, rank = T)


#FDis_ONTO_slow
hist(Data_univar_CWM_TreMs_CVL$FDis_ONTO_slow)

mod_CVL_FDis_ONTO_slow_level_depe_G = glmmTMB(FDis_ONTO_slow ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_ONTO_slow_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_ONTO_slow_level_depe_G)
plot(res, rank = T)


#CWM_ONTO_fairly_slow
hist(Data_univar_CWM_TreMs_CVL$CWM_ONTO_fairly_slow)

mod_CVL_CWM_ONTO_fairly_slow_level_depe_G = glmmTMB(CWM_ONTO_fairly_slow ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_CWM_ONTO_fairly_slow_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_ONTO_fairly_slow_level_depe_G)
plot(res, rank = T)


#FDis_ONTO_fairly_slow
hist(Data_univar_CWM_TreMs_CVL$FDis_ONTO_fairly_slow)

mod_CVL_FDis_ONTO_fairly_slow_level_depe_G = glmmTMB(FDis_ONTO_fairly_slow ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_ONTO_fairly_slow_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_ONTO_fairly_slow_level_depe_G)
plot(res, rank = T)


#CWM_ONTO_fairly_rapid
hist(Data_univar_CWM_TreMs_CVL$CWM_ONTO_fairly_rapid)

mod_CVL_CWM_ONTO_fairly_rapid_level_depe_G = glmmTMB(CWM_ONTO_fairly_rapid ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_CWM_ONTO_fairly_rapid_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_ONTO_fairly_rapid_level_depe_G)
plot(res, rank = T)


#FDis_ONTO_fairly_rapid
hist(Data_univar_CWM_TreMs_CVL$FDis_ONTO_fairly_rapid)

mod_CVL_FDis_ONTO_fairly_rapid_level_depe_G = glmmTMB(FDis_ONTO_fairly_rapid ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_ONTO_fairly_rapid_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_ONTO_fairly_rapid_level_depe_G)
plot(res, rank = T)


#CWM_ONTO_rapid
hist(Data_univar_CWM_TreMs_CVL$CWM_ONTO_rapid)

mod_CVL_CWM_ONTO_rapid_level_depe_G =glmmTMB(CWM_ONTO_rapid ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_CWM_ONTO_rapid_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_ONTO_rapid_level_depe_G)
plot(res, rank = T)


#FDis_ONTO_rapid
hist(Data_univar_CWM_TreMs_CVL$FDis_ONTO_rapid)

mod_CVL_FDis_ONTO_rapid_level_depe_G = glmmTMB(FDis_ONTO_rapid ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_ONTO_rapid_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_ONTO_rapid_level_depe_G)
plot(res, rank = T)


#CWM_natur_manag_mean
hist(Data_univar_CWM_TreMs_CVL$CWM_natur_manag_mean)

mod_CVL_CWM_natur_manag_mean_level_depe_G = glmmTMB(CWM_natur_manag_mean ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = Gamma(link = log))
summary(mod_CVL_CWM_natur_manag_mean_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_natur_manag_mean_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_CVL, aes(x = level_depe_G, y = CWM_natur_manag_mean, color = site)) + geom_point() + geom_smooth(method = "lm")


#FDis_natur_manag_mean
hist(Data_univar_CWM_TreMs_CVL$FDis_natur_manag_mean)

mod_CVL_FDis_natur_manag_mean_level_depe_G = glmmTMB(FDis_natur_manag_mean ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_CVL, family = gaussian())
summary(mod_CVL_FDis_natur_manag_mean_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_natur_manag_mean_level_depe_G)
plot(res, rank = T)


```



###CVL Magnitude study
```{r CVL Magnitude study TreMs}


#TreMs_ab
summary(mod_CVL_TreMs_ab_level_depe_G)

set.seed(1)
Estimate_mod_CVL_TreMs_ab_level_depe_G = rnorm(10000, mean = 0.138, sd = 0.8326)

D <- (exp(Estimate_mod_CVL_TreMs_ab_level_depe_G * 0.27)-1) * -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_CVL_TreMs_ab_level_depe_G)


#TreMs_div
summary(mod_CVL_TreMs_div_level_depe_G)

set.seed(1)
Estimate_mod_CVL_TreMs_div_level_depe_G = rnorm(10000, mean = 2.1389, sd = 0.8419)

D <- exp(Estimate_mod_CVL_TreMs_div_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_CVL_TreMs_div_level_depe_G)


#Exposed_sapwood_only
summary(mod_CVL_Exposed_sapwood_only_level_depe_G)

set.seed(1)
Estimate_mod_CVL_Exposed_sapwood_only_level_depe_G = rnorm(10000, mean = 6.0372, sd = 3.9495)

D <- exp(Estimate_mod_CVL_Exposed_sapwood_only_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_CVL_Exposed_sapwood_only_level_depe_G)


#Epiphytic
summary(mod_CVL_Epiphytic_level_depe_G)

set.seed(1)
Estimate_mod_CVL_Epiphytic_level_depe_G = rnorm(10000, mean = 0.7662, sd = 4.131)

D <- (exp(Estimate_mod_CVL_Epiphytic_level_depe_G * 0.27)-1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_CVL_Epiphytic_level_depe_G)


#Exposed_sapwood_and_heartwood
summary(mod_CVL_Exposed_sapwood_and_heartwood_level_depe_G)

set.seed(1)
Estimate_mod_CVL_Exposed_sapwood_and_heartwood_level_depe_G = rnorm(10000, mean = 0.2023, sd = 8.5081)

D <- (exp(Estimate_mod_CVL_Exposed_sapwood_and_heartwood_level_depe_G * 0.27)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_CVL_Exposed_sapwood_and_heartwood_level_depe_G)


#Concavities
summary(mod_CVL_Concavities_level_depe_G)

set.seed(1)
Estimate_mod_CVL_Concavities_level_depe_G = rnorm(10000, mean = 5.123, sd = 3.9668)

D <- (exp(Estimate_mod_CVL_Concavities_level_depe_G * 0.27)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_CVL_Concavities_level_depe_G)


#Perennial_fungi_fruiting_bodies
summary(mod_CVL_Perennial_fungi_fruiting_bodies_level_depe_G)

set.seed(1)
Estimate_mod_CVL_Perennial_fungi_fruiting_bodies_level_depe_G = rnorm(10000, mean = 10.0411, sd = 5.0852)

D <- exp(Estimate_mod_CVL_Perennial_fungi_fruiting_bodies_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_CVL_Perennial_fungi_fruiting_bodies_level_depe_G)


#Twig_tangles
summary(mod_CVL_Twig_tangles_level_depe_G)

set.seed(1)
Estimate_mod_CVL_Twig_tangles_level_depe_G = rnorm(10000, mean = 2.4784, sd = 8.3185)

D <- (exp(Estimate_mod_CVL_Twig_tangles_level_depe_G * 0.27)- 1)*-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_CVL_Twig_tangles_level_depe_G)


#Crown_deadwood
summary(mod_CVL_Crown_deadwood_level_depe_G)

set.seed(1)
Estimate_mod_CVL_Crown_deadwood_level_depe_G = rnorm(10000, mean = 1.11167, sd = 0.70506)
summary(Data_univar_CWM_TreMs_CVL$Crown_deadwood_LW_nb)
val_predict = predict(glmmTMB(Crown_deadwood_LW_nb ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_Crown_deadwood_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_Crown_deadwood_level_depe_G)


#Dead_branches
summary(mod_CVL_Dead_branches_level_depe_G)

set.seed(1)
Estimate_mod_CVL_Dead_branches_level_depe_G = rnorm(10000, mean = 0.9526, sd = 1.1171)

D <- exp(Estimate_mod_CVL_Dead_branches_level_depe_G * 0.27)- 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))

rm(Estimate_mod_CVL_Dead_branches_level_depe_G)


#Dead_top
summary(mod_CVL_Dead_top_level_depe_G)

set.seed(1)
Estimate_mod_CVL_Dead_top_level_depe_G = rnorm(10000, mean = 0.33736, sd = 0.33036)
summary(Data_univar_CWM_TreMs_CVL$Dead_top_LW_nb)
val_predict = predict(glmmTMB(Dead_top_LW_nb ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_Dead_top_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_Dead_top_level_depe_G)


#Rot_holes
summary(mod_CVL_Rot_holes_level_depe_G)

set.seed(1)
Estimate_mod_CVL_Rot_holes_level_depe_G = rnorm(10000, mean = 0.8416, sd = 3.3447)

D <- exp(Estimate_mod_CVL_Rot_holes_level_depe_G * 0.27)- 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_CVL_Rot_holes_level_depe_G)


#Burrs_and_cankers
summary(mod_CVL_Burrs_and_cankers_level_depe_G)

set.seed(1)
Estimate_mod_CVL_Burrs_and_cankers_level_depe_G = rnorm(10000, mean = 0.4994, sd = 3.3553)
summary(Data_univar_CWM_TreMs_CVL$Burrs_and_cankers)
val_predict = predict(glmmTMB(Burrs_and_cankers ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_Burrs_and_cankers_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_Burrs_and_cankers_level_depe_G)


#Exudates
summary(mod_CVL_Exudates_level_depe_G)

set.seed(1)
Estimate_mod_CVL_Exudates_level_depe_G = rnorm(10000, mean = 2.6667, sd = 5.5478)
summary(Data_univar_CWM_TreMs_CVL$Exudates)
val_predict = predict(glmmTMB(Exudates ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_CVL_Exudates_level_depe_G * 0.27) / val_predict) - 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_Exudates_level_depe_G)


#Wood_pecker_breeding_cavities
summary(mod_CVL_Wood_pecker_breeding_cavities_level_depe_G)

set.seed(1)
Estimate_mod_CVL_Wood_pecker_breeding_cavities_level_depe_G = rnorm(10000, mean = 0.2654, sd = 6.9247)

D <- exp(Estimate_mod_CVL_Wood_pecker_breeding_cavities_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_CVL_Wood_pecker_breeding_cavities_level_depe_G)


#Ephemeral_fungal_fruiting_bodies
summary(mod_CVL_Ephemeral_fungal_fruiting_bodies_level_depe_G)

set.seed(1)
Estimate_mod_CVL_Ephemeral_fungal_fruiting_bodies_level_depe_G = rnorm(10000, mean = 8.8991, sd = 15.7291)

D <- exp(Estimate_mod_CVL_Ephemeral_fungal_fruiting_bodies_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_CVL_Ephemeral_fungal_fruiting_bodies_level_depe_G)


# #Rootplate
# summary(mod_CVL_Rootplate_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_CVL_Rootplate_level_depe_G = rnorm(10000, mean = 1.5401, sd = 7.2523)
# 
# D <- exp(Estimate_mod_CVL_Rootplate_level_depe_G * 0.15)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_CVL_Rootplate_level_depe_G)


# #Nest
# summary(mod_CVL_Nest_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_CVL_Nest_level_depe_G = rnorm(10000, mean = 2.399, sd = 5.8673)
# 
# D <- exp(Estimate_mod_CVL_Nest_level_depe_G * 0.15)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_CVL_Nest_level_depe_G)


# #CWD
# summary(mod_CVL_CWD_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_CVL_CWD_level_depe_G = rnorm(10000, mean = 0.069, sd = 0.4043)
# 
# D <- exp(Estimate_mod_CVL_CWD_level_depe_G * 0.15)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_CVL_CWD_level_depe_G)


# #Microsoil
# summary(mod_CVL_Microsoil_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_CVL_Microsoil_level_depe_G = rnorm(10000, mean = 5.1266, sd = 11.628)
# 
# D <- exp(Estimate_mod_CVL_Microsoil_level_depe_G * 0.15)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_CVL_Microsoil_level_depe_G)


# #Insect_gCVLeries
# summary(mod_CVL_Insect_gCVLeries_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_CVL_Insect_gCVLeries_level_depe_G = rnorm(10000, mean = 0.069, sd = 0.4043)
# 
# D <- exp(Estimate_mod_CVL_Insect_gCVLeries_level_depe_G * 0.15)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_CVL_Insect_gCVLeries_level_depe_G)


#FRic
summary(mod_CVL_FRic_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FRic_level_depe_G = rnorm(10000, mean = 11.5824, sd = 5.5409)
summary(Data_univar_CWM_TreMs_CVL$FRic)
val_predict = predict(glmmTMB(FRic ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FRic_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FRic_level_depe_G)


#FDiv
summary(mod_CVL_FDiv_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDiv_level_depe_G = rnorm(10000, mean = 0.1616, sd = 0.16509)
summary(Data_univar_CWM_TreMs_CVL$FDiv)
val_predict = predict(glmmTMB(FDiv ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_CVL_FDiv_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDiv_level_depe_G)


#FEve
summary(mod_CVL_FEve_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FEve_level_depe_G = rnorm(10000, mean = 0.1405, sd = 0.361)
summary(Data_univar_CWM_TreMs_CVL$FEve)
val_predict = predict(glmmTMB(FEve ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FEve_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FEve_level_depe_G)


#FDis
summary(mod_CVL_FDis_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_level_depe_G = rnorm(10000, mean = 0.7982, sd = 1.3321)
summary(Data_univar_CWM_TreMs_CVL$FDis)
val_predict = predict(glmmTMB(FDis ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_level_depe_G)


#CWM_DW_type_substrate
summary(mod_CVL_CWM_DW_type_substrate_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_DW_type_substrate_level_depe_G = rnorm(10000, mean = 0.04385, sd = 0.21761)
summary(Data_univar_CWM_TreMs_CVL$CWM_DW_type_substrate)
val_predict = predict(glmmTMB(CWM_DW_type_substrate ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_CWM_DW_type_substrate_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_CWM_DW_type_substrate_level_depe_G)


#FDis_DW_type_substrate
summary(mod_CVL_FDis_DW_type_substrate_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_DW_type_substrate_level_depe_G = rnorm(10000, mean = 0.14287, sd = 0.64964)
summary(Data_univar_CWM_TreMs_CVL$FDis_DW_type_substrate)
val_predict = predict(glmmTMB(FDis_DW_type_substrate ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_DW_type_substrate_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_DW_type_substrate_level_depe_G)


#CWM_POS
summary(mod_CVL_CWM_POS_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_POS_level_depe_G = rnorm(10000, mean = 0.1062, sd = 0.4602)
summary(Data_univar_CWM_TreMs_CVL$CWM_POS)
val_predict = predict(glmmTMB(CWM_POS ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_CVL_CWM_POS_level_depe_G * 0.27) / val_predict) - 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_CWM_POS_level_depe_G)


#FDis_POS
summary(mod_CVL_FDis_POS_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_POS_level_depe_G = rnorm(10000, mean = 0.2135, sd = 0.4641)
summary(Data_univar_CWM_TreMs_CVL$FDis_POS)
val_predict = predict(glmmTMB(FDis_POS ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_CVL_FDis_POS_level_depe_G * 0.27) / val_predict) - 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_POS_level_depe_G)


#CWM_HUM_dry_wet
summary(mod_CVL_CWM_HUM_dry_wet_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_HUM_dry_wet_level_depe_G = rnorm(10000, mean = 0.14538, sd = 0.09831)
summary(Data_univar_CWM_TreMs_CVL$CWM_HUM_dry_wet)

D <- (exp(Estimate_mod_CVL_CWM_HUM_dry_wet_level_depe_G * 0.27)-1)*-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_CVL_CWM_HUM_dry_wet_level_depe_G)


#FDis_HUM_dry_wet
summary(mod_CVL_FDis_HUM_dry_wet_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_HUM_dry_wet_level_depe_G = rnorm(10000, mean = 0.5062, sd = 0.4118)
summary(Data_univar_CWM_TreMs_CVL$FDis_HUM_dry_wet)
val_predict = predict(glmmTMB(FDis_HUM_dry_wet ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_HUM_dry_wet_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_HUM_dry_wet_level_depe_G)


#CWM_LIFE
summary(mod_CVL_CWM_LIFE_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_LIFE_level_depe_G = rnorm(10000, mean = 0.0353, sd = 0.10645)
summary(Data_univar_CWM_TreMs_CVL$CWM_LIFE)

D <- (exp(Estimate_mod_CVL_CWM_LIFE_level_depe_G * 0.27)-1)*-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_CVL_CWM_LIFE_level_depe_G)


#FDis_LIFE
summary(mod_CVL_FDis_LIFE_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_LIFE_level_depe_G = rnorm(10000, mean = 0.52292, sd = 0.4314)
summary(Data_univar_CWM_TreMs_CVL$FDis_LIFE)
val_predict = predict(glmmTMB(FDis_LIFE ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_LIFE_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_LIFE_level_depe_G)


#CWM_ONTO
summary(mod_CVL_CWM_ONTO_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_ONTO_level_depe_G = rnorm(10000, mean = 0.33564, sd = 0.31745)
summary(Data_univar_CWM_TreMs_CVL$CWM_ONTO)
val_predict = predict(glmmTMB(CWM_ONTO ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_CWM_ONTO_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_CWM_ONTO_level_depe_G)


#FDis_ONTO
summary(mod_CVL_FDis_ONTO_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_ONTO_level_depe_G = rnorm(10000, mean = 0.63346, sd = 0.52521)
summary(Data_univar_CWM_TreMs_CVL$FDis_ONTO)
val_predict = predict(glmmTMB(FDis_ONTO ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_ONTO_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_ONTO_level_depe_G)





#CWM_DW_saproxylic
summary(mod_CVL_CWM_DW_saproxylic_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_DW_saproxylic_level_depe_G = rnorm(10000, mean = 0.1201, sd = 1.2403)
summary(Data_univar_CWM_TreMs_CVL$CWM_DW_saproxylic)
val_predict = predict(glmmTMB(CWM_DW_saproxylic ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_CVL_CWM_DW_saproxylic_level_depe_G * 0.27) / val_predict) - 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_CWM_DW_saproxylic_level_depe_G)


#FDis_DW_saproxylic
summary(mod_CVL_FDis_DW_saproxylic_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_DW_saproxylic_level_depe_G = rnorm(10000, mean = 0.485, sd = 0.8087)
summary(Data_univar_CWM_TreMs_CVL$FDis_DW_saproxylic)
val_predict = predict(glmmTMB(FDis_DW_saproxylic ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_DW_saproxylic_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_DW_saproxylic_level_depe_G)


#CWM_DW_epixylic
summary(mod_CVL_CWM_DW_epixylic_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_DW_epixylic_level_depe_G = rnorm(10000, mean = 0.1457, sd = 1.1947)
summary(Data_univar_CWM_TreMs_CVL$CWM_DW_epixylic)
val_predict = predict(glmmTMB(CWM_DW_epixylic ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_CWM_DW_epixylic_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_CWM_DW_epixylic_level_depe_G)


#FDis_DW_epixylic
summary(mod_CVL_FDis_DW_epixylic_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_DW_epixylic_level_depe_G = rnorm(10000, mean = 0.24933, sd = 0.73873)
summary(Data_univar_CWM_TreMs_CVL$FDis_DW_epixylic)
val_predict = predict(glmmTMB(FDis_DW_epixylic ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_DW_epixylic_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_DW_epixylic_level_depe_G)


#CWM_DW_mould
summary(mod_CVL_CWM_DW_contains_mould_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_DW_mould_level_depe_G = rnorm(10000, mean = 0.32838, sd = 0.54994)
summary(Data_univar_CWM_TreMs_CVL$CWM_DW_contains_mould)

D <- exp(Estimate_mod_CVL_CWM_DW_mould_level_depe_G * 0.15) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_CVL_CWM_DW_mould_level_depe_G)


#FDis_DW_mould
summary(mod_CVL_FDis_DW_contains_mould_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_DW_mould_level_depe_G = rnorm(10000, mean = 0.74291, sd = 0.3979)
summary(Data_univar_CWM_TreMs_CVL$FDis_DW_contains_mould)
val_predict = predict(glmmTMB(FDis_DW_contains_mould ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_DW_mould_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_DW_mould_level_depe_G)


#CWM_DW_living_tree
summary(mod_CVL_CWM_DW_living_tree_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_DW_living_tree_level_depe_G = rnorm(10000, mean = 1.28924, sd = 0.3887)
summary(Data_univar_CWM_TreMs_CVL$CWM_DW_living_tree)
val_predict = predict(glmmTMB(CWM_DW_living_tree ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_CVL_CWM_DW_living_tree_level_depe_G * 0.27) / val_predict) - 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_CWM_DW_living_tree_level_depe_G)


#FDis_DW_living_tree
summary(mod_CVL_FDis_DW_living_tree_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_DW_living_tree_level_depe_G = rnorm(10000, mean = 2.8522, sd = 0.876)
summary(Data_univar_CWM_TreMs_CVL$FDis_DW_living_tree)
val_predict = predict(glmmTMB(FDis_DW_living_tree ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_DW_living_tree_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_DW_living_tree_level_depe_G)


#CWM_DW_snag
summary(mod_CVL_CWM_DW_snag_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_DW_snag_level_depe_G = rnorm(10000, mean = 0.53742, sd = 0.6901)
summary(Data_univar_CWM_TreMs_CVL$CWM_DW_snag)
val_predict = predict(glmmTMB(CWM_DW_snag ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_CVL_CWM_DW_snag_level_depe_G * 0.27) / val_predict) - 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_CWM_DW_snag_level_depe_G)


#FDis_DW_snag
summary(mod_CVL_FDis_DW_snag_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_DW_snag_level_depe_G = rnorm(10000, mean = 0.45686, sd = 0.74259)
summary(Data_univar_CWM_TreMs_CVL$FDis_DW_snag)
val_predict = predict(glmmTMB(FDis_DW_snag ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_DW_snag_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_DW_snag_level_depe_G)


#CWM_DW_log
summary(mod_CVL_CWM_DW_log_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_DW_log_level_depe_G = rnorm(10000, mean = 1.6185, sd = 0.8889)
summary(Data_univar_CWM_TreMs_CVL$CWM_DW_log)
val_predict = predict(glmmTMB(CWM_DW_log ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_CVL_CWM_DW_log_level_depe_G * 0.27) / val_predict) - 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_CWM_DW_log_level_depe_G)


#FDis_DW_log
summary(mod_CVL_FDis_DW_log_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_DW_log_level_depe_G = rnorm(10000, mean = 0.44896, sd = 0.61933)
summary(Data_univar_CWM_TreMs_CVL$FDis_DW_log)
val_predict = predict(glmmTMB(FDis_DW_log ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_DW_log_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_DW_log_level_depe_G)


#CWM_POS_base
summary(mod_CVL_CWM_POS_base_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_POS_base_level_depe_G = rnorm(10000, mean = 0.2139, sd = 1.03)
summary(Data_univar_CWM_TreMs_CVL$CWM_POS_base)
val_predict = predict(glmmTMB(CWM_POS_base ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_CVL_CWM_POS_base_level_depe_G * 0.27) / val_predict) - 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_CWM_POS_base_level_depe_G)


#FDis_POS_base
summary(mod_CVL_FDis_POS_base_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_POS_base_level_depe_G = rnorm(10000, mean = 0.5776, sd = 0.8238)
summary(Data_univar_CWM_TreMs_CVL$FDis_POS_base)
val_predict = predict(glmmTMB(FDis_POS_base ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_CVL_FDis_POS_base_level_depe_G * 0.27) / val_predict) - 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_POS_base_level_depe_G)


#CWM_POS_trunk
summary(mod_CVL_CWM_POS_trunk_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_POS_trunk_level_depe_G = rnorm(10000, mean = 2.0875, sd = 0.993)
summary(Data_univar_CWM_TreMs_CVL$CWM_POS_trunk)
val_predict = predict(glmmTMB(CWM_POS_trunk ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_CWM_POS_trunk_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_CWM_POS_trunk_level_depe_G)


#FDis_POS_trunk
summary(mod_CVL_FDis_POS_trunk_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_POS_trunk_level_depe_G = rnorm(10000, mean = 0.8788, sd = 0.6729)
summary(Data_univar_CWM_TreMs_CVL$FDis_POS_trunk)
val_predict = predict(glmmTMB(FDis_POS_trunk ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_POS_trunk_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_POS_trunk_level_depe_G)


#CWM_POS_crown
summary(mod_CVL_CWM_POS_crown_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_POS_crown_level_depe_G = rnorm(10000, mean = 0.2558, sd = 0.8287)
summary(Data_univar_CWM_TreMs_CVL$CWM_POS_crown)
val_predict = predict(glmmTMB(CWM_POS_crown ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_CWM_POS_crown_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_CWM_POS_crown_level_depe_G)


#FDis_POS_crown
summary(mod_CVL_FDis_POS_crown_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_POS_crown_level_depe_G = rnorm(10000, mean = 0.4589, sd = 0.6787)
summary(Data_univar_CWM_TreMs_CVL$FDis_POS_crown)
val_predict = predict(glmmTMB(FDis_POS_crown ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_CVL_FDis_POS_crown_level_depe_G * 0.27) / val_predict) - 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_POS_crown_level_depe_G)


# #CWM_SOIL_contact
# summary(mod_CVL_CWM_SOIL_contact_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_CVL_CWM_SOIL_contact_level_depe_G = rnorm(10000, mean = 1.3234, sd = 0.3566)
# 
# D <- (exp(Estimate_mod_CVL_CWM_SOIL_contact_level_depe_G * 0.15) - 1)*-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_CVL_CWM_SOIL_contact_level_depe_G)
# 
# 
# #FDis_SOIL_contact
# summary(mod_CVL_FDis_SOIL_contact_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_CVL_FDis_SOIL_contact_level_depe_G = rnorm(10000, mean = 0.06063, sd = 0.20439)
# summary(Data_univar_CWM_TreMs_CVL$FDis_SOIL_contact)
# 
# D <- ((0.6737 + (Estimate_mod_CVL_FDis_SOIL_contact_level_depe_G * 0.15)) / 0.6737) - 1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_CVL_FDis_SOIL_contact_level_depe_G)


#CWM_HUM_dry
summary(mod_CVL_CWM_HUM_dry_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_HUM_dry_level_depe_G = rnorm(10000, mean = 0.14422, sd = 0.49838)
summary(Data_univar_CWM_TreMs_CVL$CWM_HUM_dry)
val_predict = predict(glmmTMB(CWM_HUM_dry ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_CWM_HUM_dry_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_CWM_HUM_dry_level_depe_G)


#FDis_HUM_dry
summary(mod_CVL_FDis_HUM_dry_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_HUM_dry_level_depe_G = rnorm(10000, mean = 0.05415, sd = 0.40152)
summary(Data_univar_CWM_TreMs_CVL$FDis_HUM_dry)
val_predict = predict(glmmTMB(FDis_HUM_dry ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_HUM_dry_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_HUM_dry_level_depe_G)


#CWM_HUM_wet
summary(mod_CVL_CWM_HUM_wet_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_HUM_wet_level_depe_G = rnorm(10000, mean = 0.77215, sd = 0.45204)
summary(Data_univar_CWM_TreMs_CVL$CWM_HUM_wet)
val_predict = predict(glmmTMB(CWM_HUM_wet ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_CVL_CWM_HUM_wet_level_depe_G * 0.27) / val_predict) - 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_CWM_HUM_wet_level_depe_G)


#FDis_HUM_wet
summary(mod_CVL_FDis_HUM_wet_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_HUM_wet_level_depe_G = rnorm(10000, mean = 1.34624, sd = 0.51688)
summary(Data_univar_CWM_TreMs_CVL$FDis_HUM_wet)
val_predict = predict(glmmTMB(FDis_HUM_wet ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_HUM_wet_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_HUM_wet_level_depe_G)


#CWM_LIFE_ephemeral
summary(mod_CVL_CWM_LIFE_ephemeral_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_LIFE_ephemeral_level_depe_G = rnorm(10000, mean = 0.13622, sd = 0.47109)
summary(Data_univar_CWM_TreMs_CVL$CWM_LIFE_ephemeral)
val_predict = predict(glmmTMB(CWM_LIFE_ephemeral ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_CVL_CWM_LIFE_ephemeral_level_depe_G * 0.27) / val_predict) - 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_CWM_LIFE_ephemeral_level_depe_G)


#FDis_LIFE_ephemeral
summary(mod_CVL_FDis_LIFE_ephemeral_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_LIFE_ephemeral_level_depe_G = rnorm(10000, mean = 0.2824, sd = 0.4534)
summary(Data_univar_CWM_TreMs_CVL$FDis_LIFE_ephemeral)
val_predict = predict(glmmTMB(FDis_LIFE_ephemeral ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_LIFE_ephemeral_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_LIFE_ephemeral_level_depe_G)


#CWM_LIFE_annual
summary(mod_CVL_CWM_LIFE_annual_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_LIFE_annual_level_depe_G = rnorm(10000, mean = 1.13846, sd = 0.66472)
summary(Data_univar_CWM_TreMs_CVL$CWM_LIFE_annual)
val_predict = predict(glmmTMB(CWM_LIFE_annual ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_CWM_LIFE_annual_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_CWM_LIFE_annual_level_depe_G)


#FDis_LIFE_annual
summary(mod_CVL_FDis_LIFE_annual_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_LIFE_annual_level_depe_G = rnorm(10000, mean = 1.2839, sd = 0.3993)
summary(Data_univar_CWM_TreMs_CVL$FDis_LIFE_annual)
val_predict = predict(glmmTMB(FDis_LIFE_annual ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_LIFE_annual_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_LIFE_annual_level_depe_G)


#CWM_LIFE_perenial
summary(mod_CVL_CWM_LIFE_perenial_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_LIFE_perenial_level_depe_G = rnorm(10000, mean = 0.59048, sd = 0.20009)
summary(Data_univar_CWM_TreMs_CVL$CWM_LIFE_perenial)
val_predict = predict(glmmTMB(CWM_LIFE_perenial ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_CVL_CWM_LIFE_perenial_level_depe_G * 0.27) / val_predict) - 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_CWM_LIFE_perenial_level_depe_G)


#FDis_LIFE_perenial
summary(mod_CVL_FDis_LIFE_perenial_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_LIFE_perenial_level_depe_G = rnorm(10000, mean = 1.2033, sd = 0.4327)
summary(Data_univar_CWM_TreMs_CVL$FDis_LIFE_perenial)
val_predict = predict(glmmTMB(FDis_LIFE_perenial ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_LIFE_perenial_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_LIFE_perenial_level_depe_G)


#CWM_ONTO_slow
summary(mod_CVL_CWM_ONTO_slow_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_ONTO_slow_level_depe_G = rnorm(10000, mean = 0.2701, sd = 0.64786)
summary(Data_univar_CWM_TreMs_CVL$CWM_ONTO_slow)
val_predict = predict(glmmTMB(CWM_ONTO_slow ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_CWM_ONTO_slow_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_CWM_ONTO_slow_level_depe_G)


#FDis_ONTO_slow
summary(mod_CVL_FDis_ONTO_slow_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_ONTO_slow_level_depe_G = rnorm(10000, mean = 0.26246, sd = 0.38702)
summary(Data_univar_CWM_TreMs_CVL$FDis_ONTO_slow)
val_predict = predict(glmmTMB(FDis_ONTO_slow ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_ONTO_slow_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_ONTO_slow_level_depe_G)


#CWM_ONTO_fairly_slow
summary(mod_CVL_CWM_ONTO_fairly_slow_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_ONTO_fairly_slow_level_depe_G = rnorm(10000, mean = 0.90507, sd = 0.74697)
summary(Data_univar_CWM_TreMs_CVL$CWM_ONTO_fairly_slow)
val_predict = predict(glmmTMB(CWM_ONTO_fairly_slow ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_CWM_ONTO_fairly_slow_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_CWM_ONTO_fairly_slow_level_depe_G)


#FDis_ONTO_fairly_slow
summary(mod_CVL_FDis_ONTO_fairly_slow_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_ONTO_fairly_slow_level_depe_G = rnorm(10000, mean = 0.8415, sd = 0.5878)
summary(Data_univar_CWM_TreMs_CVL$FDis_ONTO_fairly_slow)
val_predict = predict(glmmTMB(FDis_ONTO_fairly_slow ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_ONTO_fairly_slow_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_ONTO_fairly_slow_level_depe_G)


#CWM_ONTO_fairly_rapid
summary(mod_CVL_CWM_ONTO_fairly_rapid_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_ONTO_fairly_rapid_level_depe_G = rnorm(10000, mean = 1.2342, sd = 0.9126)
summary(Data_univar_CWM_TreMs_CVL$CWM_ONTO_fairly_rapid)
val_predict = predict(glmmTMB(CWM_ONTO_fairly_rapid ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_CVL_CWM_ONTO_fairly_rapid_level_depe_G * 0.27) / val_predict) - 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_CWM_ONTO_fairly_rapid_level_depe_G)


#FDis_ONTO_fairly_rapid
summary(mod_CVL_FDis_ONTO_fairly_rapid_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_ONTO_fairly_rapid_level_depe_G = rnorm(10000, mean = 0.6976, sd = 0.55748)
summary(Data_univar_CWM_TreMs_CVL$FDis_ONTO_fairly_rapid)
val_predict = predict(glmmTMB(FDis_ONTO_fairly_rapid ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_ONTO_fairly_rapid_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_ONTO_fairly_rapid_level_depe_G)


#CWM_ONTO_rapid
summary(mod_CVL_CWM_ONTO_rapid_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_ONTO_rapid_level_depe_G = rnorm(10000, mean = 1.4099, sd = 1.2685)
summary(Data_univar_CWM_TreMs_CVL$CWM_ONTO_rapid)
val_predict = predict(glmmTMB(CWM_ONTO_rapid ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_CVL_CWM_ONTO_rapid_level_depe_G * 0.27) / val_predict) - 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_CWM_ONTO_rapid_level_depe_G)


#FDis_ONTO_rapid
summary(mod_CVL_FDis_ONTO_rapid_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_ONTO_rapid_level_depe_G = rnorm(10000, mean = 0.83436, sd = 0.63768)
summary(Data_univar_CWM_TreMs_CVL$FDis_ONTO_rapid)
val_predict = predict(glmmTMB(FDis_ONTO_rapid ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_ONTO_rapid_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_ONTO_rapid_level_depe_G)


#CWM_natur_manag_mean
summary(mod_CVL_CWM_natur_manag_mean_level_depe_G)

set.seed(1)
Estimate_mod_CVL_CWM_natur_manag_mean_level_depe_G = rnorm(10000, mean = 0.08358, sd = 0.08245)
summary(Data_univar_CWM_TreMs_CVL$CWM_natur_manag_mean)

D <- (exp(Estimate_mod_CVL_CWM_natur_manag_mean_level_depe_G * 0.27) - 1)*-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_CVL_CWM_natur_manag_mean_level_depe_G)


#FDis_natur_manag_mean
summary(mod_CVL_FDis_natur_manag_mean_level_depe_G)

set.seed(1)
Estimate_mod_CVL_FDis_natur_manag_mean_level_depe_G = rnorm(10000, mean = 0.4377, sd = 0.7837)
summary(Data_univar_CWM_TreMs_CVL$FDis_natur_manag_mean)
val_predict = predict(glmmTMB(FDis_natur_manag_mean ~ level_depe_G, data = Data_univar_CWM_TreMs_CVL, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_CVL_FDis_natur_manag_mean_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_CVL_FDis_natur_manag_mean_level_depe_G)


```



###



### Bavaria
```{r level_depe_G Bavaria}


#TreMs_ab
hist(Data_univar_CWM_TreMs_Bav$TreMs_ab)

mod_Bav_TreMs_ab_level_depe_G = glmmTMB(TreMs_ab ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Bav, family = nbinom2())
summary(mod_Bav_TreMs_ab_level_depe_G)
res = simulateResiduals(mod_Bav_TreMs_ab_level_depe_G)
plot(res, rank = T)


#TreMs_div
hist(Data_univar_CWM_TreMs_Bav$TreMs_div)

mod_Bav_TreMs_div_level_depe_G = glmmTMB(TreMs_div ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = poisson())
summary(mod_Bav_TreMs_div_level_depe_G)
res = simulateResiduals(mod_Bav_TreMs_div_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Bav, aes(x = level_depe_G, y = TreMs_div)) + geom_point() + geom_smooth(method = "glm", method.args = list(family = poisson(link = log)))


#Exposed_sapwood_only
hist(Data_univar_CWM_TreMs_Bav$Exposed_sapwood_only)

mod_Bav_Exposed_sapwood_only_level_depe_G = glmmTMB(round(Exposed_sapwood_only) ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = nbinom2())
summary(mod_Bav_Exposed_sapwood_only_level_depe_G)
res = simulateResiduals(mod_Bav_Exposed_sapwood_only_level_depe_G)
plot(res, rank = T)


#Epiphytic
hist(Data_univar_CWM_TreMs_Bav$Epiphytic)

mod_Bav_Epiphytic_level_depe_G = glmmTMB(round(Epiphytic) ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = nbinom2())
summary(mod_Bav_Epiphytic_level_depe_G)
res = simulateResiduals(mod_Bav_Epiphytic_level_depe_G)
plot(res, rank = T)


#Exposed_sapwood_and_heartwood
hist(Data_univar_CWM_TreMs_Bav$Exposed_sapwood_and_heartwood)

mod_Bav_Exposed_sapwood_and_heartwood_level_depe_G = glmmTMB(round(Exposed_sapwood_and_heartwood) ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = nbinom2())
summary(mod_Bav_Exposed_sapwood_and_heartwood_level_depe_G)
res = simulateResiduals(mod_Bav_Exposed_sapwood_and_heartwood_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Bav, aes(x = level_depe_G, y = Exposed_sapwood_and_heartwood)) + geom_point() + geom_smooth(method = "glm", method.args = list(family = nbinom2()))


#Concavities
hist(Data_univar_CWM_TreMs_Bav$Concavities)

mod_Bav_Concavities_level_depe_G = glmmTMB(round(Concavities) ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = nbinom2())
summary(mod_Bav_Concavities_level_depe_G)
res = simulateResiduals(mod_Bav_Concavities_level_depe_G)
plot(res, rank = T)


#Perennial_fungi_fruiting_bodies
hist(Data_univar_CWM_TreMs_Bav$Perennial_fungi_fruiting_bodies)

mod_Bav_Perennial_fungi_fruiting_bodies_level_depe_G = glmmTMB(round(Perennial_fungi_fruiting_bodies) ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = nbinom2())
summary(mod_Bav_Perennial_fungi_fruiting_bodies_level_depe_G)
res = simulateResiduals(mod_Bav_Perennial_fungi_fruiting_bodies_level_depe_G)
plot(res, rank = T)


#Twig_tangles
hist(Data_univar_CWM_TreMs_Bav$Twig_tangles)

mod_Bav_Twig_tangles_level_depe_G = glmmTMB(Twig_tangles ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = nbinom2())
summary(mod_Bav_Twig_tangles_level_depe_G)
res = simulateResiduals(mod_Bav_Twig_tangles_level_depe_G)
plot(res, rank = T)


# #Crown_deadwood
# hist(Data_univar_CWM_TreMs_Bav$Crown_deadwood)
# 
# mod_Bav_Crown_deadwood_level_depe_G = glmmTMB(Crown_deadwood_LW_nb ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
# summary(mod_Bav_Crown_deadwood_level_depe_G)
# res = simulateResiduals(mod_Bav_Crown_deadwood_level_depe_G)
# plot(res, rank = T)


# #Dead_branches
# hist(Data_univar_CWM_TreMs_Bav$Dead_branches)
# 
# mod_Bav_Dead_branches_level_depe_G = glmmTMB(Dead_branches_LW_nb ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Bav, family = gaussian())
# summary(mod_Bav_Dead_branches_level_depe_G)
# res = simulateResiduals(mod_Bav_Dead_branches_level_depe_G)
# plot(res, rank = T)


# #Dead_top
# hist(Data_univar_CWM_TreMs_Bav$Dead_top)
# 
# # mod_Bav_Dead_top_level_depe_G = mixed_model(fixed = round(Dead_top) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_Bav, family = hurdle.negative.binomial(), zi_fixed = ~ level_depe_G)
# mod_Bav_Dead_top_level_depe_G = glmmTMB(Dead_top_LW_nb ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
# summary(mod_Bav_Dead_top_level_depe_G)
# res = simulateResiduals(mod_Bav_Dead_top_level_depe_G)
# plot(res, rank = T)


#Rot_holes
hist(Data_univar_CWM_TreMs_Bav$Rot_holes)

mod_Bav_Rot_holes_level_depe_G = glmmTMB(round(Rot_holes) ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = nbinom2())
summary(mod_Bav_Rot_holes_level_depe_G)
res = simulateResiduals(mod_Bav_Rot_holes_level_depe_G)
plot(res, rank = T)


#Burrs_and_cankers
hist(Data_univar_CWM_TreMs_Bav$Burrs_and_cankers)

mod_Bav_Burrs_and_cankers_level_depe_G = glmmTMB(round(Burrs_and_cankers) ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = nbinom2())
summary(mod_Bav_Burrs_and_cankers_level_depe_G)
res = simulateResiduals(mod_Bav_Burrs_and_cankers_level_depe_G)
plot(res, rank = T)


#Exudates
hist(Data_univar_CWM_TreMs_Bav$Exudates)

mod_Bav_Exudates_level_depe_G = glmmTMB(round(Exudates) ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = nbinom2())
summary(mod_Bav_Exudates_level_depe_G)
res = simulateResiduals(mod_Bav_Exudates_level_depe_G)
plot(res, rank = T)


# #Wood_pecker_breeding_cavities
# hist(Data_univar_CWM_TreMs_Bav$Wood_pecker_breeding_cavities)
# 
# mod_Bav_Wood_pecker_breeding_cavities_level_depe_G = glmmTMB(round(Wood_pecker_breeding_cavities) ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = nbinom2())
# summary(mod_Bav_Wood_pecker_breeding_cavities_level_depe_G)
# res = simulateResiduals(mod_Bav_Wood_pecker_breeding_cavities_level_depe_G)
# plot(res, rank = T)


#Ephemeral_fungal_fruiting_bodies
hist(Data_univar_CWM_TreMs_Bav$Ephemeral_fungal_fruiting_bodies)

mod_Bav_Ephemeral_fungal_fruiting_bodies_level_depe_G = glmmTMB(round(Ephemeral_fungal_fruiting_bodies) ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = nbinom2())
summary(mod_Bav_Ephemeral_fungal_fruiting_bodies_level_depe_G)
res = simulateResiduals(mod_Bav_Ephemeral_fungal_fruiting_bodies_level_depe_G)
plot(res, rank = T)


# #Rootplate
# hist(Data_univar_CWM_TreMs_Bav$Rootplate)
# 
# mod_Bav_Rootplate_level_depe_G = mixed_model(fixed = round(Rootplate) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_Bav, family = negative.binomial())
# summary(mod_Bav_Rootplate_level_depe_G)
# res = simulateResiduals(mod_Bav_Rootplate_level_depe_G)
# plot(res, rank = T)


# #Nest
# hist(Data_univar_CWM_TreMs_Bav$Nest)
# 
# mod_Bav_Nest_level_depe_G = mixed_model(fixed = round(Nest) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_Bav, family = negative.binomial())
# summary(mod_Bav_Nest_level_depe_G)
# res = simulateResiduals(mod_Bav_Nest_level_depe_G)
# plot(res, rank = T)


# #CWD
# hist(Data_univar_CWM_TreMs_Bav$CWD)
# 
# mod_Bav_CWD_level_depe_G = mixed_model(fixed = round(CWD) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_Bav, family = negative.binomial())
# summary(mod_Bav_CWD_level_depe_G)
# res = simulateResiduals(mod_Bav_CWD_level_depe_G)
# plot(res, rank = T)
# 
# 
# #Microsoil
# hist(Data_univar_CWM_TreMs_Bav$Microsoil)
# 
# mod_Bav_Microsoil_level_depe_G = glmmTMB(round(Microsoil) ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Bav, family = nbinom1())
# summary(mod_Bav_Microsoil_level_depe_G)
# res = simulateResiduals(mod_Bav_Microsoil_level_depe_G)
# plot(res, rank = T)
# 
# 
#Insect_galleries
hist(Data_univar_CWM_TreMs_Bav$Insect_galleries)

mod_Bav_Insect_galleries_level_depe_G = glmmTMB(round(Insect_galleries) ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = nbinom2())
summary(mod_Bav_Insect_galleries_level_depe_G)
res = simulateResiduals(mod_Bav_Insect_galleries_level_depe_G)
plot(res, rank = T)


#FRic
hist(Data_univar_CWM_TreMs_Bav$FRic)

mod_Bav_FRic_level_depe_G = glmmTMB(FRic ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FRic_level_depe_G)
res = simulateResiduals(mod_Bav_FRic_level_depe_G)
plot(res, rank = T)


#FDiv
hist(Data_univar_CWM_TreMs_Bav$FDiv)

mod_Bav_FDiv_level_depe_G = glmmTMB(FDiv ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDiv_level_depe_G)
res = simulateResiduals(mod_Bav_FDiv_level_depe_G)
plot(res, rank = T)


#FEve
hist(Data_univar_CWM_TreMs_Bav$FEve)

mod_Bav_FEve_level_depe_G = glmmTMB(FEve ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FEve_level_depe_G)
res = simulateResiduals(mod_Bav_FEve_level_depe_G)
plot(res, rank = T)


#FDis
hist(Data_univar_CWM_TreMs_Bav$FDis)

mod_Bav_FDis_level_depe_G = glmmTMB(FDis ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_level_depe_G)
plot(res, rank = T)


#CWM_DW_type_substrate
hist(Data_univar_CWM_TreMs_Bav$CWM_DW_type_substrate)

mod_Bav_CWM_DW_type_substrate_level_depe_G = glmmTMB(CWM_DW_type_substrate ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_CWM_DW_type_substrate_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_DW_type_substrate_level_depe_G)
plot(res, rank = T)


#FDis_DW_type_substrate
hist(Data_univar_CWM_TreMs_Bav$FDis_DW_type_substrate)

mod_Bav_FDis_DW_type_substrate_level_depe_G = glmmTMB(FDis_DW_type_substrate ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_DW_type_substrate_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_DW_type_substrate_level_depe_G)
plot(res, rank = T)


#CWM_POS
hist(Data_univar_CWM_TreMs_Bav$CWM_POS)

mod_Bav_CWM_POS_level_depe_G = glmmTMB(CWM_POS ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_CWM_POS_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_POS_level_depe_G)
plot(res, rank = T)


#FDis_POS
hist(Data_univar_CWM_TreMs_Bav$FDis_POS)

mod_Bav_FDis_POS_level_depe_G = glmmTMB(FDis_POS ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_POS_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_POS_level_depe_G)
plot(res, rank = T)


#CWM_HUM_dry_wet
hist(Data_univar_CWM_TreMs_Bav$CWM_HUM_dry_wet)

mod_Bav_CWM_HUM_dry_wet_level_depe_G = glmmTMB(CWM_HUM_dry_wet ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = Gamma(link = log))
summary(mod_Bav_CWM_HUM_dry_wet_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_HUM_dry_wet_level_depe_G)
plot(res, rank = T)


#FDis_HUM_dry_wet
hist(Data_univar_CWM_TreMs_Bav$FDis_HUM_dry_wet)

mod_Bav_FDis_HUM_dry_wet_level_depe_G = glmmTMB(FDis_HUM_dry_wet ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_HUM_dry_wet_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_HUM_dry_wet_level_depe_G)
plot(res, rank = T)


#CWM_LIFE
hist(Data_univar_CWM_TreMs_Bav$CWM_LIFE)

mod_Bav_CWM_LIFE_level_depe_G = glmmTMB(CWM_LIFE ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = Gamma(link = log))
summary(mod_Bav_CWM_LIFE_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_LIFE_level_depe_G)
plot(res, rank = T)


#FDis_LIFE
hist(Data_univar_CWM_TreMs_Bav$FDis_LIFE)

mod_Bav_FDis_LIFE_level_depe_G = glmmTMB(FDis_LIFE ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_LIFE_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_LIFE_level_depe_G)
plot(res, rank = T)

#CWM_ONTO
hist(Data_univar_CWM_TreMs_Bav$CWM_ONTO)

mod_Bav_CWM_ONTO_level_depe_G = glmmTMB(CWM_ONTO ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_CWM_ONTO_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_ONTO_level_depe_G)
plot(res, rank = T)


#FDis_ONTO
hist(Data_univar_CWM_TreMs_Bav$FDis_ONTO)

mod_Bav_FDis_ONTO_level_depe_G = glmmTMB(FDis_ONTO ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_ONTO_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_ONTO_level_depe_G)
plot(res, rank = T)





#CWM_DW_saproxylic
hist(Data_univar_CWM_TreMs_Bav$CWM_DW_saproxylic)

mod_Bav_CWM_DW_saproxylic_level_depe_G = glmmTMB(CWM_DW_saproxylic ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_CWM_DW_saproxylic_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_DW_saproxylic_level_depe_G)
plot(res, rank = T)


#FDis_DW_saproxylic
hist(Data_univar_CWM_TreMs_Bav$FDis_DW_saproxylic)

mod_Bav_FDis_DW_saproxylic_level_depe_G = glmmTMB(FDis_DW_saproxylic ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_DW_saproxylic_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_DW_saproxylic_level_depe_G)
plot(res, rank = T)


#CWM_DW_epixylic
hist(Data_univar_CWM_TreMs_Bav$CWM_DW_epixylic)

mod_Bav_CWM_DW_epixylic_level_depe_G = glmmTMB(CWM_DW_epixylic ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_CWM_DW_epixylic_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_DW_epixylic_level_depe_G)
plot(res, rank = T)


#FDis_DW_epixylic
hist(Data_univar_CWM_TreMs_Bav$FDis_DW_epixylic)

mod_Bav_FDis_DW_epixylic_level_depe_G = glmmTMB(FDis_DW_epixylic ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_DW_epixylic_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_DW_epixylic_level_depe_G)
plot(res, rank = T)


#CWM_DW_contains_mould
hist(Data_univar_CWM_TreMs_Bav$CWM_DW_contains_mould)

mod_Bav_CWM_DW_contains_mould_level_depe_G = glmmTMB(CWM_DW_contains_mould ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_CWM_DW_contains_mould_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_DW_contains_mould_level_depe_G)
plot(res, rank = T)


#FDis_DW_contains_mould
hist(Data_univar_CWM_TreMs_Bav$FDis_DW_contains_mould)

mod_Bav_FDis_DW_contains_mould_level_depe_G = glmmTMB(FDis_DW_contains_mould ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_DW_contains_mould_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_DW_contains_mould_level_depe_G)
plot(res, rank = T)


#CWM_DW_living_tree
hist(Data_univar_CWM_TreMs_Bav$CWM_DW_living_tree)

mod_Bav_CWM_DW_living_tree_level_depe_G = glmmTMB(CWM_DW_living_tree ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_CWM_DW_living_tree_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_DW_living_tree_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Bav, aes(x = level_depe_G, y = CWM_DW_living_tree, color = site)) + geom_point() + geom_smooth(method = "lm")


#FDis_DW_living_tree
hist(Data_univar_CWM_TreMs_Bav$FDis_DW_living_tree)

mod_Bav_FDis_DW_living_tree_level_depe_G = glmmTMB(FDis_DW_living_tree ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_DW_living_tree_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_DW_living_tree_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Bav, aes(x = level_depe_G, y = FDis_DW_living_tree)) + geom_point() + geom_smooth(method = "lm", formula = y ~ log1p(x))


#CWM_DW_snag
hist(Data_univar_CWM_TreMs_Bav$CWM_DW_snag)

mod_Bav_CWM_DW_snag_level_depe_G = glmmTMB(CWM_DW_snag ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_CWM_DW_snag_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_DW_snag_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Bav, aes(x = level_depe_G, y = CWM_DW_snag, color = site)) + geom_point() + geom_smooth(method = "lm")


#FDis_DW_snag
hist(Data_univar_CWM_TreMs_Bav$FDis_DW_snag)

mod_Bav_FDis_DW_snag_level_depe_G = glmmTMB(FDis_DW_snag ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_DW_snag_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_DW_snag_level_depe_G)
plot(res, rank = T)


#CWM_DW_log
hist(Data_univar_CWM_TreMs_Bav$CWM_DW_log)

mod_Bav_CWM_DW_log_level_depe_G = glmmTMB(CWM_DW_log ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = Gamma(link = log))
summary(mod_Bav_CWM_DW_log_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_DW_log_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Bav, aes(x = level_depe_G, y = CWM_DW_log, color = site)) + geom_point() + geom_smooth(method = "lm")


#FDis_DW_log
hist(Data_univar_CWM_TreMs_Bav$FDis_DW_log)

mod_Bav_FDis_DW_log_level_depe_G = glmmTMB(FDis_DW_log ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_DW_log_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_DW_log_level_depe_G)
plot(res, rank = T)


#CWM_SH_concavity
hist(Data_univar_CWM_TreMs_Bav$CWM_SH_concavity)

mod_Bav_CWM_SH_concavity_level_depe_G = glmmTMB(CWM_SH_concavity ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_CWM_SH_concavity_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_SH_concavity_level_depe_G)
plot(res, rank = T)

# ggplot(Data_univar_CWM_TreMs_Bav, aes(x = level_depe_G, y = CWM_SH_concavity, color = site)) + geom_point() + geom_smooth(method = "lm")


#FDis_SH_concavity
hist(Data_univar_CWM_TreMs_Bav$FDis_SH_concavity)

mod_Bav_FDis_SH_concavity_level_depe_G = glmmTMB(FDis_SH_concavity ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_SH_concavity_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_SH_concavity_level_depe_G)
plot(res, rank = T)


#CWM_SH_cavity
hist(Data_univar_CWM_TreMs_Bav$CWM_SH_cavity)

mod_Bav_CWM_SH_cavity_level_depe_G = glmmTMB(CWM_SH_cavity ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_CWM_SH_cavity_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_SH_cavity_level_depe_G)
plot(res, rank = T)


#FDis_SH_cavity
hist(Data_univar_CWM_TreMs_Bav$FDis_SH_cavity)

mod_Bav_FDis_SH_cavity_level_depe_G = glmmTMB(FDis_SH_cavity ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_SH_cavity_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_SH_cavity_level_depe_G)
plot(res, rank = T)


#CWM_SH_crack
hist(Data_univar_CWM_TreMs_Bav$CWM_SH_crack)

mod_Bav_CWM_SH_crack_level_depe_G = glmmTMB(CWM_SH_crack ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_CWM_SH_crack_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_SH_crack_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Bav, aes(x = level_depe_G, y = CWM_SH_crack, color = site)) + geom_point() + geom_smooth(method = "lm")


#FDis_SH_crack
hist(Data_univar_CWM_TreMs_Bav$FDis_SH_crack)

mod_Bav_FDis_SH_crack_level_depe_G = glmmTMB(FDis_SH_crack ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_SH_crack_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_SH_crack_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Bav, aes(x = level_depe_G, y = FDis_SH_crack, color = site)) + geom_point() + geom_smooth(method = "lm")


#CWM_POS_base
hist(Data_univar_CWM_TreMs_Bav$CWM_POS_base)

mod_Bav_CWM_POS_base_level_depe_G = glmmTMB(CWM_POS_base ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_CWM_POS_base_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_POS_base_level_depe_G)
plot(res, rank = T)


#FDis_POS_base
hist(Data_univar_CWM_TreMs_Bav$FDis_POS_base)

mod_Bav_FDis_POS_base_level_depe_G = glmmTMB(FDis_POS_base ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_POS_base_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_POS_base_level_depe_G)
plot(res, rank = T)


#CWM_POS_trunk
hist(Data_univar_CWM_TreMs_Bav$CWM_POS_trunk)

mod_Bav_CWM_POS_trunk_level_depe_G = glmmTMB(CWM_POS_trunk ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_CWM_POS_trunk_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_POS_trunk_level_depe_G)
plot(res, rank = T)


#FDis_POS_trunk
hist(Data_univar_CWM_TreMs_Bav$FDis_POS_trunk)

mod_Bav_FDis_POS_trunk_level_depe_G = glmmTMB(FDis_POS_trunk ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_POS_trunk_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_POS_trunk_level_depe_G)
plot(res, rank = T)


#CWM_POS_crown
hist(Data_univar_CWM_TreMs_Bav$CWM_POS_crown)

mod_Bav_CWM_POS_crown_level_depe_G = glmmTMB(CWM_POS_crown ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_CWM_POS_crown_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_POS_crown_level_depe_G)
plot(res, rank = T)


#FDis_POS_crown
hist(Data_univar_CWM_TreMs_Bav$FDis_POS_crown)

mod_Bav_FDis_POS_crown_level_depe_G = glmmTMB(FDis_POS_crown ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_POS_crown_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_POS_crown_level_depe_G)
plot(res, rank = T)


# #CWM_SOIL_contact
# hist(Data_univar_CWM_TreMs_Bav$CWM_SOIL_contact)
# 
# mod_Bav_CWM_SOIL_contact_level_depe_G = mixed_model(fixed = CWM_SOIL_contact ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_TreMs_Bav, family = hurdle.lognormal(), n_phis = 1, zi_fixed = ~ level_depe_G)
# summary(mod_Bav_CWM_SOIL_contact_level_depe_G)
# res = simulateResiduals(mod_Bav_CWM_SOIL_contact_level_depe_G)
# plot(res, rank = T)
# 
# 
# #FDis_SOIL_contact
# hist(Data_univar_CWM_TreMs_Bav$FDis_SOIL_contact)
# 
# mod_Bav_FDis_SOIL_contact_level_depe_G = glmmTMB(FDis_SOIL_contact ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Bav, family = gaussian())
# summary(mod_Bav_FDis_SOIL_contact_level_depe_G)
# res = simulateResiduals(mod_Bav_FDis_SOIL_contact_level_depe_G)
# plot(res, rank = T)


#CWM_HUM_dry
hist(Data_univar_CWM_TreMs_Bav$CWM_HUM_dry)

mod_Bav_CWM_HUM_dry_level_depe_G = glmmTMB(CWM_HUM_dry ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_CWM_HUM_dry_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_HUM_dry_level_depe_G)
plot(res, rank = T)


#FDis_HUM_dry
hist(Data_univar_CWM_TreMs_Bav$FDis_HUM_dry)

mod_Bav_FDis_HUM_dry_level_depe_G = glmmTMB(FDis_HUM_dry ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_HUM_dry_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_HUM_dry_level_depe_G)
plot(res, rank = T)


#CWM_HUM_wet
hist(Data_univar_CWM_TreMs_Bav$CWM_HUM_wet)

mod_Bav_CWM_HUM_wet_level_depe_G = glmmTMB(CWM_HUM_wet ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_CWM_HUM_wet_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_HUM_wet_level_depe_G)
plot(res, rank = T)


#FDis_HUM_wet
hist(Data_univar_CWM_TreMs_Bav$FDis_HUM_wet)

mod_Bav_FDis_HUM_wet_level_depe_G = glmmTMB(FDis_HUM_wet ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_HUM_wet_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_HUM_wet_level_depe_G)
plot(res, rank = T)


#CWM_LIFE_ephemeral
hist(Data_univar_CWM_TreMs_Bav$CWM_LIFE_ephemeral)

mod_Bav_CWM_LIFE_ephemeral_level_depe_G = glmmTMB(CWM_LIFE_ephemeral ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_CWM_LIFE_ephemeral_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_LIFE_ephemeral_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Bav, aes(x = level_depe_G, y = CWM_LIFE_ephemeral)) + geom_point() + geom_smooth(method = "lm")


#FDis_LIFE_ephemeral
hist(Data_univar_CWM_TreMs_Bav$FDis_LIFE_ephemeral)

mod_Bav_FDis_LIFE_ephemeral_level_depe_G = glmmTMB(FDis_LIFE_ephemeral ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_LIFE_ephemeral_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_LIFE_ephemeral_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Bav, aes(x = level_depe_G, y = FDis_LIFE_ephemeral)) + geom_point() + geom_smooth(method = "lm")


#CWM_LIFE_annual
hist(Data_univar_CWM_TreMs_Bav$CWM_LIFE_annual)

mod_Bav_CWM_LIFE_annual_level_depe_G = glmmTMB(CWM_LIFE_annual ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_CWM_LIFE_annual_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_LIFE_annual_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Bav, aes(x = level_depe_G, y = CWM_LIFE_annual)) + geom_point() + geom_smooth(method = "lm")


#FDis_LIFE_annual
hist(Data_univar_CWM_TreMs_Bav$FDis_LIFE_annual)

mod_Bav_FDis_LIFE_annual_level_depe_G = glmmTMB(FDis_LIFE_annual ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_LIFE_annual_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_LIFE_annual_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Bav, aes(x = level_depe_G, y = FDis_LIFE_annual)) + geom_point() + geom_smooth(method = "lm")


#CWM_LIFE_perenial
hist(Data_univar_CWM_TreMs_Bav$CWM_LIFE_perenial)

mod_Bav_CWM_LIFE_perenial_level_depe_G = glmmTMB(CWM_LIFE_perenial ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_CWM_LIFE_perenial_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_LIFE_perenial_level_depe_G)
plot(res, rank = T)


#FDis_LIFE_perenial
hist(Data_univar_CWM_TreMs_Bav$FDis_LIFE_perenial)

mod_Bav_FDis_LIFE_perenial_level_depe_G = glmmTMB(FDis_LIFE_perenial ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_LIFE_perenial_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_LIFE_perenial_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Bav, aes(x = level_depe_G, y = FDis_LIFE_perenial)) + geom_point() + geom_smooth(method = "lm")


#CWM_ONTO_slow
hist(Data_univar_CWM_TreMs_Bav$CWM_ONTO_slow)

mod_Bav_CWM_ONTO_slow_level_depe_G = glmmTMB(CWM_ONTO_slow ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_CWM_ONTO_slow_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_ONTO_slow_level_depe_G)
plot(res, rank = T)

ggplot(Data_univar_CWM_TreMs_Bav, aes(x = level_depe_G, y = CWM_ONTO_slow)) + geom_point() + geom_smooth(method = "lm")


#FDis_ONTO_slow
hist(Data_univar_CWM_TreMs_Bav$FDis_ONTO_slow)

mod_Bav_FDis_ONTO_slow_level_depe_G = glmmTMB(FDis_ONTO_slow ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_ONTO_slow_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_ONTO_slow_level_depe_G)
plot(res, rank = T)


#CWM_ONTO_fairly_slow
hist(Data_univar_CWM_TreMs_Bav$CWM_ONTO_fairly_slow)

mod_Bav_CWM_ONTO_fairly_slow_level_depe_G = glmmTMB(CWM_ONTO_fairly_slow ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_CWM_ONTO_fairly_slow_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_ONTO_fairly_slow_level_depe_G)
plot(res, rank = T)


#FDis_ONTO_fairly_slow
hist(Data_univar_CWM_TreMs_Bav$FDis_ONTO_fairly_slow)

mod_Bav_FDis_ONTO_fairly_slow_level_depe_G = glmmTMB(FDis_ONTO_fairly_slow ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_ONTO_fairly_slow_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_ONTO_fairly_slow_level_depe_G)
plot(res, rank = T)


#CWM_ONTO_fairly_rapid
hist(Data_univar_CWM_TreMs_Bav$CWM_ONTO_fairly_rapid)

mod_Bav_CWM_ONTO_fairly_rapid_level_depe_G = glmmTMB(CWM_ONTO_fairly_rapid ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_CWM_ONTO_fairly_rapid_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_ONTO_fairly_rapid_level_depe_G)
plot(res, rank = T)


#FDis_ONTO_fairly_rapid
hist(Data_univar_CWM_TreMs_Bav$FDis_ONTO_fairly_rapid)

mod_Bav_FDis_ONTO_fairly_rapid_level_depe_G = glmmTMB(FDis_ONTO_fairly_rapid ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_ONTO_fairly_rapid_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_ONTO_fairly_rapid_level_depe_G)
plot(res, rank = T)


#CWM_ONTO_rapid
hist(Data_univar_CWM_TreMs_Bav$CWM_ONTO_rapid)

mod_Bav_CWM_ONTO_rapid_level_depe_G =glmmTMB(CWM_ONTO_rapid ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_CWM_ONTO_rapid_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_ONTO_rapid_level_depe_G)
plot(res, rank = T)


#FDis_ONTO_rapid
hist(Data_univar_CWM_TreMs_Bav$FDis_ONTO_rapid)

mod_Bav_FDis_ONTO_rapid_level_depe_G = glmmTMB(FDis_ONTO_rapid ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian())
summary(mod_Bav_FDis_ONTO_rapid_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_ONTO_rapid_level_depe_G)
plot(res, rank = T)


# #CWM_natur_manag_mean
# hist(Data_univar_CWM_TreMs_Bav$CWM_natur_manag_mean)
# 
# mod_Bav_CWM_natur_manag_mean_level_depe_G = glmmTMB(CWM_natur_manag_mean ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Bav, family = gaussian())
# summary(mod_Bav_CWM_natur_manag_mean_level_depe_G)
# res = simulateResiduals(mod_Bav_CWM_natur_manag_mean_level_depe_G)
# plot(res, rank = T)
# 
# ggplot(Data_univar_CWM_TreMs_Bav, aes(x = level_depe_G, y = CWM_natur_manag_mean, color = site)) + geom_point() + geom_smooth(method = "lm")
# 
# 
# #FDis_natur_manag_mean
# hist(Data_univar_CWM_TreMs_Bav$FDis_natur_manag_mean)
# 
# mod_Bav_FDis_natur_manag_mean_level_depe_G = glmmTMB(FDis_natur_manag_mean ~ level_depe_G + (1|site), data = Data_univar_CWM_TreMs_Bav, family = gaussian())
# summary(mod_Bav_FDis_natur_manag_mean_level_depe_G)
# res = simulateResiduals(mod_Bav_FDis_natur_manag_mean_level_depe_G)
# plot(res, rank = T)


```



###



###Bavaria Magnitude study
```{r Bav Magnitude study TreMs}


#TreMs_ab
summary(mod_Bav_TreMs_ab_level_depe_G)

set.seed(1)
Estimate_mod_Bav_TreMs_ab_level_depe_G = rnorm(10000, mean = 0.3946, sd = 0.3069)

D <- exp(Estimate_mod_Bav_TreMs_ab_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Bav_TreMs_ab_level_depe_G)


#TreMs_div
summary(mod_Bav_TreMs_div_level_depe_G)

set.seed(1)
Estimate_mod_Bav_TreMs_div_level_depe_G = rnorm(10000, mean = 0.3006, sd = 0.2036)

D <- (exp(Estimate_mod_Bav_TreMs_div_level_depe_G * 0.27)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Bav_TreMs_div_level_depe_G)


#Exposed_sapwood_only
summary(mod_Bav_Exposed_sapwood_only_level_depe_G)

set.seed(1)
Estimate_mod_Bav_Exposed_sapwood_only_level_depe_G = rnorm(10000, mean = 1.9128, sd = 0.6082)

D <- exp(Estimate_mod_Bav_Exposed_sapwood_only_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Bav_Exposed_sapwood_only_level_depe_G)


#Epiphytic
summary(mod_Bav_Epiphytic_level_depe_G)

set.seed(1)
Estimate_mod_Bav_Epiphytic_level_depe_G = rnorm(10000, mean = 0.8535, sd = 0.4079)

D <- (exp(Estimate_mod_Bav_Epiphytic_level_depe_G * 0.27)-1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Bav_Epiphytic_level_depe_G)


#Exposed_sapwood_and_heartwood
summary(mod_Bav_Exposed_sapwood_and_heartwood_level_depe_G)

set.seed(1)
Estimate_mod_Bav_Exposed_sapwood_and_heartwood_level_depe_G = rnorm(10000, mean = 3.6148, sd = 0.745)

D <- exp(Estimate_mod_Bav_Exposed_sapwood_and_heartwood_level_depe_G * 0.27)- 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Bav_Exposed_sapwood_and_heartwood_level_depe_G)


#Concavities
summary(mod_Bav_Concavities_level_depe_G)

set.seed(1)
Estimate_mod_Bav_Concavities_level_depe_G = rnorm(10000, mean = 1.2815, sd = 0.5817)

D <- (exp(Estimate_mod_Bav_Concavities_level_depe_G * 0.27)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Bav_Concavities_level_depe_G)


#Perennial_fungi_fruiting_bodies
summary(mod_Bav_Perennial_fungi_fruiting_bodies_level_depe_G)

set.seed(1)
Estimate_mod_Bav_Perennial_fungi_fruiting_bodies_level_depe_G = rnorm(10000, mean = 3.3965, sd = 0.6365)

D <- exp(Estimate_mod_Bav_Perennial_fungi_fruiting_bodies_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Bav_Perennial_fungi_fruiting_bodies_level_depe_G)


#Twig_tangles
summary(mod_Bav_Twig_tangles_level_depe_G)

set.seed(1)
Estimate_mod_Bav_Twig_tangles_level_depe_G = rnorm(10000, mean = 64.132, sd = 74.995)

D <- (exp(Estimate_mod_Bav_Twig_tangles_level_depe_G * 0.27)- 1)*-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Bav_Twig_tangles_level_depe_G)


#Crown_deadwood
summary(mod_Bav_Crown_deadwood_level_depe_G)

set.seed(1)
Estimate_mod_Bav_Crown_deadwood_level_depe_G = rnorm(10000, mean = 0.04736, sd = 0.0794)
summary(Data_univar_CWM_TreMs_Bav$Crown_deadwood_LW_nb)
val_predict = predict(glmmTMB(Crown_deadwood_LW_nb ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_Crown_deadwood_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_Crown_deadwood_level_depe_G)


#Dead_branches
summary(mod_Bav_Dead_branches_level_depe_G)

set.seed(1)
Estimate_mod_Bav_Dead_branches_level_depe_G = rnorm(10000, mean = 0.9526, sd = 1.1171)

D <- exp(Estimate_mod_Bav_Dead_branches_level_depe_G * 0.27)- 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))

rm(Estimate_mod_Bav_Dead_branches_level_depe_G)


#Dead_top
summary(mod_Bav_Dead_top_level_depe_G)

set.seed(1)
Estimate_mod_Bav_Dead_top_level_depe_G = rnorm(10000, mean = 0.33736, sd = 0.33036)
summary(Data_univar_CWM_TreMs_Bav$Dead_top_LW_nb)
val_predict = predict(glmmTMB(Dead_top_LW_nb ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_Dead_top_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_Dead_top_level_depe_G)


#Rot_holes
summary(mod_Bav_Rot_holes_level_depe_G)

set.seed(1)
Estimate_mod_Bav_Rot_holes_level_depe_G = rnorm(10000, mean = 0.9653, sd = 1.1691)

D <- (exp(Estimate_mod_Bav_Rot_holes_level_depe_G * 0.27)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Bav_Rot_holes_level_depe_G)


#Burrs_and_cankers
summary(mod_Bav_Burrs_and_cankers_level_depe_G)

set.seed(1)
Estimate_mod_Bav_Burrs_and_cankers_level_depe_G = rnorm(10000, mean = 7.165, sd = 3.586)

D <- (exp(Estimate_mod_Bav_Burrs_and_cankers_level_depe_G * 0.27)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Bav_Burrs_and_cankers_level_depe_G)


#Exudates
summary(mod_Bav_Exudates_level_depe_G)

set.seed(1)
Estimate_mod_Bav_Exudates_level_depe_G = rnorm(10000, mean = 0.5367, sd = 2.5558)

D <- (exp(Estimate_mod_Bav_Exudates_level_depe_G * 0.27)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Bav_Exudates_level_depe_G)


#Wood_pecker_breeding_cavities
summary(mod_Bav_Wood_pecker_breeding_cavities_level_depe_G)

set.seed(1)
Estimate_mod_Bav_Wood_pecker_breeding_cavities_level_depe_G = rnorm(10000, mean = 7.7991, sd = 8.1131)

D <- exp(Estimate_mod_Bav_Wood_pecker_breeding_cavities_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Bav_Wood_pecker_breeding_cavities_level_depe_G)


#Ephemeral_fungal_fruiting_bodies
summary(mod_Bav_Ephemeral_fungal_fruiting_bodies_level_depe_G)

set.seed(1)
Estimate_mod_Bav_Ephemeral_fungal_fruiting_bodies_level_depe_G = rnorm(10000, mean = 1.4911, sd = 2.2552)

D <- (exp(Estimate_mod_Bav_Ephemeral_fungal_fruiting_bodies_level_depe_G * 0.27)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Bav_Ephemeral_fungal_fruiting_bodies_level_depe_G)


# #Rootplate
# summary(mod_Bav_Rootplate_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Bav_Rootplate_level_depe_G = rnorm(10000, mean = 1.5401, sd = 7.2523)
# 
# D <- exp(Estimate_mod_Bav_Rootplate_level_depe_G * 0.15)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Bav_Rootplate_level_depe_G)


# #Nest
# summary(mod_Bav_Nest_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Bav_Nest_level_depe_G = rnorm(10000, mean = 2.399, sd = 5.8673)
# 
# D <- exp(Estimate_mod_Bav_Nest_level_depe_G * 0.15)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Bav_Nest_level_depe_G)


# #CWD
# summary(mod_Bav_CWD_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Bav_CWD_level_depe_G = rnorm(10000, mean = 0.069, sd = 0.4043)
# 
# D <- exp(Estimate_mod_Bav_CWD_level_depe_G * 0.15)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Bav_CWD_level_depe_G)


# #Microsoil
# summary(mod_Bav_Microsoil_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Bav_Microsoil_level_depe_G = rnorm(10000, mean = 5.1266, sd = 11.628)
# 
# D <- exp(Estimate_mod_Bav_Microsoil_level_depe_G * 0.15)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Bav_Microsoil_level_depe_G)


# #Insect_gBaveries
# summary(mod_Bav_Insect_gBaveries_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Bav_Insect_gBaveries_level_depe_G = rnorm(10000, mean = 0.069, sd = 0.4043)
# 
# D <- exp(Estimate_mod_Bav_Insect_gBaveries_level_depe_G * 0.15)-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Bav_Insect_gBaveries_level_depe_G)


#FRic
summary(mod_Bav_FRic_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FRic_level_depe_G = rnorm(10000, mean = 3.9783, sd = 1.1076)
summary(Data_univar_CWM_TreMs_Bav$FRic)
val_predict = predict(glmmTMB(FRic ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Bav_FRic_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FRic_level_depe_G)


#FDiv
summary(mod_Bav_FDiv_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDiv_level_depe_G = rnorm(10000, mean = 0.14954, sd = 0.07584)
summary(Data_univar_CWM_TreMs_Bav$FDiv)
val_predict = predict(glmmTMB(FDiv ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_FDiv_level_depe_G * 0.27) / val_predict)- 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDiv_level_depe_G)


#FEve
summary(mod_Bav_FEve_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FEve_level_depe_G = rnorm(10000, mean = 0.25829, sd = 0.06531)
summary(Data_univar_CWM_TreMs_Bav$FEve)
val_predict = predict(glmmTMB(FEve ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_FEve_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FEve_level_depe_G)


#FDis
summary(mod_Bav_FDis_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_level_depe_G = rnorm(10000, mean = 0.4541, sd = 0.1963)
summary(Data_univar_CWM_TreMs_Bav$FDis)
val_predict = predict(glmmTMB(FDis ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_FDis_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_level_depe_G)


#CWM_DW_type_substrate
summary(mod_Bav_CWM_DW_type_substrate_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_DW_type_substrate_level_depe_G = rnorm(10000, mean = 0.3186, sd = 0.0243)
summary(Data_univar_CWM_TreMs_Bav$CWM_DW_type_substrate)
val_predict = predict(glmmTMB(CWM_DW_type_substrate ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Bav_CWM_DW_type_substrate_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_CWM_DW_type_substrate_level_depe_G)


#FDis_DW_type_substrate
summary(mod_Bav_FDis_DW_type_substrate_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_DW_type_substrate_level_depe_G = rnorm(10000, mean = 0.27378, sd = 0.07883)
summary(Data_univar_CWM_TreMs_Bav$FDis_DW_type_substrate)
val_predict = predict(glmmTMB(FDis_DW_type_substrate ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_FDis_DW_type_substrate_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_DW_type_substrate_level_depe_G)


#CWM_POS
summary(mod_Bav_CWM_POS_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_POS_level_depe_G = rnorm(10000, mean = 0.07257, sd = 0.03953)
summary(Data_univar_CWM_TreMs_Bav$CWM_POS)
val_predict = predict(glmmTMB(CWM_POS ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Bav_CWM_POS_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_CWM_POS_level_depe_G)


#FDis_POS
summary(mod_Bav_FDis_POS_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_POS_level_depe_G = rnorm(10000, mean = 0.28037, sd = 0.07878)
summary(Data_univar_CWM_TreMs_Bav$FDis_POS)
val_predict = predict(glmmTMB(FDis_POS ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Bav_FDis_POS_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_POS_level_depe_G)


#CWM_HUM_dry_wet
summary(mod_Bav_CWM_HUM_dry_wet_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_HUM_dry_wet_level_depe_G = rnorm(10000, mean = 0.0946, sd = 0.01872)
summary(Data_univar_CWM_TreMs_Bav$CWM_HUM_dry_wet)

D <- exp(Estimate_mod_Bav_CWM_HUM_dry_wet_level_depe_G * 0.27)- 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Bav_CWM_HUM_dry_wet_level_depe_G)


#FDis_HUM_dry_wet
summary(mod_Bav_FDis_HUM_dry_wet_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_HUM_dry_wet_level_depe_G = rnorm(10000, mean = 0.58934, sd = 0.09225)
summary(Data_univar_CWM_TreMs_Bav$FDis_HUM_dry_wet)
val_predict = predict(glmmTMB(FDis_HUM_dry_wet ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_FDis_HUM_dry_wet_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_HUM_dry_wet_level_depe_G)


#CWM_LIFE
summary(mod_Bav_CWM_LIFE_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_LIFE_level_depe_G = rnorm(10000, mean = 0.097268, sd = 0.014389)
summary(Data_univar_CWM_TreMs_Bav$CWM_LIFE)

D <- (exp(Estimate_mod_Bav_CWM_LIFE_level_depe_G * 0.27)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Bav_CWM_LIFE_level_depe_G)


#FDis_LIFE
summary(mod_Bav_FDis_LIFE_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_LIFE_level_depe_G = rnorm(10000, mean = 0.55979, sd = 0.07728)
summary(Data_univar_CWM_TreMs_Bav$FDis_LIFE)
val_predict = predict(glmmTMB(FDis_LIFE ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_FDis_LIFE_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_LIFE_level_depe_G)


#CWM_ONTO
summary(mod_Bav_CWM_ONTO_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_ONTO_level_depe_G = rnorm(10000, mean = 0.05149, sd = 0.07757)
summary(Data_univar_CWM_TreMs_Bav$CWM_ONTO)
val_predict = predict(glmmTMB(CWM_ONTO ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Bav_CWM_ONTO_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_CWM_ONTO_level_depe_G)


#FDis_ONTO
summary(mod_Bav_FDis_ONTO_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_ONTO_level_depe_G = rnorm(10000, mean = 0.3123, sd = 0.1389)
summary(Data_univar_CWM_TreMs_Bav$FDis_ONTO)
val_predict = predict(glmmTMB(FDis_ONTO ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Bav_FDis_ONTO_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_ONTO_level_depe_G)





#CWM_DW_saproxylic
summary(mod_Bav_CWM_DW_saproxylic_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_DW_saproxylic_level_depe_G = rnorm(10000, mean = 1.0735, sd = 0.2184)
summary(Data_univar_CWM_TreMs_Bav$CWM_DW_saproxylic)
val_predict = predict(glmmTMB(CWM_DW_saproxylic ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_CWM_DW_saproxylic_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_CWM_DW_saproxylic_level_depe_G)


#FDis_DW_saproxylic
summary(mod_Bav_FDis_DW_saproxylic_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_DW_saproxylic_level_depe_G = rnorm(10000, mean = 0.28177, sd = 0.10604)
summary(Data_univar_CWM_TreMs_Bav$FDis_DW_saproxylic)
val_predict = predict(glmmTMB(FDis_DW_saproxylic ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_FDis_DW_saproxylic_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_DW_saproxylic_level_depe_G)


#CWM_DW_epixylic
summary(mod_Bav_CWM_DW_epixylic_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_DW_epixylic_level_depe_G = rnorm(10000, mean = 1.3929, sd = 0.2288)
summary(Data_univar_CWM_TreMs_Bav$CWM_DW_epixylic)
val_predict = predict(glmmTMB(CWM_DW_epixylic ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Bav_CWM_DW_epixylic_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_CWM_DW_epixylic_level_depe_G)


#FDis_DW_epixylic
summary(mod_Bav_FDis_DW_epixylic_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_DW_epixylic_level_depe_G = rnorm(10000, mean = 0.17056, sd = 0.11578)
summary(Data_univar_CWM_TreMs_Bav$FDis_DW_epixylic)
val_predict = predict(glmmTMB(FDis_DW_epixylic ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_FDis_DW_epixylic_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_DW_epixylic_level_depe_G)


#CWM_DW_mould
summary(mod_Bav_CWM_DW_contains_mould_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_DW_contains_mould_level_depe_G = rnorm(10000, mean = 0.74427, sd = 0.10122)
summary(Data_univar_CWM_TreMs_Bav$CWM_DW_contains_mould)
val_predict = predict(glmmTMB(CWM_DW_contains_mould ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_CWM_DW_contains_mould_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_CWM_DW_contains_mould_level_depe_G)


#FDis_DW_mould
summary(mod_Bav_FDis_DW_contains_mould_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_DW_contains_mould_level_depe_G = rnorm(10000, mean = 0.58754, sd = 0.10815)
summary(Data_univar_CWM_TreMs_Bav$FDis_DW_contains_mould)
val_predict = predict(glmmTMB(FDis_DW_contains_mould ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_FDis_DW_contains_mould_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_DW_contains_mould_level_depe_G)


#CWM_DW_living_tree
summary(mod_Bav_CWM_DW_living_tree_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_DW_living_tree_level_depe_G = rnorm(10000, mean = 1.03174, sd = 0.09148)
summary(Data_univar_CWM_TreMs_Bav$CWM_DW_living_tree)
val_predict = predict(glmmTMB(CWM_DW_living_tree ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Bav_CWM_DW_living_tree_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_CWM_DW_living_tree_level_depe_G)


#FDis_DW_living_tree
summary(mod_Bav_FDis_DW_living_tree_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_DW_living_tree_level_depe_G = rnorm(10000, mean = 1.42462, sd = 0.15692)
summary(Data_univar_CWM_TreMs_Bav$FDis_DW_living_tree)
val_predict = predict(glmmTMB(FDis_DW_living_tree ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_FDis_DW_living_tree_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_DW_living_tree_level_depe_G)


#CWM_DW_snag
summary(mod_Bav_CWM_DW_snag_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_DW_snag_level_depe_G = rnorm(10000, mean = 1.27735, sd = 0.1267)
summary(Data_univar_CWM_TreMs_Bav$CWM_DW_snag)
val_predict = predict(glmmTMB(CWM_DW_snag ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_CWM_DW_snag_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_CWM_DW_snag_level_depe_G)


#FDis_DW_snag
summary(mod_Bav_FDis_DW_snag_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_DW_snag_level_depe_G = rnorm(10000, mean = 0.09729, sd = 0.10336)
summary(Data_univar_CWM_TreMs_Bav$FDis_DW_snag)
val_predict = predict(glmmTMB(FDis_DW_snag ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_FDis_DW_snag_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_DW_snag_level_depe_G)


#CWM_DW_log
summary(mod_Bav_CWM_DW_log_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_DW_log_level_depe_G = rnorm(10000, mean = 0.4828, sd = 0.06497)
summary(Data_univar_CWM_TreMs_Bav$CWM_DW_log)

D <- exp(Estimate_mod_Bav_CWM_DW_log_level_depe_G * 0.27)-1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(Estimate_mod_Bav_CWM_DW_log_level_depe_G)


#FDis_DW_log
summary(mod_Bav_FDis_DW_log_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_DW_log_level_depe_G = rnorm(10000, mean = 0.29933, sd = 0.06412)
summary(Data_univar_CWM_TreMs_Bav$FDis_DW_log)
val_predict = predict(glmmTMB(FDis_DW_log ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_FDis_DW_log_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_DW_log_level_depe_G)


#CWM_POS_base
summary(mod_Bav_CWM_POS_base_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_POS_base_level_depe_G = rnorm(10000, mean = 0.32999, sd = 0.10226)
summary(Data_univar_CWM_TreMs_Bav$CWM_POS_base)
val_predict = predict(glmmTMB(CWM_POS_base ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_CWM_POS_base_level_depe_G * 0.27) / val_predict)- 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_CWM_POS_base_level_depe_G)


#FDis_POS_base
summary(mod_Bav_FDis_POS_base_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_POS_base_level_depe_G = rnorm(10000, mean = 0.08947, sd = 0.10635)
summary(Data_univar_CWM_TreMs_Bav$FDis_POS_base)
val_predict = predict(glmmTMB(FDis_POS_base ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Bav_FDis_POS_base_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_POS_base_level_depe_G)


#CWM_POS_trunk
summary(mod_Bav_CWM_POS_trunk_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_POS_trunk_level_depe_G = rnorm(10000, mean = 0.14731, sd = 0.11698)
summary(Data_univar_CWM_TreMs_Bav$CWM_POS_trunk)
val_predict = predict(glmmTMB(CWM_POS_trunk ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_CWM_POS_trunk_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_CWM_POS_trunk_level_depe_G)


#FDis_POS_trunk
summary(mod_Bav_FDis_POS_trunk_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_POS_trunk_level_depe_G = rnorm(10000, mean = 0.25581, sd = 0.09348)
summary(Data_univar_CWM_TreMs_Bav$FDis_POS_trunk)
val_predict = predict(glmmTMB(FDis_POS_trunk ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Bav_FDis_POS_trunk_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_POS_trunk_level_depe_G)


#CWM_POS_crown
summary(mod_Bav_CWM_POS_crown_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_POS_crown_level_depe_G = rnorm(10000, mean = 0.13669, sd = 0.10244)
summary(Data_univar_CWM_TreMs_Bav$CWM_POS_crown)
val_predict = predict(glmmTMB(CWM_POS_crown ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Bav_CWM_POS_crown_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_CWM_POS_crown_level_depe_G)


#FDis_POS_crown
summary(mod_Bav_FDis_POS_crown_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_POS_crown_level_depe_G = rnorm(10000, mean = 0.0363, sd = 0.07849)
summary(Data_univar_CWM_TreMs_Bav$FDis_POS_crown)
val_predict = predict(glmmTMB(FDis_POS_crown ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Bav_FDis_POS_crown_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_POS_crown_level_depe_G)


# #CWM_SOIL_contact
# summary(mod_Bav_CWM_SOIL_contact_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Bav_CWM_SOIL_contact_level_depe_G = rnorm(10000, mean = 1.3234, sd = 0.3566)
# 
# D <- (exp(Estimate_mod_Bav_CWM_SOIL_contact_level_depe_G * 0.15) - 1)*-1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Bav_CWM_SOIL_contact_level_depe_G)
# 
# 
# #FDis_SOIL_contact
# summary(mod_Bav_FDis_SOIL_contact_level_depe_G)
# 
# set.seed(1)
# Estimate_mod_Bav_FDis_SOIL_contact_level_depe_G = rnorm(10000, mean = 0.06063, sd = 0.20439)
# summary(Data_univar_CWM_TreMs_Bav$FDis_SOIL_contact)
# 
# D <- ((0.6737 + (Estimate_mod_Bav_FDis_SOIL_contact_level_depe_G * 0.15)) / 0.6737) - 1
# 
# hist(D)
# summary(D)
# quantile(D, c(0.01, 0.99))
# 
# rm(Estimate_mod_Bav_FDis_SOIL_contact_level_depe_G)


#CWM_HUM_dry
summary(mod_Bav_CWM_HUM_dry_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_HUM_dry_level_depe_G = rnorm(10000, mean = 0.40903, sd = 0.07399)
summary(Data_univar_CWM_TreMs_Bav$CWM_HUM_dry)
val_predict = predict(glmmTMB(CWM_HUM_dry ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Bav_CWM_HUM_dry_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_CWM_HUM_dry_level_depe_G)


#FDis_HUM_dry
summary(mod_Bav_FDis_HUM_dry_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_HUM_dry_level_depe_G = rnorm(10000, mean = 0.66086, sd = 0.10775)
summary(Data_univar_CWM_TreMs_Bav$FDis_HUM_dry)
val_predict = predict(glmmTMB(FDis_HUM_dry ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_FDis_HUM_dry_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_HUM_dry_level_depe_G)


#CWM_HUM_wet
summary(mod_Bav_CWM_HUM_wet_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_HUM_wet_level_depe_G = rnorm(10000, mean = 0.40136, sd = 0.08659)
summary(Data_univar_CWM_TreMs_Bav$CWM_HUM_wet)
val_predict = predict(glmmTMB(CWM_HUM_wet ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_CWM_HUM_wet_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_CWM_HUM_wet_level_depe_G)


#FDis_HUM_wet
summary(mod_Bav_FDis_HUM_wet_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_HUM_wet_level_depe_G = rnorm(10000, mean = 0.67148, sd = 0.11055)
summary(Data_univar_CWM_TreMs_Bav$FDis_HUM_wet)
val_predict = predict(glmmTMB(FDis_HUM_wet ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_FDis_HUM_wet_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_HUM_wet_level_depe_G)


#CWM_LIFE_ephemeral
summary(mod_Bav_CWM_LIFE_ephemeral_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_LIFE_ephemeral_level_depe_G = rnorm(10000, mean = 0.30695, sd = 0.0515)
summary(Data_univar_CWM_TreMs_Bav$CWM_LIFE_ephemeral)
val_predict = predict(glmmTMB(CWM_LIFE_ephemeral ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_CWM_LIFE_ephemeral_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_CWM_LIFE_ephemeral_level_depe_G)


#FDis_LIFE_ephemeral
summary(mod_Bav_FDis_LIFE_ephemeral_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_LIFE_ephemeral_level_depe_G = rnorm(10000, mean = 0.37017, sd = 0.06265)
summary(Data_univar_CWM_TreMs_Bav$FDis_LIFE_ephemeral)
val_predict = predict(glmmTMB(FDis_LIFE_ephemeral ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_FDis_LIFE_ephemeral_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_LIFE_ephemeral_level_depe_G)


#CWM_LIFE_annual
summary(mod_Bav_CWM_LIFE_annual_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_LIFE_annual_level_depe_G = rnorm(10000, mean = 1.07251, sd = 0.13333)
summary(Data_univar_CWM_TreMs_Bav$CWM_LIFE_annual)
val_predict = predict(glmmTMB(CWM_LIFE_annual ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_CWM_LIFE_annual_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_CWM_LIFE_annual_level_depe_G)


#FDis_LIFE_annual
summary(mod_Bav_FDis_LIFE_annual_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_LIFE_annual_level_depe_G = rnorm(10000, mean = 1.21101, sd = 0.13083)
summary(Data_univar_CWM_TreMs_Bav$FDis_LIFE_annual)
val_predict = predict(glmmTMB(FDis_LIFE_annual ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_FDis_LIFE_annual_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_LIFE_annual_level_depe_G)


#CWM_LIFE_perenial
summary(mod_Bav_CWM_LIFE_perenial_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_LIFE_perenial_level_depe_G = rnorm(10000, mean = 0.37296, sd = 0.04273)
summary(Data_univar_CWM_TreMs_Bav$CWM_LIFE_perenial)
val_predict = predict(glmmTMB(CWM_LIFE_perenial ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Bav_CWM_LIFE_perenial_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_CWM_LIFE_perenial_level_depe_G)


#FDis_LIFE_perenial
summary(mod_Bav_FDis_LIFE_perenial_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_LIFE_perenial_level_depe_G = rnorm(10000, mean = 0.52016, sd = 0.05749)
summary(Data_univar_CWM_TreMs_Bav$FDis_LIFE_perenial)
val_predict = predict(glmmTMB(FDis_LIFE_perenial ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_FDis_LIFE_perenial_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_LIFE_perenial_level_depe_G)


#CWM_ONTO_slow
summary(mod_Bav_CWM_ONTO_slow_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_ONTO_slow_level_depe_G = rnorm(10000, mean = 0.1749, sd = 0.1394)
summary(Data_univar_CWM_TreMs_Bav$CWM_ONTO_slow)
val_predict = predict(glmmTMB(CWM_ONTO_slow ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Bav_CWM_ONTO_slow_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_CWM_ONTO_slow_level_depe_G)


#FDis_ONTO_slow
summary(mod_Bav_FDis_ONTO_slow_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_ONTO_slow_level_depe_G = rnorm(10000, mean = 0.05054, sd = 0.08558)
summary(Data_univar_CWM_TreMs_Bav$FDis_ONTO_slow)
val_predict = predict(glmmTMB(FDis_ONTO_slow ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Bav_FDis_ONTO_slow_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_ONTO_slow_level_depe_G)


#CWM_ONTO_fairly_slow
summary(mod_Bav_CWM_ONTO_fairly_slow_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_ONTO_fairly_slow_level_depe_G = rnorm(10000, mean = 1.2854, sd = 0.1845)
summary(Data_univar_CWM_TreMs_Bav$CWM_ONTO_fairly_slow)
val_predict = predict(glmmTMB(CWM_ONTO_fairly_slow ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_CWM_ONTO_fairly_slow_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_CWM_ONTO_fairly_slow_level_depe_G)


#FDis_ONTO_fairly_slow
summary(mod_Bav_FDis_ONTO_fairly_slow_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_ONTO_fairly_slow_level_depe_G = rnorm(10000, mean = 0.23915, sd = 0.10574)
summary(Data_univar_CWM_TreMs_Bav$FDis_ONTO_fairly_slow)
val_predict = predict(glmmTMB(FDis_ONTO_fairly_slow ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- ((val_predict + Estimate_mod_Bav_FDis_ONTO_fairly_slow_level_depe_G * 0.27) / val_predict) - 1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_ONTO_fairly_slow_level_depe_G)


#CWM_ONTO_fairly_rapid
summary(mod_Bav_CWM_ONTO_fairly_rapid_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_ONTO_fairly_rapid_level_depe_G = rnorm(10000, mean = 0.1789, sd = 0.2003)
summary(Data_univar_CWM_TreMs_Bav$CWM_ONTO_fairly_rapid)
val_predict = predict(glmmTMB(CWM_ONTO_fairly_rapid ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Bav_CWM_ONTO_fairly_rapid_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_CWM_ONTO_fairly_rapid_level_depe_G)


#FDis_ONTO_fairly_rapid
summary(mod_Bav_FDis_ONTO_fairly_rapid_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_ONTO_fairly_rapid_level_depe_G = rnorm(10000, mean = 0.216, sd = 0.164)
summary(Data_univar_CWM_TreMs_Bav$FDis_ONTO_fairly_rapid)
val_predict = predict(glmmTMB(FDis_ONTO_fairly_rapid ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Bav_FDis_ONTO_fairly_rapid_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_ONTO_fairly_rapid_level_depe_G)


#CWM_ONTO_rapid
summary(mod_Bav_CWM_ONTO_rapid_level_depe_G)

set.seed(1)
Estimate_mod_Bav_CWM_ONTO_rapid_level_depe_G = rnorm(10000, mean = 0.09585, sd = 0.09779)
summary(Data_univar_CWM_TreMs_Bav$CWM_ONTO_rapid)
val_predict = predict(glmmTMB(CWM_ONTO_rapid ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Bav_CWM_ONTO_rapid_level_depe_G * 0.27) / val_predict) - 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_CWM_ONTO_rapid_level_depe_G)


#FDis_ONTO_rapid
summary(mod_Bav_FDis_ONTO_rapid_level_depe_G)

set.seed(1)
Estimate_mod_Bav_FDis_ONTO_rapid_level_depe_G = rnorm(10000, mean = 0.3285, sd = 0.1728)
summary(Data_univar_CWM_TreMs_Bav$FDis_ONTO_rapid)
val_predict = predict(glmmTMB(FDis_ONTO_rapid ~ level_depe_G, data = Data_univar_CWM_TreMs_Bav, family = gaussian()), data.frame(level_depe_G = 0.1))
val_predict

D <- (((val_predict + Estimate_mod_Bav_FDis_ONTO_rapid_level_depe_G * 0.27) / val_predict)- 1)* -1

hist(D)
summary(D)
quantile(D, c(0.01, 0.99))
quantile(D, c(0.025, 0.975))

rm(val_predict)
rm(Estimate_mod_Bav_FDis_ONTO_rapid_level_depe_G)



```





###




###Construction figure magnitudes
```{r Construction figure magnitudes}


Tab_results_magnitude_TreMs <- readxl::read_xlsx("Tab_result_habitat_study.xlsx", sheet = "Magnitude_TreMs")
Tab_results_magnitude_TreMs = na.omit(Tab_results_magnitude_TreMs)


Tab_results_magnitude_TreMs$Y = fct_rev(Tab_results_magnitude_TreMs$Y)

Tab_results_magnitude_TreMs$Y = factor(Tab_results_magnitude_TreMs$Y)

Tab_results_magnitude_TreMs$pval_0_01 = factor(Tab_results_magnitude_TreMs$pval_0_01, levels = c("ns", "p < 0.01", "p < 0.001", "p < 0.0001"))
Tab_results_magnitude_TreMs$pval = factor(Tab_results_magnitude_TreMs$pval, levels = c("ns", "p < 0.05", "p < 0.01", "p < 0.001", "p < 0.0001"))
Tab_results_magnitude_TreMs$Context = factor(Tab_results_magnitude_TreMs$Context, levels = c("Fir", "Spruce", "Oak"))
# Tab_results_magnitude_TreMs$pval = as.numeric(Tab_results_magnitude_TreMs$pval)
# Tab_results_magnitude_TreMs$pval = factor(Tab_results_magnitude_TreMs$pval, levels = c("ns", "p < 0.0001", "p < 0.001", "p < 0.01", "p < 0.05"))

Magnitude_TreMs_ress_Simple = ggplot(filter(Tab_results_magnitude_TreMs, cat1 %in% "Ressource", keep == 1), aes(x = Y, y = magn_mean, ymin = magn_CI25, ymax = magn_CI975, color = Context, size = pval)) + coord_flip() + geom_hline(yintercept = 0, linetype = 2) + geom_point(position = position_dodge(width = -1)) + geom_errorbar(size = 0.5, width = 0, position = position_dodge(width = -1)) + theme_bw() + theme(axis.title.y = element_blank(), plot.subtitle = element_text(color="grey20", size=10, face="italic")) + scale_color_manual(values = c("#4F9B8A", "#D076B5", "#A28346")) + scale_size_manual(values = c(1,2.5,4,6), labels = c("ns", "p < 0.05", "p < 0.01", "p < 0.0001")) + labs(y = "Magnitude (+/- 95% Confidence Interval)", size = "p.value", color = "Context") + ylim(-5,5) + facet_grid(factor(cat2, levels = c("General", "Cavities", "Tree injuries", "Crown", "Excresc.", "Saprox. fungi", "Epiphytic", "Exuda.", "Root")) ~ ., space = "free", scales = "free") + ggtitle(label = "Tree-related microhabitats", subtitle = "Resource")

Magnitude_TreMs_ress_Simple
ggsave("Figures/Magnitude_TreMs_ress_Simple.png", plot = Magnitude_TreMs_ress_Simple, width = 20, height = 20, units = "cm", type = "cairo")



Magnitude_TreMs_ress_Simple_CVL = ggplot(filter(Tab_results_magnitude_TreMs, cat1 %in% "Ressource", keep == 1, Context %in% "Oak"), aes(x = Y, y = magn_mean, ymin = magn_CI25, ymax = magn_CI975, color = Context, size = pval)) + coord_flip() + geom_hline(yintercept = 0, linetype = 2) + geom_point(position = position_dodge(width = -1)) + geom_errorbar(size = 0.5, width = 0, position = position_dodge(width = -1)) + theme_bw() + theme(axis.title.y = element_blank(), plot.subtitle = element_text(color="grey20", size=10, face="italic")) + scale_color_manual(values = c("#A28346")) + scale_size_manual(values = c(1,2.5,4,6), labels = c("ns", "p < 0.05", "p < 0.01", "p < 0.0001")) + labs(y = "Magnitude (+/- 95% Confidence Interval)", size = "p.value", color = "Context") + ylim(-5,5) + facet_grid(factor(cat2, levels = c("General", "Cavities", "Tree injuries", "Crown", "Excresc.", "Saprox. fungi", "Epiphytic", "Exuda.", "Root")) ~ ., space = "free", scales = "free") + ggtitle(label = "Tree-related microhabitats", subtitle = "Resource")

Magnitude_TreMs_ress_Simple_CVL
ggsave("Figures/Magnitude_TreMs_ress_Simple_CVL.png", plot = Magnitude_TreMs_ress_Simple_CVL, width = 18, height = 20, units = "cm", type = "cairo")



############################ Traits ###########################


Tab_results_magnitude_TreMs_trait = Tab_results_magnitude_TreMs %>%
  filter(cat1 %in% "Traits")


Tab_results_magnitude_TreMs_trait$Y = factor(Tab_results_magnitude_TreMs_trait$Y, levels = c("Functional Richness", "Functional Divergence", "Functional Evenness", "Functional Dispersion", "CWM substrate", "FDis substrate", "CWM position", "FDis position", "CWM wetness", "FDis wetness", "CWM life span", "FDis life span", "CWM ontogenesis", "FDis ontogenesis", "CWM saproxylic", "FDis saproxylic", "CWM epixylic", "FDis epixylic", "CWM mould", "FDis mould", "CWM living tree", "FDis living tree", "CWM snag", "FDis snag", "CWM log", "FDis log", "CWM base", "FDis base", "CWM trunk", "FDis trunk", "CWM crown", "FDis crown", "CWM dry", "FDis dry", "CWM wet", "FDis wet", "CWM ephemeral", "FDis ephemeral", "CWM annual", "FDis annual", "CWM perennial", "FDis perennial", "CWM slow", "FDis slow", "CWM fairly slow", "FDis fairly slow", "CWM fairly rapid", "FDis fairly rapid", "CWM rapid", "FDis rapid"))
Tab_results_magnitude_TreMs_trait$Y = fct_rev(Tab_results_magnitude_TreMs_trait$Y)



Magnitude_TreMs_traits_Simple = ggplot(filter(Tab_results_magnitude_TreMs_trait, cat2 != "Gradient", type_var != "FDis", keep == 1), aes(x = Y, y = magn_mean, ymin = magn_CI25, ymax = magn_CI975, color = Context, size = pval)) + coord_flip() + geom_hline(yintercept = 0, linetype = 2) + geom_point(position = position_dodge(width = -1)) + geom_errorbar(size = 0.5, width = 0, position = position_dodge(width = -1)) + theme_bw() + theme(axis.title.y = element_blank(), plot.subtitle = element_text(color="grey20", size=10, face="italic")) + scale_color_manual(values = c("#4F9B8A", "#D076B5", "#A28346")) + scale_size_manual(values = c(1,2.5,4,5,6), labels = c("ns", "p < 0.05", "p < 0.01", "p < 0.001", "p < 0.0001")) + labs(y = "Magnitude (+/- 95% Confidence Interval)", size = "p.value", color = "Context") + facet_grid(factor(cat2, levels = c("General", "Disp.", "Substrate", "Position", "Wetness", "Life span", "Ontogenesis")) ~ ., space = "free", scales = "free") + ggtitle(label = "Tree-related microhabitats")

Magnitude_TreMs_traits_Simple
ggsave("Figures/Magnitude_TreMs_traits_Simple.png", plot = Magnitude_TreMs_traits_Simple, width = 20, height = 24, units = "cm", type = "cairo")



Magnitude_TreMs_traits_Simple_CVL = ggplot(filter(Tab_results_magnitude_TreMs_trait, cat2 != "Gradient", type_var != "FDis", keep == 1, Context %in% "Oak"), aes(x = Y, y = magn_mean, ymin = magn_CI25, ymax = magn_CI975, color = Context, size = pval)) + coord_flip() + geom_hline(yintercept = 0, linetype = 2) + geom_point(position = position_dodge(width = -1)) + geom_errorbar(size = 0.5, width = 0, position = position_dodge(width = -1)) + theme_bw() + theme(axis.title.y = element_blank(), plot.subtitle = element_text(color="grey20", size=10, face="italic")) + scale_color_manual(values = c("#A28346")) + scale_size_manual(values = c(1,2.5,4,5,6), labels = c("ns", "p < 0.05", "p < 0.01", "p < 0.001", "p < 0.0001")) + labs(y = "Magnitude (+/- 95% Confidence Interval)", size = "p.value", color = "Context") + facet_grid(factor(cat2, levels = c("General", "Disp.", "Substrate", "Position", "Wetness", "Life span", "Ontogenesis")) ~ ., space = "free", scales = "free") + ggtitle(label = "Tree-related microhabitats")

Magnitude_TreMs_traits_Simple_CVL
ggsave("Figures/Magnitude_TreMs_traits_Simple_CVL.png", plot = Magnitude_TreMs_traits_Simple_CVL, width = 18, height = 18, units = "cm", type = "cairo")


# Magnitude_TreMs_traits_complex = ggplot(filter(Tab_results_magnitude_TreMs_trait, Context != "All", cat2 %in% c("Disp.","General", "Gradient"), keep == 1), aes(x = Y, y = magn_mean, ymin = magn_CI25, ymax = magn_CI975, color = Context, size = pval)) + coord_flip() + geom_hline(yintercept = 0, linetype = 2) + geom_point(position = position_dodge(width = -1)) + geom_errorbar(size = 0.5, width = 0, position = position_dodge(width = -1)) + theme_bw() + theme(axis.title.y = element_blank(), plot.subtitle = element_text(color="grey20", size=10, face="italic")) + scale_color_manual(values = c("#A28346", "#4F9B8A")) + scale_size_manual(values = c(1,2.5,5), labels = c("ns", "p < 0.05", "p < 0.001")) + labs(y = "Magnitude (+/- 95% Confidence Interval)", size = "p.value", color = "Context") + ylim(-0.3,0.5) + ggtitle(label = "Tree-related microhabitat", subtitle = "Composite traits metrics")
# 
# Magnitude_TreMs_traits_complex
# ggsave("Figures/Magnitude_TreMs_traits_complex.png", plot = Magnitude_TreMs_traits_complex, width = 20, height = 10, units = "cm", type = "cairo")


```




##Multivariate analysis


###Pyrenees

####Ordination
``` {r TreMs Pyrenees}

veganCovEllipse <- function (cov, center = c(0, 0), scale = 1, npoints = 100) 
{
  theta <- (0:npoints) * 2 * pi/npoints
  Circle <- cbind(cos(theta), sin(theta))
  t(center + scale * t(Circle %*% chol(cov)))
}


#Preparation nMDS
Data_plotxTreMs_Pyr_env = Data_plotxTreMs_Pyr %>%
  left_join(General, by = "plot") %>%
  filter(salvaged != 1)
Data_plotxTreMs_Pyr_env$cat_depe = factor(Data_plotxTreMs_Pyr_env$cat_depe, levels = c("Low","Medium","High"))
Data_plotxTreMs_Pyr_env$cat_depe01 = factor(Data_plotxTreMs_Pyr_env$cat_depe01, levels = c(0,1), labels = c("Low", "Mid & High"))
Data_plotxTreMs_Pyr_env$class_depe_G = factor(Data_plotxTreMs_Pyr_env$class_depe_G, levels = c("[0 ; 15]", "]15 ; 40]", "]40 ; 70]"))

dist_TreMs_Pyr <- vegdist(round(column_to_rownames(Data_plotxTreMs_Pyr_env[1:39], "plot")), method = "bray", binary = F)
ord_TreMs_Pyr <- metaMDS(dist_TreMs_Pyr, k=4)
ord_TreMs_Pyr
stressplot(ord_TreMs_Pyr)



##ggplot

NMDS_TreMs_Pyr <- data.frame(NMDS1 = ord_TreMs_Pyr$points[,1], NMDS2 = ord_TreMs_Pyr$points[,2], group = Data_plotxTreMs_Pyr_env$class_depe_G)

df_ell_NMDS_TreMs_Pyr <- data.frame() #sets up a data frame before running the function.
for(g in levels(NMDS_TreMs_Pyr$group)){
  df_ell_NMDS_TreMs_Pyr <- rbind(df_ell_NMDS_TreMs_Pyr, cbind(as.data.frame(with(NMDS_TreMs_Pyr [NMDS_TreMs_Pyr$group==g,],
                                                         veganCovEllipse(cov.wt(cbind(NMDS1,NMDS2),wt=rep(1/length(NMDS1),length(NMDS1)))$cov,center=c(mean(NMDS1),mean(NMDS2))))) ,group=g))
}

NMDS_TreMs_Pyr.mean <- aggregate(NMDS_TreMs_Pyr[,1:2], list(group=NMDS_TreMs_Pyr$group), mean)
segments_TreMs_Pyr <- merge(NMDS_TreMs_Pyr,NMDS_TreMs_Pyr.mean, by="group", suffixes = c("",".centroid"))


GGplot_NMDS_TreMs_Pyr <- ggplot(NMDS_TreMs_Pyr, aes(NMDS1, NMDS2)) +
  geom_point(size = 2, aes(color = group, shape=group)) +
  geom_path(data = df_ell_NMDS_TreMs_Pyr, aes(x = NMDS1, y = NMDS2, group = group, color = group), size = 1)+
  theme_classic() +
  scale_color_manual(values = c("[0 ; 15]" = "#77DCC5", "]15 ; 40]" = "#49A490", "]40 ; 70]" = "#3B7165")) +
  labs(colour = "Forest\nmortality", shape = "Forest\nmortality") +
  theme(legend.position="bottom") +
  theme(legend.position="bottom", plot.subtitle = element_text(color="grey20", size=10, face="italic")) +
  ggtitle(label= "Fir-dominated forests", subtitle = "Tree-related microhabitats") +
  xlim(-0.5,0.5) +
  ylim(-0.5,0.5) +
  annotate(geom = "text", label = "p < 0.01 **\nstress = 0.108", x = 0.15, y = 0.4, hjust = 0)
GGplot_NMDS_TreMs_Pyr

ggsave("Figures/nMDS_TreMs_Pyr.png", plot = GGplot_NMDS_TreMs_Pyr, width = 10, height = 10, units = "cm")



#Adonis
set.seed(1)
adonis2(dist_TreMs_Pyr ~ level.depe, data = Data_plotxTreMs_Pyr_env, strata = Data_plotxTreMs_Pyr_env$site)
set.seed(1)
adonis2(dist_TreMs_Pyr ~ level_depe_G, data = Data_plotxTreMs_Pyr_env, strata = Data_plotxTreMs_Pyr_env$site)
set.seed(1)
adonis2(dist_TreMs_Pyr ~ class_depe_G, data = Data_plotxTreMs_Pyr_env, strata = Data_plotxTreMs_Pyr_env$site)



#Anosim
ANOSIM_TreMs_Pyr <- anosim(dist_TreMs_Pyr, Data_plotxTreMs_Pyr_env$class_depe_G)
summary(ANOSIM_TreMs_Pyr)
plot(ANOSIM_TreMs_Pyr)

#Anosim comparison
df_ANOSIM_TreMs_Pyr <- as.data.frame(cbind(ANOSIM_TreMs_Pyr$dis.rank, as.character(ANOSIM_TreMs_Pyr$class.vec)))
df_ANOSIM_TreMs_Pyr$V1  <- as.numeric(df_ANOSIM_TreMs_Pyr$V1)

df_ANOSIM_TreMs_Pyr = filter(df_ANOSIM_TreMs_Pyr, V2 != "Between")
df_ANOSIM_TreMs_Pyr$V2 = factor(df_ANOSIM_TreMs_Pyr$V2, levels = c("[0 ; 15]", "]15 ; 40]", "]40 ; 70]"), labels = c("[0 ; 15]", "]15 ; 40]", "]40 ; 70]"))

ggplot(df_ANOSIM_TreMs_Pyr, aes(x = V2, y = V1)) +
  geom_boxplot(notch = T)

hist(df_ANOSIM_TreMs_Pyr$V1)
fit1<-fitdist(df_ANOSIM_TreMs_Pyr$V1, "norm", start = NULL)
gofstat(fit1)$chisqpvalue
summary(lm(normalize(V1, "scale") ~ V2, data = df_ANOSIM_TreMs_Pyr))
# plot(lm(normalize(V1, "scale") ~ V2, data = df_ANOSIM_TreMs_Pyr))

Pyr_anosim_TreMs_lm = lm(V1 ~ V2, data = df_ANOSIM_TreMs_Pyr)
Pyr_anosim_TreMs_emmeans <- emmeans(Pyr_anosim_TreMs_lm, "V2")
pairs(Pyr_anosim_TreMs_emmeans)

summarySE_ANOSIM_TreMs_Pyr = summarySE(data = df_ANOSIM_TreMs_Pyr, measurevar = "V1", groupvars = "V2")

plot_ANOSIM_TreMs_Pyr = ggplot(summarySE_ANOSIM_TreMs_Pyr, aes(x = V2, y = V1)) + geom_bar(stat="identity", alpha = 0.8, width = 0.5, aes(fill = V2)) + geom_errorbar(aes(ymin = V1 - se, ymax = V1 + se), size = 0.8, width = .1) + scale_fill_manual(values=c("[0 ; 15]" = "#77DCC5", "]15 ; 40]" = "#49A490", "]40 ; 70]" = "#3B7165")) + theme_bw() + theme(legend.position = "none") + labs(y="Dissimilarity value\n(intra-class)", x = "Forest mortality") + ylim(0, 650) + geom_segment(aes(x=1, y=550, xend=3, yend=550)) + annotate(geom = "text", label = "ns", x = 2, y = 590) + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + ggtitle(label= "Fir-dominated forests", subtitle = "TreMs - β-diversity")
plot_ANOSIM_TreMs_Pyr

ggsave("Figures/plot_ANOSIM_TreMs_Pyr.png", plot = plot_ANOSIM_TreMs_Pyr, units = "cm", width = 8, height=8, type = "cairo")
# ggsave("Figures/plot_ANOSIM_TreMs_Pyr.pdf", plot = plot_ANOSIM_TreMs_Pyr, units = "cm", width = 8, height=8)

#Simper
summary(simper(Data_plotxTreMs_Pyr_env[2:39], Data_plotxTreMs_Pyr_env$class_depe_G, permutations = 999), ordered = T)

#Indval
set.seed(1)
Indval_TreMs_Pyr <-  multipatt(Data_plotxTreMs_Pyr_env[2:39], Data_plotxTreMs_Pyr_env$class_depe_G, control = how(nperm=999), func = "IndVal.g", duleg=T)
summary(Indval_TreMs_Pyr, indvalcomp=TRUE)

```



####Adipart
```{r}

# [0 ; 15]
y_adipart_TreMs_Pyr_0_15 = Data_plotxTreMs_Pyr_env %>%
  dplyr::filter(class_depe_G == "[0 ; 15]")

x_adipart_TreMs_Pyr_0_15 = y_adipart_TreMs_Pyr_0_15 %>%
  dplyr::select("plot", "site", "class_depe_G")
y_adipart_TreMs_Pyr_0_15 = round(y_adipart_TreMs_Pyr_0_15[2:39])

adipart(y_adipart_TreMs_Pyr_0_15 ~ plot + site + class_depe_G, x_adipart_TreMs_Pyr_0_15, index="richness", nsimul=999, relative = F, weighted = T)

adipart(y_adipart_TreMs_Pyr_0_15 ~ plot + site + class_depe_G, x_adipart_TreMs_Pyr_0_15, index="richness", nsimul=999, relative = T, weighted = T)



# ]15 ; 40]
y_adipart_TreMs_Pyr_15_40 = Data_plotxTreMs_Pyr_env %>%
  dplyr::filter(class_depe_G == "]15 ; 40]")

x_adipart_TreMs_Pyr_15_40 = y_adipart_TreMs_Pyr_15_40 %>%
  dplyr::select("plot", "site", "class_depe_G")
y_adipart_TreMs_Pyr_15_40 = round(y_adipart_TreMs_Pyr_15_40[2:39])

adipart(y_adipart_TreMs_Pyr_15_40 ~ plot + site + class_depe_G, x_adipart_TreMs_Pyr_15_40, index="richness", nsimul=999, relative = F, weighted = T)

adipart(y_adipart_TreMs_Pyr_15_40 ~ plot + site + class_depe_G, x_adipart_TreMs_Pyr_15_40, index="richness", nsimul=999, relative = T, weighted = T)



# ]40 ; 70]
y_adipart_TreMs_Pyr_40_70 = Data_plotxTreMs_Pyr_env %>%
  dplyr::filter(class_depe_G == "]40 ; 70]")

x_adipart_TreMs_Pyr_40_70 = y_adipart_TreMs_Pyr_40_70 %>%
  dplyr::select("plot", "site", "class_depe_G")
y_adipart_TreMs_Pyr_40_70 = round(y_adipart_TreMs_Pyr_40_70[2:39])

adipart(y_adipart_TreMs_Pyr_40_70 ~ plot + site + class_depe_G, x_adipart_TreMs_Pyr_40_70, index="richness", nsimul=999, relative = F, weighted = T)

adipart(y_adipart_TreMs_Pyr_40_70 ~ plot + site + class_depe_G, x_adipart_TreMs_Pyr_40_70, index="richness", nsimul=999, relative = T, weighted = T)


```




##############




###Loire

####Ordination
``` {r TreMs Loire}

#Preparation nMDS
Data_plotxTreMs_CVL$plot = as.character(Data_plotxTreMs_CVL$plot)
Data_plotxTreMs_CVL_env = Data_plotxTreMs_CVL %>%
  left_join(General, by = "plot") %>%
  filter(salvaged != 1)
Data_plotxTreMs_CVL_env$cat_depe = factor(Data_plotxTreMs_CVL_env$cat_depe, levels = c("Low","Medium","High"))
Data_plotxTreMs_CVL_env$cat_depe01 = factor(Data_plotxTreMs_CVL_env$cat_depe01, levels = c(0,1), labels = c("Low", "Mid & High"))
Data_plotxTreMs_CVL_env$class_depe_G = factor(Data_plotxTreMs_CVL_env$class_depe_G, levels = c("[0 ; 10]", "]10 ; 40]"))

dist_TreMs_CVL <- vegdist(round(column_to_rownames(Data_plotxTreMs_CVL_env[1:30], "plot")), method = "bray", binary = F)
ord_TreMs_CVL <- metaMDS(dist_TreMs_CVL, k=4)
ord_TreMs_CVL
stressplot(ord_TreMs_CVL)


##ggplot

NMDS_TreMs_CVL <- data.frame(NMDS1 = ord_TreMs_CVL$points[,1], NMDS2 = ord_TreMs_CVL$points[,2], group = Data_plotxTreMs_CVL_env$class_depe_G)

df_ell_NMDS_TreMs_CVL <- data.frame() #sets up a data frame before running the function.
for(g in levels(NMDS_TreMs_CVL$group)){
  df_ell_NMDS_TreMs_CVL <- rbind(df_ell_NMDS_TreMs_CVL, cbind(as.data.frame(with(NMDS_TreMs_CVL [NMDS_TreMs_CVL$group==g,],
                                                         veganCovEllipse(cov.wt(cbind(NMDS1,NMDS2),wt=rep(1/length(NMDS1),length(NMDS1)))$cov,center=c(mean(NMDS1),mean(NMDS2))))) ,group=g))
}

NMDS_TreMs_CVL.mean <- aggregate(NMDS_TreMs_CVL[,1:2], list(group=NMDS_TreMs_CVL$group), mean)
segments_TreMs_CVL <- merge(NMDS_TreMs_CVL,NMDS_TreMs_CVL.mean, by="group", suffixes = c("",".centroid"))


GGplot_NMDS_TreMs_CVL <- ggplot(NMDS_TreMs_CVL, aes(NMDS1, NMDS2)) +
  geom_point(size = 2, aes(color = group, shape=group)) +
  geom_path(data = df_ell_NMDS_TreMs_CVL, aes(x = NMDS1, y = NMDS2, group = group, color = group), size = 1)+
  theme_classic() +
  scale_color_manual(values = c("[0 ; 10]" = "#E5C07F", "]10 ; 40]" = "#AC8B4E")) +
  labs(colour = "Forest\nmortality", shape = "Forest\nmortality") +
  theme(legend.position="bottom") +
  theme(legend.position="bottom", plot.subtitle = element_text(color="grey20", size=10, face="italic")) +
  ggtitle(label= "Oak-dominated forests", subtitle = "Tree-related microhabitats") +
  xlim(-0.5,0.5) +
  ylim(-0.5,0.5) +
  annotate(geom = "text", label = "p < 0.01 **\nstress = 0.066", x = 0.15, y = 0.4, hjust = 0)
GGplot_NMDS_TreMs_CVL

ggsave("Figures/nMDS_TreMs_CVL.png", plot = GGplot_NMDS_TreMs_CVL, width = 10, height = 10, units = "cm")


#Adonis
set.seed(1)
adonis2(dist_TreMs_CVL ~ level.depe, data = Data_plotxTreMs_CVL_env, strata = Data_plotxTreMs_CVL_env$site)
set.seed(1)
adonis2(dist_TreMs_CVL ~ level_depe_G, data = Data_plotxTreMs_CVL_env, strata = Data_plotxTreMs_CVL_env$site)
set.seed(1)
adonis2(dist_TreMs_CVL ~ class_depe_G, data = Data_plotxTreMs_CVL_env, strata = Data_plotxTreMs_CVL_env$site)

#Anosim
ANOSIM_TreMs_CVL <- anosim(dist_TreMs_CVL, Data_plotxTreMs_CVL_env$class_depe_G)
summary(ANOSIM_TreMs_CVL)
plot(ANOSIM_TreMs_CVL)

#Anosim comparison
df_ANOSIM_TreMs_CVL <- as.data.frame(cbind(ANOSIM_TreMs_CVL$dis.rank, as.character(ANOSIM_TreMs_CVL$class.vec)))
df_ANOSIM_TreMs_CVL$V1  <- as.numeric(df_ANOSIM_TreMs_CVL$V1)

df_ANOSIM_TreMs_CVL = filter(df_ANOSIM_TreMs_CVL, V2 != "Between")
df_ANOSIM_TreMs_CVL$V2 = factor(df_ANOSIM_TreMs_CVL$V2, levels = c("[0 ; 10]", "]10 ; 40]"), labels = c("[0 ; 10]", "]10 ; 40]"))

ggplot(df_ANOSIM_TreMs_CVL, aes(x = V2, y = V1)) +
  geom_boxplot(notch = T)

hist(df_ANOSIM_TreMs_CVL$V1)
fit1<-fitdist(df_ANOSIM_TreMs_CVL$V1, "norm", start = NULL)
gofstat(fit1)$chisqpvalue
summary(lm(normalize(V1, "scale") ~ V2, data = df_ANOSIM_TreMs_CVL))
# plot(lm(normalize(V1, "scale") ~ V2, data = df_ANOSIM_TreMs_CVL))

t.test(df_ANOSIM_TreMs_CVL$V1 ~ df_ANOSIM_TreMs_CVL$V2)
summarySE_ANOSIM_TreMs_CVL = summarySE(data = df_ANOSIM_TreMs_CVL, measurevar = "V1", groupvars = "V2")

plot_ANOSIM_TreMs_CVL = ggplot(summarySE_ANOSIM_TreMs_CVL, aes(x = V2, y = V1)) + geom_bar(stat="identity", alpha = 0.8, width = 0.5, aes(fill = V2)) + geom_errorbar(aes(ymin = V1 - se, ymax = V1 + se), size = 0.8, width = .1) + scale_fill_manual(values=c("[0 ; 10]" = "#E5C07F", "]10 ; 40]" = "#AC8B4E")) + theme_bw() + theme(legend.position = "none") + labs(y="Dissimilarity value\n(intra-class)", x = "Forest mortality") + ylim(0, 125) + geom_segment(aes(x=1, y=114, xend=2, yend=114)) + annotate(geom = "text", label = "**", x = 1.5, y = 120, hjust = 0) + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + ggtitle(label= "Oak-dominated forests", subtitle = "TreMs - β-diversity")
plot_ANOSIM_TreMs_CVL

ggsave("Figures/plot_ANOSIM_TreMs_CVL.png", plot = plot_ANOSIM_TreMs_CVL, units = "cm", width = 8, height=8, type = "cairo")
# ggsave("Figures/plot_ANOSIM_TreMs_CVL.pdf", plot = plot_ANOSIM_TreMs_CVL, units = "cm", width = 8, height=8)

#Simper
summary(simper(Data_plotxTreMs_CVL_env[2:30], Data_plotxTreMs_CVL_env$class_depe_G, permutations = 999), ordered = T)

#Indval
set.seed(1)
Indval_TreMs_CVL <-  multipatt(Data_plotxTreMs_CVL_env[2:30], Data_plotxTreMs_CVL_env$class_depe_G, control = how(nperm=999), func = "IndVal.g", duleg=)
summary(Indval_TreMs_CVL, indvalcomp=TRUE)

```



####Adipart
```{r}

# [0 ; 10]
y_adipart_TreMs_CVL_0_10 = Data_plotxTreMs_CVL_env %>%
  dplyr::filter(class_depe_G == "[0 ; 10]")

x_adipart_TreMs_CVL_0_10 = y_adipart_TreMs_CVL_0_10 %>%
  dplyr::select("plot", "site", "class_depe_G")
y_adipart_TreMs_CVL_0_10 = round(y_adipart_TreMs_CVL_0_10[2:30])


adipart(y_adipart_TreMs_CVL_0_10 ~ plot + site + class_depe_G, x_adipart_TreMs_CVL_0_10, index="richness", nsimul=999, relative = F, weighted = T)

adipart(y_adipart_TreMs_CVL_0_10 ~ plot + site + class_depe_G, x_adipart_TreMs_CVL_0_10, index="richness", nsimul=999, relative = T, weighted = T)



# ]10 ; 40]
y_adipart_TreMs_CVL_10_40 = Data_plotxTreMs_CVL_env %>%
  dplyr::filter(class_depe_G == "]10 ; 40]")

x_adipart_TreMs_CVL_10_40 = y_adipart_TreMs_CVL_10_40 %>%
  dplyr::select("plot", "site", "class_depe_G")
y_adipart_TreMs_CVL_10_40 = round(y_adipart_TreMs_CVL_10_40[2:30])


adipart(y_adipart_TreMs_CVL_10_40 ~ plot + site + class_depe_G, x_adipart_TreMs_CVL_10_40, index="richness", nsimul=999, relative = F, weighted = T)

adipart(y_adipart_TreMs_CVL_10_40 ~ plot + site + class_depe_G, x_adipart_TreMs_CVL_10_40, index="richness", nsimul=999, relative = T, weighted = T)


```




#############




###Bavaria

####Ordination
``` {r TreMs Bavaria}

#Preparation nMDS
Data_plotxTreMs_Bav_env = Data_plotxTreMs_Bav %>%
  left_join(General, by = "plot") %>%
  filter(salvaged != 1)
Data_plotxTreMs_Bav_env$cat_depe01 = factor(Data_plotxTreMs_Bav_env$cat_depe01, levels = c(0,1), labels = c("Low", "Mid & High"))
Data_plotxTreMs_Bav_env$class_depe_G = factor(Data_plotxTreMs_Bav_env$class_depe_G, levels = c("[0 ; 15]", "]15 ; 40]", "]70 ; 100]"))

dist_TreMs_Bav <- vegdist(round(column_to_rownames(Data_plotxTreMs_Bav_env[1:27], "plot")), method = "bray", binary = F)
ord_TreMs_Bav <- metaMDS(dist_TreMs_Bav, k=4)
ord_TreMs_Bav
stressplot(ord_TreMs_Bav)


##ggplot

NMDS_TreMs_Bav <- data.frame(MDS1 = ord_TreMs_Bav$points[,1], MDS2 = ord_TreMs_Bav$points[,2], group = Data_plotxTreMs_Bav_env$cat_depe01)
NMDS_TreMs_Bav.mean <- aggregate(NMDS_TreMs_Bav[,1:2], list(group=NMDS_TreMs_Bav$group), mean)
segments_TreMs_Bav <- merge(NMDS_TreMs_Bav,NMDS_TreMs_Bav.mean, by="group", suffixes = c("",".centroid"))

GGplot_NMDS_TreMs_Bav <- ggplot(NMDS_TreMs_Bav, aes(MDS1, MDS2)) +
  geom_point(size = 2, aes(color = group, shape=group)) +
  geom_point (data = NMDS_TreMs_Bav.mean, aes(color = group, shape=group), size = 5) +
  geom_segment(segments_TreMs_Bav, mapping = aes(x=MDS1, y=MDS2, xend=MDS1.centroid, yend=MDS2.centroid, color = group)) +
  stat_ellipse(aes (group = group, color=group), size = 1, level= 0.95) +
  theme_classic() +
  scale_color_manual(values = c("[0 ; 15]" = "#E9A7D6", "]15 ; 40]" = "#AE3E8D", "]70 ; 100]" = "#78205E")) +
  labs(colour = "Forest\ndieback class", shape = "Forest\ndieback class") +
  theme(legend.position="bottom") +
  theme(legend.position="bottom", plot.subtitle = element_text(color="grey20", size=10, face="italic")) +
  ggtitle(label= "Spruce-dominated forests", subtitle = "Tree-related microhabitats") +
  xlim(-1,1) +
  ylim(-0.7,0.7) +
  annotate(geom = "text", label = "p < 0.001 ***", x = -0.8, y = 0.65, hjust = 0)
GGplot_NMDS_TreMs_Bav

ggsave("Figures/nMDS_TreMs_Bav.png", plot = GGplot_NMDS_TreMs_Bav, width = 9, height = 10, units = "cm")


##ggplot

NMDS_TreMs_Bav <- data.frame(NMDS1 = ord_TreMs_Bav$points[,1], NMDS2 = ord_TreMs_Bav$points[,2], group = Data_plotxTreMs_Bav_env$class_depe_G)

df_ell_NMDS_TreMs_Bav <- data.frame() #sets up a data frame before running the function.
for(g in levels(NMDS_TreMs_Bav$group)){
  df_ell_NMDS_TreMs_Bav <- rbind(df_ell_NMDS_TreMs_Bav, cbind(as.data.frame(with(NMDS_TreMs_Bav [NMDS_TreMs_Bav$group==g,],
                                                         veganCovEllipse(cov.wt(cbind(NMDS1,NMDS2),wt=rep(1/length(NMDS1),length(NMDS1)))$cov,center=c(mean(NMDS1),mean(NMDS2))))) ,group=g))
}

NMDS_TreMs_Bav.mean <- aggregate(NMDS_TreMs_Bav[,1:2], list(group=NMDS_TreMs_Bav$group), mean)
segments_TreMs_Bav <- merge(NMDS_TreMs_Bav,NMDS_TreMs_Bav.mean, by="group", suffixes = c("",".centroid"))


GGplot_NMDS_TreMs_Bav <- ggplot(NMDS_TreMs_Bav, aes(NMDS1, NMDS2)) +
  geom_point(size = 2, aes(color = group, shape=group)) +
  geom_path(data = df_ell_NMDS_TreMs_Bav, aes(x = NMDS1, y = NMDS2, group = group, color = group), size = 1)+
  theme_classic() +
  scale_color_manual(values = c("[0 ; 15]" = "#E9A7D6", "]15 ; 40]" = "#AE3E8D", "]70 ; 100]" = "#78205E")) +
  labs(colour = "Forest\nmortality", shape = "Forest\nmortality") +
  theme(legend.position="bottom") +
  theme(legend.position="bottom", plot.subtitle = element_text(color="grey20", size=10, face="italic")) +
  ggtitle(label= "Spruce-dominated forests", subtitle = "Tree-related microhabitats") +
  xlim(-0.5,0.5) +
  ylim(-0.5,0.5) +
  annotate(geom = "text", label = "p < 0.001 ***\nstress = 0.036", x = 0, y = 0.4, hjust = 0)
GGplot_NMDS_TreMs_Bav

ggsave("Figures/nMDS_TreMs_Bav.png", plot = GGplot_NMDS_TreMs_Bav, width = 10, height = 10, units = "cm")




#Adonis
set.seed(1)
adonis2(dist_TreMs_Bav ~ cat_depe01, data = Data_plotxTreMs_Bav_env)
set.seed(1)
adonis2(dist_TreMs_Bav ~ level_depe_G, data = Data_plotxTreMs_Bav_env)
set.seed(1)
adonis2(dist_TreMs_Bav ~ class_depe_G, data = Data_plotxTreMs_Bav_env)



#Anosim
ANOSIM_TreMs_Bav <- anosim(dist_TreMs_Bav, Data_plotxTreMs_Bav_env$class_depe_G)
summary(ANOSIM_TreMs_Bav)
plot(ANOSIM_TreMs_Bav)

#Anosim comparison
df_ANOSIM_TreMs_Bav <- as.data.frame(cbind(ANOSIM_TreMs_Bav$dis.rank, as.character(ANOSIM_TreMs_Bav$class.vec)))
df_ANOSIM_TreMs_Bav$V1  <- as.numeric(df_ANOSIM_TreMs_Bav$V1)

df_ANOSIM_TreMs_Bav = filter(df_ANOSIM_TreMs_Bav, V2 != "Between")
df_ANOSIM_TreMs_Bav$V2 = factor(df_ANOSIM_TreMs_Bav$V2, levels = c("[0 ; 15]", "]15 ; 40]", "]70 ; 100]"), labels = c("[0 ; 15]", "]15 ; 40]", "]70 ; 100]"))

ggplot(df_ANOSIM_TreMs_Bav, aes(x = V2, y = V1)) +
  geom_boxplot(notch = T)

hist(df_ANOSIM_TreMs_Bav$V1)
fit1<-fitdist(df_ANOSIM_TreMs_Bav$V1, "norm", start = NULL)
gofstat(fit1)$chisqpvalue
summary(lm(normalize(V1, "scale") ~ V2, data = df_ANOSIM_TreMs_Bav))
# plot(lm(normalize(V1, "scale") ~ V2, data = df_ANOSIM_TreMs_Bav))

Bav_anosim_TreMs_lm = lm(V1 ~ V2, data = df_ANOSIM_TreMs_Bav)
Bav_anosim_TreMs_emmeans <- emmeans(Bav_anosim_TreMs_lm, "V2")
pairs(Bav_anosim_TreMs_emmeans)

summarySE_ANOSIM_TreMs_Bav = summarySE(data = df_ANOSIM_TreMs_Bav, measurevar = "V1", groupvars = "V2")

plot_ANOSIM_TreMs_Bav = ggplot(summarySE_ANOSIM_TreMs_Bav, aes(x = V2, y = V1)) + geom_bar(stat="identity", alpha = 0.8, width = 0.5, aes(fill = V2)) + geom_errorbar(aes(ymin = V1 - se, ymax = V1 + se), size = 0.8, width = .1) + scale_fill_manual(values = c("[0 ; 15]" = "#E9A7D6", "]15 ; 40]" = "#AE3E8D", "]70 ; 100]" = "#78205E")) + theme_bw() + theme(legend.position = "none") + labs(y="Dissimilarity value\n(intra-class)", x = "Forest mortality") + ylim(0, 100) + geom_segment(aes(x=1, y=87.5, xend=3, yend=87.5)) + annotate(geom = "text", label = "ns", x = 2, y = 94) + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + ggtitle(label= "Spruce-dominated forests", subtitle = "TreMs - β-diversity")
plot_ANOSIM_TreMs_Bav

ggsave("Figures/plot_ANOSIM_TreMs_Bav.png", plot = plot_ANOSIM_TreMs_Bav, units = "cm", width = 8, height=8, type = "cairo")
# ggsave("Figures/plot_ANOSIM_TreMs_Bav.pdf", plot = plot_ANOSIM_TreMs_Bav, units = "cm", width = 8, height=8)

#Simper
summary(simper(Data_plotxTreMs_Bav_env[2:27], Data_plotxTreMs_Bav_env$class_depe_G, permutations = 999), ordered = T)

#Indval
set.seed(1)
Indval_TreMs_Bav <-  multipatt(Data_plotxTreMs_Bav_env[2:27], Data_plotxTreMs_Bav_env$class_depe_G, control = how(nperm=999), func = "IndVal.g", duleg=1)
summary(Indval_TreMs_Bav, indvalcomp=TRUE)

```



####Adipart
```{r}

# [0 ; 15]
y_adipart_TreMs_Bav_0_15 = Data_plotxTreMs_Bav_env %>%
  dplyr::filter(class_depe_G == "[0 ; 15]")

x_adipart_TreMs_Bav_0_15 = y_adipart_TreMs_Bav_0_15 %>%
  dplyr::select("plot", "site", "class_depe_G")
y_adipart_TreMs_Bav_0_15 = round(y_adipart_TreMs_Bav_0_15[2:27])

adipart(y_adipart_TreMs_Bav_0_15 ~ plot + class_depe_G, x_adipart_TreMs_Bav_0_15, index="richness", nsimul=999, relative = F, weighted = T)

adipart(y_adipart_TreMs_Bav_0_15 ~ plot + class_depe_G, x_adipart_TreMs_Bav_0_15, index="richness", nsimul=999, relative = T, weighted = T)



# ]15 ; 40]
y_adipart_TreMs_Bav_15_40 = Data_plotxTreMs_Bav_env %>%
  dplyr::filter(class_depe_G == "]15 ; 40]")

x_adipart_TreMs_Bav_15_40 = y_adipart_TreMs_Bav_15_40 %>%
  dplyr::select("plot", "site", "class_depe_G")
y_adipart_TreMs_Bav_15_40 = round(y_adipart_TreMs_Bav_15_40[2:27])

adipart(y_adipart_TreMs_Bav_15_40 ~ plot + class_depe_G, x_adipart_TreMs_Bav_15_40, index="richness", nsimul=999, relative = F, weighted = T)

adipart(y_adipart_TreMs_Bav_15_40 ~ plot + class_depe_G, x_adipart_TreMs_Bav_15_40, index="richness", nsimul=999, relative = T, weighted = T)



# ]70 ; 100]
y_adipart_TreMs_Bav_70_100 = Data_plotxTreMs_Bav_env %>%
  dplyr::filter(class_depe_G == "]70 ; 100]")

x_adipart_TreMs_Bav_70_100 = y_adipart_TreMs_Bav_70_100 %>%
  dplyr::select("plot", "site", "class_depe_G")
y_adipart_TreMs_Bav_70_100 = round(y_adipart_TreMs_Bav_70_100[2:27])

adipart(y_adipart_TreMs_Bav_70_100 ~ plot + class_depe_G, x_adipart_TreMs_Bav_70_100, index="richness", nsimul=999, relative = F, weighted = T)

adipart(y_adipart_TreMs_Bav_70_100 ~ plot + class_depe_G, x_adipart_TreMs_Bav_70_100, index="richness", nsimul=999, relative = T, weighted = T)


```





## Construction figure Adipart


```{r construction figure Adipart}


#Relatif

Tab_results_adipart_DW_TreMs <- readxl::read_xlsx("Tab_result_habitat_study.xlsx", sheet = "Adipart_relative")


Tab_results_adipart_DW_TreMs$type = factor(Tab_results_adipart_DW_TreMs$type, levels = c("[0 ; 10]", "[0 ; 15]", "]10 ; 40]", "]15 ; 40]", "]40 ; 70]", "]70 ; 100]"))

Tab_results_adipart_DW_TreMs$Biodiv_part = factor(Tab_results_adipart_DW_TreMs$Biodiv_part, levels = c("Alpha.1", "Beta.1", "Beta.2"))
Tab_results_adipart_DW_TreMs$Biodiv_part = fct_rev(Tab_results_adipart_DW_TreMs$Biodiv_part)
Tab_results_adipart_DW_TreMs$habitat = fct_rev(Tab_results_adipart_DW_TreMs$habitat)


# Adipart_DW_TreMs_CVL = ggplot(filter(Tab_results_adipart_DW_TreMs, Context %in% "Loire"), aes(x = Biodiv_part, y = mean)) + coord_flip() + geom_hline(yintercept = 0, linetype = 2) + geom_errorbar(aes(ymin = CI2.5, ymax = CI97.5, color = type), size = 0.7, width = 0, alpha = 0.7, position = position_dodge(width = -0.75)) + geom_point(aes(color = type), size = 2.5, alpha = 0.7, position = position_dodge(width = -0.75)) + theme_bw() + facet_grid(habitat ~ ., space = "free", scales = "free") + theme(axis.title.y = element_blank(), plot.subtitle = element_text(color="grey20", size=10, face="italic")) + scale_color_manual(values = c("#66B64A", "#B83A3A")) + labs(y = "Relative additive partition of γ diversity\n(+/- 95% Confidence Interval)", color = "Group") + ggtitle(label = "Relative additive partition of γ diversity", subtitle = "Loire")
# 
# Adipart_DW_TreMs_CVL
# ggsave("Figures/Adipart_DW_TreMs_CVL.pdf", plot = Adipart_DW_TreMs_CVL, width = 14, height = 10, units = "cm")


# Adipart_DW_TreMs_Pyr = ggplot(filter(Tab_results_adipart_DW_TreMs, Context %in% "Pyrenees"), aes(x = Biodiv_part, y = mean)) + coord_flip() + geom_hline(yintercept = 0, linetype = 2) + geom_errorbar(aes(ymin = CI2.5, ymax = CI97.5, color = type), size = 0.7, width = 0, alpha = 0.7, position = position_dodge(width = -0.75)) + geom_point(aes(color = type), size = 2.5, alpha = 0.7, position = position_dodge(width = -0.75)) + theme_bw() + facet_grid(habitat ~ ., space = "free", scales = "free") + theme(axis.title.y = element_blank(), plot.subtitle = element_text(color="grey20", size=10, face="italic")) + scale_color_manual(values = c("#66B64A", "#B83A3A")) + labs(y = "Relative additive partition of γ diversity\n(+/- 95% Confidence Interval)", color = "Group") + ggtitle(label = "Relative additive partition of γ diversity", subtitle = "Pyrenees")
# 
# Adipart_DW_TreMs_Pyr
# ggsave("Figures/Adipart_DW_TreMs_Pyr.pdf", plot = Adipart_DW_TreMs_Pyr, width = 14, height = 10, units = "cm")




#Absolue
library(viridis)

Tab_results_adipart_DW_TreMs_absol <- readxl::read_xlsx("Tab_result_habitat_study.xlsx", sheet = "Adipart_absol")


Tab_results_adipart_DW_TreMs_absol$type = factor(Tab_results_adipart_DW_TreMs_absol$type, levels = c("[0 ; 10]", "[0 ; 15]", "]10 ; 40]", "]15 ; 40]", "]40 ; 70]", "]70 ; 100]"))

Tab_results_adipart_DW_TreMs_absol$Biodiv_part = factor(Tab_results_adipart_DW_TreMs_absol$Biodiv_part, levels = c("Alpha.1", "Beta.1", "Beta.2"))
# Tab_results_adipart_DW_TreMs_absol$Biodiv_part = fct_rev(Tab_results_adipart_DW_TreMs_absol$Biodiv_part)
Tab_results_adipart_DW_TreMs_absol$habitat = fct_rev(Tab_results_adipart_DW_TreMs_absol$habitat)


#CVL
Adipart_DW_TreMs_CVL_bar = ggplot(filter(Tab_results_adipart_DW_TreMs_absol, Context %in% "Oak"), aes(x = type, y = mean, fill = Biodiv_part)) + geom_bar(position = "stack", stat = "identity", width = 0.5, alpha = 0.8) + theme_bw() + facet_grid(habitat ~ ., scales = "free") + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + labs(y = "Additive partition of γ diversity", fill = "Diversity\npartition", x = "Dieback") + scale_fill_viridis(discrete = T) + ggtitle(label = "Additive partition of γ diversity", subtitle = "Oak-dominated forests")

Adipart_DW_TreMs_CVL_bar
ggsave("Figures/Adipart_DW_TreMs_CVL_bar.png", plot = Adipart_DW_TreMs_CVL_bar, width = 10, height = 10, units = "cm", type = "cairo")



#Pyr
Adipart_DW_TreMs_Pyr_bar = ggplot(filter(Tab_results_adipart_DW_TreMs_absol, Context %in% "Fir"), aes(x = type, y = mean, fill = Biodiv_part)) + geom_bar(position = "stack", stat = "identity", width = 0.5, alpha = 0.8) + theme_bw() + facet_grid(habitat ~ ., scales = "free") + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + labs(y = "Additive partition of γ diversity", fill = "Diversity\npartition", x = "Dieback") + scale_fill_viridis(discrete = T) + ggtitle(label = "Additive partition of γ diversity", subtitle = "Fir-dominated forests")

Adipart_DW_TreMs_Pyr_bar
ggsave("Figures/Adipart_DW_TreMs_Pyr_bar.png", plot = Adipart_DW_TreMs_Pyr_bar, width = 10, height = 10, units = "cm", type = "cairo")



#Bav
Adipart_DW_TreMs_Bav_bar = ggplot(filter(Tab_results_adipart_DW_TreMs_absol, Context %in% "Spruce"), aes(x = type, y = mean, fill = Biodiv_part)) + geom_bar(position = "stack", stat = "identity", width = 0.5, alpha = 0.8) + theme_bw() + facet_grid(habitat ~ ., scales = "free") + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + labs(y = "Additive partition of γ diversity", fill = "Diversity\npartition", x = "Dieback") + scale_fill_viridis(discrete = T) + ggtitle(label = "Additive partition of γ diversity", subtitle = "Spruce-dominated forests")

Adipart_DW_TreMs_Bav_bar
ggsave("Figures/Adipart_DW_TreMs_Bav_bar.png", plot = Adipart_DW_TreMs_Bav_bar, width = 10, height = 10, units = "cm", type = "cairo")






#CVL
Adipart_DW_TreMs_CVL_bar_rel = ggplot(filter(Tab_results_adipart_DW_TreMs_absol, Context %in% "Oak"), aes(x = type, y = mean, fill = Biodiv_part)) + geom_bar(position = "fill", stat = "identity", width = 0.5, alpha = 0.8) + theme_bw() + facet_grid(habitat ~ ., scales = "free") + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + labs(y = "Additive partition of γ diversity", fill = "Diversity\npartition", x = "Dieback") + scale_fill_viridis(discrete = T) + ggtitle(label = "Additive partition of γ diversity", subtitle = "Oak-dominated forests")

Adipart_DW_TreMs_CVL_bar_rel
ggsave("Figures/Adipart_DW_TreMs_CVL_bar_rel.png", plot = Adipart_DW_TreMs_CVL_bar_rel, width = 10, height = 10, units = "cm", type = "cairo")


#Pyr
Adipart_DW_TreMs_Pyr_bar_rel = ggplot(filter(Tab_results_adipart_DW_TreMs_absol, Context %in% "Fir"), aes(x = type, y = mean, fill = Biodiv_part)) + geom_bar(position = "fill", stat = "identity", width = 0.5, alpha = 0.8) + theme_bw() + facet_grid(habitat ~ ., scales = "free") + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + labs(y = "Additive partition of γ diversity", fill = "Diversity\npartition", x = "Dieback") + scale_fill_viridis(discrete = T) + ggtitle(label = "Additive partition of γ diversity", subtitle = "Fir-dominated forests")

Adipart_DW_TreMs_Pyr_bar_rel
ggsave("Figures/Adipart_DW_TreMs_Pyr_bar_rel.png", plot = Adipart_DW_TreMs_Pyr_bar_rel, width = 10, height = 10, units = "cm", type = "cairo")


#Bav
Adipart_DW_TreMs_Bav_bar_rel = ggplot(filter(Tab_results_adipart_DW_TreMs_absol, Context %in% "Spruce"), aes(x = type, y = mean, fill = Biodiv_part)) + geom_bar(position = "fill", stat = "identity", width = 0.5, alpha = 0.8) + theme_bw() + facet_grid(habitat ~ ., scales = "free") + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + labs(y = "Additive partition of γ diversity", fill = "Diversity\npartition", x = "Dieback") + scale_fill_viridis(discrete = T) + ggtitle(label = "Additive partition of γ diversity", subtitle = "Spruce-dominated forests")

Adipart_DW_TreMs_Bav_bar_rel
ggsave("Figures/Adipart_DW_TreMs_Bav_bar_rel.png", plot = Adipart_DW_TreMs_Bav_bar_rel, width = 10, height = 10, units = "cm", type = "cairo")


```




#Lien entre DW et TreMs


```{r Procrustes}

#CVL
procrustes_CVL <- procrustes(ord_DW_CVL, ord_TreMs_CVL)
procrustes_CVL
summary(procrustes_CVL)
plot(procrustes_CVL, kind=1, type = "text")
plot(procrustes_CVL, kind=2)
residuals(procrustes_CVL)

protest_CVL <- protest(ord_DW_CVL, ord_TreMs_CVL)
protest_CVL
summary(protest_CVL)

protest_CVL <- protest(dist_DW_CVL, dist_TreMs_CVL)
protest_CVL
summary(protest_CVL)


#Pyr
procrustes_Pyr <- procrustes(ord_DW_CLIMTREE_Pyr, ord_TreMs_Pyr)
summary(procrustes_Pyr)
plot(procrustes_Pyr, kind=1, type = "text")
plot(procrustes_Pyr, kind=2)
residuals(procrustes_Pyr)

protest_Pyr <- protest(ord_DW_CLIMTREE_Pyr, ord_TreMs_Pyr)
protest_Pyr
summary(protest_Pyr)

protest_Pyr <- protest(dist_DW_Pyrenees, dist_TreMs_Pyr)
protest_Pyr
summary(protest_Pyr)



#Bav
procrustes_Bav <- procrustes(ord_DW_CLIMTREE_Bav, ord_TreMs_Bav)
summary(procrustes_Bav)
plot(procrustes_Bav, kind=1, type = "text")
plot(procrustes_Bav, kind=2)
residuals(procrustes_Bav)

protest_Bav <- protest(ord_DW_CLIMTREE_Bav, ord_TreMs_Bav)
protest_Bav
summary(protest_Bav)

protest_Bav <- protest(dist_DW_Bav, dist_TreMs_Bav)
protest_Bav
summary(protest_Bav)

```





#SEM


###SEM Pyrenees


####mod_DW
```{r SEM Pyrenees}

Data_univar_CWM_Pyrenees_SEM = Data_univar_CWM %>%
  filter(Region %in% "Pyrenees") %>%
  dplyr::rename("FRic_DW" = "FRic", "FDiv_DW" = "FDiv", "FEve_DW" = "FEve", "FDis_DW" = "FDis")


#LW_vol
mod_Pyr_LW_vol_level_depe_G = lme(fixed = log1p(LW_vol) ~ level_depe_G, random = ~ 1|site, data = Data_univar_CWM_Pyrenees_SEM)
summary(mod_Pyr_LW_vol_level_depe_G)
res = simulateResiduals(mod_Pyr_LW_vol_level_depe_G)
plot(res, rank = T)


#DW_vol
mod_Pyr_DW_vol_level_depe_G = lm(log1p(DW_vol) ~ level_depe_G, data = Data_univar_CWM_Pyrenees_SEM)
summary(mod_Pyr_DW_vol_level_depe_G)
res = simulateResiduals(mod_Pyr_DW_vol_level_depe_G)
plot(res, rank = T)


#DW_dec12
mod_Pyr_DW_dec12_level_depe_G = lm(log1p(DW_dec12) ~ level_depe_G, data = Data_univar_CWM_Pyrenees_SEM)
summary(mod_Pyr_DW_dec12_level_depe_G)
res = simulateResiduals(mod_Pyr_DW_dec12_level_depe_G)
plot(res, rank = T)


#DW_dec34
mod_Pyr_DW_dec34_level_depe_G = lm(log1p(DW_dec34) ~ level_depe_G, data = Data_univar_CWM_Pyrenees_SEM)
summary(mod_Pyr_DW_dec34_level_depe_G)
res = simulateResiduals(mod_Pyr_DW_dec34_level_depe_G)
plot(res, rank = T)


#DW_PBBM
mod_Pyr_DW_PBBM_level_depe_G = lm(log1p(DW_PBBM) ~ level_depe_G, data = Data_univar_CWM_Pyrenees_SEM)
summary(mod_Pyr_DW_PBBM_level_depe_G)
res = simulateResiduals(mod_Pyr_DW_PBBM_level_depe_G)
plot(res, rank = T)


#DW_GBTGB
mod_Pyr_DW_GBTGB_level_depe_G = lm(log1p(DW_GBTGB) ~ level_depe_G, data = Data_univar_CWM_Pyrenees_SEM)
summary(mod_Pyr_DW_GBTGB_level_depe_G)
res = simulateResiduals(mod_Pyr_DW_GBTGB_level_depe_G)
plot(res, rank = T)


#DW_BMS
mod_Pyr_DW_BMS_level_depe_G = lm(log1p(DW_BMS) ~ level_depe_G, data = Data_univar_CWM_Pyrenees_SEM)
summary(mod_Pyr_DW_BMS_level_depe_G)
res = simulateResiduals(mod_Pyr_DW_BMS_level_depe_G)
plot(res, rank = T)


#DW_BMD
mod_Pyr_DW_BMD_level_depe_G = lm(log1p(DW_BMD) ~ level_depe_G, data = Data_univar_CWM_Pyrenees_SEM)
summary(mod_Pyr_DW_BMD_level_depe_G)
res = simulateResiduals(mod_Pyr_DW_BMD_level_depe_G)
plot(res, rank = T)


#DW_div_tot
mod_Pyr_DW_div_tot_level_depe_G = lm(log1p(DW_div_tot) ~ level_depe_G, data = Data_univar_CWM_Pyrenees_SEM)
summary(mod_Pyr_DW_div_tot_level_depe_G)
res = simulateResiduals(mod_Pyr_DW_div_tot_level_depe_G)
plot(res, rank = T)


#FRic_DW
mod_Pyr_FRic_level_depe_G = lm(FRic_DW ~ level_depe_G, data = Data_univar_CWM_Pyrenees_SEM)
summary(mod_Pyr_FRic_level_depe_G)
res = simulateResiduals(mod_Pyr_FRic_level_depe_G)
plot(res, rank = T)


#FDiv_DW
mod_Pyr_FDiv_level_depe_G = lm(FDiv_DW ~ level_depe_G, data = Data_univar_CWM_Pyrenees_SEM)
summary(mod_Pyr_FDiv_level_depe_G)
res = simulateResiduals(mod_Pyr_FDiv_level_depe_G)
plot(res, rank = T)


#FEve_DW
mod_Pyr_FEve_level_depe_G = lm(FEve_DW ~ level_depe_G, data = Data_univar_CWM_Pyrenees_SEM)
summary(mod_Pyr_FEve_level_depe_G)
res = simulateResiduals(mod_Pyr_FEve_level_depe_G)
plot(res, rank = T)


#FDis_DW
mod_Pyr_FDis_level_depe_G = lm(FDis_DW ~ level_depe_G, data = Data_univar_CWM_Pyrenees_SEM)
summary(mod_Pyr_FDis_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_level_depe_G)
plot(res, rank = T)


#CWM_statut
mod_Pyr_CWM_statut_level_depe_G = lme(fixed = CWM_statut ~ level_depe_G, random = ~ 1|site, data = na.omit(Data_univar_CWM_Pyrenees_SEM))
summary(mod_Pyr_CWM_statut_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_statut_level_depe_G)
plot(res, rank = T)


#FDis_statut
mod_Pyr_FDis_statut_level_depe_G = lm(log1p(FDis_statut) ~ level_depe_G, data = Data_univar_CWM_Pyrenees_SEM)
summary(mod_Pyr_FDis_statut_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_statut_level_depe_G)
plot(res, rank = T)


#CWM_stade_saprox
mod_Pyr_CWM_stade_saprox_level_depe_G = lm(CWM_stade_saprox ~ level_depe_G, data = Data_univar_CWM_Pyrenees_SEM)
summary(mod_Pyr_CWM_stade_saprox_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_stade_saprox_level_depe_G)
plot(res, rank = T)


#FDis_stade_saprox
mod_Pyr_FDis_stade_saprox_level_depe_G = lm(log1p(FDis_stade_saprox) ~ level_depe_G, data = Data_univar_CWM_Pyrenees_SEM)
summary(mod_Pyr_FDis_stade_saprox_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_stade_saprox_level_depe_G)
plot(res, rank = T)


#CWM_dbh
mod_Pyr_CWM_dbh_level_depe_G = lm(CWM_dbh ~ level_depe_G, data = Data_univar_CWM_Pyrenees_SEM)
summary(mod_Pyr_CWM_dbh_level_depe_G)
res = simulateResiduals(mod_Pyr_CWM_dbh_level_depe_G)
plot(res, rank = T)


#FDis_dbh
mod_Pyr_FDis_dbh_level_depe_G = lm(FDis_dbh ~ level_depe_G, data = Data_univar_CWM_Pyrenees_SEM)
summary(mod_Pyr_FDis_dbh_level_depe_G)
res = simulateResiduals(mod_Pyr_FDis_dbh_level_depe_G)
plot(res, rank = T)

```
####


####mod_TreMs
```{r mod_TreMs}

Data_univar_CWM_TreMs_Pyr_SEM = Data_univar_CWM_TreMs_All %>%
  filter(Region %in% "Pyrenees") %>%
  dplyr::rename("FRic_TreMs" = "FRic", "FDiv_TreMs" = "FDiv", "FEve_TreMs" = "FEve", "FDis_TreMs" = "FDis") %>%
  dplyr::select(-"Region",-"site",-"alt",-"lat",-"lon",-"cat_depe",-"salvaged",-"cat_depe01",-"level_depe_G",-"class_depe_G", -"LW_nb")


Data_univar_SEM_Pyrenees =  Data_univar_CWM_Pyrenees_SEM %>%
  left_join(Data_univar_CWM_TreMs_Pyr_SEM, by = c("plot")) %>%
  mutate(log_LW_vol = log1p(LW_vol), log_DW_vol = log1p(DW_vol), log_DW_dec12 = log1p(DW_dec12), log_DW_dec34 = log1p(DW_dec34), log_DW_PBBM = log1p(DW_PBBM), log_DW_GBTGB = log1p(DW_GBTGB), log_DW_BMS = log1p(DW_BMS), log_DW_BMD = log1p(DW_BMD), log_DW_div_tot = log1p(DW_div_tot), log_FDis_statut = log1p(FDis_statut), log_CWM_stade_saprox = log1p(CWM_stade_saprox), log_FDis_stade_saprox = log1p(FDis_stade_saprox),
         log_TreMs_ab = log1p(TreMs_ab), log_TreMs_div = log1p(TreMs_div), log_Exposed_sapwood_only = log1p(Exposed_sapwood_only), log_Epiphytic = log1p(Epiphytic), log_Exposed_sapwood_and_heartwood = log1p(Exposed_sapwood_and_heartwood), log_Concavities = log1p(Concavities), log_Perennial_fungi_fruiting_bodies = log1p(Perennial_fungi_fruiting_bodies), log_Twig_tangles = log1p(Twig_tangles), log_Crown_deadwood = log1p(Crown_deadwood), log_Rot_holes = log1p(Rot_holes), log_Burrs_and_cankers = log1p(Burrs_and_cankers), log_Ephemeral_fungal_fruiting_bodies = log1p(Ephemeral_fungal_fruiting_bodies), log_FDis_POS = log1p(FDis_POS))



# level.depe + log_LW_vol + log_DW_dec12 + log_DW_dec34 + log_DW_PBBM + log_DW_GBTGB + log_DW_BMS + log_DW_BMD + log_DW_div_tot + CWM_statut + log_FDis_statut + log_CWM_stade_saprox + log_FDis_stade_saprox + CWM_dbh + FDis_dbh


#TreMs_ab
mod_Pyr_TreMs_ab_level.depe = lm(log1p(TreMs_ab) ~ log_LW_vol + log_CWM_stade_saprox + CWM_dbh, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_TreMs_ab_level.depe)
summary(mod_Pyr_TreMs_ab_level.depe)

mod_Pyr_TreMs_ab_level.depe_dredge = dredge(mod_Pyr_TreMs_ab_level.depe)
head(mod_Pyr_TreMs_ab_level.depe_dredge)
res = simulateResiduals(mod_Pyr_TreMs_ab_level.depe)
plot(res, rank = T)


#TreMs_div
mod_Pyr_TreMs_div_level.depe = lm(log1p(TreMs_div) ~ log_DW_BMD, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_TreMs_div_level.depe)
summary(mod_Pyr_TreMs_div_level.depe)

mod_Pyr_TreMs_div_level.depe_dredge = dredge(mod_Pyr_TreMs_div_level.depe)
head(mod_Pyr_TreMs_div_level.depe_dredge)
res = simulateResiduals(mod_Pyr_TreMs_div_level.depe)
plot(res, rank = T)


#Exposed_sapwood_only
mod_Pyr_Exposed_sapwood_only_level.depe = lm(log1p(Exposed_sapwood_only) ~ log_DW_PBBM, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_Exposed_sapwood_only_level.depe)
summary(mod_Pyr_Exposed_sapwood_only_level.depe)

mod_Pyr_Exposed_sapwood_only_level.depe_dredge = dredge(mod_Pyr_Exposed_sapwood_only_level.depe)
head(mod_Pyr_Exposed_sapwood_only_level.depe_dredge)
res = simulateResiduals(mod_Pyr_Exposed_sapwood_only_level.depe)
plot(res, rank = T)


#Epiphytic
mod_Pyr_Epiphytic_level.depe = lm(log1p(Epiphytic) ~ level.depe + CWM_dbh, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_Epiphytic_level.depe)
summary(mod_Pyr_Epiphytic_level.depe)

mod_Pyr_Epiphytic_level.depe_dredge = dredge(mod_Pyr_Epiphytic_level.depe)
head(mod_Pyr_Epiphytic_level.depe_dredge)
res = simulateResiduals(mod_Pyr_Epiphytic_level.depe)
plot(res, rank = T)


#Exposed_sapwood_and_heartwood
mod_Pyr_Exposed_sapwood_and_heartwood_level.depe = lm(log1p(Exposed_sapwood_and_heartwood) ~ log_CWM_stade_saprox, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_Exposed_sapwood_and_heartwood_level.depe)
summary(mod_Pyr_Exposed_sapwood_and_heartwood_level.depe)

mod_Pyr_Exposed_sapwood_and_heartwood_level.depe_dredge = dredge(mod_Pyr_Exposed_sapwood_and_heartwood_level.depe)
head(mod_Pyr_Exposed_sapwood_and_heartwood_level.depe_dredge)
res = simulateResiduals(mod_Pyr_Exposed_sapwood_and_heartwood_level.depe)
plot(res, rank = T)


#Concavities
mod_Pyr_Concavities_level.depe = lm(log1p(Concavities) ~ log_LW_vol + log_DW_PBBM, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_Concavities_level.depe)
summary(mod_Pyr_Concavities_level.depe)

mod_Pyr_Concavities_level.depe_dredge = dredge(mod_Pyr_Concavities_level.depe)
head(mod_Pyr_Concavities_level.depe_dredge)
res = simulateResiduals(mod_Pyr_Concavities_level.depe)
plot(res, rank = T)


#Perennial_fungi_fruiting_bodies
mod_Pyr_Perennial_fungi_fruiting_bodies_level.depe = lm(log1p(Perennial_fungi_fruiting_bodies) ~ log_DW_PBBM, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_Perennial_fungi_fruiting_bodies_level.depe)
summary(mod_Pyr_Perennial_fungi_fruiting_bodies_level.depe)

mod_Pyr_Perennial_fungi_fruiting_bodies_level.depe_dredge = dredge(mod_Pyr_Perennial_fungi_fruiting_bodies_level.depe)
head(mod_Pyr_Perennial_fungi_fruiting_bodies_level.depe_dredge)
res = simulateResiduals(mod_Pyr_Perennial_fungi_fruiting_bodies_level.depe)
plot(res, rank = T)


#Twig_tangles
mod_Pyr_Twig_tangles_level.depe = lm(log1p(Twig_tangles) ~ level.depe + log_CWM_stade_saprox, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_Twig_tangles_level.depe)
summary(mod_Pyr_Twig_tangles_level.depe)

mod_Pyr_Twig_tangles_level.depe_dredge = dredge(mod_Pyr_Twig_tangles_level.depe)
head(mod_Pyr_Twig_tangles_level.depe_dredge)
res = simulateResiduals(mod_Pyr_Twig_tangles_level.depe)
plot(res, rank = T)


#Crown_deadwood
mod_Pyr_Crown_deadwood_level.depe = lm(log1p(Crown_deadwood) ~ log_LW_vol, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_Crown_deadwood_level.depe)
summary(mod_Pyr_Crown_deadwood_level.depe)

mod_Pyr_Crown_deadwood_level.depe_dredge = dredge(mod_Pyr_Crown_deadwood_level.depe)
head(mod_Pyr_Crown_deadwood_level.depe_dredge)
res = simulateResiduals(mod_Pyr_Crown_deadwood_level.depe)
plot(res, rank = T)


#Rot_holes
mod_Pyr_Rot_holes_level.depe = lm(log1p(Rot_holes) ~ level.depe, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_Rot_holes_level.depe)
summary(mod_Pyr_Rot_holes_level.depe)

mod_Pyr_Rot_holes_level.depe_dredge = dredge(mod_Pyr_Rot_holes_level.depe)
head(mod_Pyr_Rot_holes_level.depe_dredge)
res = simulateResiduals(mod_Pyr_Rot_holes_level.depe)
plot(res, rank = T)


#Burrs_and_cankers
mod_Pyr_Burrs_and_cankers_level.depe = lm(log1p(Burrs_and_cankers) ~ log_DW_BMD + log_CWM_stade_saprox, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_Burrs_and_cankers_level.depe)
summary(mod_Pyr_Burrs_and_cankers_level.depe)

mod_Pyr_Burrs_and_cankers_level.depe_dredge = dredge(mod_Pyr_Burrs_and_cankers_level.depe)
head(mod_Pyr_Burrs_and_cankers_level.depe_dredge)
res = simulateResiduals(mod_Pyr_Burrs_and_cankers_level.depe)
plot(res, rank = T)


# #Exudates
# mod_Pyr_Exudates_level.depe = lm(log1p(Exudates) ~ level.depe, data = Data_univar_SEM_Pyrenees)
# summary(mod_Pyr_Exudates_level.depe)
# res = simulateResiduals(mod_Pyr_Exudates_level.depe)
# plot(res, rank = T)


# #Wood_pecker_breeding_cavities
# mod_Pyr_Wood_pecker_breeding_cavities_level.depe = lm(log1p(Wood_pecker_breeding_cavities) ~ level.depe, data = Data_univar_SEM_Pyrenees)
# summary(mod_Pyr_Wood_pecker_breeding_cavities_level.depe)
# res = simulateResiduals(mod_Pyr_Wood_pecker_breeding_cavities_level.depe)
# plot(res, rank = T)


#Ephemeral_fungal_fruiting_bodies
mod_Pyr_Ephemeral_fungal_fruiting_bodies_level.depe = lm(log1p(Ephemeral_fungal_fruiting_bodies) ~ log_DW_BMD + log_DW_BMS + log_DW_GBTGB, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_Ephemeral_fungal_fruiting_bodies_level.depe)
summary(mod_Pyr_Ephemeral_fungal_fruiting_bodies_level.depe)

mod_Pyr_Ephemeral_fungal_fruiting_bodies_level.depe_dredge = dredge(mod_Pyr_Ephemeral_fungal_fruiting_bodies_level.depe)
head(mod_Pyr_Ephemeral_fungal_fruiting_bodies_level.depe_dredge)
res = simulateResiduals(mod_Pyr_Ephemeral_fungal_fruiting_bodies_level.depe)
plot(res, rank = T)


# #Rootplate
# mod_Pyr_Rootplate_level.depe = lm(log1p(Rootplate) ~ level.depe, data = Data_univar_SEM_Pyrenees)
# summary(mod_Pyr_Rootplate_level.depe)
# res = simulateResiduals(mod_Pyr_Rootplate_level.depe)
# plot(res, rank = T)


# #Nest
# mod_Pyr_Nest_level.depe = lm(log1p(Nest) ~ level.depe, data = Data_univar_SEM_Pyrenees)
# summary(mod_Pyr_Nest_level.depe)
# res = simulateResiduals(mod_Pyr_Nest_level.depe)
# plot(res, rank = T)


#FRic_TreMs
mod_Pyr_FRic_TreMs_level.depe = lme(fixed = FRic_TreMs ~ CWM_dbh + CWM_statut + log_DW_dec12 + log_DW_PBBM, random = ~ 1|site, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_FRic_TreMs_level.depe)
summary(mod_Pyr_FRic_TreMs_level.depe)

mod_Pyr_FRic_TreMs_level.depe_dredge = dredge(mod_Pyr_FRic_TreMs_level.depe)
head(mod_Pyr_FRic_TreMs_level.depe_dredge)
res = simulateResiduals(mod_Pyr_FRic_TreMs_level.depe)
plot(res, rank = T)


#FDiv_TreMs
mod_Pyr_FDiv_TreMs_level.depe = lm(FDiv_TreMs ~ level.depe + FDis_dbh, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_FDiv_TreMs_level.depe)
summary(mod_Pyr_FDiv_TreMs_level.depe)

mod_Pyr_FDiv_TreMs_level.depe_dredge = dredge(mod_Pyr_FDiv_TreMs_level.depe)
head(mod_Pyr_FDiv_TreMs_level.depe_dredge)
res = simulateResiduals(mod_Pyr_FDiv_TreMs_level.depe)
plot(res, rank = T)


#FEve_TreMs
mod_Pyr_FEve_TreMs_level.depe = lm(FEve_TreMs ~ 1, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_FEve_TreMs_level.depe)
summary(mod_Pyr_FEve_TreMs_level.depe)

mod_Pyr_FEve_TreMs_level.depe_dredge = dredge(mod_Pyr_FEve_TreMs_level.depe)
head(mod_Pyr_FEve_TreMs_level.depe_dredge)
res = simulateResiduals(mod_Pyr_FEve_TreMs_level.depe)
plot(res, rank = T)


#FDis_TreMs
mod_Pyr_FDis_TreMs_level.depe = lm(FDis_TreMs ~ level.depe, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_FDis_TreMs_level.depe)
summary(mod_Pyr_FDis_TreMs_level.depe)

mod_Pyr_FDis_TreMs_level.depe_dredge = dredge(mod_Pyr_FDis_TreMs_level.depe)
head(mod_Pyr_FDis_TreMs_level.depe_dredge)
res = simulateResiduals(mod_Pyr_FDis_TreMs_level.depe)
plot(res, rank = T)


#CWM_DW_type_substrate
mod_Pyr_CWM_DW_type_substrate_level.depe = lme(fixed = CWM_DW_type_substrate ~ level_depe_G + CWM_dbh + log_CWM_stade_saprox + nb_TGB_All_sub, random = ~ 1|site, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_CWM_DW_type_substrate_level.depe)
summary(mod_Pyr_CWM_DW_type_substrate_level.depe)

mod_Pyr_CWM_DW_type_substrate_level.depe_dredge = dredge(mod_Pyr_CWM_DW_type_substrate_level.depe)
head(mod_Pyr_CWM_DW_type_substrate_level.depe_dredge)
res = simulateResiduals(mod_Pyr_CWM_DW_type_substrate_level.depe)
plot(res, rank = T)


#FDis_DW_type_substrate
mod_Pyr_FDis_DW_type_substrate_level.depe = lm(FDis_DW_type_substrate ~ level_depe_G + log_DW_dec34, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_FDis_DW_type_substrate_level.depe)
summary(mod_Pyr_FDis_DW_type_substrate_level.depe)

mod_Pyr_FDis_DW_type_substrate_level.depe_dredge = dredge(mod_Pyr_FDis_DW_type_substrate_level.depe)
head(mod_Pyr_FDis_DW_type_substrate_level.depe_dredge)
res = simulateResiduals(mod_Pyr_FDis_DW_type_substrate_level.depe)
plot(res, rank = T)


#CWM_POS
mod_Pyr_CWM_POS_level.depe = lm(CWM_POS ~ log_LW_vol, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_CWM_POS_level.depe)
summary(mod_Pyr_CWM_POS_level.depe)

mod_Pyr_CWM_POS_level.depe_dredge = dredge(mod_Pyr_CWM_POS_level.depe)
head(mod_Pyr_CWM_POS_level.depe_dredge)
res = simulateResiduals(mod_Pyr_CWM_POS_level.depe)
plot(res, rank = T)


#FDis_POS
mod_Pyr_FDis_POS_level.depe = lm(log1p(FDis_POS) ~ level.depe + log_DW_PBBM, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_FDis_POS_level.depe)
summary(mod_Pyr_FDis_POS_level.depe)

mod_Pyr_FDis_POS_level.depe_dredge = dredge(mod_Pyr_FDis_POS_level.depe)
head(mod_Pyr_FDis_POS_level.depe_dredge)
res = simulateResiduals(mod_Pyr_FDis_POS_level.depe)
plot(res, rank = T)


#CWM_HUM_dry_wet
mod_Pyr_CWM_HUM_dry_wet_level.depe = lme(fixed = CWM_HUM_dry_wet ~ FDis_dbh + log_DW_BMS, random = ~1|site, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_CWM_HUM_dry_wet_level.depe)
summary(mod_Pyr_CWM_HUM_dry_wet_level.depe)

mod_Pyr_CWM_HUM_dry_wet_level.depe_dredge = dredge(mod_Pyr_CWM_HUM_dry_wet_level.depe)
head(mod_Pyr_CWM_HUM_dry_wet_level.depe_dredge)
res = simulateResiduals(mod_Pyr_CWM_HUM_dry_wet_level.depe)
plot(res, rank = T)


#FDis_HUM_dry_wet
mod_Pyr_FDis_HUM_dry_wet_level.depe = lm(FDis_HUM_dry_wet ~ CWM_statut + log_CWM_stade_saprox, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_FDis_HUM_dry_wet_level.depe)
summary(mod_Pyr_FDis_HUM_dry_wet_level.depe)

mod_Pyr_FDis_HUM_dry_wet_level.depe_dredge = dredge(mod_Pyr_FDis_HUM_dry_wet_level.depe)
head(mod_Pyr_FDis_HUM_dry_wet_level.depe_dredge)
res = simulateResiduals(mod_Pyr_FDis_HUM_dry_wet_level.depe)
plot(res, rank = T)


#CWM_LIFE
mod_Pyr_CWM_LIFE_level.depe = lm(CWM_LIFE ~ log_CWM_stade_saprox + log_DW_BMD + log_DW_GBTGB + log_LW_vol, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_CWM_LIFE_level.depe)
summary(mod_Pyr_CWM_LIFE_level.depe)

mod_Pyr_CWM_LIFE_level.depe_dredge = dredge(mod_Pyr_CWM_LIFE_level.depe)
head(mod_Pyr_CWM_LIFE_level.depe_dredge)
res = simulateResiduals(mod_Pyr_CWM_LIFE_level.depe)
plot(res, rank = T)


#FDis_LIFE
mod_Pyr_FDis_LIFE_level.depe = lm(FDis_LIFE ~ log_DW_BMD, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_FDis_LIFE_level.depe)
summary(mod_Pyr_FDis_LIFE_level.depe)

mod_Pyr_FDis_LIFE_level.depe_dredge = dredge(mod_Pyr_FDis_LIFE_level.depe)
head(mod_Pyr_FDis_LIFE_level.depe_dredge)
res = simulateResiduals(mod_Pyr_FDis_LIFE_level.depe)
plot(res, rank = T)

#CWM_ONTO
mod_Pyr_CWM_ONTO_level.depe = lm(CWM_ONTO ~ level.depe + log_DW_dec34, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_CWM_ONTO_level.depe)
summary(mod_Pyr_CWM_ONTO_level.depe)

mod_Pyr_CWM_ONTO_level.depe_dredge = dredge(mod_Pyr_CWM_ONTO_level.depe)
head(mod_Pyr_CWM_ONTO_level.depe_dredge)
res = simulateResiduals(mod_Pyr_CWM_ONTO_level.depe)
plot(res, rank = T)


#FDis_ONTO
mod_Pyr_FDis_ONTO_level.depe = lm(FDis_ONTO ~ level.depe + log_CWM_stade_saprox + log_DW_BMD + log_DW_PBBM, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_FDis_ONTO_level.depe)
summary(mod_Pyr_FDis_ONTO_level.depe)

mod_Pyr_FDis_ONTO_level.depe_dredge = dredge(mod_Pyr_FDis_ONTO_level.depe)
head(mod_Pyr_FDis_ONTO_level.depe_dredge)
res = simulateResiduals(mod_Pyr_FDis_ONTO_level.depe)
plot(res, rank = T)


#CWM_DW_saproxylic
mod_Pyr_CWM_DW_saproxylic_level.depe = lm(CWM_DW_saproxylic ~ log_DW_dec12 + log_DW_div_tot, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_CWM_DW_saproxylic_level.depe)
summary(mod_Pyr_CWM_DW_saproxylic_level.depe)

mod_Pyr_CWM_DW_saproxylic_level.depe_dredge = dredge(mod_Pyr_CWM_DW_saproxylic_level.depe)
head(mod_Pyr_CWM_DW_saproxylic_level.depe_dredge)
res = simulateResiduals(mod_Pyr_CWM_DW_saproxylic_level.depe)
plot(res, rank = T)


#FDis_DW_saproxylic
mod_Pyr_FDis_DW_saproxylic_level.depe = lm(FDis_DW_saproxylic ~ log_DW_div_tot, data = Data_univar_SEM_Pyrenees, na.action = "na.fail")
check_collinearity(mod_Pyr_FDis_DW_saproxylic_level.depe)
summary(mod_Pyr_FDis_DW_saproxylic_level.depe)

mod_Pyr_FDis_DW_saproxylic_level.depe_dredge = dredge(mod_Pyr_FDis_DW_saproxylic_level.depe)
head(mod_Pyr_FDis_DW_saproxylic_level.depe_dredge)
res = simulateResiduals(mod_Pyr_FDis_DW_saproxylic_level.depe)
plot(res, rank = T)


```
####



###SEM Pyrenees

```{r}

Data_univar_SEM_Pyrenees = as.data.frame(Data_univar_SEM_Pyrenees)

options(max.print=9000)


SEM_Pyr = psem(lme(fixed = log_LW_vol ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = log_DW_vol ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = log_DW_dec12 ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = log_DW_dec34 ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = log_DW_PBBM ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = log_DW_GBTGB ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = log_DW_BMS ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = log_DW_BMD ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = log_DW_div_tot ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = FRic_DW ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = FDiv_DW ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = FEve_DW ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = FDis_DW ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = CWM_statut ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = log_FDis_statut ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = log_CWM_stade_saprox ~ level_depe_G, random = ~ 1|site, data = filter(Data_univar_SEM_Pyrenees, CWM_dbh > 0)),
               lme(fixed = FDis_stade_saprox ~ level_depe_G + FDis_ONTO, random = ~ 1|site, data = filter(Data_univar_SEM_Pyrenees, CWM_dbh > 0)),
               lme(fixed = CWM_dbh ~ level_depe_G, random = ~ 1|site, data = filter(Data_univar_SEM_Pyrenees, CWM_dbh > 0)),
               lme(fixed = FDis_dbh ~ level_depe_G, random = ~ 1|site, data = filter(Data_univar_SEM_Pyrenees, CWM_dbh > 0)),
               lme(fixed = nb_TGB_All_sub ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               
               
               lme(fixed = log_TreMs_ab ~ log_LW_vol + CWM_dbh + log_DW_BMD, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = log_TreMs_div ~ log_DW_BMD, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = FRic_TreMs ~ CWM_dbh + log_DW_PBBM, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = FDiv_TreMs ~ nb_TGB_All_sub + FDis_dbh, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = FEve_TreMs ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = FDis_TreMs ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = CWM_DW_type_substrate ~ CWM_dbh + log_DW_BMD, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = FDis_DW_type_substrate ~ level_depe_G + log_DW_dec34, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = CWM_POS ~ log_LW_vol, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = log_FDis_POS ~ CWM_dbh + log_CWM_stade_saprox, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = CWM_HUM_dry_wet ~ FDis_dbh + log_CWM_stade_saprox, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = FDis_HUM_dry_wet ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = CWM_LIFE ~ log_DW_BMD + log_DW_GBTGB + CWM_statut, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = FDis_LIFE ~ log_DW_BMD, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = CWM_ONTO ~ level_depe_G + log_DW_dec34 + CWM_dbh, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = FDis_ONTO ~ log_DW_BMD, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               lme(fixed = CWM_DW_saproxylic ~ log_DW_dec12 + log_DW_div_tot + nb_TGB_All_sub, random = ~ 1|site, data = Data_univar_SEM_Pyrenees),
               data = Data_univar_SEM_Pyrenees)
sink(file='SEM_Pyr.txt')
summary(SEM_Pyr, conserve = T, standardize = "none")
sink()

# dSep_SEM_Pyr = dSep(SEM_Pyr, conserve = T)
# fisherC(dSep_SEM_Pyr)


SEM_Pyr_2 = update(SEM_Pyr, log_DW_vol %~~% log_DW_dec12, log_DW_dec12 %~~% log_DW_PBBM, log_DW_dec12 %~~% log_DW_div_tot, log_DW_dec12 %~~% FDiv_DW, FDis_DW %~~% FEve_DW, CWM_dbh %~~% FEve_DW, FDis_dbh %~~% FEve_DW, FEve_DW %~~% FDis_dbh, FEve_DW %~~% log_DW_GBTGB, FEve_DW %~~% log_DW_div_tot, FEve_DW %~~% FDiv_DW, FEve_DW %~~% FDis_ONTO, FDis_DW %~~% CWM_dbh, FDis_DW %~~% FDis_dbh, FDis_DW %~~% log_DW_vol, FDis_DW %~~% log_DW_GBTGB, FDis_DW %~~% log_DW_BMD, FDis_DW %~~% log_DW_div_tot, FDis_DW %~~% FRic_DW, FDis_DW %~~% FDiv_DW, CWM_statut %~~% CWM_dbh, CWM_statut %~~% FDis_dbh, CWM_statut %~~% log_DW_div_tot, CWM_dbh %~~% FDis_dbh, CWM_dbh %~~% log_DW_GBTGB, CWM_dbh %~~% log_DW_div_tot, CWM_dbh %~~% FDiv_DW, FDis_dbh %~~% log_DW_GBTGB, FDis_dbh %~~% log_DW_div_tot, FDis_dbh %~~% FDiv_DW, FEve_TreMs %~~% log_TreMs_ab, FEve_TreMs %~~% log_Concavities, FEve_TreMs %~~% CWM_DW_type_substrate, FEve_TreMs %~~% FDis_DW_type_substrate, FEve_TreMs %~~% CWM_ONTO, log_LW_vol %~~% FDis_stade_saprox, log_DW_vol %~~% log_DW_dec34, log_DW_vol %~~% log_DW_PBBM, log_DW_vol %~~% log_DW_GBTGB, log_DW_vol %~~% log_DW_BMS, log_DW_vol %~~% log_DW_BMD, log_DW_vol %~~% log_DW_div_tot, log_DW_vol %~~% FRic_DW, log_DW_vol %~~% FDiv_DW, log_DW_vol %~~% log_FDis_statut, log_DW_vol %~~% log_CWM_stade_saprox, log_DW_vol %~~% FDis_stade_saprox, log_DW_dec34 %~~% log_DW_PBBM, log_DW_dec34 %~~% log_DW_GBTGB, log_DW_dec34 %~~% log_DW_BMS, log_DW_dec34 %~~% log_DW_BMD, log_DW_dec34 %~~% log_DW_div_tot, log_DW_dec34 %~~% log_FDis_statut, log_DW_dec34 %~~% log_CWM_stade_saprox, log_DW_PBBM %~~% log_DW_BMS, log_DW_PBBM %~~% log_DW_BMD, log_DW_PBBM %~~% log_DW_div_tot, log_DW_PBBM %~~% log_FDis_statut, log_DW_GBTGB %~~% log_DW_BMD, log_DW_GBTGB %~~% log_DW_div_tot, log_DW_GBTGB %~~% FRic_DW, log_DW_GBTGB %~~% FDiv_DW, log_DW_GBTGB %~~% log_FDis_statut, log_DW_GBTGB %~~% FDis_stade_saprox, log_DW_BMS %~~% log_DW_div_tot, log_DW_BMS %~~% log_FDis_statut, log_DW_BMS %~~% log_CWM_stade_saprox, log_DW_BMD %~~% log_DW_div_tot, log_DW_BMD %~~% FRic_DW, log_DW_BMD %~~% FDiv_DW, log_DW_BMD %~~% log_FDis_statut, log_DW_div_tot %~~% FRic_DW, log_DW_div_tot %~~% FDiv_DW, log_DW_div_tot %~~% log_CWM_stade_saprox, log_DW_div_tot %~~% FDis_stade_saprox, FRic_DW %~~% FDiv_DW, FRic_DW %~~% FDis_stade_saprox, log_CWM_stade_saprox %~~% FDis_stade_saprox, CWM_statut %~~% log_DW_vol, log_DW_GBTGB %~~% log_DW_dec12, FDis_DW %~~% log_DW_dec12, FDis_stade_saprox %~~% log_DW_dec12, CWM_statut %~~% log_DW_dec34, CWM_HUM_dry_wet %~~% log_DW_BMS, FDiv_DW %~~% FDis_stade_saprox, FEve_DW %~~% FDis_stade_saprox,
                   
                   FDis_ONTO %~~% CWM_POS, FDis_ONTO %~~% CWM_LIFE, FDis_ONTO %~~% FDis_LIFE, FDis_ONTO %~~% CWM_ONTO, log_TreMs_ab %~~% FDis_TreMs, log_TreMs_ab %~~% CWM_DW_type_substrate, log_TreMs_ab %~~% FDis_DW_type_substrate, log_TreMs_ab %~~% log_FDis_POS, log_TreMs_ab %~~% CWM_ONTO, log_TreMs_div %~~% FRic_TreMs, FDiv_TreMs %~~% FDis_TreMs, FDiv_TreMs %~~% CWM_DW_type_substrate, FDiv_TreMs %~~% log_FDis_POS, FDiv_TreMs %~~% CWM_HUM_dry_wet, FDiv_TreMs %~~% FDis_HUM_dry_wet, FDiv_TreMs %~~% CWM_ONTO, FDiv_TreMs %~~% CWM_DW_saproxylic, FDiv_TreMs %~~% CWM_DW_type_substrate, FDiv_TreMs %~~% FDis_DW_type_substrate, FDiv_TreMs %~~% log_FDis_POS, FDiv_TreMs %~~% CWM_HUM_dry_wet, FDiv_TreMs %~~% FDis_HUM_dry_wet, FDiv_TreMs %~~% CWM_ONTO, FDiv_TreMs %~~% CWM_DW_saproxylic, CWM_DW_type_substrate %~~% CWM_POS, CWM_DW_type_substrate %~~% log_FDis_POS, CWM_DW_type_substrate %~~% CWM_HUM_dry_wet, FDis_DW_type_substrate %~~% CWM_ONTO, log_FDis_POS %~~% CWM_HUM_dry_wet, log_FDis_POS %~~% FDis_HUM_dry_wet, log_FDis_POS %~~% CWM_ONTO, CWM_HUM_dry_wet %~~% CWM_DW_saproxylic, FDis_HUM_dry_wet %~~% CWM_LIFE, CWM_LIFE %~~% FDis_LIFE, CWM_ONTO %~~% CWM_DW_saproxylic, CWM_DW_type_substrate  %~~%  FDis_TreMs, FDis_TreMs %~~% FDis_DW_type_substrate, FDis_TreMs %~~% log_FDis_POS, FDis_TreMs %~~% CWM_HUM_dry_wet, FDis_TreMs %~~% FDis_HUM_dry_wet, FDis_TreMs %~~% CWM_ONTO, FDis_TreMs %~~% CWM_DW_saproxylic, log_DW_GBTGB %~~% log_LW_vol, log_DW_div_tot %~~% log_LW_vol, nb_TGB_All_sub %~~% log_LW_vol, FDis_DW %~~% FDis_stade_saprox, CWM_statut %~~% log_CWM_stade_saprox, CWM_dbh %~~% log_CWM_stade_saprox, FDis_ONTO %~~% CWM_DW_type_substrate, CWM_dbh %~~% nb_TGB_All_sub, FDis_dbh %~~% nb_TGB_All_sub, CWM_ONTO %~~% CWM_DW_type_substrate, log_DW_vol %~~% log_LW_vol, log_DW_dec12 %~~% log_LW_vol, log_DW_BMD %~~% log_LW_vol, CWM_DW_type_substrate %~~% log_LW_vol, FEve_DW %~~% log_DW_dec12, FDis_DW %~~% log_DW_dec34, FDis_DW %~~% log_DW_PBBM, CWM_dbh %~~% log_DW_PBBM, FDis_DW %~~% log_DW_BMS, CWM_statut %~~% log_DW_BMS, nb_TGB_All_sub %~~% log_DW_BMD, CWM_statut %~~% FDiv_DW, CWM_statut %~~% FEve_DW, FRic_DW %~~% log_DW_dec12, log_FDis_POS %~~% FDis_DW_type_substrate, FDis_DW_type_substrate %~~% CWM_POS, log_TreMs_div %~~% CWM_DW_saproxylic, FDis_ONTO %~~% FDis_DW_type_substrate, FDis_dbh %~~% log_CWM_stade_saprox, log_FDis_statut %~~% CWM_statut, CWM_ONTO %~~% FEve_DW, FDiv_DW %~~% log_CWM_stade_saprox, log_DW_BMD %~~% CWM_statut, CWM_statut %~~% log_DW_PBBM, FDis_dbh %~~% FDis_stade_saprox)
summary(SEM_Pyr_2, conserve = T, standardize = "none")
dSep_SEM_Pyr_2 = dSep(SEM_Pyr_2, conserve = T)
fisherC(dSep_SEM_Pyr_2)

sink(file='SEM_Pyr_stand_coef.txt')
coefs(SEM_Pyr_2, standardize = "scale", standardize.type = "Menard.OE")
sink()

plot(SEM_Pyr)

```






###SEM Loire


####mod_DW
```{r SEM Loire}

Data_univar_CWM_Loire_SEM = Data_univar_CWM %>%
  filter(Region %in% "CVL") %>%
  dplyr::rename("FRic_DW" = "FRic", "FDiv_DW" = "FDiv", "FEve_DW" = "FEve", "FDis_DW" = "FDis")

Data_univar_CWM_Loire_SEM[is.na(Data_univar_CWM_Loire_SEM)] <- 0


#LW_vol
mod_CVL_LW_vol_level_depe_G = lm(log1p(LW_vol) ~ level_depe_G, data = Data_univar_CWM_Loire_SEM)
summary(mod_CVL_LW_vol_level_depe_G)
res = simulateResiduals(mod_CVL_LW_vol_level_depe_G)
plot(res, rank = T)


#DW_vol
mod_CVL_DW_vol_level_depe_G = lm(log1p(DW_vol) ~ level_depe_G, data = Data_univar_CWM_Loire_SEM)
summary(mod_CVL_DW_vol_level_depe_G)
res = simulateResiduals(mod_CVL_DW_vol_level_depe_G)
plot(res, rank = T)


#DW_dec12
mod_CVL_DW_dec12_level_depe_G = lm(log1p(DW_dec12) ~ level_depe_G, data = Data_univar_CWM_Loire_SEM)
summary(mod_CVL_DW_dec12_level_depe_G)
res = simulateResiduals(mod_CVL_DW_dec12_level_depe_G)
plot(res, rank = T)


#DW_dec34
mod_CVL_DW_dec34_level_depe_G = lm(log1p(DW_dec34) ~ level_depe_G, data = Data_univar_CWM_Loire_SEM)
summary(mod_CVL_DW_dec34_level_depe_G)
res = simulateResiduals(mod_CVL_DW_dec34_level_depe_G)
plot(res, rank = T)


#DW_PBBM
mod_CVL_DW_PBBM_level_depe_G = lm(log1p(DW_PBBM) ~ level_depe_G, data = Data_univar_CWM_Loire_SEM)
summary(mod_CVL_DW_PBBM_level_depe_G)
res = simulateResiduals(mod_CVL_DW_PBBM_level_depe_G)
plot(res, rank = T)


#DW_GBTGB
mod_CVL_DW_GBTGB_level_depe_G = lm(log1p(DW_GBTGB) ~ level_depe_G, data = Data_univar_CWM_Loire_SEM)
summary(mod_CVL_DW_GBTGB_level_depe_G)
res = simulateResiduals(mod_CVL_DW_GBTGB_level_depe_G)
plot(res, rank = T)


#DW_BMS
mod_CVL_DW_BMS_level_depe_G = lm(log1p(DW_BMS) ~ level_depe_G, data = Data_univar_CWM_Loire_SEM)
summary(mod_CVL_DW_BMS_level_depe_G)
res = simulateResiduals(mod_CVL_DW_BMS_level_depe_G)
plot(res, rank = T)


#DW_BMD
mod_CVL_DW_BMD_level_depe_G = lm(log1p(DW_BMD) ~ level_depe_G, data = Data_univar_CWM_Loire_SEM)
summary(mod_CVL_DW_BMD_level_depe_G)
res = simulateResiduals(mod_CVL_DW_BMD_level_depe_G)
plot(res, rank = T)


#DW_div_tot
mod_CVL_DW_div_tot_level_depe_G = lm(log1p(DW_div_tot) ~ level_depe_G, data = Data_univar_CWM_Loire_SEM)
summary(mod_CVL_DW_div_tot_level_depe_G)
res = simulateResiduals(mod_CVL_DW_div_tot_level_depe_G)
plot(res, rank = T)


#FRic_DW
mod_CVL_FRic_level_depe_G = lm(FRic_DW ~ level_depe_G, data = Data_univar_CWM_Loire_SEM)
summary(mod_CVL_FRic_level_depe_G)
res = simulateResiduals(mod_CVL_FRic_level_depe_G)
plot(res, rank = T)


#FDiv_DW
mod_CVL_FDiv_level_depe_G = lm(FDiv_DW ~ level_depe_G, data = Data_univar_CWM_Loire_SEM)
summary(mod_CVL_FDiv_level_depe_G)
res = simulateResiduals(mod_CVL_FDiv_level_depe_G)
plot(res, rank = T)


#FEve_DW
mod_CVL_FEve_level_depe_G = lm(FEve_DW ~ level_depe_G, data = Data_univar_CWM_Loire_SEM)
summary(mod_CVL_FEve_level_depe_G)
res = simulateResiduals(mod_CVL_FEve_level_depe_G)
plot(res, rank = T)


#FDis_DW
mod_CVL_FDis_level_depe_G = lm(FDis_DW ~ level_depe_G, data = Data_univar_CWM_Loire_SEM)
summary(mod_CVL_FDis_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_level_depe_G)
plot(res, rank = T)


#CWM_statut
mod_CVL_CWM_statut_level_depe_G = lm(CWM_statut ~ level_depe_G, data = Data_univar_CWM_Loire_SEM)
summary(mod_CVL_CWM_statut_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_statut_level_depe_G)
plot(res, rank = T)


#FDis_statut
mod_CVL_FDis_statut_level_depe_G = lm(FDis_statut ~ level_depe_G, data = Data_univar_CWM_Loire_SEM)
summary(mod_CVL_FDis_statut_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_statut_level_depe_G)
plot(res, rank = T)


#CWM_stade_saprox
mod_CVL_CWM_stade_saprox_level_depe_G = lm(CWM_stade_saprox ~ level_depe_G, data = Data_univar_CWM_Loire_SEM)
summary(mod_CVL_CWM_stade_saprox_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_stade_saprox_level_depe_G)
plot(res, rank = T)


#FDis_stade_saprox
mod_CVL_FDis_stade_saprox_level_depe_G = lm(FDis_stade_saprox ~ level_depe_G, data = Data_univar_CWM_Loire_SEM)
summary(mod_CVL_FDis_stade_saprox_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_stade_saprox_level_depe_G)
plot(res, rank = T)


#CWM_dbh
mod_CVL_CWM_dbh_level_depe_G = lm(CWM_dbh ~ level_depe_G, data = Data_univar_CWM_Loire_SEM)
summary(mod_CVL_CWM_dbh_level_depe_G)
res = simulateResiduals(mod_CVL_CWM_dbh_level_depe_G)
plot(res, rank = T)


#FDis_dbh
mod_CVL_FDis_dbh_level_depe_G = lm(FDis_dbh ~ level_depe_G, data = Data_univar_CWM_Loire_SEM)
summary(mod_CVL_FDis_dbh_level_depe_G)
res = simulateResiduals(mod_CVL_FDis_dbh_level_depe_G)
plot(res, rank = T)


```
####



####mod_TreMs
```{r mod_TreMs}

Data_univar_CWM_TreMs_CVL_SEM = Data_univar_CWM_TreMs_All %>%
  filter(Region %in% "CVL") %>%
  dplyr::rename("FRic_TreMs" = "FRic", "FDiv_TreMs" = "FDiv", "FEve_TreMs" = "FEve", "FDis_TreMs" = "FDis") %>%
  dplyr::select(-"Region",-"site",-"alt",-"lat",-"lon",-"cat_depe",-"salvaged",-"cat_depe01", -"level_depe_G", -"class_depe_G")


Data_univar_SEM_Loire =  Data_univar_CWM_Loire_SEM %>%
  left_join(Data_univar_CWM_TreMs_CVL_SEM, by = c("plot")) %>%
  mutate(log_LW_vol = log1p(LW_vol), log_DW_vol = log1p(DW_vol), log_DW_dec12 = log1p(DW_dec12), log_DW_dec34 = log1p(DW_dec34), log_DW_PBBM = log1p(DW_PBBM), log_DW_GBTGB = log1p(DW_GBTGB), log_DW_BMS = log1p(DW_BMS), log_DW_BMD = log1p(DW_BMD), log_DW_div_tot = log1p(DW_div_tot), log_CWM_statut = log1p(CWM_statut), log_FDis_statut = log1p(FDis_statut), log_CWM_stade_saprox = log1p(CWM_stade_saprox), log_FDis_stade_saprox = log1p(FDis_stade_saprox),
         log_TreMs_ab = log1p(TreMs_ab), log_TreMs_div = log1p(TreMs_div))



Data_univar_SEM_Loire[is.na(Data_univar_SEM_Loire)] <- 0

# level.depe + log_LW_vol + log_DW_dec12 + log_DW_dec34 + log_DW_PBBM + log_DW_GBTGB + log_DW_BMS + log_DW_BMD + log_DW_div_tot + CWM_statut + log_FDis_statut + log_CWM_stade_saprox + log_FDis_stade_saprox + CWM_dbh + FDis_dbh


#TreMs_ab
mod_CVL_TreMs_ab_level.depe = lm(log1p(TreMs_ab) ~ level.depe + log_DW_BMS + log_DW_dec12 + log_DW_PBBM, data = Data_univar_SEM_Loire, na.action = "na.fail")
check_collinearity(mod_CVL_TreMs_ab_level.depe)
summary(mod_CVL_TreMs_ab_level.depe)

mod_CVL_TreMs_ab_level.depe_dredge = dredge(mod_CVL_TreMs_ab_level.depe)
head(mod_CVL_TreMs_ab_level.depe_dredge)
res = simulateResiduals(mod_CVL_TreMs_ab_level.depe)
plot(res, rank = T)


#TreMs_div
mod_CVL_TreMs_div_level.depe = lme(TreMs_div ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Loire, na.action = "na.fail")
check_collinearity(mod_CVL_TreMs_div_level.depe)
summary(mod_CVL_TreMs_div_level.depe)

mod_CVL_TreMs_div_level.depe_dredge = dredge(mod_CVL_TreMs_div_level.depe)
head(mod_CVL_TreMs_div_level.depe_dredge)
res = simulateResiduals(mod_CVL_TreMs_div_level.depe)
plot(res, rank = T)


#FRic_TreMs
mod_CVL_FRic_TreMs_level.depe = lm(FRic_TreMs ~ level.depe, data = filter(Data_univar_SEM_Loire, plot %in% c("1343",	"1491", "81", "290", "1427", "1502", "249", "751", "35", "236", "71", "179", "19", "70", "1140")), na.action = "na.fail")
check_collinearity(mod_CVL_FRic_TreMs_level.depe)
summary(mod_CVL_FRic_TreMs_level.depe)

mod_CVL_FRic_TreMs_level.depe_dredge = dredge(mod_CVL_FRic_TreMs_level.depe)
head(mod_CVL_FRic_TreMs_level.depe_dredge)
res = simulateResiduals(mod_CVL_FRic_TreMs_level.depe)
plot(res, rank = T)


#FDiv_TreMs
mod_CVL_FDiv_TreMs_level.depe = lm(FDiv_TreMs ~ level.depe + FDis_dbh, data = Data_univar_SEM_Loire, na.action = "na.fail")
check_collinearity(mod_CVL_FDiv_TreMs_level.depe)
summary(mod_CVL_FDiv_TreMs_level.depe)

mod_CVL_FDiv_TreMs_level.depe_dredge = dredge(mod_CVL_FDiv_TreMs_level.depe)
head(mod_CVL_FDiv_TreMs_level.depe_dredge)
res = simulateResiduals(mod_CVL_FDiv_TreMs_level.depe)
plot(res, rank = T)


#FEve_TreMs
mod_CVL_FEve_TreMs_level.depe = lm(FEve_TreMs ~ level.depe, data = Data_univar_SEM_Loire, na.action = "na.fail")
check_collinearity(mod_CVL_FEve_TreMs_level.depe)
summary(mod_CVL_FEve_TreMs_level.depe)

mod_CVL_FEve_TreMs_level.depe_dredge = dredge(mod_CVL_FEve_TreMs_level.depe)
head(mod_CVL_FEve_TreMs_level.depe_dredge)
res = simulateResiduals(mod_CVL_FEve_TreMs_level.depe)
plot(res, rank = T)


#FDis_TreMs
mod_CVL_FDis_TreMs_level.depe = lm(FDis_TreMs ~ level.depe, data = Data_univar_SEM_Loire, na.action = "na.fail")
check_collinearity(mod_CVL_FDis_TreMs_level.depe)
summary(mod_CVL_FDis_TreMs_level.depe)

mod_CVL_FDis_TreMs_level.depe_dredge = dredge(mod_CVL_FDis_TreMs_level.depe)
head(mod_CVL_FDis_TreMs_level.depe_dredge)
res = simulateResiduals(mod_CVL_FDis_TreMs_level.depe)
plot(res, rank = T)


#CWM_DW_type_substrate
mod_CVL_CWM_DW_type_substrate_level.depe = lm(CWM_DW_type_substrate ~ level.depe + CWM_dbh + log_CWM_stade_saprox, data = Data_univar_SEM_Loire, na.action = "na.fail")
check_collinearity(mod_CVL_CWM_DW_type_substrate_level.depe)
summary(mod_CVL_CWM_DW_type_substrate_level.depe)

mod_CVL_CWM_DW_type_substrate_level.depe_dredge = dredge(mod_CVL_CWM_DW_type_substrate_level.depe)
head(mod_CVL_CWM_DW_type_substrate_level.depe_dredge)
res = simulateResiduals(mod_CVL_CWM_DW_type_substrate_level.depe)
plot(res, rank = T)


#FDis_DW_type_substrate
mod_CVL_FDis_DW_type_substrate_level.depe = lm(FDis_DW_type_substrate ~ level.depe, data = Data_univar_SEM_Loire, na.action = "na.fail")
check_collinearity(mod_CVL_FDis_DW_type_substrate_level.depe)
summary(mod_CVL_FDis_DW_type_substrate_level.depe)

mod_CVL_FDis_DW_type_substrate_level.depe_dredge = dredge(mod_CVL_FDis_DW_type_substrate_level.depe)
head(mod_CVL_FDis_DW_type_substrate_level.depe_dredge)
res = simulateResiduals(mod_CVL_FDis_DW_type_substrate_level.depe)
plot(res, rank = T)


#CWM_POS
mod_CVL_CWM_POS_level.depe = lme(CWM_POS ~ level.depe, random=~1|site, data = dplyr::filter(Data_univar_SEM_Loire, plot %in% c(1343,1491,81,290,1427,1502,249,751,35,236,71,179,19,70,1140)), na.action = "na.fail")
check_collinearity(mod_CVL_CWM_POS_level.depe)
summary(mod_CVL_CWM_POS_level.depe)

mod_CVL_CWM_POS_level.depe_dredge = dredge(mod_CVL_CWM_POS_level.depe)
head(mod_CVL_CWM_POS_level.depe_dredge)
res = simulateResiduals(mod_CVL_CWM_POS_level.depe)
plot(res, rank = T)

ggplot(dplyr::filter(Data_univar_SEM_Loire, plot %in% c(1343,1491,81,290,1427,1502,249,751,35,236,71,179,19,70,1140)), aes(x = level.depe, y = CWM_POS)) + geom_point(position = "jitter") + geom_smooth(method = "lm")


#FDis_POS
mod_CVL_FDis_POS_level.depe = lm(FDis_POS ~ level.depe + log_DW_PBBM, data = dplyr::filter(Data_univar_SEM_Loire, plot %in% c(1343,1491,81,290,1427,1502,249,751,35,236,71,179,19,70,1140)), na.action = "na.fail")
check_collinearity(mod_CVL_FDis_POS_level.depe)
summary(mod_CVL_FDis_POS_level.depe)

mod_CVL_FDis_POS_level.depe_dredge = dredge(mod_CVL_FDis_POS_level.depe)
head(mod_CVL_FDis_POS_level.depe_dredge)
res = simulateResiduals(mod_CVL_FDis_POS_level.depe)
plot(res, rank = T)


#CWM_HUM_dry_wet
mod_CVL_CWM_HUM_dry_wet_level.depe = lm(CWM_HUM_dry_wet ~ FDis_dbh, data = Data_univar_SEM_Loire, na.action = "na.fail")
check_collinearity(mod_CVL_CWM_HUM_dry_wet_level.depe)
summary(mod_CVL_CWM_HUM_dry_wet_level.depe)

mod_CVL_CWM_HUM_dry_wet_level.depe_dredge = dredge(mod_CVL_CWM_HUM_dry_wet_level.depe)
head(mod_CVL_CWM_HUM_dry_wet_level.depe_dredge)
res = simulateResiduals(mod_CVL_CWM_HUM_dry_wet_level.depe)
plot(res, rank = T)


#FDis_HUM_dry_wet
mod_CVL_FDis_HUM_dry_wet_level.depe = lm(FDis_HUM_dry_wet ~ CWM_statut + log_CWM_stade_saprox, data = Data_univar_SEM_Loire, na.action = "na.fail")
check_collinearity(mod_CVL_FDis_HUM_dry_wet_level.depe)
summary(mod_CVL_FDis_HUM_dry_wet_level.depe)

mod_CVL_FDis_HUM_dry_wet_level.depe_dredge = dredge(mod_CVL_FDis_HUM_dry_wet_level.depe)
head(mod_CVL_FDis_HUM_dry_wet_level.depe_dredge)
res = simulateResiduals(mod_CVL_FDis_HUM_dry_wet_level.depe)
plot(res, rank = T)


#CWM_LIFE
mod_CVL_CWM_LIFE_level.depe = lm(CWM_LIFE ~ log_CWM_stade_saprox + log_DW_BMD + log_DW_GBTGB + log_LW_vol, data = Data_univar_SEM_Loire, na.action = "na.fail")
check_collinearity(mod_CVL_CWM_LIFE_level.depe)
summary(mod_CVL_CWM_LIFE_level.depe)

mod_CVL_CWM_LIFE_level.depe_dredge = dredge(mod_CVL_CWM_LIFE_level.depe)
head(mod_CVL_CWM_LIFE_level.depe_dredge)
res = simulateResiduals(mod_CVL_CWM_LIFE_level.depe)
plot(res, rank = T)


#FDis_LIFE
mod_CVL_FDis_LIFE_level.depe = lm(FDis_LIFE ~ log_DW_BMD, data = Data_univar_SEM_Loire, na.action = "na.fail")
check_collinearity(mod_CVL_FDis_LIFE_level.depe)
summary(mod_CVL_FDis_LIFE_level.depe)

mod_CVL_FDis_LIFE_level.depe_dredge = dredge(mod_CVL_FDis_LIFE_level.depe)
head(mod_CVL_FDis_LIFE_level.depe_dredge)
res = simulateResiduals(mod_CVL_FDis_LIFE_level.depe)
plot(res, rank = T)

#CWM_ONTO
mod_CVL_CWM_ONTO_level.depe = lm(CWM_ONTO ~ level.depe + log_DW_dec34, data = Data_univar_SEM_Loire, na.action = "na.fail")
check_collinearity(mod_CVL_CWM_ONTO_level.depe)
summary(mod_CVL_CWM_ONTO_level.depe)

mod_CVL_CWM_ONTO_level.depe_dredge = dredge(mod_CVL_CWM_ONTO_level.depe)
head(mod_CVL_CWM_ONTO_level.depe_dredge)
res = simulateResiduals(mod_CVL_CWM_ONTO_level.depe)
plot(res, rank = T)


#FDis_ONTO
mod_CVL_FDis_ONTO_level.depe = lm(FDis_ONTO ~ level.depe + log_CWM_stade_saprox + log_DW_BMD + log_DW_PBBM, data = Data_univar_SEM_Loire, na.action = "na.fail")
check_collinearity(mod_CVL_FDis_ONTO_level.depe)
summary(mod_CVL_FDis_ONTO_level.depe)

mod_CVL_FDis_ONTO_level.depe_dredge = dredge(mod_CVL_FDis_ONTO_level.depe)
head(mod_CVL_FDis_ONTO_level.depe_dredge)
res = simulateResiduals(mod_CVL_FDis_ONTO_level.depe)
plot(res, rank = T)


#CWM_DW_saproxylic
mod_CVL_CWM_DW_saproxylic_level.depe = lm(CWM_DW_saproxylic ~ log_DW_dec12 + log_DW_div_tot, data = Data_univar_SEM_Loire, na.action = "na.fail")
check_collinearity(mod_CVL_CWM_DW_saproxylic_level.depe)
summary(mod_CVL_CWM_DW_saproxylic_level.depe)

mod_CVL_CWM_DW_saproxylic_level.depe_dredge = dredge(mod_CVL_CWM_DW_saproxylic_level.depe)
head(mod_CVL_CWM_DW_saproxylic_level.depe_dredge)
res = simulateResiduals(mod_CVL_CWM_DW_saproxylic_level.depe)
plot(res, rank = T)


#FDis_DW_saproxylic
mod_CVL_FDis_DW_saproxylic_level.depe = lm(FDis_DW_saproxylic ~ log_DW_div_tot, data = Data_univar_SEM_Loire, na.action = "na.fail")
check_collinearity(mod_CVL_FDis_DW_saproxylic_level.depe)
summary(mod_CVL_FDis_DW_saproxylic_level.depe)

mod_CVL_FDis_DW_saproxylic_level.depe_dredge = dredge(mod_CVL_FDis_DW_saproxylic_level.depe)
head(mod_CVL_FDis_DW_saproxylic_level.depe_dredge)
res = simulateResiduals(mod_CVL_FDis_DW_saproxylic_level.depe)
plot(res, rank = T)


```


####SEM Loire

```{r}

Data_univar_SEM_Loire = as.data.frame(Data_univar_SEM_Loire)


TreMs_div_DW_div_tot_CVL = ggplot(data = Data_univar_SEM_Loire, aes(y = TreMs_div, x = DW_div_tot)) + geom_point() + geom_smooth(method = "lm", formula = y ~ x, fullrange = T, color = "#A28346") + theme_bw() + labs(x = "Diversité du bois mort", y = "Diversité de TreMs") + theme(plot.subtitle = element_text(color="grey20", size=10, face="italic")) + ggtitle(label = "Lien Bois mort - TreMs") + annotate(geom = "text", label = "p < 0.05 *", x = 2.25, y = 4, hjust = 0)
TreMs_div_DW_div_tot_CVL

ggsave("Figures/TreMs_div_DW_div_tot_CVL.png", plot = TreMs_div_DW_div_tot_CVL, width = 12, height = 10, units = "cm", type = "cairo")


# view(dplyr::select(Data_univar_SEM_Loire, "plot", "FRic_TreMs", "CWM_DW_type_substrate", "FDis_DW_type_substrate", "CWM_POS", "FDis_POS", "CWM_HUM_dry_wet", "FDis_HUM_dry_wet", "CWM_LIFE" ,"FDis_LIFE", "CWM_ONTO", "FDis_ONTO", "CWM_DW_saproxylic"))

options(max.print=9000)


SEM_CVL = psem(lme(fixed = log_LW_vol ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Loire),
               lme(fixed = log_DW_vol ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Loire),
               lme(fixed = log_DW_dec12 ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Loire),
               lme(fixed = log_DW_dec34 ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Loire),
               lme(fixed = log_DW_PBBM ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Loire),
               lme(fixed = log_DW_GBTGB ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Loire),
               lme(fixed = log_DW_BMS ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Loire),
               lme(fixed = log_DW_BMD ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Loire),
               lme(fixed = log_DW_div_tot ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Loire),
               lme(fixed = CWM_statut ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Loire),
               lme(fixed = log_FDis_statut ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Loire),
               lme(fixed = log_CWM_stade_saprox ~ level_depe_G, random = ~ 1|site, data = filter(Data_univar_SEM_Loire, CWM_dbh > 0)),
               lme(fixed = FDis_stade_saprox ~ level_depe_G, random = ~ 1|site, data = filter(Data_univar_SEM_Loire, CWM_dbh > 0)),
               lme(fixed = CWM_dbh ~ level_depe_G, random = ~ 1|site, data = filter(Data_univar_SEM_Loire, CWM_dbh > 0)),
               lme(fixed = FDis_dbh ~ level_depe_G, random = ~ 1|site, data = filter(Data_univar_SEM_Loire, CWM_dbh > 0)),
               lme(fixed = nb_TGB_All_sub ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Loire),
               
               lme(fixed = log_TreMs_ab ~ level_depe_G + log_DW_div_tot, random = ~ 1|site, data = Data_univar_SEM_Loire),
               lme(fixed = log_TreMs_div ~ nb_TGB_All_sub, random = ~ 1|site, data = Data_univar_SEM_Loire),
               lme(fixed = FRic_TreMs ~ nb_TGB_All_sub + log_DW_div_tot, random = ~ 1|site, data = Data_univar_SEM_Loire),
               lme(fixed = FEve_TreMs ~ level_depe_G + log_DW_vol + log_LW_vol + nb_TGB_All_sub, random = ~ 1|site, data = Data_univar_SEM_Loire),
               lme(fixed = CWM_DW_type_substrate ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Loire),
               lme(fixed = FDis_DW_type_substrate ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Loire),
               lme(fixed = CWM_POS ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Loire),
               lme(fixed = FDis_POS ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Loire),
               lme(fixed = CWM_HUM_dry_wet ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Loire),
               lme(fixed = FDis_HUM_dry_wet ~ log_DW_vol, random = ~ 1|site, data = Data_univar_SEM_Loire),
               lme(fixed = CWM_LIFE ~ nb_TGB_All_sub, random = ~ 1|site, data = Data_univar_SEM_Loire),
               lme(fixed = CWM_ONTO ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Loire),
               lme(fixed = FDis_ONTO ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Loire),
               lme(fixed = CWM_DW_saproxylic ~ level_depe_G, random = ~ 1|site, data = Data_univar_SEM_Loire),
               data = Data_univar_SEM_Loire)
sink(file='SEM_CVL.txt')
summary(SEM_CVL, conserve = T, standardize = "none")
sink()

# dSep_SEM_CVL = dSep(SEM_CVL, conserve = T)
# fisherC(dSep_SEM_CVL)


SEM_CVL_2 = update(SEM_CVL, log_DW_vol %~~% log_DW_dec12, log_DW_vol %~~% log_DW_GBTGB, log_DW_vol %~~% log_DW_BMD, log_DW_vol %~~% log_DW_div_tot, log_DW_vol %~~% CWM_statut, log_DW_vol %~~% log_FDis_statut, log_DW_vol %~~% log_CWM_stade_saprox, log_DW_vol %~~% CWM_dbh, log_DW_dec12 %~~% log_DW_GBTGB, log_DW_dec12 %~~% log_DW_BMD, log_DW_dec12 %~~% CWM_statut, log_DW_dec12 %~~% log_FDis_statut, log_DW_dec12 %~~% CWM_dbh, log_DW_dec34 %~~% log_DW_BMS, log_DW_GBTGB %~~% log_DW_BMD, log_DW_GBTGB %~~% CWM_dbh, log_DW_BMD %~~% log_DW_div_tot, log_DW_BMD %~~% log_FDis_statut, log_DW_BMD %~~% CWM_dbh, log_DW_div_tot %~~% log_CWM_stade_saprox, log_DW_div_tot %~~% CWM_dbh, log_DW_div_tot %~~% FDis_dbh, log_DW_div_tot %~~% FDis_stade_saprox, log_FDis_statut %~~% FDis_stade_saprox, log_CWM_stade_saprox %~~% CWM_dbh, log_DW_div_tot %~~% log_DW_dec34, log_DW_GBTGB %~~% log_DW_PBBM, log_FDis_statut %~~% log_DW_PBBM, FDis_stade_saprox %~~% log_DW_PBBM, log_FDis_statut %~~% log_DW_BMS, FDis_ONTO %~~% FRic_TreMs, FDis_ONTO %~~% FDis_DW_type_substrate, nb_TGB_All_sub %~~% log_LW_vol,
                   
                   FDis_ONTO %~~% log_TreMs_div, FDis_ONTO %~~% FEve_TreMs, FDis_ONTO %~~% CWM_POS, FDis_ONTO %~~% FDis_POS, FDis_ONTO %~~% CWM_LIFE, FDis_ONTO %~~% CWM_ONTO, FDis_ONTO %~~% CWM_DW_saproxylic, log_TreMs_div %~~% FRic_TreMs, log_TreMs_div %~~% FDis_DW_type_substrate, log_TreMs_div %~~% CWM_POS, log_TreMs_div %~~% CWM_LIFE, FRic_TreMs %~~% FDis_DW_type_substrate, FRic_TreMs %~~% CWM_POS, FEve_TreMs %~~% FDis_POS, CWM_DW_type_substrate %~~% FDis_DW_type_substrate, CWM_POS %~~% FDis_POS, CWM_POS %~~% CWM_LIFE, CWM_POS %~~% CWM_ONTO, CWM_POS %~~% CWM_DW_saproxylic, CWM_LIFE %~~% CWM_ONTO, CWM_LIFE %~~% CWM_DW_saproxylic, CWM_ONTO %~~% CWM_DW_saproxylic, FDis_dbh %~~% log_DW_dec34, log_DW_dec34 %~~% FDis_stade_saprox, log_DW_PBBM %~~% log_DW_BMS, CWM_statut %~~% log_FDis_statut, CWM_LIFE %~~% FDis_POS, FDis_dbh %~~% FDis_stade_saprox, log_TreMs_div %~~% CWM_DW_type_substrate, log_TreMs_div %~~% FDis_POS, log_TreMs_div %~~% CWM_ONTO, log_TreMs_div %~~% CWM_DW_saproxylic, log_TreMs_div %~~% FEve_TreMs, FRic_TreMs %~~% CWM_LIFE, FDis_DW_type_substrate %~~% CWM_LIFE, FDis_DW_type_substrate %~~% CWM_ONTO, FDis_DW_type_substrate %~~% CWM_DW_saproxylic, FDis_DW_type_substrate %~~% FEve_TreMs, FDis_POS %~~% CWM_DW_saproxylic, CWM_LIFE %~~% FEve_TreMs, CWM_ONTO %~~% FEve_TreMs)
summary(SEM_CVL_2, conserve = T, standardize = "none")
dSep_SEM_CVL_2 = dSep(SEM_CVL_2, conserve = T)
fisherC(dSep_SEM_CVL_2)

sink(file='SEM_CVL_stand_coef.txt')
coefs(SEM_CVL_2, standardize = "scale", standardize.type = "Menard.OE")
sink()

plot(SEM_CVL)

```






###SEM Bavaria


####mod_DW
```{r SEM Bavaria}

Data_univar_CWM_Bav_SEM = Data_univar_CWM %>%
  filter(Region %in% "Bavaria") %>%
  dplyr::rename("FRic_DW" = "FRic", "FDiv_DW" = "FDiv", "FEve_DW" = "FEve", "FDis_DW" = "FDis")


#LW_vol
mod_Bav_LW_vol_level_depe_G = lm(LW_vol ~ level_depe_G, data = Data_univar_CWM_Bav_SEM)
summary(mod_Bav_LW_vol_level_depe_G)
res = simulateResiduals(mod_Bav_LW_vol_level_depe_G)
plot(res, rank = T)


#DW_vol
mod_Bav_DW_vol_level_depe_G = lm(DW_vol ~ level_depe_G, data = Data_univar_CWM_Bav_SEM)
summary(mod_Bav_DW_vol_level_depe_G)
res = simulateResiduals(mod_Bav_DW_vol_level_depe_G)
plot(res, rank = T)


#DW_dec12
mod_Bav_DW_dec12_level_depe_G = lm(DW_dec12 ~ level_depe_G, data = Data_univar_CWM_Bav_SEM)
summary(mod_Bav_DW_dec12_level_depe_G)
res = simulateResiduals(mod_Bav_DW_dec12_level_depe_G)
plot(res, rank = T)


#DW_dec34
mod_Bav_DW_dec34_level_depe_G = lm(DW_dec34 ~ level_depe_G, data = Data_univar_CWM_Bav_SEM)
summary(mod_Bav_DW_dec34_level_depe_G)
res = simulateResiduals(mod_Bav_DW_dec34_level_depe_G)
plot(res, rank = T)


#DW_PBBM
mod_Bav_DW_PBBM_level_depe_G = lm(log1p(DW_PBBM) ~ level_depe_G, data = Data_univar_CWM_Bav_SEM)
summary(mod_Bav_DW_PBBM_level_depe_G)
res = simulateResiduals(mod_Bav_DW_PBBM_level_depe_G)
plot(res, rank = T)


#DW_GBTGB
mod_Bav_DW_GBTGB_level_depe_G = lm(DW_GBTGB ~ level_depe_G, data = Data_univar_CWM_Bav_SEM)
summary(mod_Bav_DW_GBTGB_level_depe_G)
res = simulateResiduals(mod_Bav_DW_GBTGB_level_depe_G)
plot(res, rank = T)


#DW_BMS
mod_Bav_DW_BMS_level_depe_G = lm(DW_BMS ~ level_depe_G, data = Data_univar_CWM_Bav_SEM)
summary(mod_Bav_DW_BMS_level_depe_G)
res = simulateResiduals(mod_Bav_DW_BMS_level_depe_G)
plot(res, rank = T)


#DW_BMD
mod_Bav_DW_BMD_level_depe_G = lm(DW_BMD ~ level_depe_G, data = Data_univar_CWM_Bav_SEM)
summary(mod_Bav_DW_BMD_level_depe_G)
res = simulateResiduals(mod_Bav_DW_BMD_level_depe_G)
plot(res, rank = T)


#DW_div_tot
mod_Bav_DW_div_tot_level_depe_G = lm(log1p(DW_div_tot) ~ level_depe_G, data = Data_univar_CWM_Bav_SEM)
summary(mod_Bav_DW_div_tot_level_depe_G)
res = simulateResiduals(mod_Bav_DW_div_tot_level_depe_G)
plot(res, rank = T)


#FRic_DW
mod_Bav_FRic_level_depe_G = lm(FRic_DW ~ level_depe_G, data = Data_univar_CWM_Bav_SEM)
summary(mod_Bav_FRic_level_depe_G)
res = simulateResiduals(mod_Bav_FRic_level_depe_G)
plot(res, rank = T)


#FDiv_DW
mod_Bav_FDiv_level_depe_G = lm(FDiv_DW ~ level_depe_G, data = Data_univar_CWM_Bav_SEM)
summary(mod_Bav_FDiv_level_depe_G)
res = simulateResiduals(mod_Bav_FDiv_level_depe_G)
plot(res, rank = T)


#FEve_DW
mod_Bav_FEve_level_depe_G = lm(FEve_DW ~ level_depe_G, data = Data_univar_CWM_Bav_SEM)
summary(mod_Bav_FEve_level_depe_G)
res = simulateResiduals(mod_Bav_FEve_level_depe_G)
plot(res, rank = T)


#FDis_DW
mod_Bav_FDis_level_depe_G = lm(FDis_DW ~ level_depe_G, data = Data_univar_CWM_Bav_SEM)
summary(mod_Bav_FDis_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_level_depe_G)
plot(res, rank = T)


#CWM_statut
mod_Bav_CWM_statut_level_depe_G = lm(CWM_statut ~ level_depe_G, data = Data_univar_CWM_Bav_SEM)
summary(mod_Bav_CWM_statut_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_statut_level_depe_G)
plot(res, rank = T)


#FDis_statut
mod_Bav_FDis_statut_level_depe_G = lm(log1p(FDis_statut) ~ level_depe_G, data = Data_univar_CWM_Bav_SEM)
summary(mod_Bav_FDis_statut_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_statut_level_depe_G)
plot(res, rank = T)


#CWM_stade_saprox
mod_Bav_CWM_stade_saprox_level_depe_G = lm(CWM_stade_saprox ~ level_depe_G, data = Data_univar_CWM_Bav_SEM)
summary(mod_Bav_CWM_stade_saprox_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_stade_saprox_level_depe_G)
plot(res, rank = T)


#FDis_stade_saprox
mod_Bav_FDis_stade_saprox_level_depe_G = lm(FDis_stade_saprox ~ level_depe_G, data = Data_univar_CWM_Bav_SEM)
summary(mod_Bav_FDis_stade_saprox_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_stade_saprox_level_depe_G)
plot(res, rank = T)


#CWM_dbh
mod_Bav_CWM_dbh_level_depe_G = lm(CWM_dbh ~ level_depe_G, data = Data_univar_CWM_Bav_SEM)
summary(mod_Bav_CWM_dbh_level_depe_G)
res = simulateResiduals(mod_Bav_CWM_dbh_level_depe_G)
plot(res, rank = T)


#FDis_dbh
mod_Bav_FDis_dbh_level_depe_G = lm(FDis_dbh ~ level_depe_G, data = Data_univar_CWM_Bav_SEM)
summary(mod_Bav_FDis_dbh_level_depe_G)
res = simulateResiduals(mod_Bav_FDis_dbh_level_depe_G)
plot(res, rank = T)

```
####


####mod_TreMs
```{r mod_TreMs}

Data_univar_CWM_TreMs_Bav_SEM = Data_univar_CWM_TreMs_All %>%
  filter(Region %in% "Bavaria") %>%
  dplyr::rename("FRic_TreMs" = "FRic", "FDiv_TreMs" = "FDiv", "FEve_TreMs" = "FEve", "FDis_TreMs" = "FDis") %>%
  dplyr::select(-"Region",-"site",-"alt",-"lat",-"lon",-"cat_depe",-"salvaged",-"cat_depe01",-"level_depe_G",-"class_depe_G", -"LW_nb")


Data_univar_SEM_Bav =  Data_univar_CWM_Bav_SEM %>%
  left_join(Data_univar_CWM_TreMs_Bav_SEM, by = c("plot", "level.depe")) %>%
  mutate(log_DW_PBBM = log1p(DW_PBBM), log_DW_div_tot = log1p(DW_div_tot), log_FDis_statut = log1p(FDis_statut), log_CWM_stade_saprox = log1p(CWM_stade_saprox),
         log_TreMs_ab = log1p(TreMs_ab), log_TreMs_div = log1p(TreMs_div), log_Exposed_sapwood_only = log1p(Exposed_sapwood_only), log_Epiphytic = log1p(Epiphytic), log_Exposed_sapwood_and_heartwood = log1p(Exposed_sapwood_and_heartwood), log_Concavities = log1p(Concavities), log_Perennial_fungi_fruiting_bodies = log1p(Perennial_fungi_fruiting_bodies), log_Twig_tangles = log1p(Twig_tangles), log_Crown_deadwood = log1p(Crown_deadwood), log_Rot_holes = log1p(Rot_holes), log_Burrs_and_cankers = log1p(Burrs_and_cankers), log_Ephemeral_fungal_fruiting_bodies = log1p(Ephemeral_fungal_fruiting_bodies), log_FDis_DW_type_substrate = log1p(FDis_DW_type_substrate))



# level_depe_G + LW_vol + DW_dec12 + DW_dec34 + log_DW_PBBM + DW_GBTGB + DW_BMS + DW_BMD + log_DW_div_tot + CWM_statut + log_FDis_statut + log_CWM_stade_saprox + FDis_stade_saprox + CWM_dbh + FDis_dbh + nb_TGB_All_sub


#TreMs_ab
mod_Bav_TreMs_ab_level.depe = lm(log1p(TreMs_ab) ~ level_depe_G, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_TreMs_ab_level.depe)
summary(mod_Bav_TreMs_ab_level.depe)

mod_Bav_TreMs_ab_level.depe_dredge = dredge(mod_Bav_TreMs_ab_level.depe)
head(mod_Bav_TreMs_ab_level.depe_dredge)
res = simulateResiduals(mod_Bav_TreMs_ab_level.depe)
plot(res, rank = T)


#TreMs_div
mod_Bav_TreMs_div_level.depe = lm(log1p(TreMs_div) ~ level_depe_G, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_TreMs_div_level.depe)
summary(mod_Bav_TreMs_div_level.depe)

mod_Bav_TreMs_div_level.depe_dredge = dredge(mod_Bav_TreMs_div_level.depe)
head(mod_Bav_TreMs_div_level.depe_dredge)
res = simulateResiduals(mod_Bav_TreMs_div_level.depe)
plot(res, rank = T)


#Exposed_sapwood_only
mod_Bav_Exposed_sapwood_only_level.depe = lm(log1p(Exposed_sapwood_only) ~ log_DW_PBBM, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_Exposed_sapwood_only_level.depe)
summary(mod_Bav_Exposed_sapwood_only_level.depe)

mod_Bav_Exposed_sapwood_only_level.depe_dredge = dredge(mod_Bav_Exposed_sapwood_only_level.depe)
head(mod_Bav_Exposed_sapwood_only_level.depe_dredge)
res = simulateResiduals(mod_Bav_Exposed_sapwood_only_level.depe)
plot(res, rank = T)


#Epiphytic
mod_Bav_Epiphytic_level.depe = lm(log1p(Epiphytic) ~ level.depe + CWM_dbh, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_Epiphytic_level.depe)
summary(mod_Bav_Epiphytic_level.depe)

mod_Bav_Epiphytic_level.depe_dredge = dredge(mod_Bav_Epiphytic_level.depe)
head(mod_Bav_Epiphytic_level.depe_dredge)
res = simulateResiduals(mod_Bav_Epiphytic_level.depe)
plot(res, rank = T)


#Exposed_sapwood_and_heartwood
mod_Bav_Exposed_sapwood_and_heartwood_level.depe = lm(log1p(Exposed_sapwood_and_heartwood) ~ log_CWM_stade_saprox, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_Exposed_sapwood_and_heartwood_level.depe)
summary(mod_Bav_Exposed_sapwood_and_heartwood_level.depe)

mod_Bav_Exposed_sapwood_and_heartwood_level.depe_dredge = dredge(mod_Bav_Exposed_sapwood_and_heartwood_level.depe)
head(mod_Bav_Exposed_sapwood_and_heartwood_level.depe_dredge)
res = simulateResiduals(mod_Bav_Exposed_sapwood_and_heartwood_level.depe)
plot(res, rank = T)


#Concavities
mod_Bav_Concavities_level.depe = lm(log1p(Concavities) ~ LW_vol + log_DW_PBBM, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_Concavities_level.depe)
summary(mod_Bav_Concavities_level.depe)

mod_Bav_Concavities_level.depe_dredge = dredge(mod_Bav_Concavities_level.depe)
head(mod_Bav_Concavities_level.depe_dredge)
res = simulateResiduals(mod_Bav_Concavities_level.depe)
plot(res, rank = T)


#Perennial_fungi_fruiting_bodies
mod_Bav_Perennial_fungi_fruiting_bodies_level.depe = lm(log1p(Perennial_fungi_fruiting_bodies) ~ log_DW_PBBM, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_Perennial_fungi_fruiting_bodies_level.depe)
summary(mod_Bav_Perennial_fungi_fruiting_bodies_level.depe)

mod_Bav_Perennial_fungi_fruiting_bodies_level.depe_dredge = dredge(mod_Bav_Perennial_fungi_fruiting_bodies_level.depe)
head(mod_Bav_Perennial_fungi_fruiting_bodies_level.depe_dredge)
res = simulateResiduals(mod_Bav_Perennial_fungi_fruiting_bodies_level.depe)
plot(res, rank = T)


#Twig_tangles
mod_Bav_Twig_tangles_level.depe = lm(log1p(Twig_tangles) ~ level.depe + log_CWM_stade_saprox, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_Twig_tangles_level.depe)
summary(mod_Bav_Twig_tangles_level.depe)

mod_Bav_Twig_tangles_level.depe_dredge = dredge(mod_Bav_Twig_tangles_level.depe)
head(mod_Bav_Twig_tangles_level.depe_dredge)
res = simulateResiduals(mod_Bav_Twig_tangles_level.depe)
plot(res, rank = T)


#Crown_deadwood
mod_Bav_Crown_deadwood_level.depe = lm(log1p(Crown_deadwood) ~ LW_vol, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_Crown_deadwood_level.depe)
summary(mod_Bav_Crown_deadwood_level.depe)

mod_Bav_Crown_deadwood_level.depe_dredge = dredge(mod_Bav_Crown_deadwood_level.depe)
head(mod_Bav_Crown_deadwood_level.depe_dredge)
res = simulateResiduals(mod_Bav_Crown_deadwood_level.depe)
plot(res, rank = T)


#Rot_holes
mod_Bav_Rot_holes_level.depe = lm(log1p(Rot_holes) ~ level.depe, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_Rot_holes_level.depe)
summary(mod_Bav_Rot_holes_level.depe)

mod_Bav_Rot_holes_level.depe_dredge = dredge(mod_Bav_Rot_holes_level.depe)
head(mod_Bav_Rot_holes_level.depe_dredge)
res = simulateResiduals(mod_Bav_Rot_holes_level.depe)
plot(res, rank = T)


#Burrs_and_cankers
mod_Bav_Burrs_and_cankers_level.depe = lm(log1p(Burrs_and_cankers) ~ DW_BMD + log_CWM_stade_saprox, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_Burrs_and_cankers_level.depe)
summary(mod_Bav_Burrs_and_cankers_level.depe)

mod_Bav_Burrs_and_cankers_level.depe_dredge = dredge(mod_Bav_Burrs_and_cankers_level.depe)
head(mod_Bav_Burrs_and_cankers_level.depe_dredge)
res = simulateResiduals(mod_Bav_Burrs_and_cankers_level.depe)
plot(res, rank = T)


# #Exudates
# mod_Bav_Exudates_level.depe = lm(log1p(Exudates) ~ level.depe, data = Data_univar_SEM_Bav)
# summary(mod_Bav_Exudates_level.depe)
# res = simulateResiduals(mod_Bav_Exudates_level.depe)
# plot(res, rank = T)


# #Wood_pecker_breeding_cavities
# mod_Bav_Wood_pecker_breeding_cavities_level.depe = lm(log1p(Wood_pecker_breeding_cavities) ~ level.depe, data = Data_univar_SEM_Bav)
# summary(mod_Bav_Wood_pecker_breeding_cavities_level.depe)
# res = simulateResiduals(mod_Bav_Wood_pecker_breeding_cavities_level.depe)
# plot(res, rank = T)


#Ephemeral_fungal_fruiting_bodies
mod_Bav_Ephemeral_fungal_fruiting_bodies_level.depe = lm(log1p(Ephemeral_fungal_fruiting_bodies) ~ DW_BMD + DW_BMS + DW_GBTGB, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_Ephemeral_fungal_fruiting_bodies_level.depe)
summary(mod_Bav_Ephemeral_fungal_fruiting_bodies_level.depe)

mod_Bav_Ephemeral_fungal_fruiting_bodies_level.depe_dredge = dredge(mod_Bav_Ephemeral_fungal_fruiting_bodies_level.depe)
head(mod_Bav_Ephemeral_fungal_fruiting_bodies_level.depe_dredge)
res = simulateResiduals(mod_Bav_Ephemeral_fungal_fruiting_bodies_level.depe)
plot(res, rank = T)


# #Rootplate
# mod_Bav_Rootplate_level.depe = lm(log1p(Rootplate) ~ level.depe, data = Data_univar_SEM_Bav)
# summary(mod_Bav_Rootplate_level.depe)
# res = simulateResiduals(mod_Bav_Rootplate_level.depe)
# plot(res, rank = T)


# #Nest
# mod_Bav_Nest_level.depe = lm(log1p(Nest) ~ level.depe, data = Data_univar_SEM_Bav)
# summary(mod_Bav_Nest_level.depe)
# res = simulateResiduals(mod_Bav_Nest_level.depe)
# plot(res, rank = T)


#FRic_TreMs
mod_Bav_FRic_TreMs_level.depe = lm(FRic_TreMs ~ level_depe_G, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_FRic_TreMs_level.depe)
summary(mod_Bav_FRic_TreMs_level.depe)

mod_Bav_FRic_TreMs_level.depe_dredge = dredge(mod_Bav_FRic_TreMs_level.depe)
head(mod_Bav_FRic_TreMs_level.depe_dredge)
res = simulateResiduals(mod_Bav_FRic_TreMs_level.depe)
plot(res, rank = T)


#FDiv_TreMs
mod_Bav_FDiv_TreMs_level.depe = lm(FDiv_TreMs ~ level_depe_G, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_FDiv_TreMs_level.depe)
summary(mod_Bav_FDiv_TreMs_level.depe)

mod_Bav_FDiv_TreMs_level.depe_dredge = dredge(mod_Bav_FDiv_TreMs_level.depe)
head(mod_Bav_FDiv_TreMs_level.depe_dredge)
res = simulateResiduals(mod_Bav_FDiv_TreMs_level.depe)
plot(res, rank = T)


#FEve_TreMs
mod_Bav_FEve_TreMs_level.depe = lm(FEve_TreMs ~ 1, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_FEve_TreMs_level.depe)
summary(mod_Bav_FEve_TreMs_level.depe)

mod_Bav_FEve_TreMs_level.depe_dredge = dredge(mod_Bav_FEve_TreMs_level.depe)
head(mod_Bav_FEve_TreMs_level.depe_dredge)
res = simulateResiduals(mod_Bav_FEve_TreMs_level.depe)
plot(res, rank = T)


#FDis_TreMs
mod_Bav_FDis_TreMs_level.depe = lm(FDis_TreMs ~ level.depe, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_FDis_TreMs_level.depe)
summary(mod_Bav_FDis_TreMs_level.depe)

mod_Bav_FDis_TreMs_level.depe_dredge = dredge(mod_Bav_FDis_TreMs_level.depe)
head(mod_Bav_FDis_TreMs_level.depe_dredge)
res = simulateResiduals(mod_Bav_FDis_TreMs_level.depe)
plot(res, rank = T)


#CWM_DW_type_substrate
mod_Bav_CWM_DW_type_substrate_level.depe = lm(CWM_DW_type_substrate ~ CWM_statut, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_CWM_DW_type_substrate_level.depe)
summary(mod_Bav_CWM_DW_type_substrate_level.depe)

mod_Bav_CWM_DW_type_substrate_level.depe_dredge = dredge(mod_Bav_CWM_DW_type_substrate_level.depe)
head(mod_Bav_CWM_DW_type_substrate_level.depe_dredge)
res = simulateResiduals(mod_Bav_CWM_DW_type_substrate_level.depe)
plot(res, rank = T)


#FDis_DW_type_substrate
mod_Bav_FDis_DW_type_substrate_level.depe = lm(log1p(FDis_DW_type_substrate) ~ level_depe_G, data = Data_univar_SEM_Bav)
check_collinearity(mod_Bav_FDis_DW_type_substrate_level.depe)
summary(mod_Bav_FDis_DW_type_substrate_level.depe)

mod_Bav_FDis_DW_type_substrate_level.depe_dredge = dredge(mod_Bav_FDis_DW_type_substrate_level.depe)
head(mod_Bav_FDis_DW_type_substrate_level.depe_dredge)
res = simulateResiduals(mod_Bav_FDis_DW_type_substrate_level.depe)
plot(res, rank = T)


#CWM_POS
mod_Bav_CWM_POS_level.depe = lm(CWM_POS ~ level_depe_G, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_CWM_POS_level.depe)
summary(mod_Bav_CWM_POS_level.depe)

mod_Bav_CWM_POS_level.depe_dredge = dredge(mod_Bav_CWM_POS_level.depe)
head(mod_Bav_CWM_POS_level.depe_dredge)
res = simulateResiduals(mod_Bav_CWM_POS_level.depe)
plot(res, rank = T)


#FDis_POS
mod_Bav_FDis_POS_level.depe = lm(FDis_POS ~ LW_vol, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_FDis_POS_level.depe)
summary(mod_Bav_FDis_POS_level.depe)

mod_Bav_FDis_POS_level.depe_dredge = dredge(mod_Bav_FDis_POS_level.depe)
head(mod_Bav_FDis_POS_level.depe_dredge)
res = simulateResiduals(mod_Bav_FDis_POS_level.depe)
plot(res, rank = T)


#CWM_HUM_dry_wet
mod_Bav_CWM_HUM_dry_wet_level.depe = lm(CWM_HUM_dry_wet ~ level_depe_G, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_CWM_HUM_dry_wet_level.depe)
summary(mod_Bav_CWM_HUM_dry_wet_level.depe)

mod_Bav_CWM_HUM_dry_wet_level.depe_dredge = dredge(mod_Bav_CWM_HUM_dry_wet_level.depe)
head(mod_Bav_CWM_HUM_dry_wet_level.depe_dredge)
res = simulateResiduals(mod_Bav_CWM_HUM_dry_wet_level.depe)
plot(res, rank = T)


#FDis_HUM_dry_wet
mod_Bav_FDis_HUM_dry_wet_level.depe = lm(FDis_HUM_dry_wet ~ DW_GBTGB + CWM_statut, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_FDis_HUM_dry_wet_level.depe)
summary(mod_Bav_FDis_HUM_dry_wet_level.depe)

mod_Bav_FDis_HUM_dry_wet_level.depe_dredge = dredge(mod_Bav_FDis_HUM_dry_wet_level.depe)
head(mod_Bav_FDis_HUM_dry_wet_level.depe_dredge)
res = simulateResiduals(mod_Bav_FDis_HUM_dry_wet_level.depe)
plot(res, rank = T)


#CWM_LIFE
mod_Bav_CWM_LIFE_level.depe = lm(CWM_LIFE ~ level_depe_G, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_CWM_LIFE_level.depe)
summary(mod_Bav_CWM_LIFE_level.depe)

mod_Bav_CWM_LIFE_level.depe_dredge = dredge(mod_Bav_CWM_LIFE_level.depe)
head(mod_Bav_CWM_LIFE_level.depe_dredge)
res = simulateResiduals(mod_Bav_CWM_LIFE_level.depe)
plot(res, rank = T)


#FDis_LIFE
mod_Bav_FDis_LIFE_level.depe = lm(FDis_LIFE ~ level_depe_G, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_FDis_LIFE_level.depe)
summary(mod_Bav_FDis_LIFE_level.depe)

mod_Bav_FDis_LIFE_level.depe_dredge = dredge(mod_Bav_FDis_LIFE_level.depe)
head(mod_Bav_FDis_LIFE_level.depe_dredge)
res = simulateResiduals(mod_Bav_FDis_LIFE_level.depe)
plot(res, rank = T)

#CWM_ONTO
mod_Bav_CWM_ONTO_level.depe = lm(CWM_ONTO ~ log_DW_div_tot, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_CWM_ONTO_level.depe)
summary(mod_Bav_CWM_ONTO_level.depe)

mod_Bav_CWM_ONTO_level.depe_dredge = dredge(mod_Bav_CWM_ONTO_level.depe)
head(mod_Bav_CWM_ONTO_level.depe_dredge)
res = simulateResiduals(mod_Bav_CWM_ONTO_level.depe)
plot(res, rank = T)


#FDis_ONTO
mod_Bav_FDis_ONTO_level.depe = lm(FDis_ONTO ~ level_depe_G, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_FDis_ONTO_level.depe)
summary(mod_Bav_FDis_ONTO_level.depe)

mod_Bav_FDis_ONTO_level.depe_dredge = dredge(mod_Bav_FDis_ONTO_level.depe)
head(mod_Bav_FDis_ONTO_level.depe_dredge)
res = simulateResiduals(mod_Bav_FDis_ONTO_level.depe)
plot(res, rank = T)


#CWM_DW_saproxylic
mod_Bav_CWM_DW_saproxylic_level.depe = lm(CWM_DW_saproxylic ~ level_depe_G, data = Data_univar_SEM_Bav, na.action = "na.fail")
check_collinearity(mod_Bav_CWM_DW_saproxylic_level.depe)
summary(mod_Bav_CWM_DW_saproxylic_level.depe)

mod_Bav_CWM_DW_saproxylic_level.depe_dredge = dredge(mod_Bav_CWM_DW_saproxylic_level.depe)
head(mod_Bav_CWM_DW_saproxylic_level.depe_dredge)
res = simulateResiduals(mod_Bav_CWM_DW_saproxylic_level.depe)
plot(res, rank = T)


```
####



####SEM Bavaria

```{r}

Data_univar_SEM_Bav = as.data.frame(Data_univar_SEM_Bav)

options(max.print=9000)


SEM_Bav = psem(lm(LW_vol ~ level_depe_G, data = Data_univar_SEM_Bav),
               lm(DW_vol ~ level_depe_G, data = Data_univar_SEM_Bav),
               lm(DW_dec12 ~ level_depe_G, data = Data_univar_SEM_Bav),
               lm(DW_dec34 ~ level_depe_G, data = Data_univar_SEM_Bav),
               lm(log_DW_PBBM ~ level_depe_G, data = Data_univar_SEM_Bav),
               lm(DW_GBTGB ~ level_depe_G, data = Data_univar_SEM_Bav),
               lm(DW_BMS ~ level_depe_G, data = Data_univar_SEM_Bav),
               lm(DW_BMD ~ level_depe_G, data = Data_univar_SEM_Bav),
               lm(log_DW_div_tot ~ level_depe_G, data = Data_univar_SEM_Bav),
               lm(FRic_DW ~ level_depe_G, data = Data_univar_SEM_Bav),
               lm(FDiv_DW ~ level_depe_G, data = Data_univar_SEM_Bav),
               lm(FEve_DW ~ level_depe_G, data = Data_univar_SEM_Bav),
               lm(FDis_DW ~ level_depe_G, data = Data_univar_SEM_Bav),
               lm(CWM_statut ~ level_depe_G, data = Data_univar_SEM_Bav),
               lm(log_FDis_statut ~ level_depe_G, data = Data_univar_SEM_Bav),
               lm(log_CWM_stade_saprox ~ level_depe_G, data = filter(Data_univar_SEM_Bav, CWM_dbh > 0)),
               lm(FDis_stade_saprox ~ level_depe_G, data = filter(Data_univar_SEM_Bav, CWM_dbh > 0)),
               lm(CWM_dbh ~ level_depe_G, data = filter(Data_univar_SEM_Bav, CWM_dbh > 0)),
               lm(FDis_dbh ~ level_depe_G, data = filter(Data_univar_SEM_Bav, CWM_dbh > 0)),
               lm(nb_TGB_All_sub ~ level_depe_G, data = Data_univar_SEM_Bav),
               
               
               lm(log_TreMs_ab ~ level_depe_G + log_DW_PBBM + DW_BMD, data = Data_univar_SEM_Bav),
               lm(log_TreMs_div ~ LW_vol + log_DW_div_tot, data = Data_univar_SEM_Bav),
               lm(FRic_TreMs ~ level_depe_G + log_DW_div_tot, data = Data_univar_SEM_Bav),
               lm(FDiv_TreMs ~ level_depe_G, data = Data_univar_SEM_Bav),
               lm(FEve_TreMs ~ log_FDis_statut, data = Data_univar_SEM_Bav),
               lm(FDis_TreMs ~ log_DW_div_tot + CWM_dbh, data = Data_univar_SEM_Bav),
               lm(CWM_DW_type_substrate ~ CWM_statut, data = Data_univar_SEM_Bav),
               lm(log_FDis_DW_type_substrate ~ log_DW_div_tot, data = Data_univar_SEM_Bav),
               lm(CWM_POS ~ log_DW_div_tot + FDis_dbh, data = Data_univar_SEM_Bav),
               lm(FDis_POS ~ LW_vol + FDis_dbh, data = Data_univar_SEM_Bav),
               lm(CWM_HUM_dry_wet ~ level_depe_G, data = Data_univar_SEM_Bav),
               lm(FDis_HUM_dry_wet ~ DW_GBTGB + CWM_statut, data = Data_univar_SEM_Bav),
               lm(CWM_LIFE ~ DW_GBTGB, data = Data_univar_SEM_Bav),
               lm(FDis_LIFE ~ DW_vol, data = Data_univar_SEM_Bav),
               lm(CWM_ONTO ~ log_DW_div_tot, data = Data_univar_SEM_Bav),
               lm(FDis_ONTO ~ level_depe_G, data = Data_univar_SEM_Bav),
               lm(CWM_DW_saproxylic ~ CWM_statut, data = Data_univar_SEM_Bav),
               data = Data_univar_SEM_Bav)
sink(file='SEM_Bav.txt')
summary(SEM_Bav, conserve = T, standardize = "none")
sink()

# dSep_SEM_Bav = dSep(SEM_Bav, conserve = T)
# fisherC(dSep_SEM_Bav)


SEM_Bav_2 = update(SEM_Bav, LW_vol %~~% log_DW_PBBM, LW_vol %~~% log_DW_div_tot, LW_vol %~~% FRic_DW, DW_vol %~~% DW_dec12, DW_vol %~~% DW_dec34, DW_vol %~~% DW_GBTGB, DW_vol %~~% DW_BMS, DW_vol %~~% DW_BMD, DW_dec12 %~~% log_CWM_stade_saprox, DW_dec12 %~~% FDis_stade_saprox, log_DW_PBBM %~~% DW_BMS, log_DW_PBBM %~~% log_DW_div_tot, log_DW_PBBM %~~% FRic_DW, log_DW_PBBM %~~% FDiv_DW, log_DW_PBBM %~~% FEve_DW, log_DW_PBBM %~~% log_FDis_statut, log_DW_PBBM %~~% FDis_dbh, DW_GBTGB %~~% DW_BMD, DW_GBTGB %~~% CWM_statut, DW_GBTGB %~~% CWM_dbh, DW_GBTGB %~~% FDis_dbh, DW_BMS %~~% CWM_statut, DW_BMS %~~% log_FDis_statut, DW_BMS %~~% FDis_stade_saprox, DW_BMD %~~% CWM_statut, log_DW_div_tot %~~% FRic_DW, log_DW_div_tot %~~% FEve_DW, log_DW_div_tot %~~% log_FDis_statut, FRic_DW %~~% log_FDis_statut, FDiv_DW %~~% FEve_DW, FEve_DW %~~% log_FDis_statut, CWM_dbh %~~% FDis_dbh,
                   
                   log_TreMs_div %~~% FRic_TreMs, log_TreMs_div %~~% FDiv_TreMs, log_TreMs_div %~~% log_FDis_DW_type_substrate, log_TreMs_div %~~% FDis_POS, log_TreMs_div %~~% FDis_LIFE, FRic_TreMs %~~% FDis_TreMs, FRic_TreMs %~~% log_FDis_DW_type_substrate, FRic_TreMs %~~% FDis_HUM_dry_wet, FRic_TreMs %~~% FDis_LIFE, FRic_TreMs %~~% CWM_ONTO, FRic_TreMs %~~% FDis_ONTO, FRic_TreMs %~~% CWM_DW_saproxylic, FEve_TreMs %~~% FDis_TreMs, FEve_TreMs %~~% CWM_ONTO, FEve_TreMs %~~% FDis_ONTO, FDis_TreMs %~~% log_FDis_DW_type_substrate, FDis_TreMs %~~% CWM_POS, FDis_TreMs %~~% FDis_POS, FDis_TreMs %~~% FDis_HUM_dry_wet, FDis_TreMs %~~% CWM_ONTO, FDis_TreMs %~~% FDis_ONTO, FDis_TreMs %~~% CWM_DW_saproxylic, CWM_DW_type_substrate %~~% CWM_LIFE, log_FDis_DW_type_substrate %~~% CWM_POS, log_FDis_DW_type_substrate %~~% FDis_HUM_dry_wet, log_FDis_DW_type_substrate %~~% CWM_ONTO, log_FDis_DW_type_substrate %~~% FDis_ONTO, log_FDis_DW_type_substrate %~~% CWM_DW_saproxylic, CWM_POS %~~% FDis_POS, CWM_POS %~~% CWM_ONTO, CWM_POS %~~% FDis_ONTO, CWM_POS %~~% CWM_DW_saproxylic, CWM_HUM_dry_wet %~~% FDis_HUM_dry_wet, CWM_HUM_dry_wet %~~% CWM_LIFE, CWM_HUM_dry_wet %~~% FDis_LIFE, CWM_HUM_dry_wet %~~% CWM_ONTO, CWM_HUM_dry_wet %~~% CWM_DW_saproxylic, FDis_HUM_dry_wet %~~% CWM_LIFE, FDis_HUM_dry_wet %~~% FDis_LIFE, FDis_HUM_dry_wet %~~% CWM_ONTO, FDis_HUM_dry_wet %~~% CWM_DW_saproxylic, CWM_LIFE %~~% FDis_LIFE, CWM_ONTO %~~% FDis_ONTO, CWM_ONTO %~~% CWM_DW_saproxylic, FDis_ONTO %~~% CWM_DW_saproxylic, CWM_HUM_dry_wet %~~% log_FDis_DW_type_substrate, CWM_HUM_dry_wet %~~% FRic_TreMs, CWM_LIFE %~~% CWM_ONTO, CWM_DW_type_substrate %~~% level_depe_G)
summary(SEM_Bav_2, conserve = T, standardize = "none")
dSep_SEM_Bav_2 = dSep(SEM_Bav_2, conserve = T)
fisherC(dSep_SEM_Bav_2)

sink(file='SEM_Bav_stand_coef.txt')
coefs(SEM_Bav_2, standardize = "scale", standardize.type = "Menard.OE")
sink()

plot(SEM_Bav)

```









#Fin